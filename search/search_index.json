{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Home","text":""},{"location":"#features","title":"Features","text":"<ul> <li>Automated: S0-S11 pipeline automation.</li> <li>Robust: Spinal cord specific processing.</li> <li>QC-First: Every step emits quality reports.</li> </ul>"},{"location":"#citation","title":"Citation","text":"<pre><code>@software{spineprep,\n  title = {SpinePrep: A Robust Preprocessing Pipeline for Spinal Cord fMRI},\n  author = {SpinePrep Team},\n  year = {2026},\n  url = {https://spineprep.org}\n}\n</code></pre>"},{"location":"DEVELOPMENT_WORKFLOW/","title":"SpinePrep Development Workflow","text":""},{"location":"DEVELOPMENT_WORKFLOW/#overview","title":"Overview","text":"<p>This document describes the integrated development cycle for SpinePrep. The workflow ensures code quality, correctness, and adherence to acceptance criteria through systematic testing and validation.</p>"},{"location":"DEVELOPMENT_WORKFLOW/#development-cycle","title":"Development Cycle","text":""},{"location":"DEVELOPMENT_WORKFLOW/#1-plan","title":"1. Plan","text":"<ul> <li>Define ticket in <code>private/ROADMAP.md</code> with:</li> <li>Subtasks (S{N}.k) - for documentation only</li> <li>Inputs/Outputs</li> <li>Acceptance criteria</li> <li>Testable commands</li> </ul> <p>Example: <pre><code>### BUILD-S3-T1: Dummy drop + func cord localization\n\nSubtask: S3.1, S3.2\n\nGoal:\n- Drop dummy volumes per policy, compute fast median reference...\n\nInputs:\n- `{OUT}/run_XX/runs/S1_input_verify/bids_inventory.json`\n- ...\n\nAcceptance (testable):\n- All acceptance commands exit with code 0.\n- Required artifacts present and validated...\n</code></pre></p>"},{"location":"DEVELOPMENT_WORKFLOW/#2-implement","title":"2. Implement","text":"<ul> <li>Code in <code>src/spineprep/S{N}_*.py</code></li> <li>Follow step contracts and QC requirements</li> <li>Ensure deterministic outputs</li> <li>Add proper error handling</li> </ul> <p>Key Principles: - Validity-first: Spinal cord measurement validity comes first - Determinism: Same inputs + policy \u2192 identical outputs - Fail fast: No silent downgrades, clear error messages</p>"},{"location":"DEVELOPMENT_WORKFLOW/#3-test","title":"3. Test","text":"<pre><code># Unit tests\npoetry run pytest tests/test_*.py -v\n\n# Smoke test for specific step\npython3 scripts/smoke_s{N}.py\n</code></pre> <p>Test Types: - Unit tests: Test individual functions and components - Smoke tests: Quick validation on minimal test data - Integration tests: Test step execution end-to-end</p>"},{"location":"DEVELOPMENT_WORKFLOW/#4-validate","title":"4. Validate","text":"<pre><code># Run on regression datasets (auto-creates wf_reg_XXX)\npython3 scripts/validate_regression.py --step S{N}_func_init_and_crop\n\n# Check QC outputs\npoetry run spineprep check S{N}_func_init_and_crop --dataset-key &lt;key&gt; --out &lt;out&gt;\n</code></pre> <p>Validation Process: - Runs step on all regression dataset keys - Automatically uses canonical workfolder naming (<code>wf_reg_XXX</code>) - Verifies QC outputs are generated - Checks QC JSON structure and required fields - Reports any failures</p>"},{"location":"DEVELOPMENT_WORKFLOW/#5-accept","title":"5. Accept","text":"<pre><code># Run acceptance tests (auto-creates wf_full_XXX)\npython3 scripts/acceptance_test.py --ticket BUILD-S{N}-T{i}\n\n# Verify acceptance criteria met\npython3 scripts/acceptance_test.py --ticket BUILD-S{N}-T{i} --step S{N}_func_init_and_crop\n</code></pre> <p>Acceptance Criteria: - Required artifacts exist - QC JSON is valid and contains required fields - All acceptance commands exit with code 0 - QC status is PASS or WARN (not FAIL) - Automatically uses canonical workfolder naming (<code>wf_full_XXX</code>)</p>"},{"location":"DEVELOPMENT_WORKFLOW/#quick-reference","title":"Quick Reference","text":""},{"location":"DEVELOPMENT_WORKFLOW/#run-a-step","title":"Run a step","text":"<pre><code>poetry run spineprep run S{N}_func_init_and_crop --dataset-key &lt;key&gt; --out &lt;out&gt;\n</code></pre>"},{"location":"DEVELOPMENT_WORKFLOW/#run-full-development-cycle","title":"Run full development cycle","text":"<pre><code>./scripts/dev_cycle_full.sh --step S{N}_func_init_and_crop\n</code></pre>"},{"location":"DEVELOPMENT_WORKFLOW/#individual-workflow-steps","title":"Individual workflow steps","text":"<pre><code># 1. Unit tests\npoetry run pytest tests/test_*.py -v\n\n# 2. Smoke test\npython3 scripts/smoke_s{N}.py\n\n# 3. Validation\npython3 scripts/validate_regression.py --step S{N}_func_init_and_crop\n\n# 4. Acceptance\npython3 scripts/acceptance_test.py --ticket BUILD-S{N}-T{i} --step S{N}_func_init_and_crop\n</code></pre>"},{"location":"DEVELOPMENT_WORKFLOW/#workflow-examples","title":"Workflow Examples","text":""},{"location":"DEVELOPMENT_WORKFLOW/#example-1-implementing-a-new-step-feature","title":"Example 1: Implementing a New Step Feature","text":"<ol> <li>Plan: Add ticket to ROADMAP with acceptance criteria</li> <li>Implement: Write code in step file</li> <li>Test:     <pre><code>poetry run pytest tests/test_s{N}_*.py -v\npython3 scripts/smoke_s{N}.py\n</code></pre></li> <li>Validate:    <pre><code>python3 scripts/validate_regression.py --step S{N}_func_init_and_crop\n</code></pre></li> <li>Accept: Verify acceptance criteria met</li> </ol>"},{"location":"DEVELOPMENT_WORKFLOW/#example-2-fixing-a-bug","title":"Example 2: Fixing a Bug","text":"<ol> <li>Plan: Document bug in ticket/issue</li> <li>Implement: Fix the bug</li> <li>Test: Run relevant unit tests</li> <li>Validate: Run on regression datasets to ensure no regressions</li> <li>Accept: Verify fix works and no new issues introduced</li> </ol>"},{"location":"DEVELOPMENT_WORKFLOW/#example-3-full-cycle-for-new-step","title":"Example 3: Full Cycle for New Step","text":"<pre><code># Run complete cycle\n./scripts/dev_cycle_full.sh --step S{N}_func_init_and_crop\n</code></pre> <p>This automatically runs: 1. Unit tests 2. Smoke test (if available) 3. Validation on regression datasets 4. Acceptance tests</p>"},{"location":"DEVELOPMENT_WORKFLOW/#qc-requirements","title":"QC Requirements","text":"<p>Every step must produce: - QC JSON: Machine-readable status (<code>{OUT}/logs/{STEP}/{DATASET_KEY}/qc_status.json</code>) - Reportlets: Human-readable figures (PNG files in <code>derivatives/spineprep/.../figures/</code>) - Artifacts: Required outputs as specified in ROADMAP</p>"},{"location":"DEVELOPMENT_WORKFLOW/#work-directory-naming","title":"Work Directory Naming","text":"<p>Work directories follow a canonical naming convention: - <code>wf_smoke_XXX</code>: Smoke tests (quick validation on minimal test data) - <code>wf_reg_XXX</code>: Regression validation (runs on regression dataset keys) - <code>wf_full_XXX</code>: Full runs (v1 validation datasets, acceptance tests)</p> <p>Scripts automatically use the next available number (e.g., <code>wf_full_001</code>, <code>wf_full_002</code>, etc.). You can override with <code>--out</code> if needed.</p> <p>To migrate existing directories to the new naming: <pre><code>python3 scripts/migrate_workfolders.py --dry-run  # Preview changes\npython3 scripts/migrate_workfolders.py            # Apply migration\n</code></pre></p>"},{"location":"DEVELOPMENT_WORKFLOW/#regression-datasets","title":"Regression Datasets","text":"<p>Regression testing uses dataset keys marked with <code>\"regression\"</code> in <code>intended_use</code>: - <code>reg_openneuro_ds005884_cospine_motor_subset</code> - <code>reg_openneuro_ds005883_cospine_pain_subset</code> - <code>reg_openneuro_ds004386_rest_subset</code> - <code>reg_openneuro_ds004616_handgrasp_subset</code> - <code>reg_internal_balgrist_motor_11_subset</code></p>"},{"location":"DEVELOPMENT_WORKFLOW/#troubleshooting","title":"Troubleshooting","text":""},{"location":"DEVELOPMENT_WORKFLOW/#tests-fail","title":"Tests Fail","text":"<ul> <li>Check error messages for specific failures</li> <li>Verify test data is available</li> <li>Check that dependencies are installed</li> </ul>"},{"location":"DEVELOPMENT_WORKFLOW/#validation-fails","title":"Validation Fails","text":"<ul> <li>Check QC JSON for specific error messages</li> <li>Verify regression datasets are accessible</li> <li>Check <code>config/datasets_local.yaml</code> is configured</li> </ul>"},{"location":"DEVELOPMENT_WORKFLOW/#acceptance-tests-fail","title":"Acceptance Tests Fail","text":"<ul> <li>Review ROADMAP acceptance criteria</li> <li>Verify all required artifacts are generated</li> <li>Check QC JSON structure matches schema</li> </ul>"},{"location":"DEVELOPMENT_WORKFLOW/#related-documentation","title":"Related Documentation","text":"<ul> <li><code>private/ROADMAP.md</code> - Implementation plan and tickets</li> <li><code>private/BLUEPRINT.md</code> - Scope and guarantees</li> <li><code>private/PILLAR.md</code> - Development principles</li> </ul>"},{"location":"contributing/","title":"Contributing","text":"<p>Coming soon.</p>"},{"location":"setup/","title":"Setup Guide","text":"<p>Instructions for installing SpinePrep.</p>"},{"location":"pipeline/overview/","title":"Pipeline Overview","text":"<p>Coming soon.</p>"},{"location":"reference/api/","title":"API Reference","text":"<p>::: spineprep</p>"},{"location":"reference/cli/","title":"CLI Reference","text":"<p>Coming soon.</p>"},{"location":"reference/config/","title":"Configuration","text":"<p>Coming soon.</p>"}]}