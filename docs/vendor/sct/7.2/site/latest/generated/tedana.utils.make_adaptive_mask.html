

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="readthedocs-addons-api-version" content="1"><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tedana.utils.make_adaptive_mask &mdash; tedana 25.1.1a3.dev2+ge0932906e documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css?v=ef81f6ce" />

  
    <link rel="shortcut icon" href="../_static/tedana_favicon.png"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=643184eb"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script src="https://cdn.rawgit.com/chrisfilo/zenodo.js/v0.1/zenodo.js"></script>
    <script src="../_static/js/theme.js"></script>
    <script src="../_static/js/versions.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="tedana.utils.threshold_map" href="tedana.utils.threshold_map.html" />
    <link rel="prev" title="tedana.utils.reshape_niimg" href="tedana.utils.reshape_niimg.html" /> 
<script async type="text/javascript" src="/_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="tedana" /><meta name="readthedocs-version-slug" content="latest" /><meta name="readthedocs-resolver-filename" content="/generated/tedana.utils.make_adaptive_mask.html" /><meta name="readthedocs-http-status" content="200" /></head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            tedana
          </a>
              <div class="switch-menus">
                <div class="version-switch"></div>
                <div class="language-switch"></div>
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../multi-echo.html">About multi-echo fMRI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Using tedana from the command line</a></li>
<li class="toctree-l1"><a class="reference internal" href="../approach.html">tedana’s denoising approach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../outputs.html">Outputs of tedana</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../building_decision_trees.html">Understanding and building a component selection process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Support and communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing to tedana</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roadmap.html">The tedana roadmap</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../api.html">API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../api.html#module-tedana.workflows"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tedana.workflows</span></code>: Common workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html#module-tedana.decay"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tedana.decay</span></code>: Modeling signal decay across echoes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html#module-tedana.combine"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tedana.combine</span></code>: Combining time series across echoes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html#module-tedana.decomposition"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tedana.decomposition</span></code>: Data decomposition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html#module-tedana.metrics"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tedana.metrics</span></code>: Computing TE-dependence metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html#module-tedana.selection"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tedana.selection</span></code>: Component selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html#module-tedana.gscontrol"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tedana.gscontrol</span></code>: Global signal control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html#module-tedana.io"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tedana.io</span></code>: Reading and writing data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html#module-tedana.reporting"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tedana.reporting</span></code>: Reporting functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html#module-tedana.stats"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tedana.stats</span></code>: Statistical functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html#module-tedana.bibtex"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tedana.bibtex</span></code>: Tools for working with BibTeX files</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../api.html#module-tedana.utils"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tedana.utils</span></code>: Utility functions</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="tedana.utils.andb.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tedana.utils</span></code>.andb</a></li>
<li class="toctree-l3"><a class="reference internal" href="tedana.utils.dice.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tedana.utils</span></code>.dice</a></li>
<li class="toctree-l3"><a class="reference internal" href="tedana.utils.get_spectrum.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tedana.utils</span></code>.get_spectrum</a></li>
<li class="toctree-l3"><a class="reference internal" href="tedana.utils.reshape_niimg.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tedana.utils</span></code>.reshape_niimg</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tedana.utils</span></code>.make_adaptive_mask</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tedana.utils.make_adaptive_mask"><code class="docutils literal notranslate"><span class="pre">make_adaptive_mask()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="tedana.utils.threshold_map.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tedana.utils</span></code>.threshold_map</a></li>
<li class="toctree-l3"><a class="reference internal" href="tedana.utils.unmask.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tedana.utils</span></code>.unmask</a></li>
<li class="toctree-l3"><a class="reference internal" href="tedana.utils.sec2millisec.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tedana.utils</span></code>.sec2millisec</a></li>
<li class="toctree-l3"><a class="reference internal" href="tedana.utils.millisec2sec.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tedana.utils</span></code>.millisec2sec</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../denoising.html">Denoising Data with Components</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/ME-ICA/tedana/releases">What's New</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">tedana</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../api.html">API</a></li>
      <li class="breadcrumb-item active"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tedana.utils</span></code>.make_adaptive_mask</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/generated/tedana.utils.make_adaptive_mask.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tedana-utils-make-adaptive-mask">
<h1><a class="reference internal" href="../api.html#module-tedana.utils" title="tedana.utils"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tedana.utils</span></code></a>.make_adaptive_mask<a class="headerlink" href="#tedana-utils-make-adaptive-mask" title="Link to this heading"></a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="tedana.utils.make_adaptive_mask">
<span class="sig-name descname"><span class="pre">make_adaptive_mask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_independent_echos</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">methods</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['dropout']</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/me-ica/tedana/blob/e093290/tedana/utils.py#L57"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tedana.utils.make_adaptive_mask" title="Link to this definition"></a></dt>
<dd><p>Make map of <cite>data</cite> specifying longest echo a voxel can be sampled with.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>(S x E x T) array_like</em>) – Multi-echo data array, where <cite>S</cite> is samples, <cite>E</cite> is echos, and <cite>T</cite> is time.</p></li>
<li><p><strong>mask</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a> or img_like) – Binary mask for voxels to consider in TE Dependent ANAlysis.
This must be provided, as the mask is used to identify exemplar voxels.
Without a mask limiting the voxels to consider,
the adaptive mask will generally select voxels outside the brain as exemplars.</p></li>
<li><p><strong>n_independent_echos</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>, optional) – Number of independent echoes to use in goodness of fit metrics (fstat).
Primarily used for EPTI acquisitions.
If None, number of echoes will be used. Default is None.</p></li>
<li><p><strong>threshold</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>, optional) – Minimum echo count to retain in the mask.
Default is 1, which is equivalent to not thresholding.</p></li>
<li><p><strong>methods</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.14)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code></a>, optional) – List of methods to use for adaptive mask generation. Default is [“dropout”].
Valid methods are “decay”, “dropout”, and “none”.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>mask</strong> ((S,) <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a>) – Boolean array of voxels that have sufficient signal in at least <code class="docutils literal notranslate"><span class="pre">threshold</span></code> echos.</p></li>
<li><p><strong>adaptive_mask</strong> ((S,) <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a>) – Valued array indicating the number of echos with sufficient signal in a given voxel.</p></li>
</ul>
</p>
</dd>
</dl>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>The adaptive mask can flag “bad” echoes via two methods: dropout and decay.
Either or both methods are applied to the mean magnitude across time for each voxel and echo.</p>
<p>Dropout</p>
<p>Remove voxels with relatively low mean magnitudes from the mask.</p>
<p>This method uses distributions of values across the mask.
Therefore, it is sensitive to the quality of the mask.
A bad mask may result in a bad adaptive mask.</p>
<p>This method is implemented as follows:</p>
<ol class="loweralpha simple">
<li><p>Calculate the 33rd percentile of values in the first echo,
based on voxel-wise mean over time.</p></li>
<li><p>Identify the voxel where the first echo’s mean value is equal to the 33rd percentile.
Basically, this identifies “exemplar” voxel reflecting the 33rd percentile.</p>
<ul class="simple">
<li><p>The 33rd percentile is arbitrary.</p></li>
<li><p>If more than one voxel has a value exactly equal to the 33rd percentile,
keep all of them.</p></li>
</ul>
</li>
<li><p>For the exemplar voxel from the first echo, calculate 1/3 of the mean value for each echo.</p>
<ul class="simple">
<li><p>This is the threshold for “good” data.</p></li>
<li><p>The 1/3 value is arbitrary.</p></li>
<li><p>If there was more than one exemplar voxel, retain the the highest value for each echo.</p></li>
</ul>
</li>
<li><p>For each voxel, identify the last echo with a mean value greater than the
corresponding echo’s threshold.</p>
<ul class="simple">
<li><p>Preceding echoes (including ones with mean values less than the threshold)
are considered “good” data. That means, if echoes 1-3 in a voxel are
[good, good, bad] the adaptive mask will assign a 2, and if they are
[good, bad, good], the adaptive mask will assign a 3.</p></li>
</ul>
</li>
</ol>
<p>Decay</p>
<p>Determine the echo at which the signal stops decreasing for each voxel.
If a voxel’s signal stops decreasing as echo time increases, then we can infer that the
voxel has either fully dephased (i.e., “bottomed out”) or been contaminated by noise.
This essentially identifies the last echo with “good” data.
For a scan that collects many echoes for T2* estimation or has a relatively short echo
spacing, it is possible that a later echo will have a higher value,
but the overall trend still shows a decay.
This method should not be used in those situations.</p>
<p>The element-wise minimum value between any selected methods is used to construct the adaptive
mask.</p>
</div>
</dd></dl>

<div class="clearer"></div></section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tedana.utils.reshape_niimg.html" class="btn btn-neutral float-left" title="tedana.utils.reshape_niimg" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tedana.utils.threshold_map.html" class="btn btn-neutral float-right" title="tedana.utils.threshold_map" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2025, tedana developers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>