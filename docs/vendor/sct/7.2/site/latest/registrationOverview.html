<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registration Overview &mdash; SimpleITK 2.4.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="_static/style.css" />

  
    <link rel="shortcut icon" href="_static/yellow_itk_icon.svg"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Common Conventions" href="conventions.html" />
    <link rel="prev" title="Fundamental Concepts" href="fundamentalConcepts.html" /> 
<script async type="text/javascript" src="/_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="simpleitk" /><meta name="readthedocs-version-slug" content="latest" /><meta name="readthedocs-resolver-filename" content="/registrationOverview.html" /><meta name="readthedocs-http-status" content="200" /></head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            SimpleITK
              <img src="_static/simpleitk_logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.4
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="gettingStarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="fundamentalConcepts.html">Fundamental Concepts</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Registration Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#actual-code">Actual Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#initialization-and-center-of-rotation">Initialization and Center of Rotation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">ImageRegistrationMethod</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#transform">Transform</a></li>
<li class="toctree-l3"><a class="reference internal" href="#similarity-metric">Similarity Metric</a></li>
<li class="toctree-l3"><a class="reference internal" href="#optimizer">Optimizer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interpolator">Interpolator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#features-of-interest">Features of Interest</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#transforms-and-image-spaces">Transforms and image spaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multi-resolution-framework">Multi Resolution Framework</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sampling">Sampling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#scaling-in-parameter-space">Scaling in Parameter Space</a></li>
<li class="toctree-l4"><a class="reference internal" href="#observing-registration-progress">Observing Registration Progress</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reproducibility">Reproducibility</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="conventions.html">Common Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="IO.html">Reading and Writing for Images and Transforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="filters.html">SimpleITK Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="building.html">Building SimpleITK</a></li>
<li class="toctree-l1"><a class="reference internal" href="setUp.html">Setting Up Eclipse and Visual Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorialsAndCourses.html">Tutorials and Courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="migrationGuide2.0.html">Migration Guide 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="FilterTemplates.html">Developer</a></li>
<li class="toctree-l1"><a class="reference internal" href="link_examples.html">Examples</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SimpleITK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Registration Overview</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/registrationOverview.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="registration-overview">
<span id="lbl-registration-overview"></span><h1>Registration Overview<a class="headerlink" href="#registration-overview" title="Permalink to this heading"></a></h1>
<p>The goal of registration is to estimate the transformation which maps points
from one image to the corresponding points in another image. The
transformation estimated via registration is said to map points from the
<strong>fixed image</strong> coordinate system to the <strong>moving image</strong> coordinate system.</p>
<p>SimpleITK provides a configurable multi-resolution registration
framework, implemented in the <a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1ImageRegistrationMethod.html">ImageRegistrationMethod</a> class.
In addition, a number of variations of the Demons registration algorithm are
implemented independently from this class as they do not fit into the framework.</p>
<section id="actual-code">
<h2>Actual Code<a class="headerlink" href="#actual-code" title="Permalink to this heading"></a></h2>
<p>Code illustrating various aspects of the registration framework can be found in
the set of <a class="reference internal" href="link_examples.html#lbl-examples"><span class="std std-ref">examples</span></a> which are part of the SimpleITK distribution
and in the SimpleITK <a class="reference external" href="http://insightsoftwareconsortium.github.io/SimpleITK-Notebooks/">Jupyter notebook repository</a>.</p>
</section>
<section id="initialization-and-center-of-rotation">
<h2>Initialization and Center of Rotation<a class="headerlink" href="#initialization-and-center-of-rotation" title="Permalink to this heading"></a></h2>
<p>The task of registration is formulated using non-linear optimization which requires an initial estimate. The two
most common initialization approaches are (1) Use the identity transform (a.k.a. forgot to initialize).
(2) Align the physical centers of the two images (see <a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1CenteredTransformInitializerFilter.html">CenteredTransformInitializerFilter</a>). If after initialization there is no overlap between the
images, registration will fail. The closer the initialization transformation is to the actual transformation, the higher the probability
of convergence to the correct solution.</p>
<p>If your registration involves the use of a global domain transform (<a class="reference internal" href="fundamentalConcepts.html#lbl-transforms"><span class="std std-ref">described here</span></a>), you should also set
an appropriate center of rotation. In many cases you want the center of rotation to be the physical center of the fixed image
(the CenteredTransformCenteredTransformInitializerFilter ensures this). This is of significant importance for registration convergence due
to the non-linear nature of rotation. When the center of rotation is far from our physical region of interest (ROI), a small rotational angle
results in a large displacement. Think of moving the pivot/fulcrum point of a <a class="reference external" href="https://en.wikipedia.org/wiki/Lever">lever</a>. For the same
rotation angle, the farther you are from the fulcrum the larger the displacement. For numerical stability we do not want our computations
to be sensitive to very small variations in the rotation angle, thus the ideal center of rotation is the point which minimizes the
distance to the farthest point in our ROI:</p>
<div class="math notranslate nohighlight">
\[p_{center} = \underset{p_{rotation}} {\arg\min}\ dist(p_{rotation}, \{p_{roi}\})\]</div>
<p>Without additional knowledge we can only assume that the ROI is the whole fixed image. If your ROI is only in a sub
region of the image, a more appropriate point would be the center of the oriented bounding box of that ROI.</p>
</section>
<section id="id1">
<h2>ImageRegistrationMethod<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h2>
<p>To create a specific registration instance using the ImageRegistrationMethod
you need to select several components which together define the registration instance:</p>
<ol class="arabic simple">
<li><p>Transformation.</p></li>
<li><p>Similarity metric.</p></li>
<li><p>Optimizer.</p></li>
<li><p>Interpolator.</p></li>
</ol>
<section id="transform">
<h3>Transform<a class="headerlink" href="#transform" title="Permalink to this heading"></a></h3>
<p>The type of transformation defines the mapping between the two images. SimpleITK
supports a variety of global and local transformations. The available
transformations include:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1TranslationTransform.html">TranslationTransform</a>.</p></li>
<li><p><a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1VersorTransform.html">VersorTransform</a>.</p></li>
<li><p><a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1VersorRigid3DTransform.html">VersorRigid3DTransform</a>.</p></li>
<li><p><a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1Euler2DTransform.html">Euler2DTransform</a>.</p></li>
<li><p><a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1Euler3DTransform.html">Euler3DTransform</a>.</p></li>
<li><p><a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1Similarity2DTransform.html">Similarity2DTransform</a>.</p></li>
<li><p><a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1Similarity3DTransform.html">Similarity3DTransform</a>.</p></li>
<li><p><a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1ScaleTransform.html">ScaleTransform</a>.</p></li>
<li><p><a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1ScaleVersor3DTransform.html">ScaleVersor3DTransform</a>.</p></li>
<li><p><a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1ScaleSkewVersor3DTransform.html">ScaleSkewVersor3DTransform</a>.</p></li>
<li><p><a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1ComposeScaleSkewVersor3DTransform.html">ComposeScaleSkewVersor3DTransform</a>.</p></li>
<li><p><a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1AffineTransform.html">AffineTransform</a>.</p></li>
<li><p><a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1BSplineTransform.html">BSplineTransform</a>.</p></li>
<li><p><a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1DisplacementFieldTransform.html">DisplacementFieldTransform</a>.</p></li>
<li><p><a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1Transform.html">Composite Transform</a>.</p></li>
</ul>
<p>The parameters modified by the registration framework are those returned by the
transforms <strong>GetParameters()</strong> method. This requires special attention when the
using a composite transform, as the specific parameters vary
based on the content of your composite transformation.</p>
</section>
<section id="similarity-metric">
<h3>Similarity Metric<a class="headerlink" href="#similarity-metric" title="Permalink to this heading"></a></h3>
<p>The similarity metric reflects the relationship between the intensities of the
images (identity, affine, stochastic…). The available metrics include:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1MeanSquaresImageToImageMetricv4.html">MeanSquares</a> .</p></li>
<li><p><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1DemonsImageToImageMetricv4.html">Demons</a>.</p></li>
<li><p><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1CorrelationImageToImageMetricv4.html">Correlation</a>.</p></li>
<li><p><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1ANTSNeighborhoodCorrelationImageToImageMetricv4.html">ANTSNeighborhoodCorrelation</a>.</p></li>
<li><p><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1JointHistogramMutualInformationImageToImageMetricv4.html">JointHistogramMutualInformation</a>.</p></li>
<li><p><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1MattesMutualInformationImageToImageMetricv4.html">MattesMutualInformation</a>.</p></li>
</ul>
<p>In the ITKv4 and consequentially in SimpleITK all similarity metrics are
minimized. For metrics whose optimum corresponds to a maximum, such as mutual
information, the metric value is negated internally. The selection of a
similarity metric is done using the ImageRegistrationMethod’s <strong>SetMetricAsX()</strong>
methods.</p>
</section>
<section id="optimizer">
<h3>Optimizer<a class="headerlink" href="#optimizer" title="Permalink to this heading"></a></h3>
<p>The optimizer is selected using the <strong>SetOptimizerAsX()</strong> methods.
When selecting the optimizer you will also need to configure it (e.g. set the
number of iterations). The available optimizers include:</p>
<ul class="simple">
<li><p>Gradient free</p>
<ul>
<li><p><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1ExhaustiveOptimizerv4.html">Exhaustive</a>.</p></li>
<li><p><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1AmoebaOptimizerv4.html">Nelder-Mead downhill simplex</a> (Amoeba).</p></li>
<li><p><a class="reference external" href="https://itk.org/Doxygen/html/classitk_1_1PowellOptimizerv4.html">Powell</a>.</p></li>
<li><p><a class="reference external" href="https://itk.org/Doxygen/html/classitk_1_1OnePlusOneEvolutionaryOptimizerv4.html">1+1 evolutionary optimizer</a>.</p></li>
</ul>
</li>
<li><p>Gradient based:</p>
<ul>
<li><p><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1GradientDescentOptimizerv4Template.html">Gradient Descent</a>.</p></li>
<li><p><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1GradientDescentLineSearchOptimizerv4Template.html">Gradient Descent Line Search</a>.</p></li>
<li><p><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1RegularStepGradientDescentOptimizerv4.html">Regular Step Gradient Descent</a>.</p></li>
<li><p><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1ConjugateGradientLineSearchOptimizerv4Template.html">Conjugate Gradient Line Search</a>.</p></li>
<li><p><a class="reference external" href="http://www.itk.org/Doxygen/html/classitk_1_1LBFGSBOptimizerv4.html">L-BFGS-B</a>. Limited memory Broyden, Fletcher, Goldfarb, Shannon, Bound Constrained (supports the use of simple constraints).</p></li>
</ul>
</li>
</ul>
</section>
<section id="interpolator">
<h3>Interpolator<a class="headerlink" href="#interpolator" title="Permalink to this heading"></a></h3>
<p>SimpleITK has a large number of interpolators. In most cases linear
interpolation, the default setting, is sufficient. Unlike the similarity metric
and optimizer, the interpolator is set using the <strong>SetInterpolator</strong> method which
receives a <a class="reference external" href="https://simpleitk.org/doxygen/latest/html/namespaceitk_1_1simple.html#a7cb1ef8bd02c669c02ea2f9f5aa374e5">parameter</a>
indicating the interpolator type.</p>
</section>
<section id="features-of-interest">
<h3>Features of Interest<a class="headerlink" href="#features-of-interest" title="Permalink to this heading"></a></h3>
<section id="transforms-and-image-spaces">
<h4>Transforms and image spaces<a class="headerlink" href="#transforms-and-image-spaces" title="Permalink to this heading"></a></h4>
<p>While the goal of registration, as defined above, refers to a single
transformation and two images, the ITKv4 registration and the
SimpleITK ImageRegistrationMethod provide additional flexibility in
registration configuration.</p>
<p>From a coordinate system standpoint ITKv4 introduced the
<strong>virtual image domain</strong>, making registration a symmetric process so that both
images are treated similarly. As a consequence the ImageRegistrationMethod
has methods for setting <strong>three transformations</strong>:</p>
<p>1. SetInitialTransform <span class="math notranslate nohighlight">\(T_{opt}\)</span> - composed with the moving initial transform, maps
points from the virtual image domain to the moving image domain, modified
during optimization.</p>
<p>2. SetFixedInitialTransform <span class="math notranslate nohighlight">\(T_f\)</span> - maps points from the virtual image domain
to the fixed image domain, never modified.</p>
<p>3. SetMovingInitialTransform <span class="math notranslate nohighlight">\(T_m\)</span>- maps points from the virtual image domain to
the moving image domain, never modified.</p>
<p>The transformation that maps points from the fixed to moving image domains is thus:</p>
<div class="math notranslate nohighlight">
\[p_{moving}=T_m(T_{opt}(T_f^{-1}(p_{fixed})))\]</div>
</section>
<section id="multi-resolution-framework">
<h4>Multi Resolution Framework<a class="headerlink" href="#multi-resolution-framework" title="Permalink to this heading"></a></h4>
<p>The ImageRegistrationMethod supports multi-resolution, pyramid, registration
via two methods <a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1ImageRegistrationMethod.html#a59fef92122919202cf4a00f84fd87ea5">SetShrinkFactorsPerLevel</a>
and <a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1ImageRegistrationMethod.html#a0aea868182491c8d6900129955b4f5b4">SetSmoothingSigmasPerLevel</a>.
The former receives the shrink factors to apply when moving from one level of
the pyramid to the next and the later receives the sigmas to use for smoothing
when moving from level to level. Sigmas can be specified either in voxel units
or physical units (default) using <a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1ImageRegistrationMethod.html#a50c2a2242421fdcafdc42d548b994ed9">SetSmoothingSigmasAreSpecifiedInPhysicalUnits</a>.</p>
</section>
<section id="sampling">
<h4>Sampling<a class="headerlink" href="#sampling" title="Permalink to this heading"></a></h4>
<p>For many registration tasks one can use a fraction of the image voxels to
estimate the similarity measure. Aggressive sampling can significantly reduce
the registration runtime. The ImageRegistration method allows you to
specify how/if to sample the voxels, <a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1ImageRegistrationMethod.html#aa49fdfae5950c2ec6e01a75df59078f6">SetMetricSamplingStrategy</a>, and
if using a sampling, what percentage, <a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1ImageRegistrationMethod.html#a8b891c62404a8dc5010241fea619c932">SetMetricSamplingPercentage</a>.</p>
<p>The registration framework supports three sampling strategies:</p>
<ol class="arabic simple">
<li><p>NONE - use all voxels, sampled points are the voxel centers.</p></li>
<li><p>REGULAR - sample every n-th voxel while traversing the image
in scan-line order, then within each voxel randomly
perturb from center.</p></li>
<li><p>RANDOM - sample image voxels with replacement using a uniform distribution, then within each voxel randomly perturb from center.</p></li>
</ol>
<p>When using the REGULAR or RANDOM sampling strategies, running the same
registration code multiple times will yield different results. To remove
the randomness, set the pseudo-random number generator’s seed in the
<a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1ImageRegistrationMethod.html#a8b891c62404a8dc5010241fea619c932">SetMetricSamplingPercentage</a>
method to a constant. The default seed value is
wall clock time.</p>
<p>Note that using the RANDOM sampling strategy with a 100% sampling rate is not
equivalent to using the sampling strategy of NONE. Given an image with N voxels,
the former randomly selects N voxels with repetition and perturbs the points
within each voxel, the latter uses the centers of all N voxels. Thus, for
repeated random sampling with 100% rate, different samples are produced and likely
none of them is of the centers of all N voxels.</p>
<p>Combining a mask with sampling is done using a rejection approach. First a sample is generated and
then it is accepted or rejected if it is inside or outside the mask. This may cause
problems when the mask region occupies a very small region in the original image. Because the sampling
only discards data,the sample rate may be reduced from the requested one. For some similarity metrics (e.g. mutual information)
this can result in an insufficient number of samples for metric value computation, leading to registration failure.
Other metrics are more robust to small sample sizes (e.g. mean squares), but they all suffer from it.
In such cases it is better to use a cropped version of the image for registration, possibly the mask’s bounding box,
instead of the original image with a mask.</p>
</section>
<section id="scaling-in-parameter-space">
<h4>Scaling in Parameter Space<a class="headerlink" href="#scaling-in-parameter-space" title="Permalink to this heading"></a></h4>
<p>The ITKv4 framework introduced automated methods for estimating scaling factors
for non-commensurate parameter units. These change the step size per parameter
so that the effect of a unit of change has similar effects in physical space
(think rotation of 1 radian and translation of 1 millimeter).
The relevant methods are <a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1ImageRegistrationMethod.html#a53934282121e152d37781ffa5224ec5f">SetOptimizerScalesFromPhysicalShift</a>,
<a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1ImageRegistrationMethod.html#a0ad235e8291716cb44c87a01c6b545a9">SetOptimizerScalesFromIndexShift</a> and
<a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1ImageRegistrationMethod.html#afe20311a9a425f312e3cefaaf683fab4">SetOptimizerScalesFromJacobian</a>.
In many cases this scaling is what determines if the the optimization converges to the
correct optimum.</p>
</section>
<section id="observing-registration-progress">
<h4>Observing Registration Progress<a class="headerlink" href="#observing-registration-progress" title="Permalink to this heading"></a></h4>
<p>The ImageRegistrationMethod enables you to observe the registration process as it progresses.
This is done using the Command-Observer pattern, associating callbacks with specific events.
To associate a callback with a specific <a class="reference external" href="https://simpleitk.org/doxygen/latest/html/namespaceitk_1_1simple.html#aa7399868984d99493c5a307cce373ace">event</a>
use the <a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1ProcessObject.html#a2199e5cca19b45d504676a595e1f6cfd">AddCommand</a>
method.</p>
</section>
<section id="reproducibility">
<h4>Reproducibility<a class="headerlink" href="#reproducibility" title="Permalink to this heading"></a></h4>
<p>Generally speaking, repeated registrations of the same datasets will yield slightly different results. This is
associated with the registration framework’s similarity metric computation implementation which utilizes both
randomization and multi-threading.</p>
<p>The primary source of variability is the use of randomization. To eliminate randomization variability,
set the seed parameter for the <a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1ImageRegistrationMethod.html#a8b891c62404a8dc5010241fea619c932">SetMetricSamplingPercentage</a> to a fixed value (e.g. <a class="reference external" href="https://en.wikipedia.org/wiki/42_(number)">42</a>).</p>
<p>The secondary, and much more minor, source of variability has to do with the multithreading implementation, different
order of operations in each registration run. To eliminate multithreading variability, set the number of threads to one
via the <a class="reference external" href="https://simpleitk.org/doxygen/latest/html/classitk_1_1simple_1_1ProcessObject.html#a305b43330f9feb26325eadfc30695bd9">SetGlobalDefaultNumberOfThreads</a> method. From a practical standpoint, in the tradeoff between full reproducibility and computational efficiency with minor
variability in results, computational efficiency is most often more important.</p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="fundamentalConcepts.html" class="btn btn-neutral float-left" title="Fundamental Concepts" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="conventions.html" class="btn btn-neutral float-right" title="Common Conventions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025 NumFOCUS.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>