

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="readthedocs-addons-api-version" content="1"><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Script repository &mdash; 3D Slicer  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=0defd4e4" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <script src="../_static/js/versions.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Build Instructions" href="build_instructions/index.html" />
    <link rel="prev" title="Python FAQ" href="python_faq.html" /> 
<script async type="text/javascript" src="/_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="slicer" /><meta name="readthedocs-version-slug" content="latest" /><meta name="readthedocs-resolver-filename" content="/developer_guide/script_repository.html" /><meta name="readthedocs-http-status" content="200" /></head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            3D Slicer
              <img src="../_static/3D-Slicer-Mark.png" class="logo" alt="Logo"/>
          </a>
              <div class="switch-menus">
                <div class="version-switch"></div>
                <div class="language-switch"></div>
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user_guide/about.html">About 3D Slicer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/get_help.html">Get Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/user_interface.html">User Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/coordinate_systems.html">Coordinate systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/data_loading_and_saving.html">Data Loading and Saving</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/image_segmentation.html">Image Segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/registration.html">Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/modules/index.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/extensions.html">Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/settings.html">Application settings</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="api.html">Slicer API</a></li>
<li class="toctree-l2"><a class="reference internal" href="mrml_overview.html">MRML Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="module_overview.html">Module Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameter_nodes/index.html">Parameter Nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="modules/index.html">Modules API</a></li>
<li class="toctree-l2"><a class="reference internal" href="extensions.html">Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="python_faq.html">Python FAQ</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Script repository</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#install-slicer">Install Slicer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#launch-slicer">Launch Slicer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#open-a-file-with-slicer-at-the-command-line">Open a file with Slicer at the command line</a></li>
<li class="toctree-l4"><a class="reference internal" href="#open-an-mrb-file-with-slicer-at-the-command-line">Open an .mrb file with Slicer at the command line</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-python-commands-in-the-slicer-environment">Run Python commands in the Slicer environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-a-python-script-file-in-the-slicer-environment">Run a Python script file in the Slicer environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#launch-slicer-directly-from-a-web-browser">Launch Slicer directly from a web browser</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mrml-scene">MRML scene</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#get-mrml-node-from-the-scene">Get MRML node from the scene</a></li>
<li class="toctree-l4"><a class="reference internal" href="#clone-a-node">Clone a node</a></li>
<li class="toctree-l4"><a class="reference internal" href="#save-a-node-to-file">Save a node to file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#save-the-scene-into-a-single-mrb-file">Save the scene into a single MRB file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#save-the-scene-into-a-new-directory">Save the scene into a new directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#override-default-scene-save-dialog">Override default scene save dialog</a></li>
<li class="toctree-l4"><a class="reference internal" href="#override-application-close-behavior">Override application close behavior</a></li>
<li class="toctree-l4"><a class="reference internal" href="#change-default-output-file-type-for-new-nodes">Change default output file type for new nodes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#change-file-type-for-saving-for-existing-nodes">Change file type for saving for existing nodes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-selection">Module selection</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#switch-to-a-different-module">Switch to a different module</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-a-new-default-module-at-startup">Set a new default module at startup</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#views">Views</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#display-text-in-a-3d-view-or-slice-view">Display text in a 3D view or slice view</a></li>
<li class="toctree-l4"><a class="reference internal" href="#activate-hanging-protocol-by-keyboard-shortcut">Activate hanging protocol by keyboard shortcut</a></li>
<li class="toctree-l4"><a class="reference internal" href="#show-orientation-marker-in-all-views">Show orientation marker in all views</a></li>
<li class="toctree-l4"><a class="reference internal" href="#change-view-axis-labels">Change view axis labels</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hide-view-controller-bars">Hide view controller bars</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hide-slicer-logo-from-main-window">Hide Slicer logo from main window</a></li>
<li class="toctree-l4"><a class="reference internal" href="#customize-widgets-in-view-controller-bars">Customize widgets in view controller bars</a></li>
<li class="toctree-l4"><a class="reference internal" href="#display-a-node-in-only-some-views">Display a node in only some views</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-current-mouse-coordinates-in-a-slice-view">Get current mouse coordinates in a slice view</a></li>
<li class="toctree-l4"><a class="reference internal" href="#display-crosshair-at-a-3d-position">Display crosshair at a 3D position</a></li>
<li class="toctree-l4"><a class="reference internal" href="#change-the-crosshair-color">Change the crosshair color</a></li>
<li class="toctree-l4"><a class="reference internal" href="#display-mouse-pointer-coordinates-in-alternative-coordinate-system">Display mouse pointer coordinates in alternative coordinate system</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-3d-coordinates-from-2d-display-coordinates">Get 3D coordinates from 2D display coordinates</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-dataprobe-text">Get DataProbe text</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-custom-color-table">Create custom color table</a></li>
<li class="toctree-l4"><a class="reference internal" href="#show-color-legend-for-a-volume-node">Show color legend for a volume node</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-custom-color-map-and-display-color-legend">Create custom color map and display color legend</a></li>
<li class="toctree-l4"><a class="reference internal" href="#customize-view-layout">Customize view layout</a></li>
<li class="toctree-l4"><a class="reference internal" href="#turn-on-slice-intersections">Turn on slice intersections</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hide-slice-view-annotations">Hide slice view annotations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#change-slice-offset">Change slice offset</a></li>
<li class="toctree-l4"><a class="reference internal" href="#change-slice-orientation">Change slice orientation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#measure-angle-between-two-slice-planes">Measure angle between two slice planes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-slice-position-and-orientation-from-a-normal-vector-and-position">Set slice position and orientation from a normal vector and position</a></li>
<li class="toctree-l4"><a class="reference internal" href="#show-slice-views-in-3d-window">Show slice views in 3D window</a></li>
<li class="toctree-l4"><a class="reference internal" href="#change-default-slice-view-orientation">Change default slice view orientation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-all-slice-views-linked-by-default">Set all slice views linked by default</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-crosshair-jump-mode-to-centered-by-default">Set crosshair jump mode to centered by default</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-up-custom-units-in-slice-view-ruler">Set up custom units in slice view ruler</a></li>
<li class="toctree-l4"><a class="reference internal" href="#center-the-3d-view-on-the-scene">Center the 3D view on the scene</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rotate-the-3d-view">Rotate the 3D View</a></li>
<li class="toctree-l4"><a class="reference internal" href="#change-3d-view-background-color">Change 3D view background color</a></li>
<li class="toctree-l4"><a class="reference internal" href="#change-box-color-in-3d-view">Change box color in 3D view</a></li>
<li class="toctree-l4"><a class="reference internal" href="#show-a-slice-view-outside-the-view-layout">Show a slice view outside the view layout</a></li>
<li class="toctree-l4"><a class="reference internal" href="#show-a-3d-view-outside-the-view-layout">Show a 3D view outside the view layout</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#access-vtk-rendering-classes">Access VTK rendering classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#access-vtk-views-renderers-and-cameras">Access VTK views, renderers, and cameras</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-displayable-manager-of-a-certain-type-for-a-certain-view">Get displayable manager of a certain type for a certain view</a></li>
<li class="toctree-l4"><a class="reference internal" href="#access-vtk-actor-properties">Access VTK actor properties</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#keyboard-shortcuts-and-mouse-gestures">Keyboard shortcuts and mouse gestures</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#customize-keyboard-shortcuts">Customize keyboard shortcuts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#customize-keyboard-mouse-gestures-in-viewers">Customize keyboard/mouse gestures in viewers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#disable-certain-user-interactions-in-slice-views">Disable certain user interactions in slice views</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-keyboard-shortcut-to-jump-to-center-or-world-coordinate-system">Add keyboard shortcut to jump to center or world coordinate system</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#launch-external-applications">Launch external applications</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#launch-external-process-in-startup-environment">Launch external process in startup environment</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#manage-extensions">Manage extensions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#download-and-install-extension">Download and install extension</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-a-module-directly-from-a-git-repository">Install a module directly from a git repository</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-a-python-package">Install a Python package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#dicom">DICOM</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#load-dicom-files-into-the-scene-from-a-folder">Load DICOM files into the scene from a folder</a></li>
<li class="toctree-l4"><a class="reference internal" href="#import-dicom-files-into-the-application-s-dicom-database">Import DICOM files into the application’s DICOM database</a></li>
<li class="toctree-l4"><a class="reference internal" href="#import-dicom-files-using-dicomweb">Import DICOM files using DICOMweb</a></li>
<li class="toctree-l4"><a class="reference internal" href="#access-top-level-tags-of-dicom-images-imported-into-slicer">Access top level tags of DICOM images imported into Slicer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#access-dicom-tags-nested-in-a-sequence">Access DICOM tags nested in a sequence</a></li>
<li class="toctree-l4"><a class="reference internal" href="#access-tag-of-a-scalar-volume-loaded-from-dicom">Access tag of a scalar volume loaded from DICOM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#access-tag-of-an-item-in-the-subject-hierarchy-tree">Access tag of an item in the Subject Hierarchy tree</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-path-and-filename-of-a-scalar-volume-node-loaded-from-dicom">Get path and filename of a scalar volume node loaded from DICOM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#convert-dicom-to-nrrd-on-the-command-line">Convert DICOM to NRRD on the command line</a></li>
<li class="toctree-l4"><a class="reference internal" href="#export-a-volume-to-dicom-file-format">Export a volume to DICOM file format</a></li>
<li class="toctree-l4"><a class="reference internal" href="#export-a-segmentation-to-dicom-segmentation-object">Export a segmentation to DICOM segmentation object</a></li>
<li class="toctree-l4"><a class="reference internal" href="#export-dicom-series-from-the-database-to-research-file-format">Export DICOM series from the database to research file format</a></li>
<li class="toctree-l4"><a class="reference internal" href="#customize-table-columns-in-dicom-browser">Customize table columns in DICOM browser</a></li>
<li class="toctree-l4"><a class="reference internal" href="#query-and-retrieve-data-from-a-pacs-using-classic-dimse-dicom-networking">Query and retrieve data from a PACS using classic DIMSE DICOM networking</a></li>
<li class="toctree-l4"><a class="reference internal" href="#query-and-retrieve-data-from-a-pacs-using-classic-dimse-dicom-networking-with-the-experimental-ctkdicomvisualbrowser">Query and retrieve data from a PACS using classic DIMSE DICOM networking with the (experimental) ctkDICOMVisualBrowser</a></li>
<li class="toctree-l4"><a class="reference internal" href="#query-and-retrieve-data-from-a-pacs-using-classic-dimse-dicom-networking-with-the-experimental-ctkdicomscheduler-no-ui-needed">Query and retrieve data from a PACS using classic DIMSE DICOM networking with the (experimental) ctkDICOMScheduler (no UI needed)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#send-data-to-a-pacs-using-classic-dimse-dicom-networking">Send data to a PACS using classic DIMSE DICOM networking</a></li>
<li class="toctree-l4"><a class="reference internal" href="#send-data-to-a-pacs-using-dicomweb-networking">Send data to a PACS using DICOMweb networking</a></li>
<li class="toctree-l4"><a class="reference internal" href="#convert-rt-structure-set-to-labelmap-nrrd-files">Convert RT structure set to labelmap NRRD files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-a-dcmtk-command-line-tool">Run a DCMTK Command Line Tool</a></li>
<li class="toctree-l4"><a class="reference internal" href="#additional-notes">Additional Notes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#markups">Markups</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#save-markups-to-file">Save markups to file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#load-markups-from-file">Load markups from file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#load-markups-point-list-from-file">Load markups point list from file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-control-points-programmatically">Adding control points Programmatically</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-to-draw-a-curve-using-control-points-stored-in-a-numpy-array">How to draw a curve using control points stored in a numpy array</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-a-button-to-module-gui-to-activate-control-point-placement">Add a button to module GUI to activate control point placement</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-control-points-via-mouse-clicks">Adding control points via mouse clicks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#access-to-markups-point-list-properties">Access to markups point list Properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#define-edit-a-circular-region-of-interest-in-a-slice-viewer">Define/edit a circular region of interest in a slice viewer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#specify-a-sphere-by-multiple-control-points">Specify a sphere by multiple control points</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fit-markups-roi-to-volume">Fit markups ROI to volume</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fit-markups-plane-to-model">Fit markups plane to model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#measure-angle-between-two-markup-planes">Measure angle between two markup planes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#measure-angle-between-two-markup-lines">Measure angle between two markup lines</a></li>
<li class="toctree-l4"><a class="reference internal" href="#project-a-line-to-a-plane">Project a line to a plane</a></li>
<li class="toctree-l4"><a class="reference internal" href="#measure-distances-of-points-from-a-plane">Measure distances of points from a plane</a></li>
<li class="toctree-l4"><a class="reference internal" href="#measure-distances-of-points-from-a-line">Measure distances of points from a line</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-slice-position-and-orientation-from-3-markups-control-points">Set slice position and orientation from 3 markups control points</a></li>
<li class="toctree-l4"><a class="reference internal" href="#switching-to-markups-control-point-placement-mode">Switching to markups control point placement mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#change-markup-point-list-display-properties">Change markup point list display properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-a-notification-if-a-markup-control-point-position-is-modified">Get a notification if a markup control point position is modified</a></li>
<li class="toctree-l4"><a class="reference internal" href="#write-markup-control-point-positions-to-json-file">Write markup control point positions to JSON file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#write-markup-roi-to-json-file">Write markup ROI to JSON file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-markup-plane-json-file-outside-slicer">Create markup plane JSON file - outside Slicer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fit-slice-plane-to-markup-control-points">Fit slice plane to markup control points</a></li>
<li class="toctree-l4"><a class="reference internal" href="#change-color-of-a-markups-node">Change color of a markups node</a></li>
<li class="toctree-l4"><a class="reference internal" href="#display-list-of-control-points-in-my-module-s-gui">Display list of control points in my module’s GUI</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pre-populate-the-scene-with-measurements">Pre-populate the scene with measurements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#copy-all-measurements-in-the-scene-to-excel">Copy all measurements in the scene to Excel</a></li>
<li class="toctree-l4"><a class="reference internal" href="#use-markups-json-files-in-python-outside-slicer">Use markups json files in Python - outside Slicer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#assign-custom-actions-to-markups">Assign custom actions to markups</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#models">Models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#show-a-simple-surface-mesh-as-a-model-node">Show a simple surface mesh as a model node</a></li>
<li class="toctree-l4"><a class="reference internal" href="#measure-distance-of-points-from-surface">Measure distance of points from surface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-a-texture-mapped-plane-to-the-scene-as-a-model">Add a texture mapped plane to the scene as a model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-scalar-values-at-surface-of-a-model">Get scalar values at surface of a model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#apply-vtk-filter-on-a-model-node">Apply VTK filter on a model node</a></li>
<li class="toctree-l4"><a class="reference internal" href="#select-cells-of-a-model-using-markups-point-list">Select cells of a model using markups point list</a></li>
<li class="toctree-l4"><a class="reference internal" href="#export-entire-scene-as-gltf">Export entire scene as glTF</a></li>
<li class="toctree-l4"><a class="reference internal" href="#export-entire-scene-as-vrml">Export entire scene as VRML</a></li>
<li class="toctree-l4"><a class="reference internal" href="#export-model-to-blender-including-color-by-scalar">Export model to Blender, including color by scalar</a></li>
<li class="toctree-l4"><a class="reference internal" href="#show-comparison-view-of-all-model-files-a-folder">Show comparison view of all model files a folder</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rasterize-a-model-and-save-it-to-a-series-of-image-files">Rasterize a model and save it to a series of image files</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#plots">Plots</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#slicer-plots-displayed-in-view-layout">Slicer plots displayed in view layout</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-slicer-util-plot-utility-function">Using <code class="xref py py-func docutils literal notranslate"><span class="pre">slicer.util.plot()</span></code> utility function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#save-a-plot-as-vector-graphics-svg">Save a plot as vector graphics (.svg)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-matplotlib">Using matplotlib</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#screen-capture">Screen Capture</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#capture-the-full-slicer-screen-and-save-it-into-a-file">Capture the full Slicer screen and save it into a file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#capture-all-the-views-save-it-into-a-file">Capture all the views save it into a file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#capture-a-single-view">Capture a single view</a></li>
<li class="toctree-l4"><a class="reference internal" href="#capture-a-slice-view-sweep-into-a-series-of-png-files">Capture a slice view sweep into a series of PNG files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#capture-3d-view-into-png-file-with-transparent-background">Capture 3D view into PNG file with transparent background</a></li>
<li class="toctree-l4"><a class="reference internal" href="#capture-slice-view-into-png-file-with-white-background">Capture slice view into PNG file with white background</a></li>
<li class="toctree-l4"><a class="reference internal" href="#save-a-series-of-images-from-a-slice-view">Save a series of images from a slice view</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#segmentations">Segmentations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#load-a-3d-image-or-model-file-as-segmentation">Load a 3D image or model file as segmentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-a-segmentation-from-a-labelmap-volume-and-display-in-3d">Create a segmentation from a labelmap volume and display in 3D</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-segmentation-from-a-model-node">Create segmentation from a model node</a></li>
<li class="toctree-l4"><a class="reference internal" href="#export-labelmap-node-from-segmentation-node">Export labelmap node from segmentation node</a></li>
<li class="toctree-l4"><a class="reference internal" href="#import-export-labelmap-node-using-custom-label-value-mapping">Import/export labelmap node using custom label value mapping</a></li>
<li class="toctree-l4"><a class="reference internal" href="#export-model-nodes-from-segmentation-node">Export model nodes from segmentation node</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-a-hollow-model-from-boundary-of-solid-segment">Create a hollow model from boundary of solid segment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#show-a-segmentation-in-3d">Show a segmentation in 3D</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modify-segmentation-display-options">Modify segmentation display options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-a-representation-of-a-segment">Get a representation of a segment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#convert-all-segments-using-default-path-and-conversion-parameters">Convert all segments using default path and conversion parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#convert-all-segments-using-custom-path-or-conversion-parameters">Convert all segments using custom path or conversion parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#re-convert-using-a-modified-conversion-parameter">Re-convert using a modified conversion parameter</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-keyboard-shortcut-for-toggling-sphere-brush-for-paint-and-erase-effects">Create keyboard shortcut for toggling sphere brush for paint and erase effects</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-keyboard-shortcut-for-toggling-visibility-of-a-set-of-segments">Create keyboard shortcut for toggling visibility of a set of segments</a></li>
<li class="toctree-l4"><a class="reference internal" href="#customize-list-of-displayed-segment-editor-effects">Customize list of displayed Segment editor effects</a></li>
<li class="toctree-l4"><a class="reference internal" href="#center-all-views-on-a-segment">Center all views on a segment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#read-and-write-a-segment-as-a-numpy-array">Read and write a segment as a numpy array</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-centroid-of-a-segment-in-world-ras-coordinates">Get centroid of a segment in world (RAS) coordinates</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-histogram-of-a-segmented-region">Get histogram of a segmented region</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-segments-visible-at-a-selected-position">Get segments visible at a selected position</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-default-segmentation-options">Set default segmentation options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-to-run-segment-editor-effects-from-a-script">How to run segment editor effects from a script</a></li>
<li class="toctree-l4"><a class="reference internal" href="#process-segment-using-a-vtk-filter">Process segment using a VTK filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="#use-segmentation-files-in-python-outside-slicer">Use segmentation files in Python - outside Slicer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#clone-a-segment">Clone a segment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#resample-segmentation-to-higher-resolution">Resample segmentation to higher resolution</a></li>
<li class="toctree-l4"><a class="reference internal" href="#quantifying-segments">Quantifying segments</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#registration">Registration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#register-two-images-with-brainsfit">Register two images with BRAINSFit</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#sequences">Sequences</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#access-voxels-of-a-4d-volume-as-numpy-array">Access voxels of a 4D volume as numpy array</a></li>
<li class="toctree-l4"><a class="reference internal" href="#access-voxels-of-a-4d-volume-as-a-single-numpy-array">Access voxels of a 4D volume as a single numpy array</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-index-value">Get index value</a></li>
<li class="toctree-l4"><a class="reference internal" href="#browse-a-sequence-and-access-currently-displayed-nodes">Browse a sequence and access currently displayed nodes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#concatenate-all-sequences-in-the-scene-into-a-new-sequence">Concatenate all sequences in the scene into a new sequence</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plot-segments-average-intensity-over-time">Plot segments average intensity over time</a></li>
<li class="toctree-l4"><a class="reference internal" href="#export-nodes-warped-by-transform-sequence">Export nodes warped by transform sequence</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-a-4d-volume-in-python-outside-slicer">Create a 4D volume in Python - outside Slicer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#subject-hierarchy">Subject hierarchy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#get-the-pseudo-singleton-subject-hierarchy-node">Get the pseudo-singleton subject hierarchy node</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-subject-hierarchy-item">Create subject hierarchy item</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-subject-hierarchy-item">Get subject hierarchy item</a></li>
<li class="toctree-l4"><a class="reference internal" href="#traverse-children-of-a-subject-hierarchy-item">Traverse children of a subject hierarchy item</a></li>
<li class="toctree-l4"><a class="reference internal" href="#manipulate-subject-hierarchy-item">Manipulate subject hierarchy item</a></li>
<li class="toctree-l4"><a class="reference internal" href="#filter-items-in-treeview-or-combobox">Filter items in TreeView or ComboBox</a></li>
<li class="toctree-l4"><a class="reference internal" href="#listen-to-subject-hierarchy-item-events">Listen to subject hierarchy item events</a></li>
<li class="toctree-l4"><a class="reference internal" href="#subject-hierarchy-plugin-offering-view-context-menu-action">Subject hierarchy plugin offering view context menu action</a></li>
<li class="toctree-l4"><a class="reference internal" href="#use-allowlist-to-customize-view-menu">Use allowlist to customize view menu</a></li>
<li class="toctree-l4"><a class="reference internal" href="#save-files-to-directory-structure-matching-subject-hierarchy-folders">Save files to directory structure matching subject hierarchy folders</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tractography">Tractography</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#export-a-tract-fiberbundle-to-blender-including-color">Export a tract (FiberBundle) to Blender, including color</a></li>
<li class="toctree-l4"><a class="reference internal" href="#iterate-over-tract-fiberbundle-streamline-points">Iterate over tract (FiberBundle) streamline points</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#transforms">Transforms</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#get-a-notification-if-a-transform-is-modified">Get a notification if a transform is modified</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rotate-a-node-around-a-specified-point">Rotate a node around a specified point</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rotate-a-node-around-a-specified-line">Rotate a node around a specified line</a></li>
<li class="toctree-l4"><a class="reference internal" href="#convert-between-itk-and-slicer-linear-transforms">Convert between ITK and Slicer linear transforms</a></li>
<li class="toctree-l4"><a class="reference internal" href="#apply-a-transform-to-a-transformable-node">Apply a transform to a transformable node</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-a-transformation-matrix-from-a-numpy-array">Set a transformation matrix from a numpy array</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-of-moving-a-volume-along-a-trajectory-using-a-transform">Example of moving a volume along a trajectory using a transform</a></li>
<li class="toctree-l4"><a class="reference internal" href="#combine-multiple-transforms">Combine multiple transforms</a></li>
<li class="toctree-l4"><a class="reference internal" href="#convert-the-transform-to-a-grid-transform">Convert the transform to a grid transform</a></li>
<li class="toctree-l4"><a class="reference internal" href="#export-the-displacement-magnitude-of-the-transform-as-a-volume">Export the displacement magnitude of the transform as a volume</a></li>
<li class="toctree-l4"><a class="reference internal" href="#visualize-the-displacement-magnitude-as-a-color-volume">Visualize the displacement magnitude as a color volume</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#volumes">Volumes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#load-volume-from-file">Load volume from file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#save-volume-to-file">Save volume to file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#load-volume-from-vti-file">Load volume from .vti file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#load-volume-from-a-remote-server">Load volume from a remote server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#show-volume-rendering-automatically-when-a-volume-is-loaded">Show volume rendering automatically when a volume is loaded</a></li>
<li class="toctree-l4"><a class="reference internal" href="#show-volume-rendering-using-maximum-intensity-projection">Show volume rendering using maximum intensity projection</a></li>
<li class="toctree-l4"><a class="reference internal" href="#show-volume-rendering-making-soft-tissues-transparent">Show volume rendering making soft tissues transparent</a></li>
<li class="toctree-l4"><a class="reference internal" href="#automatically-load-volumes-that-are-copied-into-a-folder">Automatically load volumes that are copied into a folder</a></li>
<li class="toctree-l4"><a class="reference internal" href="#extract-slice-from-volume">Extract slice from volume</a></li>
<li class="toctree-l4"><a class="reference internal" href="#extract-randomly-oriented-slabs-of-given-shape-from-a-volume">Extract randomly oriented slabs of given shape from a volume</a></li>
<li class="toctree-l4"><a class="reference internal" href="#clone-a-volume">Clone a volume</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-a-new-volume">Create a new volume</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-a-new-volume-from-roi">Create a new volume from ROI</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-value-of-a-volume-at-specific-voxel-coordinates">Get value of a volume at specific voxel coordinates</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modify-voxels-in-a-volume">Modify voxels in a volume</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-volume-voxel-coordinates-from-markup-control-point-ras-coordinates">Get volume voxel coordinates from markup control point RAS coordinates</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-markup-control-point-ras-coordinates-from-volume-voxel-coordinates">Get markup control point RAS coordinates from volume voxel coordinates</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-the-values-of-all-voxels-for-a-label-value">Get the values of all voxels for a label value</a></li>
<li class="toctree-l4"><a class="reference internal" href="#access-values-in-a-dti-tensor-volume">Access values in a DTI tensor volume</a></li>
<li class="toctree-l4"><a class="reference internal" href="#change-window-level-brightness-contrast-or-colormap-of-a-volume">Change window/level (brightness/contrast) or colormap of a volume</a></li>
<li class="toctree-l4"><a class="reference internal" href="#make-mouse-left-click-and-drag-on-the-image-adjust-window-level">Make mouse left-click and drag on the image adjust window/level</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reset-field-of-view-to-show-background-volume-maximized">Reset field of view to show background volume maximized</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rotate-slice-views-to-volume-plane">Rotate slice views to volume plane</a></li>
<li class="toctree-l4"><a class="reference internal" href="#iterate-over-current-visible-slice-views-and-set-foreground-and-background-images">Iterate over current visible slice views, and set foreground and background images</a></li>
<li class="toctree-l4"><a class="reference internal" href="#show-a-volume-in-slice-views">Show a volume in slice views</a></li>
<li class="toctree-l4"><a class="reference internal" href="#change-opacity-of-foreground-volume-in-slice-views">Change opacity of foreground volume in slice views</a></li>
<li class="toctree-l4"><a class="reference internal" href="#turning-off-interpolation">Turning off interpolation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-an-itk-filter-in-python-using-simpleitk">Running an ITK filter in Python using SimpleITK</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-axial-slice-as-numpy-array">Get axial slice as numpy array</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-reformatted-image-from-a-slice-viewer-as-numpy-array">Get reformatted image from a slice viewer as numpy array</a></li>
<li class="toctree-l4"><a class="reference internal" href="#combine-multiple-volumes-into-one">Combine multiple volumes into one</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-noise-to-image">Add noise to image</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mask-volume-using-segmentation">Mask volume using segmentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#apply-random-deformations-to-image">Apply random deformations to image</a></li>
<li class="toctree-l4"><a class="reference internal" href="#thick-slab-reconstruction-and-maximum-minimum-intensity-volume-projections">Thick slab reconstruction and maximum/minimum intensity volume projections</a></li>
<li class="toctree-l4"><a class="reference internal" href="#display-volume-using-volume-rendering">Display volume using volume rendering</a></li>
<li class="toctree-l4"><a class="reference internal" href="#apply-a-custom-volume-rendering-color-opacity-transfer-function">Apply a custom volume rendering color/opacity transfer function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#limit-volume-rendering-to-a-specific-region-of-the-volume">Limit volume rendering to a specific region of the volume</a></li>
<li class="toctree-l4"><a class="reference internal" href="#register-a-new-volume-rendering-mapper">Register a new Volume Rendering mapper</a></li>
<li class="toctree-l4"><a class="reference internal" href="#register-custom-volume-rendering-presets">Register custom volume rendering presets</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#batch-processing">Batch processing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#iterate-through-dicom-series">Iterate through dicom series</a></li>
<li class="toctree-l4"><a class="reference internal" href="#extracting-volume-patches-around-segments">Extracting volume patches around segments</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#webserver">WebServer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#create-a-custom-web-server-instance-to-serve-static-content">Create a custom web server instance to serve static content</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-a-custom-web-server-to-handle-request-endpoints">Create a custom web server to handle request endpoints</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="build_instructions/index.html">Build Instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging/index.html">Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html">Contributing to Slicer</a></li>
<li class="toctree-l2"><a class="reference internal" href="style_guide.html">Style Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced_topics.html">Advanced Topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="authors.html">Credits</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">3D Slicer</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Developer Guide</a></li>
      <li class="breadcrumb-item active">Script repository</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/slicer/slicer/blob/main/Docs/developer_guide/script_repository.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="script-repository">
<h1>Script repository<a class="headerlink" href="#script-repository" title="Link to this heading"></a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Usage</strong>: Copy-paste the code lines displayed below or the linked <code class="docutils literal notranslate"><span class="pre">.py</span></code> file contents into Python console in Slicer. Or save them to a <code class="docutils literal notranslate"><span class="pre">.py</span></code> file and run them using <code class="docutils literal notranslate"><span class="pre">execfile</span></code>.</p>
<p>To run a Python code snippet automatically at each application startup, add it to the <a class="reference internal" href="../user_guide/settings.html#application-startup-file"><span class="std std-ref">.slicerrc.py file</span></a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>More reference code</strong>:
The Slicer source code has Python <a class="reference external" href="https://github.com/Slicer/Slicer/tree/main/Modules/Scripted">scripted modules</a> and <a class="reference external" href="https://github.com/Slicer/Slicer/tree/main/Modules/Loadable/Segmentations/EditorEffects/Python">scripted Segmentation Editor effects</a> that can be used as working examples.</p>
<ul class="simple">
<li><p>Most <a class="reference external" href="https://github.com/topics/3d-slicer-extension">Slicer Extensions</a> are written in Python to address specific use cases.  Looking at their source code can be informative.</p></li>
<li><p>The <a class="reference external" href="https://discourse.slicer.org/">Slicer Discourse forum</a> has many code snippets and discussions.</p></li>
</ul>
</div>
<section id="install-slicer">
<h2>Install Slicer<a class="headerlink" href="#install-slicer" title="Link to this heading"></a></h2>
<p>There are different approaches to install Slicer and extensions programmatically:</p>
<ul class="simple">
<li><p>Install Slicer manually and install extensions by using <code class="docutils literal notranslate"><span class="pre">slicer.app.extensionsManagerModel()</span></code>. See example <a class="reference internal" href="#download-and-install-extension">below</a> and in <a class="reference external" href="https://github.com/pieper/SlicerDockers/blob/master/slicer-plus/install-slicer-extension.py">install-slicer-extension.py</a></p></li>
<li><p>Directly interact with the REST API endpoints of <a class="reference external" href="https://slicer-packages.kitware.com">https://slicer-packages.kitware.com</a> using <code class="docutils literal notranslate"><span class="pre">curl</span></code> and <code class="docutils literal notranslate"><span class="pre">jq</span></code>. See <a class="reference external" href="https://github.com/Slicer/SlicerDocker/blob/master/scripts/slicer-download.sh">slicer-download.sh</a></p></li>
</ul>
</section>
<section id="launch-slicer">
<h2>Launch Slicer<a class="headerlink" href="#launch-slicer" title="Link to this heading"></a></h2>
<section id="open-a-file-with-slicer-at-the-command-line">
<h3>Open a file with Slicer at the command line<a class="headerlink" href="#open-a-file-with-slicer-at-the-command-line" title="Link to this heading"></a></h3>
<p>Open Slicer to view the <code class="docutils literal notranslate"><span class="pre">c:\some\folder\MRHead.nrrd</span></code> image file:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&quot;c:\Users\myusername\AppData\Local\NA-MIC\Slicer 4.11.20210226\Slicer.exe&quot; c:\some\folder\MRHead.nrrd</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is necessary to specify full path to the Slicer executable and to the file that needs to be loaded.</p>
</div>
<p>On Windows, the installer registers the <code class="docutils literal notranslate"><span class="pre">Slicer</span></code> application during install. This makes it possible to use <code class="docutils literal notranslate"><span class="pre">start</span></code> command to launch the most recently installed Slicer. For example, this command on the command-line starts Slicer and loads an image:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">start Slicer c:\some\folder\MRHead.nrrd</span>
</pre></div>
</div>
<p>To load a file with non-default options, you can use <code class="docutils literal notranslate"><span class="pre">--python-code</span></code> option to run <code class="docutils literal notranslate"><span class="pre">slicer.util.load...</span></code> commands.</p>
</section>
<section id="open-an-mrb-file-with-slicer-at-the-command-line">
<h3>Open an .mrb file with Slicer at the command line<a class="headerlink" href="#open-an-mrb-file-with-slicer-at-the-command-line" title="Link to this heading"></a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Slicer.exe --python-code &quot;slicer.util.loadScene(&#39;f:/2013-08-23-Scene.mrb&#39;)&quot;</span>
</pre></div>
</div>
</section>
<section id="run-python-commands-in-the-slicer-environment">
<h3>Run Python commands in the Slicer environment<a class="headerlink" href="#run-python-commands-in-the-slicer-environment" title="Link to this heading"></a></h3>
<p>Run Python commands, without showing any graphical user interface:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Slicer.exe --python-code &quot;doSomething; doSomethingElse; etc.&quot; --testing --no-splash --no-main-window</span>
</pre></div>
</div>
<p>Slicer exits when the commands are completed because <code class="docutils literal notranslate"><span class="pre">--testing</span></code> options is specified.</p>
</section>
<section id="run-a-python-script-file-in-the-slicer-environment">
<h3>Run a Python script file in the Slicer environment<a class="headerlink" href="#run-a-python-script-file-in-the-slicer-environment" title="Link to this heading"></a></h3>
<p>Run a Python script on Windows (stored in script file), without showing any graphical user interface:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Slicer.exe --python-script &quot;/full/path/to/myscript.py&quot; --no-splash --no-main-window</span>
</pre></div>
</div>
<p>Run a Python script on MacOS (stored in script file), without showing any graphical user interface:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">/Applications/Slicer.app/Contents/MacOS/Slicer --no-splash --no-main-window --python-script &quot;/full/path/to/myscript.py&quot;</span>
</pre></div>
</div>
<p>To make Slicer exit when the script execution is completed, call <code class="docutils literal notranslate"><span class="pre">sys.exit(errorCode)</span></code> (where <code class="docutils literal notranslate"><span class="pre">errorCode</span></code> is set 0 for success and other value to indicate error).</p>
</section>
<section id="launch-slicer-directly-from-a-web-browser">
<h3>Launch Slicer directly from a web browser<a class="headerlink" href="#launch-slicer-directly-from-a-web-browser" title="Link to this heading"></a></h3>
<p>Slicer can be associated with the <code class="docutils literal notranslate"><span class="pre">slicer:</span></code> custom URL protocol in the operating system or web browser. This is done automatically in the Windows installer and can be set up on other operating systems manually. After this when the user clicks on a <code class="docutils literal notranslate"><span class="pre">slicer://...</span></code> URL in the web browser, Slicer will start and the <code class="docutils literal notranslate"><span class="pre">slicer.app</span></code> object emits a signal with the URL that modules can process. The DICOM module processes DICOMweb URLs, but any module can specify additional actions.</p>
<p>For example, <a class="reference external" href="https://gist.github.com/lassoan/534298ee567000a37b3cb89de01750b8">this module</a> will download and view any image if the user clicks on an URL like this in the web browser:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>slicer://viewer/?download=https%3A%2F%2Fgithub.com%2Frbumm%2FSlicerLungCTAnalyzer%2Freleases%2Fdownload%2FSampleData%2FLungCTAnalyzerChestCT.nrrd
</pre></div>
</div>
<p>For reference, the DICOM module downloads a study from a DICOMweb server and shows it when providing a URL like this (which is used for example in the <a class="reference external" href="https://kheops.online/">Kheops DICOM data sharing platform</a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>slicer://viewer/?studyUID=2.16.840.1.113669.632.20.121711.10000158860
    &amp;access_token=k0zR6WAPpNbVguQ8gGUHp6
    &amp;dicomweb_endpoint=http%3A%2F%2Fdemo.kheops.online%2Fapi
    &amp;dicomweb_uri_endpoint=%20http%3A%2F%2Fdemo.kheops.online%2Fapi%2Fwado
</pre></div>
</div>
</section>
</section>
<section id="mrml-scene">
<h2>MRML scene<a class="headerlink" href="#mrml-scene" title="Link to this heading"></a></h2>
<section id="get-mrml-node-from-the-scene">
<h3>Get MRML node from the scene<a class="headerlink" href="#get-mrml-node-from-the-scene" title="Link to this heading"></a></h3>
<p>Get markups point list node named <code class="docutils literal notranslate"><span class="pre">F</span></code> (useful for quickly getting access to a MRML node in the Python console):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pointListNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
<span class="c1"># do something with the node... let&#39;s remove the first control point in it</span>
<span class="n">pointListNode</span><span class="o">.</span><span class="n">RemoveNthControlPoint</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>Getting the first volume node without knowing its name (useful if there is only one volume loaded):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">volumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetFirstNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLScalarVolumeNode&quot;</span><span class="p">)</span>
<span class="c1"># do something with the node... let&#39;s change its display window/level</span>
<span class="n">volumeNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetAutoWindowLevel</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">volumeNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetWindowLevelMinMax</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p><a class="reference internal" href="slicer.html#slicer.util.getNode" title="slicer.util.getNode"><code class="xref py py-func docutils literal notranslate"><span class="pre">slicer.util.getNode()</span></code></a> is recommended <strong>only for interactive debugging</strong> in the Python console/Jupyter notebook</p>
<ul>
<li><p>its input is intentionally defined vaguely (it can be either node ID or name and you can use wildcards such as <code class="docutils literal notranslate"><span class="pre">*</span></code>), which is good because it make it simpler to use, but the uncertain behavior is not good for general-purpose use in a module</p></li>
<li><p>throws an exception so that the developer knows immediately that there was a typo or other unexpected error</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">slicer.mrmlScene.GetNodeByID()</span></code> is more appropriate when a module needs to access a MRML node:</p>
<ul>
<li><p>its behavior is more predictable: it only accepts node ID as input. <code class="docutils literal notranslate"><span class="pre">slicer.mrmlScene.GetFirstNodeByName()</span></code> can be used to get a node by its name, but since multiple nodes in the scene can have the same name, it is not recommended to keep reference to a node by its name. Since node IDs may change when a scene is saved and reloaded, node ID should not be stored persistently, but <a class="reference internal" href="mrml_overview.html#mrml-node-references"><span class="std std-ref">node references</span></a> must be used instead</p></li>
<li><p>if node is not found it returns <code class="docutils literal notranslate"><span class="pre">None</span></code> (instead of throwing an exception), because this is often not considered an error in module code (it is just used to check existence of a node) and using return value for not-found nodes allows simpler syntax</p></li>
</ul>
</li>
</ul>
</div>
</section>
<section id="clone-a-node">
<h3>Clone a node<a class="headerlink" href="#clone-a-node" title="Link to this heading"></a></h3>
<p>This example shows how to make a copy of any node that appears in Subject Hierarchy (in Data module).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get a node from SampleData that we will clone</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">SampleData</span>
<span class="n">nodeToClone</span> <span class="o">=</span> <span class="n">SampleData</span><span class="o">.</span><span class="n">SampleDataLogic</span><span class="p">()</span><span class="o">.</span><span class="n">downloadMRHead</span><span class="p">()</span>

<span class="c1"># Clone the node</span>
<span class="n">shNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLSubjectHierarchyNode</span><span class="o">.</span><span class="n">GetSubjectHierarchyNode</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="p">)</span>
<span class="n">itemIDToClone</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemByDataNode</span><span class="p">(</span><span class="n">nodeToClone</span><span class="p">)</span>
<span class="n">clonedItemID</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">subjecthierarchy</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">CloneSubjectHierarchyItem</span><span class="p">(</span><span class="n">shNode</span><span class="p">,</span> <span class="n">itemIDToClone</span><span class="p">)</span>
<span class="n">clonedNode</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemDataNode</span><span class="p">(</span><span class="n">clonedItemID</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="save-a-node-to-file">
<h3>Save a node to file<a class="headerlink" href="#save-a-node-to-file" title="Link to this heading"></a></h3>
<p>Save a transform node to file (should work with any other node type, if file extension is set to a supported one):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">myNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;LinearTransform_3&quot;</span><span class="p">)</span>

<span class="n">myStorageNode</span> <span class="o">=</span> <span class="n">myNode</span><span class="o">.</span><span class="n">CreateDefaultStorageNode</span><span class="p">()</span>
<span class="n">myStorageNode</span><span class="o">.</span><span class="n">SetFileName</span><span class="p">(</span><span class="s2">&quot;c:/tmp/something.tfm&quot;</span><span class="p">)</span>
<span class="n">myStorageNode</span><span class="o">.</span><span class="n">WriteData</span><span class="p">(</span><span class="n">myNode</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="save-the-scene-into-a-single-mrb-file">
<h3>Save the scene into a single MRB file<a class="headerlink" href="#save-the-scene-into-a-single-mrb-file" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate file name</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="n">sceneSaveFilename</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">temporaryPath</span> <span class="o">+</span> <span class="s2">&quot;/saved-scene-&quot;</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">-%H%M%S&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.mrb&quot;</span>

<span class="c1"># Save scene</span>
<span class="k">if</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">saveScene</span><span class="p">(</span><span class="n">sceneSaveFilename</span><span class="p">):</span>
  <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Scene saved to: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sceneSaveFilename</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
  <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Scene saving failed&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="save-the-scene-into-a-new-directory">
<h3>Save the scene into a new directory<a class="headerlink" href="#save-the-scene-into-a-new-directory" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a new directory where the scene will be saved into</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="n">sceneSaveDirectory</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">temporaryPath</span> <span class="o">+</span> <span class="s2">&quot;/saved-scene-&quot;</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">-%H%M%S&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">sceneSaveDirectory</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">F_OK</span><span class="p">):</span>
  <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">sceneSaveDirectory</span><span class="p">)</span>

<span class="c1"># Save the scene</span>
<span class="k">if</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">applicationLogic</span><span class="p">()</span><span class="o">.</span><span class="n">SaveSceneToSlicerDataBundleDirectory</span><span class="p">(</span><span class="n">sceneSaveDirectory</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
  <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Scene saved to: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sceneSaveDirectory</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
  <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Scene saving failed&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="override-default-scene-save-dialog">
<h3>Override default scene save dialog<a class="headerlink" href="#override-default-scene-save-dialog" title="Link to this heading"></a></h3>
<p>Place this class in the scripted module file to override</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MyModuleFileDialog</span> <span class="p">():</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;This specially named class is detected by the scripted loadable</span>
<span class="sd">  module and is the target for optional drag and drop operations.</span>
<span class="sd">  See: Base/QTGUI/qSlicerScriptedFileDialog.h.</span>

<span class="sd">  This class is used for overriding default scene save dialog</span>
<span class="sd">  with simple saving the scene without asking anything.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">qSlicerFileDialog</span> <span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">qSlicerFileDialog</span> <span class="o">=</span> <span class="n">qSlicerFileDialog</span>
    <span class="n">qSlicerFileDialog</span><span class="o">.</span><span class="n">fileType</span> <span class="o">=</span> <span class="s2">&quot;NoFile&quot;</span>
    <span class="n">qSlicerFileDialog</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Save scene&quot;</span>
    <span class="n">qSlicerFileDialog</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">qSlicerFileDialog</span><span class="o">.</span><span class="n">Write</span>

  <span class="k">def</span><span class="w"> </span><span class="nf">execDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Implement custom scene save operation here.</span>
    <span class="c1"># Return True if saving completed successfully,</span>
    <span class="c1"># return False if saving was cancelled.</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">saved</span>
</pre></div>
</div>
</section>
<section id="override-application-close-behavior">
<h3>Override application close behavior<a class="headerlink" href="#override-application-close-behavior" title="Link to this heading"></a></h3>
<p>When application close is requested then by default confirmation popup is displayed. To customize this behavior (for example, allow application closing without displaying default confirmation popup) an event filter can be installed for the close event on the main window:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">CloseApplicationEventFilter</span><span class="p">(</span><span class="n">qt</span><span class="o">.</span><span class="n">QWidget</span><span class="p">):</span>
  <span class="k">def</span><span class="w"> </span><span class="nf">eventFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">qt</span><span class="o">.</span><span class="n">QEvent</span><span class="o">.</span><span class="n">Close</span><span class="p">:</span>
      <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
      <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>

<span class="nb">filter</span> <span class="o">=</span> <span class="n">CloseApplicationEventFilter</span><span class="p">()</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">()</span><span class="o">.</span><span class="n">installEventFilter</span><span class="p">(</span><span class="nb">filter</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="change-default-output-file-type-for-new-nodes">
<h3>Change default output file type for new nodes<a class="headerlink" href="#change-default-output-file-type-for-new-nodes" title="Link to this heading"></a></h3>
<p>This script changes default output file format for nodes that have not been saved yet (do not have storage node yet).</p>
<p>Default node can be specified that will be used as a basis of all new storage nodes. This can be used for setting default file extension. For example, change file format to PLY for model nodes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">defaultModelStorageNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLModelStorageNode</span><span class="p">()</span>
<span class="n">defaultModelStorageNode</span><span class="o">.</span><span class="n">SetDefaultWriteFileExtension</span><span class="p">(</span><span class="s2">&quot;ply&quot;</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddDefaultNode</span><span class="p">(</span><span class="n">defaultModelStorageNode</span><span class="p">)</span>
</pre></div>
</div>
<p>To permanently change default file extension on your computer, copy-paste the code above into your application startup script (you can find its location in menu: Edit / Application settings / General / Application startup script).</p>
</section>
<section id="change-file-type-for-saving-for-existing-nodes">
<h3>Change file type for saving for existing nodes<a class="headerlink" href="#change-file-type-for-saving-for-existing-nodes" title="Link to this heading"></a></h3>
<p>This script changes output file types for nodes that have been already saved (they already have storage node).</p>
<p>If it is not necessary to preserve file paths then the simplest is to configure default storage node (as shown in the example above), then delete all existing storage nodes. When save dialog is opened, default storage nodes will be recreated.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Delete existing model storage nodes so that they will be recreated with default settings</span>
<span class="n">existingModelStorageNodes</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNodesByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLModelStorageNode&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">modelStorageNode</span> <span class="ow">in</span> <span class="n">existingModelStorageNodes</span><span class="p">:</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">RemoveNode</span><span class="p">(</span><span class="n">modelStorageNode</span><span class="p">)</span>
</pre></div>
</div>
<p>To update existing storage nodes to use new file extension (but keep all other parameters unchanged) you can use this approach (example is for volume storage):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requiredFileExtension</span> <span class="o">=</span> <span class="s2">&quot;.nia&quot;</span>
<span class="n">originalFileExtension</span> <span class="o">=</span> <span class="s2">&quot;.nrrd&quot;</span>
<span class="n">volumeNodes</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNodesByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLScalarVolumeNode&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">volumeNode</span> <span class="ow">in</span> <span class="n">volumeNodes</span><span class="p">:</span>
  <span class="n">volumeStorageNode</span> <span class="o">=</span> <span class="n">volumeNode</span><span class="o">.</span><span class="n">GetStorageNode</span><span class="p">()</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">volumeStorageNode</span><span class="p">:</span>
    <span class="n">volumeNode</span><span class="o">.</span><span class="n">AddDefaultStorageNode</span><span class="p">()</span>
    <span class="n">volumeStorageNode</span> <span class="o">=</span> <span class="n">volumeNode</span><span class="o">.</span><span class="n">GetStorageNode</span><span class="p">()</span>
    <span class="n">volumeStorageNode</span><span class="o">.</span><span class="n">SetFileName</span><span class="p">(</span><span class="n">volumeNode</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span><span class="o">+</span><span class="n">requiredFileExtension</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">volumeStorageNode</span><span class="o">.</span><span class="n">SetFileName</span><span class="p">(</span><span class="n">volumeStorageNode</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">originalFileExtension</span><span class="p">,</span> <span class="n">requiredFileExtension</span><span class="p">))</span>
</pre></div>
</div>
<p>To set all volume nodes to save uncompressed by default (add this to <a class="reference internal" href="../user_guide/settings.html#application-startup-file"><span class="std std-ref">slicerrc.py file</span></a> so it takes effect for the whole session):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set the default volume storage to not compress by default</span>
<span class="n">defaultVolumeStorageNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLVolumeArchetypeStorageNode</span><span class="p">()</span>
<span class="n">defaultVolumeStorageNode</span><span class="o">.</span><span class="n">SetUseCompression</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddDefaultNode</span><span class="p">(</span><span class="n">defaultVolumeStorageNode</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Volume nodes will be stored uncompressed by default&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Same thing as above, but applied to all segmentations instead of volumes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set the default segmentation storage to not compress by default</span>
<span class="n">defaultSegmentationStorageNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLSegmentationStorageNode</span><span class="p">()</span>
<span class="n">defaultSegmentationStorageNode</span><span class="o">.</span><span class="n">SetUseCompression</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddDefaultNode</span><span class="p">(</span><span class="n">defaultSegmentationStorageNode</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Segmentation nodes will be stored uncompressed by default&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="module-selection">
<h2>Module selection<a class="headerlink" href="#module-selection" title="Link to this heading"></a></h2>
<section id="switch-to-a-different-module">
<h3>Switch to a different module<a class="headerlink" href="#switch-to-a-different-module" title="Link to this heading"></a></h3>
<p>This utility function can be used to open a different module:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">selectModule</span><span class="p">(</span><span class="s2">&quot;DICOM&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="set-a-new-default-module-at-startup">
<h3>Set a new default module at startup<a class="headerlink" href="#set-a-new-default-module-at-startup" title="Link to this heading"></a></h3>
<p>Instead of the default Welcome module:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">qt</span><span class="o">.</span><span class="n">QSettings</span><span class="p">()</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="s2">&quot;Modules/HomeModule&quot;</span><span class="p">,</span> <span class="s2">&quot;Data&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="views">
<h2>Views<a class="headerlink" href="#views" title="Link to this heading"></a></h2>
<section id="display-text-in-a-3d-view-or-slice-view">
<h3>Display text in a 3D view or slice view<a class="headerlink" href="#display-text-in-a-3d-view-or-slice-view" title="Link to this heading"></a></h3>
<p>The easiest way to show information overlaid on a viewer is to use corner annotations.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">view</span><span class="o">=</span><span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">threeDWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">threeDView</span><span class="p">()</span>
<span class="c1"># Set text to &quot;Something&quot;</span>
<span class="n">view</span><span class="o">.</span><span class="n">cornerAnnotation</span><span class="p">()</span><span class="o">.</span><span class="n">SetText</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkCornerAnnotation</span><span class="o">.</span><span class="n">UpperRight</span><span class="p">,</span><span class="s2">&quot;Something&quot;</span><span class="p">)</span>
<span class="c1"># Set color to red</span>
<span class="n">view</span><span class="o">.</span><span class="n">cornerAnnotation</span><span class="p">()</span><span class="o">.</span><span class="n">GetTextProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Update the view</span>
<span class="n">view</span><span class="o">.</span><span class="n">forceRender</span><span class="p">()</span>
</pre></div>
</div>
<p>To display text in slice views, replace the first line by this line (and consider hiding slice view annotations, to prevent them from overwriting the text you place there):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">view</span><span class="o">=</span><span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">sliceWidget</span><span class="p">(</span><span class="s2">&quot;Red&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sliceView</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="activate-hanging-protocol-by-keyboard-shortcut">
<h3>Activate hanging protocol by keyboard shortcut<a class="headerlink" href="#activate-hanging-protocol-by-keyboard-shortcut" title="Link to this heading"></a></h3>
<p>This code snippet shows how to specify a hanging protocol for PET/CT with the following properties:</p>
<ul class="simple">
<li><p>window/level and colormap is set to standardized values</p></li>
<li><p>any acquisition transforms hardened on the images (these transforms are created for example when the image is acquired with varying slice spacing)</p></li>
<li><p>show PET/CT images fused in slice views</p></li>
<li><p>show PET image and fused image slices in 3D view</p></li>
</ul>
<p>The hanging protocol can be activated using the Ctrl+9 keyboard shortcut.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">useHangingProtocolPetCt</span><span class="p">():</span>
    <span class="n">ctImage</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">petImage</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">shNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLSubjectHierarchyNode</span><span class="o">.</span><span class="n">GetSubjectHierarchyNode</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="p">)</span>
    <span class="n">petColor</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetFirstNodeByName</span><span class="p">(</span><span class="s1">&#39;PET-Heat&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">imageNode</span> <span class="ow">in</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNodesByClass</span><span class="p">(</span><span class="s1">&#39;vtkMRMLScalarVolumeNode&#39;</span><span class="p">):</span>
        <span class="c1"># Harden any transform (in case the image is stored non-uniform spacing, etc.</span>
        <span class="c1"># hardening the acquisition transforms creates a single Cartesian volume)</span>
        <span class="n">imageNode</span><span class="o">.</span><span class="n">HardenTransform</span><span class="p">()</span>

        <span class="c1"># Set window/level and colormap for recognized image types</span>
        <span class="n">imageItem</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemByDataNode</span><span class="p">(</span><span class="n">imageNode</span><span class="p">)</span>
        <span class="n">modality</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemAttribute</span><span class="p">(</span><span class="n">imageItem</span><span class="p">,</span> <span class="s1">&#39;DICOM.Modality&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">modality</span> <span class="o">==</span> <span class="s2">&quot;CT&quot;</span><span class="p">:</span>
            <span class="n">ctImage</span> <span class="o">=</span> <span class="n">imageNode</span>
            <span class="n">ctImage</span><span class="o">.</span><span class="n">GetVolumeDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetAndObserveColorNodeID</span><span class="p">(</span><span class="n">petColor</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
            <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">volumes</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">ApplyVolumeDisplayPreset</span><span class="p">(</span><span class="n">ctImage</span><span class="o">.</span><span class="n">GetVolumeDisplayNode</span><span class="p">(),</span> <span class="s2">&quot;CT_ABDOMEN&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">modality</span> <span class="o">==</span> <span class="s2">&quot;PT&quot;</span><span class="p">:</span>
            <span class="n">petImage</span> <span class="o">=</span> <span class="n">imageNode</span>
            <span class="n">petImage</span><span class="o">.</span><span class="n">GetVolumeDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetAndObserveColorNodeID</span><span class="p">(</span><span class="n">petColor</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
            <span class="n">petImage</span><span class="o">.</span><span class="n">GetVolumeDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetWindowLevelMinMax</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

    <span class="c1"># Set up view layout and content</span>
    <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLLayoutNode</span><span class="o">.</span><span class="n">SlicerLayoutFourUpView</span><span class="p">)</span>
    <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">setSliceViewerLayers</span><span class="p">(</span><span class="n">background</span><span class="o">=</span><span class="n">ctImage</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="n">petImage</span><span class="p">,</span> <span class="n">foregroundOpacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Show the PET image in 3D view using volume rendering</span>
    <span class="n">vrLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">volumerendering</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span>
    <span class="n">vrDisplayNode</span> <span class="o">=</span> <span class="n">vrLogic</span><span class="o">.</span><span class="n">CreateDefaultVolumeRenderingNodes</span><span class="p">(</span><span class="n">petImage</span><span class="p">)</span>
    <span class="n">vrDisplayNode</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Use the same window/level and colormap settings for volume rendering as for slice display</span>
    <span class="n">vrDisplayNode</span><span class="o">.</span><span class="n">SetFollowVolumeDisplayNode</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Show slice views in 3D view</span>
    <span class="n">layoutManager</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">sliceViewName</span> <span class="ow">in</span> <span class="n">layoutManager</span><span class="o">.</span><span class="n">sliceViewNames</span><span class="p">():</span>
        <span class="n">controller</span> <span class="o">=</span> <span class="n">layoutManager</span><span class="o">.</span><span class="n">sliceWidget</span><span class="p">(</span><span class="n">sliceViewName</span><span class="p">)</span><span class="o">.</span><span class="n">sliceController</span><span class="p">()</span>
        <span class="n">controller</span><span class="o">.</span><span class="n">setSliceVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Center and fit displayed content in 3D view</span>
    <span class="n">layoutManager</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span>
    <span class="n">threeDWidget</span> <span class="o">=</span> <span class="n">layoutManager</span><span class="o">.</span><span class="n">threeDWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">threeDView</span> <span class="o">=</span> <span class="n">threeDWidget</span><span class="o">.</span><span class="n">threeDView</span><span class="p">()</span>
    <span class="n">threeDView</span><span class="o">.</span><span class="n">rotateToViewAxis</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># look from anterior direction</span>
    <span class="n">threeDView</span><span class="o">.</span><span class="n">resetFocalPoint</span><span class="p">()</span>  <span class="c1"># reset the 3D view cube size and center it</span>
    <span class="n">threeDView</span><span class="o">.</span><span class="n">resetCamera</span><span class="p">()</span>  <span class="c1"># reset camera zoom</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">ctImage</span><span class="p">,</span> <span class="n">petImage</span><span class="p">]</span>

<span class="c1"># Register keyboard shortcut</span>
<span class="n">shortcut</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">QShortcut</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">())</span>
<span class="n">shortcut</span><span class="o">.</span><span class="n">setKey</span><span class="p">(</span><span class="n">qt</span><span class="o">.</span><span class="n">QKeySequence</span><span class="p">(</span><span class="s2">&quot;Ctrl+9&quot;</span><span class="p">))</span>
<span class="n">shortcut</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="s2">&quot;activated()&quot;</span><span class="p">,</span> <span class="n">useHangingProtocolPetCt</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="show-orientation-marker-in-all-views">
<h3>Show orientation marker in all views<a class="headerlink" href="#show-orientation-marker-in-all-views" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">viewNodes</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNodesByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLAbstractViewNode&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">viewNode</span> <span class="ow">in</span> <span class="n">viewNodes</span><span class="p">:</span>
  <span class="n">viewNode</span><span class="o">.</span><span class="n">SetOrientationMarkerType</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLAbstractViewNode</span><span class="o">.</span><span class="n">OrientationMarkerTypeAxes</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="change-view-axis-labels">
<h3>Change view axis labels<a class="headerlink" href="#change-view-axis-labels" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">]</span>
<span class="n">viewNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">threeDWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mrmlViewNode</span><span class="p">()</span>
<span class="c1"># for slice view:</span>
<span class="c1"># viewNode = slicer.app.layoutManager().sliceWidget(&quot;Red&quot;).mrmlSliceNode()</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
  <span class="n">viewNode</span><span class="o">.</span><span class="n">SetAxisLabel</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="hide-view-controller-bars">
<h3>Hide view controller bars<a class="headerlink" href="#hide-view-controller-bars" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">threeDWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">threeDController</span><span class="p">()</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">sliceWidget</span><span class="p">(</span><span class="s2">&quot;Red&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sliceController</span><span class="p">()</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">plotWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plotController</span><span class="p">()</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">tableWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tableController</span><span class="p">()</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="hide-slicer-logo-from-main-window">
<h3>Hide Slicer logo from main window<a class="headerlink" href="#hide-slicer-logo-from-main-window" title="Link to this heading"></a></h3>
<p>This script increases vertical space available in the module panel by hiding the Slicer application logo.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">(),</span> <span class="s2">&quot;LogoLabel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</section>
<section id="customize-widgets-in-view-controller-bars">
<h3>Customize widgets in view controller bars<a class="headerlink" href="#customize-widgets-in-view-controller-bars" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sliceController</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">sliceWidget</span><span class="p">(</span><span class="s2">&quot;Red&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sliceController</span><span class="p">()</span>

<span class="c1"># hide what is not needed</span>
<span class="n">sliceController</span><span class="o">.</span><span class="n">pinButton</span><span class="p">()</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
<span class="c1">#sliceController.viewLabel().hide()</span>
<span class="n">sliceController</span><span class="o">.</span><span class="n">fitToWindowToolButton</span><span class="p">()</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
<span class="n">sliceController</span><span class="o">.</span><span class="n">sliceOffsetSlider</span><span class="p">()</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

<span class="c1"># add custom widgets</span>
<span class="n">myButton</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;My custom button&quot;</span><span class="p">)</span>
<span class="n">sliceController</span><span class="o">.</span><span class="n">barLayout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">myButton</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="display-a-node-in-only-some-views">
<h3>Display a node in only some views<a class="headerlink" href="#display-a-node-in-only-some-views" title="Link to this heading"></a></h3>
<p>Show a displayable node in a predefined set of views. Here, show a markups line only in <code class="docutils literal notranslate"><span class="pre">Red+</span></code>, <code class="docutils literal notranslate"><span class="pre">Green+</span></code> and <code class="docutils literal notranslate"><span class="pre">Yellow+</span></code> views.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">displayableNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>

<span class="n">viewNodeIDs</span> <span class="o">=</span> <span class="p">[</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">sliceWidget</span><span class="p">(</span><span class="n">viewName</span><span class="p">)</span><span class="o">.</span><span class="n">mrmlSliceNode</span><span class="p">()</span><span class="o">.</span><span class="n">GetID</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">viewName</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Red+&quot;</span><span class="p">,</span> <span class="s2">&quot;Green+&quot;</span><span class="p">,</span> <span class="s2">&quot;Yellow+&quot;</span><span class="p">]</span>
<span class="p">]</span>

<span class="n">displayableNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetViewNodeIDs</span><span class="p">(</span><span class="n">viewNodeIDs</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="get-current-mouse-coordinates-in-a-slice-view">
<h3>Get current mouse coordinates in a slice view<a class="headerlink" href="#get-current-mouse-coordinates-in-a-slice-view" title="Link to this heading"></a></h3>
<p>You can get 3D (RAS) coordinates of the current mouse cursor from the crosshair singleton node as shown in the example below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">onMouseMoved</span><span class="p">(</span><span class="n">observer</span><span class="p">,</span><span class="n">eventid</span><span class="p">):</span>
  <span class="n">ras</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">crosshairNode</span><span class="o">.</span><span class="n">GetCursorPositionRAS</span><span class="p">(</span><span class="n">ras</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">ras</span><span class="p">)</span>

<span class="n">crosshairNode</span><span class="o">=</span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Crosshair&quot;</span><span class="p">)</span>
<span class="n">crosshairNode</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLCrosshairNode</span><span class="o">.</span><span class="n">CursorPositionModifiedEvent</span><span class="p">,</span> <span class="n">onMouseMoved</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="display-crosshair-at-a-3d-position">
<h3>Display crosshair at a 3D position<a class="headerlink" href="#display-crosshair-at-a-3d-position" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">position_RAS</span> <span class="o">=</span> <span class="p">[</span><span class="mf">23.4</span><span class="p">,</span> <span class="mf">5.6</span><span class="p">,</span> <span class="mf">78.9</span><span class="p">]</span>
<span class="n">crosshairNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Crosshair&quot;</span><span class="p">)</span>
<span class="c1"># Set crosshair position</span>
<span class="n">crosshairNode</span><span class="o">.</span><span class="n">SetCrosshairRAS</span><span class="p">(</span><span class="n">position_RAS</span><span class="p">)</span>
<span class="c1"># Center the position in all slice views</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLSliceNode</span><span class="o">.</span><span class="n">JumpAllSlices</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="p">,</span> <span class="o">*</span><span class="n">position_RAS</span><span class="p">,</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLSliceNode</span><span class="o">.</span><span class="n">CenteredJumpSlice</span><span class="p">)</span>
<span class="c1"># Make the crosshair visible</span>
<span class="n">crosshairNode</span><span class="o">.</span><span class="n">SetCrosshairMode</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLCrosshairNode</span><span class="o">.</span><span class="n">ShowBasic</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Crosshair node stores two positions: Cursor position is the current position of the mouse pointer in a slice or 3D view (modules should only read this position). Crosshair position is the location of the visible crosshair in views (modules can read or write this position).</p>
</div>
</section>
<section id="change-the-crosshair-color">
<h3>Change the crosshair color<a class="headerlink" href="#change-the-crosshair-color" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the crosshair node</span>
<span class="n">crosshairNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Crosshair&quot;</span><span class="p">)</span>
<span class="c1"># Set the crosshair color to Red</span>
<span class="n">crosshairNode</span><span class="o">.</span><span class="n">SetCrosshairColor</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="display-mouse-pointer-coordinates-in-alternative-coordinate-system">
<h3>Display mouse pointer coordinates in alternative coordinate system<a class="headerlink" href="#display-mouse-pointer-coordinates-in-alternative-coordinate-system" title="Link to this heading"></a></h3>
<p>The Data probe only shows coordinate values in the world coordinate system. You can make the world coordinate system mean anything you want (e.g., MNI) by applying a transform to the volume that transforms it into that space. See more details in <a class="reference external" href="https://discourse.slicer.org/t/setting-an-mni-origo-to-a-volume/16164/4">here </a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">onMouseMoved</span><span class="p">(</span><span class="n">observer</span><span class="p">,</span><span class="n">eventid</span><span class="p">):</span>
  <span class="n">mniToWorldTransformNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;LinearTransform_3&quot;</span><span class="p">)</span>  <span class="c1"># replace this by the name of your actual MNI to world transform</span>
  <span class="n">worldToMniTransform</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkGeneralTransform</span><span class="p">()</span>
  <span class="n">mniToWorldTransformNode</span><span class="o">.</span><span class="n">GetTransformToWorld</span><span class="p">(</span><span class="n">worldToMniTransform</span><span class="p">)</span>
  <span class="n">ras</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">mni</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">crosshairNode</span><span class="o">.</span><span class="n">GetCursorPositionRAS</span><span class="p">(</span><span class="n">ras</span><span class="p">)</span>
  <span class="n">worldToMniTransform</span><span class="o">.</span><span class="n">TransformPoint</span><span class="p">(</span><span class="n">ras</span><span class="p">,</span> <span class="n">mni</span><span class="p">)</span>
  <span class="n">_ras</span> <span class="o">=</span> <span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ras</span><span class="p">])</span>
  <span class="n">_mni</span> <span class="o">=</span> <span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">mni</span><span class="p">])</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">showStatusMessage</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RAS=</span><span class="si">{</span><span class="n">_ras</span><span class="si">}</span><span class="s2">   MNI=</span><span class="si">{</span><span class="n">_mni</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">crosshairNode</span><span class="o">=</span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Crosshair&quot;</span><span class="p">)</span>
<span class="n">observationId</span> <span class="o">=</span> <span class="n">crosshairNode</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLCrosshairNode</span><span class="o">.</span><span class="n">CursorPositionModifiedEvent</span><span class="p">,</span> <span class="n">onMouseMoved</span><span class="p">)</span>

<span class="c1"># Run this to stop displaying values:</span>
<span class="c1"># crosshairNode.RemoveObserver(observationId)</span>
</pre></div>
</div>
</section>
<section id="get-3d-coordinates-from-2d-display-coordinates">
<h3>Get 3D coordinates from 2D display coordinates<a class="headerlink" href="#get-3d-coordinates-from-2d-display-coordinates" title="Link to this heading"></a></h3>
<p>If 2D display position (in pixels) of a model’s surface point is known then this code snippet can compute its position in 3D (in world coordinate system).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display position is in pixels, origin is top-left corner</span>
<span class="n">displayPosition</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>

<span class="c1"># Get model displayable manager</span>
<span class="n">threeDViewNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetNodeByID</span><span class="p">(</span><span class="s2">&quot;vtkMRMLViewNode1&quot;</span><span class="p">)</span>
<span class="n">appLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">applicationLogic</span><span class="p">()</span>
<span class="n">modelDisplayableManager</span> <span class="o">=</span> <span class="n">appLogic</span><span class="o">.</span><span class="n">GetViewDisplayableManagerByClassName</span><span class="p">(</span><span class="n">threeDViewNode</span><span class="p">,</span> <span class="s2">&quot;vtkMRMLModelDisplayableManager&quot;</span><span class="p">)</span>

<span class="c1"># Use model displayable manager&#39;s point picker</span>
<span class="k">if</span> <span class="n">modelDisplayableManager</span><span class="o">.</span><span class="n">Pick</span><span class="p">(</span><span class="n">displayPosition</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">displayPosition</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="n">modelDisplayableManager</span><span class="o">.</span><span class="n">GetPickedNodeID</span><span class="p">():</span>
    <span class="n">rasPosition</span> <span class="o">=</span> <span class="n">modelDisplayableManager</span><span class="o">.</span><span class="n">GetPickedRAS</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">rasPosition</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No model is visible at </span><span class="si">{</span><span class="n">displayPosition</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="get-dataprobe-text">
<h3>Get DataProbe text<a class="headerlink" href="#get-dataprobe-text" title="Link to this heading"></a></h3>
<p>You can get the mouse location in pixel coordinates along with the pixel value at the mouse by hitting the <code class="docutils literal notranslate"><span class="pre">.</span></code> (period) key in a slice view after pasting in the following code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">printDataProbe</span><span class="p">():</span>
  <span class="n">infoWidget</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">DataProbeInstance</span><span class="o">.</span><span class="n">infoWidget</span>
  <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">infoWidget</span><span class="o">.</span><span class="n">layerNames</span><span class="p">[</span><span class="n">layer</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">infoWidget</span><span class="o">.</span><span class="n">layerIJKs</span><span class="p">[</span><span class="n">layer</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">infoWidget</span><span class="o">.</span><span class="n">layerValues</span><span class="p">[</span><span class="n">layer</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">QShortcut</span><span class="p">(</span><span class="n">qt</span><span class="o">.</span><span class="n">QKeySequence</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">),</span> <span class="n">mainWindow</span><span class="p">())</span>
<span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;activated()&quot;</span><span class="p">,</span> <span class="n">printDataProbe</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="create-custom-color-table">
<h3>Create custom color table<a class="headerlink" href="#create-custom-color-table" title="Link to this heading"></a></h3>
<p>This example shows how to create a new color table, for example with inverted color range from the default Ocean color table.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">invertedocean</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLColorTableNode</span><span class="p">()</span>
<span class="n">invertedocean</span><span class="o">.</span><span class="n">SetTypeToUser</span><span class="p">()</span>
<span class="n">invertedocean</span><span class="o">.</span><span class="n">SetNumberOfColors</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
<span class="n">invertedocean</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="s2">&quot;InvertedOcean&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">):</span>
  <span class="n">invertedocean</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mf">1e-16</span><span class="p">)</span><span class="o">/</span><span class="mf">255.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

<span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNode</span><span class="p">(</span><span class="n">invertedocean</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="show-color-legend-for-a-volume-node">
<h3>Show color legend for a volume node<a class="headerlink" href="#show-color-legend-for-a-volume-node" title="Link to this heading"></a></h3>
<p>Display color legend for a volume node in slice views (and in 3D views, if the slice is displayed in 3D):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">volumeNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s1">&#39;MRHead&#39;</span><span class="p">)</span>
<span class="n">colorLegendDisplayNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">AddDefaultColorLegendDisplayNode</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="create-custom-color-map-and-display-color-legend">
<h3>Create custom color map and display color legend<a class="headerlink" href="#create-custom-color-map-and-display-color-legend" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">modelNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s1">&#39;MyModel&#39;</span><span class="p">)</span>  <span class="c1"># color legend requires a displayable node</span>
<span class="n">colorTableRangeMm</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">title</span> <span class="o">=</span><span class="s2">&quot;Radial</span><span class="se">\n</span><span class="s2">Compression</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="n">labelFormat</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%4.1f</span><span class="s2"> mm&quot;</span>

<span class="c1"># Create color node</span>
<span class="n">colorNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">CreateNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLProceduralColorNode&quot;</span><span class="p">)</span>
<span class="n">colorNode</span><span class="o">.</span><span class="n">UnRegister</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># to prevent memory leaks</span>
<span class="n">colorNode</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GenerateUniqueName</span><span class="p">(</span><span class="s2">&quot;MyColormap&quot;</span><span class="p">))</span>
<span class="n">colorNode</span><span class="o">.</span><span class="n">SetAttribute</span><span class="p">(</span><span class="s2">&quot;Category&quot;</span><span class="p">,</span> <span class="s2">&quot;MyModule&quot;</span><span class="p">)</span>
<span class="c1"># The color node is a procedural color node, which is saved using a storage node.</span>
<span class="c1"># Hidden nodes are not saved if they use a storage node, therefore</span>
<span class="c1"># the color node must be visible.</span>
<span class="n">colorNode</span><span class="o">.</span><span class="n">SetHideFromEditors</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNode</span><span class="p">(</span><span class="n">colorNode</span><span class="p">)</span>

<span class="c1"># Specify colormap</span>
<span class="n">colorMap</span> <span class="o">=</span> <span class="n">colorNode</span><span class="o">.</span><span class="n">GetColorTransferFunction</span><span class="p">()</span>
<span class="n">colorMap</span><span class="o">.</span><span class="n">RemoveAllPoints</span><span class="p">()</span>
<span class="n">colorMap</span><span class="o">.</span><span class="n">AddRGBPoint</span><span class="p">(</span><span class="n">colorTableRangeMm</span> <span class="o">*</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">colorMap</span><span class="o">.</span><span class="n">AddRGBPoint</span><span class="p">(</span><span class="n">colorTableRangeMm</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">colorMap</span><span class="o">.</span><span class="n">AddRGBPoint</span><span class="p">(</span><span class="n">colorTableRangeMm</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="n">colorMap</span><span class="o">.</span><span class="n">AddRGBPoint</span><span class="p">(</span><span class="n">colorTableRangeMm</span> <span class="o">*</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

<span class="c1"># Display color legend</span>
<span class="n">modelNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetAndObserveColorNodeID</span><span class="p">(</span><span class="n">colorNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
<span class="n">colorLegendDisplayNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">AddDefaultColorLegendDisplayNode</span><span class="p">(</span><span class="n">modelNode</span><span class="p">)</span>
<span class="n">colorLegendDisplayNode</span><span class="o">.</span><span class="n">SetTitleText</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<span class="n">colorLegendDisplayNode</span><span class="o">.</span><span class="n">SetLabelFormat</span><span class="p">(</span><span class="n">labelFormat</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="customize-view-layout">
<h3>Customize view layout<a class="headerlink" href="#customize-view-layout" title="Link to this heading"></a></h3>
<p>Show a custom layout of a 3D view on top of the red slice view:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">customLayout</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;layout type=&quot;vertical&quot; split=&quot;true&quot;&gt;</span>
<span class="s2">  &lt;item&gt;</span>
<span class="s2">  &lt;view class=&quot;vtkMRMLViewNode&quot; singletontag=&quot;1&quot;&gt;</span>
<span class="s2">    &lt;property name=&quot;viewlabel&quot; action=&quot;default&quot;&gt;1&lt;/property&gt;</span>
<span class="s2">  &lt;/view&gt;</span>
<span class="s2">  &lt;/item&gt;</span>
<span class="s2">  &lt;item&gt;</span>
<span class="s2">  &lt;view class=&quot;vtkMRMLSliceNode&quot; singletontag=&quot;Red&quot;&gt;</span>
<span class="s2">    &lt;property name=&quot;orientation&quot; action=&quot;default&quot;&gt;Axial&lt;/property&gt;</span>
<span class="s2">    &lt;property name=&quot;viewlabel&quot; action=&quot;default&quot;&gt;R&lt;/property&gt;</span>
<span class="s2">    &lt;property name=&quot;viewcolor&quot; action=&quot;default&quot;&gt;#F34A33&lt;/property&gt;</span>
<span class="s2">  &lt;/view&gt;</span>
<span class="s2">  &lt;/item&gt;</span>
<span class="s2">&lt;/layout&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Built-in layout IDs are all below 100, so you can choose any large random number</span>
<span class="c1"># for your custom layout ID.</span>
<span class="n">customLayoutId</span><span class="o">=</span><span class="mi">501</span>

<span class="n">layoutManager</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span>
<span class="n">layoutManager</span><span class="o">.</span><span class="n">layoutLogic</span><span class="p">()</span><span class="o">.</span><span class="n">GetLayoutNode</span><span class="p">()</span><span class="o">.</span><span class="n">AddLayoutDescription</span><span class="p">(</span><span class="n">customLayoutId</span><span class="p">,</span> <span class="n">customLayout</span><span class="p">)</span>

<span class="c1"># Switch to the new custom layout</span>
<span class="n">layoutManager</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">customLayoutId</span><span class="p">)</span>
</pre></div>
</div>
<p>See description of standard layouts (that can be used as examples) here: <a class="reference external" href="https://github.com/Slicer/Slicer/blob/main/Libs/MRML/Logic/vtkMRMLLayoutLogic.cxx">https://github.com/Slicer/Slicer/blob/main/Libs/MRML/Logic/vtkMRMLLayoutLogic.cxx</a></p>
<p>You can use this code snippet to add a button to the layout selector toolbar:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add button to layout selector toolbar for this custom layout</span>
<span class="n">viewToolBar</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="p">()</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span><span class="s2">&quot;QToolBar&quot;</span><span class="p">,</span> <span class="s2">&quot;ViewToolBar&quot;</span><span class="p">)</span>
<span class="n">layoutMenu</span> <span class="o">=</span> <span class="n">viewToolBar</span><span class="o">.</span><span class="n">widgetForAction</span><span class="p">(</span><span class="n">viewToolBar</span><span class="o">.</span><span class="n">actions</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">menu</span><span class="p">()</span>
<span class="n">layoutSwitchActionParent</span> <span class="o">=</span> <span class="n">layoutMenu</span>  <span class="c1"># use `layoutMenu` to add inside layout list, use `viewToolBar` to add next the standard layout list</span>
<span class="n">layoutSwitchAction</span> <span class="o">=</span> <span class="n">layoutSwitchActionParent</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;My view&quot;</span><span class="p">)</span> <span class="c1"># add inside layout list</span>
<span class="n">layoutSwitchAction</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">customLayoutId</span><span class="p">)</span>
<span class="n">layoutSwitchAction</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">qt</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&quot;:Icons/Go.png&quot;</span><span class="p">))</span>
<span class="n">layoutSwitchAction</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;3D and slice view&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="turn-on-slice-intersections">
<h3>Turn on slice intersections<a class="headerlink" href="#turn-on-slice-intersections" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sliceDisplayNodes</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNodesByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLSliceDisplayNode&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">sliceDisplayNode</span> <span class="ow">in</span> <span class="n">sliceDisplayNodes</span><span class="p">:</span>
  <span class="n">sliceDisplayNode</span><span class="o">.</span><span class="n">SetIntersectingSlicesVisibility</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Workaround to force visual update (see https://github.com/Slicer/Slicer/issues/6338)</span>
<span class="n">sliceNodes</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNodesByClass</span><span class="p">(</span><span class="s1">&#39;vtkMRMLSliceNode&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">sliceNode</span> <span class="ow">in</span> <span class="n">sliceNodes</span><span class="p">:</span>
    <span class="n">sliceNode</span><span class="o">.</span><span class="n">Modified</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>How to find code corresponding to a user interface widget?</p>
<p>For this one I searched for “slice intersections” text in the whole Slicer source code, found that the function is implemented in <code class="docutils literal notranslate"><span class="pre">Base\QTGUI\qSlicerViewersToolBar.cxx</span></code>, then translated the <code class="docutils literal notranslate"><span class="pre">qSlicerViewersToolBarPrivate::setSliceIntersectionVisible(bool</span> <span class="pre">visible)</span></code> method to Python.</p>
</div>
</section>
<section id="hide-slice-view-annotations">
<h3>Hide slice view annotations<a class="headerlink" href="#hide-slice-view-annotations" title="Link to this heading"></a></h3>
<p>This script can hide node name, patient information displayed in corners of slice views (managed by DataProbe module).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Disable slice annotations immediately</span>
<span class="n">sliceAnnotations</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">DataProbeInstance</span><span class="o">.</span><span class="n">infoWidget</span><span class="o">.</span><span class="n">sliceAnnotations</span>
<span class="n">sliceAnnotations</span><span class="o">.</span><span class="n">sliceViewAnnotationsEnabled</span><span class="o">=</span><span class="kc">False</span>
<span class="n">sliceAnnotations</span><span class="o">.</span><span class="n">updateSliceViewFromGUI</span><span class="p">()</span>
<span class="c1"># Disable slice annotations persistently (after Slicer restarts)</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">QSettings</span><span class="p">()</span>
<span class="n">settings</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="s2">&quot;DataProbe/sliceViewAnnotations.enabled&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="change-slice-offset">
<h3>Change slice offset<a class="headerlink" href="#change-slice-offset" title="Link to this heading"></a></h3>
<p>Equivalent to moving the slider in slice view controller.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">layoutManager</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span>
<span class="n">red</span> <span class="o">=</span> <span class="n">layoutManager</span><span class="o">.</span><span class="n">sliceWidget</span><span class="p">(</span><span class="s2">&quot;Red&quot;</span><span class="p">)</span>
<span class="n">redLogic</span> <span class="o">=</span> <span class="n">red</span><span class="o">.</span><span class="n">sliceLogic</span><span class="p">()</span>
<span class="c1"># Print current slice offset position</span>
<span class="nb">print</span><span class="p">(</span><span class="n">redLogic</span><span class="o">.</span><span class="n">GetSliceOffset</span><span class="p">())</span>
<span class="c1"># Change slice position</span>
<span class="n">redLogic</span><span class="o">.</span><span class="n">SetSliceOffset</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="change-slice-orientation">
<h3>Change slice orientation<a class="headerlink" href="#change-slice-orientation" title="Link to this heading"></a></h3>
<p>Get <code class="docutils literal notranslate"><span class="pre">Red</span></code> slice node and rotate around <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">Y</span></code> axes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sliceNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">sliceWidget</span><span class="p">(</span><span class="s2">&quot;Red&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mrmlSliceNode</span><span class="p">()</span>
<span class="n">sliceToRas</span> <span class="o">=</span> <span class="n">sliceNode</span><span class="o">.</span><span class="n">GetSliceToRAS</span><span class="p">()</span>
<span class="n">transform</span><span class="o">=</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkTransform</span><span class="p">()</span>
<span class="n">transform</span><span class="o">.</span><span class="n">SetMatrix</span><span class="p">(</span><span class="n">sliceToRas</span><span class="p">)</span>
<span class="n">transform</span><span class="o">.</span><span class="n">RotateX</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">transform</span><span class="o">.</span><span class="n">RotateY</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="n">sliceToRas</span><span class="o">.</span><span class="n">DeepCopy</span><span class="p">(</span><span class="n">transform</span><span class="o">.</span><span class="n">GetMatrix</span><span class="p">())</span>
<span class="n">sliceNode</span><span class="o">.</span><span class="n">UpdateMatrices</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="measure-angle-between-two-slice-planes">
<h3>Measure angle between two slice planes<a class="headerlink" href="#measure-angle-between-two-slice-planes" title="Link to this heading"></a></h3>
<p>Measure angle between red and yellow slice nodes. Whenever any of the slice nodes are moved, the updated angle is printed on the console.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sliceNodeIds</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;vtkMRMLSliceNodeRed&quot;</span><span class="p">,</span> <span class="s2">&quot;vtkMRMLSliceNodeYellow&quot;</span><span class="p">]</span>

<span class="c1"># Print angles between slice nodes</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ShowAngle</span><span class="p">(</span><span class="n">unused1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unused2</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="n">sliceNormalVector</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">sliceNodeId</span> <span class="ow">in</span> <span class="n">sliceNodeIds</span><span class="p">:</span>
    <span class="n">sliceToRAS</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetNodeByID</span><span class="p">(</span><span class="n">sliceNodeId</span><span class="p">)</span><span class="o">.</span><span class="n">GetSliceToRAS</span><span class="p">()</span>
    <span class="n">sliceNormalVector</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">sliceToRAS</span><span class="o">.</span><span class="n">GetElement</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">sliceToRAS</span><span class="o">.</span><span class="n">GetElement</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">sliceToRAS</span><span class="o">.</span><span class="n">GetElement</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)])</span>
  <span class="n">angleRad</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMath</span><span class="o">.</span><span class="n">AngleBetweenVectors</span><span class="p">(</span><span class="n">sliceNormalVector</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sliceNormalVector</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
  <span class="n">angleDeg</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMath</span><span class="o">.</span><span class="n">DegreesFromRadians</span><span class="p">(</span><span class="n">angleRad</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Angle between slice planes = </span><span class="si">{0:0.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">angleDeg</span><span class="p">))</span>

<span class="c1"># Observe slice node changes</span>
<span class="k">for</span> <span class="n">sliceNodeId</span> <span class="ow">in</span> <span class="n">sliceNodeIds</span><span class="p">:</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetNodeByID</span><span class="p">(</span><span class="n">sliceNodeId</span><span class="p">)</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkCommand</span><span class="o">.</span><span class="n">ModifiedEvent</span><span class="p">,</span> <span class="n">ShowAngle</span><span class="p">)</span>

<span class="c1"># Print current angle</span>
<span class="n">ShowAngle</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="set-slice-position-and-orientation-from-a-normal-vector-and-position">
<h3>Set slice position and orientation from a normal vector and position<a class="headerlink" href="#set-slice-position-and-orientation-from-a-normal-vector-and-position" title="Link to this heading"></a></h3>
<p>This code snippet shows how to display a slice view defined by a normal vector and position in an anatomically sensible way: rotating slice view so that “up” direction (or “right” direction) is towards an anatomical axis.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">setSlicePoseFromSliceNormalAndPosition</span><span class="p">(</span><span class="n">sliceNode</span><span class="p">,</span> <span class="n">sliceNormal</span><span class="p">,</span> <span class="n">slicePosition</span><span class="p">,</span> <span class="n">defaultViewUpDirection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">backupViewRightDirection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Set slice pose from the provided plane normal and position. View up direction is determined automatically,</span>
<span class="sd">  to make view up point towards defaultViewUpDirection.</span>
<span class="sd">  :param defaultViewUpDirection Slice view will be spinned in-plane to match point approximately this up direction. Default: patient superior.</span>
<span class="sd">  :param backupViewRightDirection Slice view will be spinned in-plane to match point approximately this right direction</span>
<span class="sd">    if defaultViewUpDirection is too similar to sliceNormal. Default: patient left.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="c1"># Fix up input directions</span>
  <span class="k">if</span> <span class="n">defaultViewUpDirection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">defaultViewUpDirection</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">backupViewRightDirection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">backupViewRightDirection</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">sliceNormal</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
    <span class="n">sliceNormalStandardized</span> <span class="o">=</span> <span class="n">sliceNormal</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">sliceNormalStandardized</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">sliceNormal</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">sliceNormal</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">sliceNormal</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
  <span class="c1"># Compute slice axes</span>
  <span class="n">sliceNormalViewUpAngle</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMath</span><span class="o">.</span><span class="n">AngleBetweenVectors</span><span class="p">(</span><span class="n">sliceNormalStandardized</span><span class="p">,</span> <span class="n">defaultViewUpDirection</span><span class="p">)</span>
  <span class="n">angleTooSmallThresholdRad</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="c1"># about 15 degrees</span>
  <span class="k">if</span> <span class="n">sliceNormalViewUpAngle</span> <span class="o">&gt;</span> <span class="n">angleTooSmallThresholdRad</span> <span class="ow">and</span> <span class="n">sliceNormalViewUpAngle</span> <span class="o">&lt;</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMath</span><span class="o">.</span><span class="n">Pi</span><span class="p">()</span> <span class="o">-</span> <span class="n">angleTooSmallThresholdRad</span><span class="p">:</span>
    <span class="n">viewUpDirection</span> <span class="o">=</span> <span class="n">defaultViewUpDirection</span>
    <span class="n">sliceAxisY</span> <span class="o">=</span> <span class="n">viewUpDirection</span>
    <span class="n">sliceAxisX</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMath</span><span class="o">.</span><span class="n">Cross</span><span class="p">(</span><span class="n">sliceAxisY</span><span class="p">,</span> <span class="n">sliceNormalStandardized</span><span class="p">,</span> <span class="n">sliceAxisX</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">sliceAxisX</span> <span class="o">=</span> <span class="n">backupViewRightDirection</span>
  <span class="c1"># Set slice axes</span>
  <span class="n">sliceNode</span><span class="o">.</span><span class="n">SetSliceToRASByNTP</span><span class="p">(</span><span class="n">sliceNormalStandardized</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sliceNormalStandardized</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sliceNormalStandardized</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">sliceAxisX</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sliceAxisX</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sliceAxisX</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">slicePosition</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">slicePosition</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">slicePosition</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Example usage:</span>
<span class="n">sliceNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;vtkMRMLSliceNodeRed&quot;</span><span class="p">)</span>
<span class="n">transformNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Transform_3&quot;</span><span class="p">)</span>
<span class="n">transformMatrix</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMatrix4x4</span><span class="p">()</span>
<span class="n">transformNode</span><span class="o">.</span><span class="n">GetMatrixTransformToParent</span><span class="p">(</span><span class="n">transformMatrix</span><span class="p">)</span>
<span class="n">sliceNormal</span> <span class="o">=</span> <span class="p">[</span><span class="n">transformMatrix</span><span class="o">.</span><span class="n">GetElement</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">transformMatrix</span><span class="o">.</span><span class="n">GetElement</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">transformMatrix</span><span class="o">.</span><span class="n">GetElement</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span>
<span class="n">slicePosition</span> <span class="o">=</span> <span class="p">[</span><span class="n">transformMatrix</span><span class="o">.</span><span class="n">GetElement</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">transformMatrix</span><span class="o">.</span><span class="n">GetElement</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">transformMatrix</span><span class="o">.</span><span class="n">GetElement</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span>
<span class="n">setSlicePoseFromSliceNormalAndPosition</span><span class="p">(</span><span class="n">sliceNode</span><span class="p">,</span> <span class="n">sliceNormal</span><span class="p">,</span> <span class="n">slicePosition</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="show-slice-views-in-3d-window">
<h3>Show slice views in 3D window<a class="headerlink" href="#show-slice-views-in-3d-window" title="Link to this heading"></a></h3>
<p>Equivalent to clicking ‘eye’ icon in the slice view controller.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">layoutManager</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span>
<span class="k">for</span> <span class="n">sliceViewName</span> <span class="ow">in</span> <span class="n">layoutManager</span><span class="o">.</span><span class="n">sliceViewNames</span><span class="p">():</span>
  <span class="n">controller</span> <span class="o">=</span> <span class="n">layoutManager</span><span class="o">.</span><span class="n">sliceWidget</span><span class="p">(</span><span class="n">sliceViewName</span><span class="p">)</span><span class="o">.</span><span class="n">sliceController</span><span class="p">()</span>
  <span class="n">controller</span><span class="o">.</span><span class="n">setSliceVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="change-default-slice-view-orientation">
<h3>Change default slice view orientation<a class="headerlink" href="#change-default-slice-view-orientation" title="Link to this heading"></a></h3>
<p>You can left-right “flip” slice view orientation presets (show patient left side on left/right side of the screen) by copy-pasting the script below to your <a class="reference internal" href="../user_guide/settings.html#application-startup-file"><span class="std std-ref">slicerrc.py file</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Axial slice axes:</span>
<span class="c1">#  1 0 0</span>
<span class="c1">#  0 1 0</span>
<span class="c1">#  0 0 1</span>
<span class="n">axialSliceToRas</span><span class="o">=</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkMatrix3x3</span><span class="p">()</span>

<span class="c1"># Coronal slice axes:</span>
<span class="c1">#  1 0 0</span>
<span class="c1">#  0 0 -1</span>
<span class="c1">#  0 1 0</span>
<span class="n">coronalSliceToRas</span><span class="o">=</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkMatrix3x3</span><span class="p">()</span>
<span class="n">coronalSliceToRas</span><span class="o">.</span><span class="n">SetElement</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">coronalSliceToRas</span><span class="o">.</span><span class="n">SetElement</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">coronalSliceToRas</span><span class="o">.</span><span class="n">SetElement</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">coronalSliceToRas</span><span class="o">.</span><span class="n">SetElement</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Replace orientation presets in all existing slice nodes and in the default slice node</span>
<span class="n">sliceNodes</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNodesByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLSliceNode&quot;</span><span class="p">)</span>
<span class="n">sliceNodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetDefaultNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLSliceNode&quot;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">sliceNode</span> <span class="ow">in</span> <span class="n">sliceNodes</span><span class="p">:</span>
  <span class="n">orientationPresetName</span> <span class="o">=</span> <span class="n">sliceNode</span><span class="o">.</span><span class="n">GetOrientation</span><span class="p">()</span>
  <span class="n">sliceNode</span><span class="o">.</span><span class="n">RemoveSliceOrientationPreset</span><span class="p">(</span><span class="s2">&quot;Axial&quot;</span><span class="p">)</span>
  <span class="n">sliceNode</span><span class="o">.</span><span class="n">AddSliceOrientationPreset</span><span class="p">(</span><span class="s2">&quot;Axial&quot;</span><span class="p">,</span> <span class="n">axialSliceToRas</span><span class="p">)</span>
  <span class="n">sliceNode</span><span class="o">.</span><span class="n">RemoveSliceOrientationPreset</span><span class="p">(</span><span class="s2">&quot;Coronal&quot;</span><span class="p">)</span>
  <span class="n">sliceNode</span><span class="o">.</span><span class="n">AddSliceOrientationPreset</span><span class="p">(</span><span class="s2">&quot;Coronal&quot;</span><span class="p">,</span> <span class="n">coronalSliceToRas</span><span class="p">)</span>
  <span class="n">sliceNode</span><span class="o">.</span><span class="n">SetOrientation</span><span class="p">(</span><span class="n">orientationPresetName</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="set-all-slice-views-linked-by-default">
<h3>Set all slice views linked by default<a class="headerlink" href="#set-all-slice-views-linked-by-default" title="Link to this heading"></a></h3>
<p>You can make slice views linked by default (when application starts or the scene is cleared) by copy-pasting the script below to your <a class="reference internal" href="../user_guide/settings.html#application-startup-file"><span class="std std-ref">.slicerrc.py file</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set linked slice views  in all existing slice composite nodes and in the default node</span>
<span class="n">sliceCompositeNodes</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNodesByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLSliceCompositeNode&quot;</span><span class="p">)</span>
<span class="n">defaultSliceCompositeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetDefaultNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLSliceCompositeNode&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">defaultSliceCompositeNode</span><span class="p">:</span>
  <span class="n">defaultSliceCompositeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">CreateNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLSliceCompositeNode&quot;</span><span class="p">)</span>
  <span class="n">defaultSliceCompositeNode</span><span class="o">.</span><span class="n">UnRegister</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># CreateNodeByClass is factory method, need to unregister the result to prevent memory leaks</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddDefaultNode</span><span class="p">(</span><span class="n">defaultSliceCompositeNode</span><span class="p">)</span>
<span class="n">sliceCompositeNodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">defaultSliceCompositeNode</span><span class="p">)</span>
<span class="k">for</span> <span class="n">sliceCompositeNode</span> <span class="ow">in</span> <span class="n">sliceCompositeNodes</span><span class="p">:</span>
  <span class="n">sliceCompositeNode</span><span class="o">.</span><span class="n">SetLinkedControl</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="set-crosshair-jump-mode-to-centered-by-default">
<h3>Set crosshair jump mode to centered by default<a class="headerlink" href="#set-crosshair-jump-mode-to-centered-by-default" title="Link to this heading"></a></h3>
<p>You can change default slice jump mode (when application starts or the scene is cleared) by copy-pasting the script below to your <a class="reference internal" href="../user_guide/settings.html#application-startup-file"><span class="std std-ref">.slicerrc.py file</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">crosshair</span><span class="o">=</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetFirstNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLCrosshairNode&quot;</span><span class="p">)</span>
<span class="n">crosshair</span><span class="o">.</span><span class="n">SetCrosshairBehavior</span><span class="p">(</span><span class="n">crosshair</span><span class="o">.</span><span class="n">CenteredJumpSlice</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="set-up-custom-units-in-slice-view-ruler">
<h3>Set up custom units in slice view ruler<a class="headerlink" href="#set-up-custom-units-in-slice-view-ruler" title="Link to this heading"></a></h3>
<p>For microscopy or micro-CT images you may want to switch unit to micrometer instead of the default mm. To do that, 1. change the unit in Application settings / Units and 2. update ruler display settings using the script below (it can be copied to your Application startup script):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">appLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">applicationLogic</span><span class="p">()</span>
<span class="n">layoutManagerLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">layoutLogic</span><span class="p">()</span>
<span class="k">for</span> <span class="n">viewNode</span> <span class="ow">in</span> <span class="n">layoutManagerLogic</span><span class="o">.</span><span class="n">GetViewNodes</span><span class="p">():</span>
  <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">viewNode</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLSliceNode</span><span class="p">:</span>
    <span class="k">continue</span>
  <span class="n">displayableManager</span> <span class="o">=</span> <span class="n">appLogic</span><span class="o">.</span><span class="n">GetViewDisplayableManagerByClassName</span><span class="p">(</span><span class="n">viewNode</span><span class="p">,</span> <span class="s2">&quot;vtkMRMLRulerDisplayableManager&quot;</span><span class="p">)</span>
  <span class="n">displayableManager</span><span class="o">.</span><span class="n">RemoveAllRulerScalePresets</span><span class="p">()</span>
  <span class="n">displayableManager</span><span class="o">.</span><span class="n">AddRulerScalePreset</span><span class="p">(</span>   <span class="mf">0.001</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;nm&quot;</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
  <span class="n">displayableManager</span><span class="o">.</span><span class="n">AddRulerScalePreset</span><span class="p">(</span>   <span class="mf">0.010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;nm&quot;</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
  <span class="n">displayableManager</span><span class="o">.</span><span class="n">AddRulerScalePreset</span><span class="p">(</span>   <span class="mf">0.100</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;nm&quot;</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
  <span class="n">displayableManager</span><span class="o">.</span><span class="n">AddRulerScalePreset</span><span class="p">(</span>   <span class="mf">0.500</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;nm&quot;</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
  <span class="n">displayableManager</span><span class="o">.</span><span class="n">AddRulerScalePreset</span><span class="p">(</span>   <span class="mf">1.0</span><span class="p">,</span>   <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;um&quot;</span><span class="p">,</span>    <span class="mf">1.0</span><span class="p">)</span>
  <span class="n">displayableManager</span><span class="o">.</span><span class="n">AddRulerScalePreset</span><span class="p">(</span>   <span class="mf">5.0</span><span class="p">,</span>   <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;um&quot;</span><span class="p">,</span>    <span class="mf">1.0</span><span class="p">)</span>
  <span class="n">displayableManager</span><span class="o">.</span><span class="n">AddRulerScalePreset</span><span class="p">(</span>  <span class="mf">10.0</span><span class="p">,</span>   <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;um&quot;</span><span class="p">,</span>    <span class="mf">1.0</span><span class="p">)</span>
  <span class="n">displayableManager</span><span class="o">.</span><span class="n">AddRulerScalePreset</span><span class="p">(</span>  <span class="mf">50.0</span><span class="p">,</span>   <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;um&quot;</span><span class="p">,</span>    <span class="mf">1.0</span><span class="p">)</span>
  <span class="n">displayableManager</span><span class="o">.</span><span class="n">AddRulerScalePreset</span><span class="p">(</span> <span class="mf">100.0</span><span class="p">,</span>   <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;um&quot;</span><span class="p">,</span>    <span class="mf">1.0</span><span class="p">)</span>
  <span class="n">displayableManager</span><span class="o">.</span><span class="n">AddRulerScalePreset</span><span class="p">(</span> <span class="mf">500.0</span><span class="p">,</span>   <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;um&quot;</span><span class="p">,</span>    <span class="mf">1.0</span><span class="p">)</span>
  <span class="n">displayableManager</span><span class="o">.</span><span class="n">AddRulerScalePreset</span><span class="p">(</span><span class="mf">1000.0</span><span class="p">,</span>   <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;mm&quot;</span><span class="p">,</span>    <span class="mf">0.001</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="center-the-3d-view-on-the-scene">
<h3>Center the 3D view on the scene<a class="headerlink" href="#center-the-3d-view-on-the-scene" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">layoutManager</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span>
<span class="n">threeDWidget</span> <span class="o">=</span> <span class="n">layoutManager</span><span class="o">.</span><span class="n">threeDWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">threeDView</span> <span class="o">=</span> <span class="n">threeDWidget</span><span class="o">.</span><span class="n">threeDView</span><span class="p">()</span>
<span class="n">threeDView</span><span class="o">.</span><span class="n">resetFocalPoint</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="rotate-the-3d-view">
<h3>Rotate the 3D View<a class="headerlink" href="#rotate-the-3d-view" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">layoutManager</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span>
<span class="n">threeDWidget</span> <span class="o">=</span> <span class="n">layoutManager</span><span class="o">.</span><span class="n">threeDWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">threeDView</span> <span class="o">=</span> <span class="n">threeDWidget</span><span class="o">.</span><span class="n">threeDView</span><span class="p">()</span>
<span class="n">threeDView</span><span class="o">.</span><span class="n">yaw</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="change-3d-view-background-color">
<h3>Change 3D view background color<a class="headerlink" href="#change-3d-view-background-color" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">viewNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">threeDWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mrmlViewNode</span><span class="p">()</span>
<span class="n">viewNode</span><span class="o">.</span><span class="n">SetBackgroundColor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">viewNode</span><span class="o">.</span><span class="n">SetBackgroundColor2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="change-box-color-in-3d-view">
<h3>Change box color in 3D view<a class="headerlink" href="#change-box-color-in-3d-view" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">viewNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">threeDWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mrmlViewNode</span><span class="p">()</span>
<span class="n">viewNode</span><span class="o">.</span><span class="n">SetBoxColor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="show-a-slice-view-outside-the-view-layout">
<h3>Show a slice view outside the view layout<a class="headerlink" href="#show-a-slice-view-outside-the-view-layout" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># layout name is used to create and identify the underlying slice node and  should be set to a value that is not used in any of the layouts owned by the layout manager</span>
<span class="n">layoutName</span> <span class="o">=</span> <span class="s2">&quot;TestSlice1&quot;</span>
<span class="n">layoutLabel</span> <span class="o">=</span> <span class="s2">&quot;TS1&quot;</span>
<span class="n">layoutColor</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
<span class="c1"># ownerNode manages this view instead of the layout manager (it can be any node in the scene)</span>
<span class="n">viewOwnerNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLScriptedModuleNode&quot;</span><span class="p">)</span>

<span class="c1"># Create MRML nodes</span>
<span class="n">viewLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLSliceLogic</span><span class="p">()</span>
<span class="n">viewLogic</span><span class="o">.</span><span class="n">SetMRMLScene</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="p">)</span>
<span class="n">viewNode</span> <span class="o">=</span> <span class="n">viewLogic</span><span class="o">.</span><span class="n">AddSliceNode</span><span class="p">(</span><span class="n">layoutName</span><span class="p">)</span>
<span class="n">viewNode</span><span class="o">.</span><span class="n">SetLayoutLabel</span><span class="p">(</span><span class="n">layoutLabel</span><span class="p">)</span>
<span class="n">viewNode</span><span class="o">.</span><span class="n">SetLayoutColor</span><span class="p">(</span><span class="n">layoutColor</span><span class="p">)</span>
<span class="n">viewNode</span><span class="o">.</span><span class="n">SetAndObserveParentLayoutNodeID</span><span class="p">(</span><span class="n">viewOwnerNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>

<span class="c1"># Create widget</span>
<span class="n">viewWidget</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">qMRMLSliceWidget</span><span class="p">()</span>
<span class="n">viewWidget</span><span class="o">.</span><span class="n">setMRMLScene</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="p">)</span>
<span class="n">viewWidget</span><span class="o">.</span><span class="n">setMRMLSliceNode</span><span class="p">(</span><span class="n">viewNode</span><span class="p">)</span>
<span class="n">sliceLogics</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">applicationLogic</span><span class="p">()</span><span class="o">.</span><span class="n">GetSliceLogics</span><span class="p">()</span>
<span class="n">viewWidget</span><span class="o">.</span><span class="n">setSliceLogics</span><span class="p">(</span><span class="n">sliceLogics</span><span class="p">)</span>
<span class="n">sliceLogics</span><span class="o">.</span><span class="n">AddItem</span><span class="p">(</span><span class="n">viewWidget</span><span class="o">.</span><span class="n">sliceLogic</span><span class="p">())</span>
<span class="n">viewWidget</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="show-a-3d-view-outside-the-view-layout">
<h3>Show a 3D view outside the view layout<a class="headerlink" href="#show-a-3d-view-outside-the-view-layout" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># layout name is used to create and identify the underlying view node and  should be set to a value that is not used in any of the layouts owned by the layout manager</span>
<span class="n">layoutName</span> <span class="o">=</span> <span class="s2">&quot;Test3DView&quot;</span>
<span class="n">layoutLabel</span> <span class="o">=</span> <span class="s2">&quot;T3&quot;</span>
<span class="n">layoutColor</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
<span class="c1"># ownerNode manages this view instead of the layout manager (it can be any node in the scene)</span>
<span class="n">viewOwnerNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLScriptedModuleNode&quot;</span><span class="p">)</span>

<span class="c1"># Create MRML node</span>
<span class="n">viewLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLViewLogic</span><span class="p">()</span>
<span class="n">viewLogic</span><span class="o">.</span><span class="n">SetMRMLScene</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="p">)</span>
<span class="n">viewNode</span> <span class="o">=</span> <span class="n">viewLogic</span><span class="o">.</span><span class="n">AddViewNode</span><span class="p">(</span><span class="n">layoutName</span><span class="p">)</span>
<span class="n">viewNode</span><span class="o">.</span><span class="n">SetLayoutLabel</span><span class="p">(</span><span class="n">layoutLabel</span><span class="p">)</span>
<span class="n">viewNode</span><span class="o">.</span><span class="n">SetLayoutColor</span><span class="p">(</span><span class="n">layoutColor</span><span class="p">)</span>
<span class="n">viewNode</span><span class="o">.</span><span class="n">SetAndObserveParentLayoutNodeID</span><span class="p">(</span><span class="n">viewOwnerNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>

<span class="c1"># Create widget</span>
<span class="n">viewWidget</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">qMRMLThreeDWidget</span><span class="p">()</span>
<span class="n">viewWidget</span><span class="o">.</span><span class="n">setMRMLScene</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="p">)</span>
<span class="n">viewWidget</span><span class="o">.</span><span class="n">setMRMLViewNode</span><span class="p">(</span><span class="n">viewNode</span><span class="p">)</span>
<span class="n">viewWidget</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="access-vtk-rendering-classes">
<h2>Access VTK rendering classes<a class="headerlink" href="#access-vtk-rendering-classes" title="Link to this heading"></a></h2>
<section id="access-vtk-views-renderers-and-cameras">
<h3>Access VTK views, renderers, and cameras<a class="headerlink" href="#access-vtk-views-renderers-and-cameras" title="Link to this heading"></a></h3>
<p>Iterate through all 3D views in current layout:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">layoutManager</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span>
<span class="k">for</span> <span class="n">threeDViewIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">layoutManager</span><span class="o">.</span><span class="n">threeDViewCount</span><span class="p">)</span> <span class="p">:</span>
  <span class="n">view</span> <span class="o">=</span> <span class="n">layoutManager</span><span class="o">.</span><span class="n">threeDWidget</span><span class="p">(</span><span class="n">threeDViewIndex</span><span class="p">)</span><span class="o">.</span><span class="n">threeDView</span><span class="p">()</span>
  <span class="n">threeDViewNode</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">mrmlViewNode</span><span class="p">()</span>
  <span class="n">cameraNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">cameras</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">GetViewActiveCameraNode</span><span class="p">(</span><span class="n">threeDViewNode</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;View node for 3D widget &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">threeDViewIndex</span><span class="p">))</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Name: &quot;</span> <span class="o">+</span> <span class="n">threeDViewNode</span> <span class="o">.</span><span class="n">GetName</span><span class="p">())</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ID: &quot;</span> <span class="o">+</span> <span class="n">threeDViewNode</span> <span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Camera ID: &quot;</span> <span class="o">+</span> <span class="n">cameraNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
</pre></div>
</div>
<p>Iterate through all slice views in current layout:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">layoutManager</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span>
<span class="k">for</span> <span class="n">sliceViewName</span> <span class="ow">in</span> <span class="n">layoutManager</span><span class="o">.</span><span class="n">sliceViewNames</span><span class="p">():</span>
  <span class="n">view</span> <span class="o">=</span> <span class="n">layoutManager</span><span class="o">.</span><span class="n">sliceWidget</span><span class="p">(</span><span class="n">sliceViewName</span><span class="p">)</span><span class="o">.</span><span class="n">sliceView</span><span class="p">()</span>
  <span class="n">sliceNode</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">mrmlSliceNode</span><span class="p">()</span>
  <span class="n">sliceLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">applicationLogic</span><span class="p">()</span><span class="o">.</span><span class="n">GetSliceLogic</span><span class="p">(</span><span class="n">sliceNode</span><span class="p">)</span>
  <span class="n">compositeNode</span> <span class="o">=</span> <span class="n">sliceLogic</span><span class="o">.</span><span class="n">GetSliceCompositeNode</span><span class="p">()</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Slice view &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sliceViewName</span><span class="p">))</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Name: &quot;</span> <span class="o">+</span> <span class="n">sliceNode</span><span class="o">.</span><span class="n">GetName</span><span class="p">())</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ID: &quot;</span> <span class="o">+</span> <span class="n">sliceNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Background volume: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">compositeNode</span><span class="o">.</span><span class="n">GetBackgroundVolumeID</span><span class="p">()))</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Foreground volume: </span><span class="si">{0}</span><span class="s2"> (opacity: </span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">compositeNode</span><span class="o">.</span><span class="n">GetForegroundVolumeID</span><span class="p">(),</span> <span class="n">compositeNode</span><span class="o">.</span><span class="n">GetForegroundOpacity</span><span class="p">()))</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Label volume: </span><span class="si">{0}</span><span class="s2"> (opacity: </span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">compositeNode</span><span class="o">.</span><span class="n">GetLabelVolumeID</span><span class="p">(),</span> <span class="n">compositeNode</span><span class="o">.</span><span class="n">GetLabelOpacity</span><span class="p">()))</span>
</pre></div>
</div>
<p>For low-level manipulation of views, it is possible to access VTK render windows, renderers and cameras of views in the current layout.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">renderWindow</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">renderWindow</span><span class="p">()</span>
<span class="n">renderers</span> <span class="o">=</span> <span class="n">renderWindow</span><span class="o">.</span><span class="n">GetRenderers</span><span class="p">()</span>
<span class="n">renderer</span> <span class="o">=</span> <span class="n">renderers</span><span class="o">.</span><span class="n">GetItemAsObject</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">camera</span> <span class="o">=</span> <span class="n">cameraNode</span><span class="o">.</span><span class="n">GetCamera</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="get-displayable-manager-of-a-certain-type-for-a-certain-view">
<h3>Get displayable manager of a certain type for a certain view<a class="headerlink" href="#get-displayable-manager-of-a-certain-type-for-a-certain-view" title="Link to this heading"></a></h3>
<p>Displayable managers are responsible for creating VTK filters, mappers, and actors to display MRML nodes in renderers. Input to filters and mappers are VTK objects stored in MRML data nodes. Filter and actor properties are set based on display options specified in MRML display nodes.</p>
<p>Accessing displayable managers is useful for troubleshooting or for testing new features that are not exposed via MRML classes yet, as they provide usually allow low-level access to VTK actors.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">threeDViewNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetNodeByID</span><span class="p">(</span><span class="s2">&quot;vtkMRMLViewNode1&quot;</span><span class="p">)</span>
<span class="n">appLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">applicationLogic</span><span class="p">()</span>
<span class="n">modelDisplayableManager</span> <span class="o">=</span> <span class="n">appLogic</span><span class="o">.</span><span class="n">GetViewDisplayableManagerByClassName</span><span class="p">(</span><span class="n">threeDViewNode</span><span class="p">,</span> <span class="s2">&quot;vtkMRMLModelDisplayableManager&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">modelDisplayableManager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
  <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to find the model displayable manager&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="access-vtk-actor-properties">
<h3>Access VTK actor properties<a class="headerlink" href="#access-vtk-actor-properties" title="Link to this heading"></a></h3>
<p>This example shows how to access and modify VTK actor properties to experiment with physically-based rendering.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">modelNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;MyModel&quot;</span><span class="p">)</span>

<span class="n">threeDViewNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetNodeByID</span><span class="p">(</span><span class="s2">&quot;vtkMRMLViewNode1&quot;</span><span class="p">)</span>
<span class="n">appLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">applicationLogic</span><span class="p">()</span>
<span class="n">modelDisplayableManager</span> <span class="o">=</span> <span class="n">appLogic</span><span class="o">.</span><span class="n">GetViewDisplayableManagerByClassName</span><span class="p">(</span><span class="n">threeDViewNode</span><span class="p">,</span> <span class="s2">&quot;vtkMRMLModelDisplayableManager&quot;</span><span class="p">)</span>
<span class="n">actor</span><span class="o">=</span><span class="n">modelDisplayableManager</span><span class="o">.</span><span class="n">GetActorByID</span><span class="p">(</span><span class="n">modelNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
<span class="nb">property</span><span class="o">=</span><span class="n">actor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span>
<span class="nb">property</span><span class="o">.</span><span class="n">SetInterpolationToPBR</span><span class="p">()</span>
<span class="nb">property</span><span class="o">.</span><span class="n">SetMetallic</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="nb">property</span><span class="o">.</span><span class="n">SetRoughness</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="nb">property</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.9</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">forceRenderAllViews</span><span class="p">()</span>
</pre></div>
</div>
<p>See more information on physically based rendering in VTK here: <a class="reference external" href="https://blog.kitware.com/vtk-pbr/">https://blog.kitware.com/vtk-pbr/</a></p>
</section>
</section>
<section id="keyboard-shortcuts-and-mouse-gestures">
<h2>Keyboard shortcuts and mouse gestures<a class="headerlink" href="#keyboard-shortcuts-and-mouse-gestures" title="Link to this heading"></a></h2>
<section id="customize-keyboard-shortcuts">
<h3>Customize keyboard shortcuts<a class="headerlink" href="#customize-keyboard-shortcuts" title="Link to this heading"></a></h3>
<p>Keyboard shortcuts can be specified for activating any Slicer feature by adding a couple of lines to your <a class="reference internal" href="../user_guide/settings.html#application-startup-file"><span class="std std-ref">.slicerrc.py file</span></a>.</p>
<p>For example, this script registers <kbd>Ctrl+b</kbd>, <kbd>Ctrl+n</kbd>, <kbd>Ctrl+m</kbd>, <kbd>Ctrl+,</kbd> keyboard shortcuts to switch between red, yellow, green, and 4-up view layouts.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">shortcuts</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">(</span><span class="s2">&quot;Ctrl+b&quot;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLLayoutNode</span><span class="o">.</span><span class="n">SlicerLayoutOneUpRedSliceView</span><span class="p">)),</span>
  <span class="p">(</span><span class="s2">&quot;Ctrl+n&quot;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLLayoutNode</span><span class="o">.</span><span class="n">SlicerLayoutOneUpYellowSliceView</span><span class="p">)),</span>
  <span class="p">(</span><span class="s2">&quot;Ctrl+m&quot;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLLayoutNode</span><span class="o">.</span><span class="n">SlicerLayoutOneUpGreenSliceView</span><span class="p">)),</span>
  <span class="p">(</span><span class="s2">&quot;Ctrl+,&quot;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLLayoutNode</span><span class="o">.</span><span class="n">SlicerLayoutFourUpView</span><span class="p">))</span>
  <span class="p">]</span>

<span class="k">for</span> <span class="p">(</span><span class="n">shortcutKey</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span> <span class="ow">in</span> <span class="n">shortcuts</span><span class="p">:</span>
  <span class="n">shortcut</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">QShortcut</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">())</span>
  <span class="n">shortcut</span><span class="o">.</span><span class="n">setKey</span><span class="p">(</span><span class="n">qt</span><span class="o">.</span><span class="n">QKeySequence</span><span class="p">(</span><span class="n">shortcutKey</span><span class="p">))</span>
  <span class="n">shortcut</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="s2">&quot;activated()&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
</pre></div>
</div>
<p>Here’s an example for cycling through Segment Editor effects (requested <a class="reference external" href="https://discourse.slicer.org/t/is-there-a-keystroke-to-cycle-through-effects-in-segment-editor/10117/2">on the Slicer forum</a> for the <a class="reference external" href="https://slicermorph.github.io/">SlicerMorph</a> project).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">cycleEffect</span><span class="p">(</span><span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">orderedNames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">SegmentEditorWidget</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">effectNameOrder</span><span class="p">())</span>
    <span class="n">allNames</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">SegmentEditorWidget</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">availableEffectNames</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">allNames</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="n">orderedNames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
      <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">orderedNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">orderedNames</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">activeEffect</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">SegmentEditorWidget</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">activeEffect</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">activeEffect</span><span class="p">:</span>
      <span class="n">activeName</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">SegmentEditorWidget</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">activeEffect</span><span class="p">()</span><span class="o">.</span><span class="n">name</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">activeName</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">newIndex</span> <span class="o">=</span> <span class="p">(</span><span class="n">orderedNames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">activeName</span><span class="p">)</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">orderedNames</span><span class="p">)</span>
    <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">SegmentEditorWidget</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">setActiveEffectByName</span><span class="p">(</span><span class="n">orderedNames</span><span class="p">[</span><span class="n">newIndex</span><span class="p">])</span>
  <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
    <span class="c1"># module not active</span>
    <span class="k">pass</span>

<span class="n">shortcuts</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">cycleEffect</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span>
  <span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">cycleEffect</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span>
  <span class="p">]</span>

<span class="k">for</span> <span class="p">(</span><span class="n">shortcutKey</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span> <span class="ow">in</span> <span class="n">shortcuts</span><span class="p">:</span>
  <span class="n">shortcut</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">QShortcut</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">())</span>
  <span class="n">shortcut</span><span class="o">.</span><span class="n">setKey</span><span class="p">(</span><span class="n">qt</span><span class="o">.</span><span class="n">QKeySequence</span><span class="p">(</span><span class="n">shortcutKey</span><span class="p">))</span>
  <span class="n">shortcut</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="s2">&quot;activated()&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="customize-keyboard-mouse-gestures-in-viewers">
<h3>Customize keyboard/mouse gestures in viewers<a class="headerlink" href="#customize-keyboard-mouse-gestures-in-viewers" title="Link to this heading"></a></h3>
<section id="make-the-3d-view-rotate-using-right-click-and-drag">
<h4>Make the 3D view rotate using right-click-and-drag<a class="headerlink" href="#make-the-3d-view-rotate-using-right-click-and-drag" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">threeDViewNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetNodeByID</span><span class="p">(</span><span class="s2">&quot;vtkMRMLViewNode1&quot;</span><span class="p">)</span>
<span class="n">appLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">applicationLogic</span><span class="p">()</span>
<span class="n">cameraDisplayableManager</span> <span class="o">=</span> <span class="n">appLogic</span><span class="o">.</span><span class="n">GetViewDisplayableManagerByClassName</span><span class="p">(</span><span class="n">threeDViewNode</span><span class="p">,</span> <span class="s2">&quot;vtkMRMLCameraDisplayableManager&quot;</span><span class="p">)</span>
<span class="n">cameraWidget</span> <span class="o">=</span> <span class="n">cameraDisplayableManager</span><span class="o">.</span><span class="n">GetCameraWidget</span><span class="p">()</span>

<span class="c1"># Remove old mapping from right-click-and-drag</span>
<span class="n">cameraWidget</span><span class="o">.</span><span class="n">SetEventTranslationClickAndDrag</span><span class="p">(</span><span class="n">cameraWidget</span><span class="o">.</span><span class="n">WidgetStateIdle</span><span class="p">,</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCommand</span><span class="o">.</span><span class="n">RightButtonPressEvent</span><span class="p">,</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkEvent</span><span class="o">.</span><span class="n">NoModifier</span><span class="p">,</span>
  <span class="n">cameraWidget</span><span class="o">.</span><span class="n">WidgetStateRotate</span><span class="p">,</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkWidgetEvent</span><span class="o">.</span><span class="n">NoEvent</span><span class="p">,</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkWidgetEvent</span><span class="o">.</span><span class="n">NoEvent</span><span class="p">)</span>

<span class="c1"># Make right-click-and-drag rotate the view</span>
<span class="n">cameraWidget</span><span class="o">.</span><span class="n">SetEventTranslationClickAndDrag</span><span class="p">(</span><span class="n">cameraWidget</span><span class="o">.</span><span class="n">WidgetStateIdle</span><span class="p">,</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCommand</span><span class="o">.</span><span class="n">RightButtonPressEvent</span><span class="p">,</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkEvent</span><span class="o">.</span><span class="n">NoModifier</span><span class="p">,</span>
  <span class="n">cameraWidget</span><span class="o">.</span><span class="n">WidgetStateRotate</span><span class="p">,</span> <span class="n">cameraWidget</span><span class="o">.</span><span class="n">WidgetEventRotateStart</span><span class="p">,</span> <span class="n">cameraWidget</span><span class="o">.</span><span class="n">WidgetEventRotateEnd</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="custom-shortcut-for-moving-crosshair-in-a-slice-view">
<h4>Custom shortcut for moving crosshair in a slice view<a class="headerlink" href="#custom-shortcut-for-moving-crosshair-in-a-slice-view" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Red slice view</span>
<span class="n">sliceViewLabel</span> <span class="o">=</span> <span class="s2">&quot;Red&quot;</span>
<span class="n">sliceViewNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetNodeByID</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;vtkMRMLSliceNode</span><span class="si">{</span><span class="n">sliceViewLabel</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">appLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">applicationLogic</span><span class="p">()</span>
<span class="n">displayableManager</span> <span class="o">=</span> <span class="n">appLogic</span><span class="o">.</span><span class="n">GetViewDisplayableManagerByClassName</span><span class="p">(</span><span class="n">sliceViewNode</span><span class="p">,</span> <span class="s2">&quot;vtkMRMLCrosshairDisplayableManager&quot;</span><span class="p">)</span>

<span class="n">widget</span> <span class="o">=</span> <span class="n">displayableManager</span><span class="o">.</span><span class="n">GetSliceIntersectionWidget</span><span class="p">()</span>

<span class="c1"># Set crosshair position by left-click</span>
<span class="n">widget</span><span class="o">.</span><span class="n">SetEventTranslation</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">WidgetStateIdle</span><span class="p">,</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLInteractionEventData</span><span class="o">.</span><span class="n">LeftButtonClickEvent</span><span class="p">,</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkEvent</span><span class="o">.</span><span class="n">NoModifier</span><span class="p">,</span> <span class="n">widget</span><span class="o">.</span><span class="n">WidgetEventSetCrosshairPosition</span><span class="p">)</span>
<span class="n">widget</span><span class="o">.</span><span class="n">SetEventTranslation</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">WidgetStateIdle</span><span class="p">,</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLInteractionEventData</span><span class="o">.</span><span class="n">LeftButtonClickEvent</span><span class="p">,</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkEvent</span><span class="o">.</span><span class="n">NoModifier</span><span class="p">,</span> <span class="n">widget</span><span class="o">.</span><span class="n">WidgetEventSetCrosshairPosition</span><span class="p">)</span>

<span class="c1"># Move crosshair by Alt+left-click-and-drag</span>
<span class="n">widget</span><span class="o">.</span><span class="n">SetEventTranslationClickAndDrag</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">WidgetStateIdle</span><span class="p">,</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCommand</span><span class="o">.</span><span class="n">LeftButtonPressEvent</span><span class="p">,</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkEvent</span><span class="o">.</span><span class="n">AltModifier</span><span class="p">,</span>
  <span class="n">widget</span><span class="o">.</span><span class="n">WidgetStateMoveCrosshair</span><span class="p">,</span> <span class="n">widget</span><span class="o">.</span><span class="n">WidgetEventMoveCrosshairStart</span><span class="p">,</span> <span class="n">widget</span><span class="o">.</span><span class="n">WidgetEventMoveCrosshairEnd</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="custom-shortcut-for-moving-crosshair-in-a-3d-view">
<h4>Custom shortcut for moving crosshair in a 3D view<a class="headerlink" href="#custom-shortcut-for-moving-crosshair-in-a-3d-view" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3D view</span>
<span class="n">threeDViewNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetNodeByID</span><span class="p">(</span><span class="s2">&quot;vtkMRMLViewNode1&quot;</span><span class="p">)</span>
<span class="n">appLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">applicationLogic</span><span class="p">()</span>
<span class="n">cameraDisplayableManager</span> <span class="o">=</span> <span class="n">appLogic</span><span class="o">.</span><span class="n">GetViewDisplayableManagerByClassName</span><span class="p">(</span><span class="n">threeDViewNode</span><span class="p">,</span> <span class="s2">&quot;vtkMRMLCameraDisplayableManager&quot;</span><span class="p">)</span>
<span class="n">widget</span> <span class="o">=</span> <span class="n">cameraDisplayableManager</span><span class="o">.</span><span class="n">GetCameraWidget</span><span class="p">()</span>

<span class="c1"># Set crosshair position by left-click</span>
<span class="n">widget</span><span class="o">.</span><span class="n">SetEventTranslation</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">WidgetStateIdle</span><span class="p">,</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLInteractionEventData</span><span class="o">.</span><span class="n">LeftButtonClickEvent</span><span class="p">,</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkEvent</span><span class="o">.</span><span class="n">NoModifier</span><span class="p">,</span> <span class="n">widget</span><span class="o">.</span><span class="n">WidgetEventSetCrosshairPosition</span><span class="p">)</span>

<span class="c1"># Move crosshair by Alt+left-click-and-drag</span>
<span class="n">widget</span><span class="o">.</span><span class="n">SetEventTranslationClickAndDrag</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">WidgetStateIdle</span><span class="p">,</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCommand</span><span class="o">.</span><span class="n">LeftButtonPressEvent</span><span class="p">,</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkEvent</span><span class="o">.</span><span class="n">AltModifier</span><span class="p">,</span>
  <span class="n">widget</span><span class="o">.</span><span class="n">WidgetStateMoveCrosshair</span><span class="p">,</span> <span class="n">widget</span><span class="o">.</span><span class="n">WidgetEventMoveCrosshairStart</span><span class="p">,</span> <span class="n">widget</span><span class="o">.</span><span class="n">WidgetEventMoveCrosshairEnd</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="add-shortcut-to-adjust-window-level-in-any-mouse-mode">
<h4>Add shortcut to adjust window/level in any mouse mode<a class="headerlink" href="#add-shortcut-to-adjust-window-level-in-any-mouse-mode" title="Link to this heading"></a></h4>
<p>Makes Ctrl + Right-click-and-drag gesture adjust window/level in red slice view. This gesture works even when not in “Adjust window/level” mouse mode.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sliceViewLabel</span> <span class="o">=</span> <span class="s2">&quot;Red&quot;</span>
<span class="n">sliceViewNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetNodeByID</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;vtkMRMLSliceNode</span><span class="si">{</span><span class="n">sliceViewLabel</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">appLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">applicationLogic</span><span class="p">()</span>
<span class="n">displayableManager</span> <span class="o">=</span> <span class="n">appLogic</span><span class="o">.</span><span class="n">GetViewDisplayableManagerByClassName</span><span class="p">(</span><span class="n">sliceViewNode</span><span class="p">,</span> <span class="s2">&quot;vtkMRMLScalarBarDisplayableManager&quot;</span><span class="p">)</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">displayableManager</span><span class="o">.</span><span class="n">GetWindowLevelWidget</span><span class="p">()</span>
<span class="n">w</span><span class="o">.</span><span class="n">SetEventTranslationClickAndDrag</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">WidgetStateIdle</span><span class="p">,</span>
  <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCommand</span><span class="o">.</span><span class="n">RightButtonPressEvent</span><span class="p">,</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkEvent</span><span class="o">.</span><span class="n">ControlModifier</span><span class="p">,</span>
  <span class="n">w</span><span class="o">.</span><span class="n">WidgetStateAdjustWindowLevel</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">WidgetEventAlwaysOnAdjustWindowLevelStart</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">WidgetEventAlwaysOnAdjustWindowLevelEnd</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="disable-certain-user-interactions-in-slice-views">
<h3>Disable certain user interactions in slice views<a class="headerlink" href="#disable-certain-user-interactions-in-slice-views" title="Link to this heading"></a></h3>
<p>For example, disable slice browsing using mouse wheel and keyboard shortcuts in the red slice viewer:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">interactorObserver</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">sliceWidget</span><span class="p">(</span><span class="s2">&quot;Red&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sliceView</span><span class="p">()</span><span class="o">.</span><span class="n">interactorObserver</span><span class="p">()</span>
<span class="n">interactorObserver</span><span class="o">.</span><span class="n">SetActionEnabled</span><span class="p">(</span><span class="n">interactorStyle</span><span class="o">.</span><span class="n">BrowseSlice</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Hide all slice view controllers:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lm</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span>
<span class="k">for</span> <span class="n">sliceViewName</span> <span class="ow">in</span> <span class="n">lm</span><span class="o">.</span><span class="n">sliceViewNames</span><span class="p">():</span>
  <span class="n">lm</span><span class="o">.</span><span class="n">sliceWidget</span><span class="p">(</span><span class="n">sliceViewName</span><span class="p">)</span><span class="o">.</span><span class="n">sliceController</span><span class="p">()</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Hide all 3D view controllers:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lm</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span>
<span class="k">for</span> <span class="n">viewIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">threeDViewCount</span><span class="p">):</span>
  <span class="n">lm</span><span class="o">.</span><span class="n">threeDWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">threeDController</span><span class="p">()</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="add-keyboard-shortcut-to-jump-to-center-or-world-coordinate-system">
<h3>Add keyboard shortcut to jump to center or world coordinate system<a class="headerlink" href="#add-keyboard-shortcut-to-jump-to-center-or-world-coordinate-system" title="Link to this heading"></a></h3>
<p>You can copy-paste this into the Python console to jump slice views to (0,0,0) position on (Ctrl+e):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">shortcut</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">QShortcut</span><span class="p">(</span><span class="n">qt</span><span class="o">.</span><span class="n">QKeySequence</span><span class="p">(</span><span class="s2">&quot;Ctrl+e&quot;</span><span class="p">),</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">())</span>
<span class="n">shortcut</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;activated()&quot;</span><span class="p">,</span>
  <span class="k">lambda</span><span class="p">:</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">markups</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">JumpSlicesToLocation</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>
<section id="launch-external-applications">
<h2>Launch external applications<a class="headerlink" href="#launch-external-applications" title="Link to this heading"></a></h2>
<p>How to run external applications from Slicer.</p>
<section id="launch-external-process-in-startup-environment">
<h3>Launch external process in startup environment<a class="headerlink" href="#launch-external-process-in-startup-environment" title="Link to this heading"></a></h3>
<p>When a process is launched from Slicer then by default Slicer”s ITK, VTK, Qt, etc. libraries are used. If an external application has its own version of these libraries, then the application is expected to crash. To prevent crashing, the application must be run in the environment where Slicer started up (without all Slicer-specific library paths). This startup environment can be retrieved using <a class="reference internal" href="slicer.html#slicer.util.startupEnvironment" title="slicer.util.startupEnvironment"><code class="xref py py-func docutils literal notranslate"><span class="pre">slicer.util.startupEnvironment()</span></code></a>.</p>
<p>Example: run Python3 script from Slicer:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">command_to_execute</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;/usr/bin/python3&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;print(&quot;</span><span class="n">hola</span><span class="s2">&quot;)&quot;</span><span class="p">]</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">subprocess</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_output</span>
<span class="n">check_output</span><span class="p">(</span>
  <span class="n">command_to_execute</span><span class="p">,</span>
  <span class="n">env</span><span class="o">=</span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">startupEnvironment</span><span class="p">()</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>will output:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;hola</span><span class="se">\n</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>On some systems, <em>shell=True</em> must be specified as well.</p>
</section>
</section>
<section id="manage-extensions">
<h2>Manage extensions<a class="headerlink" href="#manage-extensions" title="Link to this heading"></a></h2>
<section id="download-and-install-extension">
<h3>Download and install extension<a class="headerlink" href="#download-and-install-extension" title="Link to this heading"></a></h3>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 5.4: </span>Slicer introduces <code class="xref py py-func docutils literal notranslate"><span class="pre">slicer.app.installExtensionFromServer()</span></code>, which
simplifies the process of downloading and installing extensions. The updated
approach is as follows:</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">extensionName</span> <span class="o">=</span> <span class="s1">&#39;SlicerIGT&#39;</span>
<span class="n">em</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">extensionsManagerModel</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">interactive</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># prevent display of popups</span>
<span class="n">restart</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">em</span><span class="o">.</span><span class="n">installExtensionFromServer</span><span class="p">(</span><span class="n">extensionName</span><span class="p">,</span> <span class="n">restart</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to install </span><span class="si">{</span><span class="n">extensionName</span><span class="si">}</span><span class="s2"> extension&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="install-a-module-directly-from-a-git-repository">
<h3>Install a module directly from a git repository<a class="headerlink" href="#install-a-module-directly-from-a-git-repository" title="Link to this heading"></a></h3>
<p>This <a class="reference external" href="https://gist.github.com/pieper/a9c0ba57de3833c9f5aea68247bda597">code snippet</a> can be useful for sharing code in development without requiring a restart of Slicer.</p>
</section>
<section id="install-a-python-package">
<h3>Install a Python package<a class="headerlink" href="#install-a-python-package" title="Link to this heading"></a></h3>
<p>It is recommended to only install a package at runtime when it is actually needed (not at startup, not even when the user opens a module, but just before that Python package is used the first time), and ask the user about it. For more comprehensive guidelines, refer to the <a class="reference internal" href="python_faq.html#can-i-use-any-python-package-in-a-slicer-module"><span class="std std-ref">best practices</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">flywheel</span>
<span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
  <span class="k">if</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">confirmOkCancelDisplay</span><span class="p">(</span><span class="s2">&quot;This module requires &#39;flywheel-sdk&#39; Python package. Click OK to install it now.&quot;</span><span class="p">):</span>
    <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">pip_install</span><span class="p">(</span><span class="s2">&quot;flywheel-sdk&quot;</span><span class="p">)</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">flywheel</span>
</pre></div>
</div>
</section>
</section>
<section id="dicom">
<h2>DICOM<a class="headerlink" href="#dicom" title="Link to this heading"></a></h2>
<section id="load-dicom-files-into-the-scene-from-a-folder">
<h3>Load DICOM files into the scene from a folder<a class="headerlink" href="#load-dicom-files-into-the-scene-from-a-folder" title="Link to this heading"></a></h3>
<p>This code loads all DICOM objects into the scene from a file folder. All the registered plugins are evaluated and the one with the highest confidence will be used to load the data. Files are imported into a temporary DICOM database, so the current Slicer DICOM database is not impacted.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dicomDataDir</span> <span class="o">=</span> <span class="s2">&quot;c:/my/folder/with/dicom-files&quot;</span>  <span class="c1"># input folder with DICOM files</span>
<span class="n">loadedNodeIDs</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># this list will contain the list of all loaded node IDs</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">DICOMLib</span><span class="w"> </span><span class="kn">import</span> <span class="n">DICOMUtils</span>
<span class="k">with</span> <span class="n">DICOMUtils</span><span class="o">.</span><span class="n">TemporaryDICOMDatabase</span><span class="p">()</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
  <span class="n">DICOMUtils</span><span class="o">.</span><span class="n">importDicom</span><span class="p">(</span><span class="n">dicomDataDir</span><span class="p">,</span> <span class="n">db</span><span class="p">)</span>
  <span class="n">patientUIDs</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">patients</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">patientUID</span> <span class="ow">in</span> <span class="n">patientUIDs</span><span class="p">:</span>
    <span class="n">loadedNodeIDs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">DICOMUtils</span><span class="o">.</span><span class="n">loadPatientByUID</span><span class="p">(</span><span class="n">patientUID</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="import-dicom-files-into-the-application-s-dicom-database">
<h3>Import DICOM files into the application’s DICOM database<a class="headerlink" href="#import-dicom-files-into-the-application-s-dicom-database" title="Link to this heading"></a></h3>
<p>This code snippet uses Slicer DICOM browser built-in indexer to import DICOM files into the database. Images are not loaded into the scene, but they show up in the DICOM browser. After import, data sets can be loaded using DICOMUtils functions (e.g., loadPatientByUID) - see above for an example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># instantiate a new DICOM browser</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">selectModule</span><span class="p">(</span><span class="s2">&quot;DICOM&quot;</span><span class="p">)</span>
<span class="n">dicomBrowser</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">DICOMWidget</span><span class="o">.</span><span class="n">browserWidget</span><span class="o">.</span><span class="n">dicomBrowser</span>
<span class="c1"># use dicomBrowser.ImportDirectoryCopy to make a copy of the files (useful for importing data from removable storage)</span>
<span class="n">dicomBrowser</span><span class="o">.</span><span class="n">importDirectory</span><span class="p">(</span><span class="n">dicomFilesDirectory</span><span class="p">,</span> <span class="n">dicomBrowser</span><span class="o">.</span><span class="n">ImportDirectoryAddLink</span><span class="p">)</span>
<span class="c1"># wait for import to finish before proceeding (optional, if removed then import runs in the background)</span>
<span class="n">dicomBrowser</span><span class="o">.</span><span class="n">waitForImportFinished</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="import-dicom-files-using-dicomweb">
<h3>Import DICOM files using DICOMweb<a class="headerlink" href="#import-dicom-files-using-dicomweb" title="Link to this heading"></a></h3>
<p>Download and import DICOM data set using DICOMweb from a Picture Archiving and Communications System (PACS) such as <a class="reference external" href="https://kheops.online/">Kheops</a>, Google Health API, <a class="reference external" href="https://www.orthanc-server.com/index.php">Orthanc</a>, <a class="reference external" href="https://www.dcm4che.org/">DCM4CHE</a>, etc.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">selectModule</span><span class="p">(</span><span class="s2">&quot;DICOM&quot;</span><span class="p">)</span>  <span class="c1"># ensure DICOM database is initialized</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">DICOMLib</span><span class="w"> </span><span class="kn">import</span> <span class="n">DICOMUtils</span>
<span class="n">DICOMUtils</span><span class="o">.</span><span class="n">importFromDICOMWeb</span><span class="p">(</span>
  <span class="n">dicomWebEndpoint</span><span class="o">=</span><span class="s2">&quot;https://demo.kheops.online/api&quot;</span><span class="p">,</span>
  <span class="n">studyInstanceUID</span><span class="o">=</span><span class="s2">&quot;1.3.6.1.4.1.14519.5.2.1.8421.4009.985792766370191766692237040819&quot;</span><span class="p">)</span>
</pre></div>
</div>
<section id="authenticate-with-an-access-token">
<h4>Authenticate with an Access Token<a class="headerlink" href="#authenticate-with-an-access-token" title="Link to this heading"></a></h4>
<p>Several PACS solutions support remote access authentication with an access token.</p>
<p>How to obtain your access token:</p>
<ul class="simple">
<li><p>Google Cloud: Execute <code class="docutils literal notranslate"><span class="pre">gcloud</span> <span class="pre">auth</span> <span class="pre">print-access-token</span></code> once you have logged in</p></li>
<li><p>Kheops: create an album, create a sharing link (something like <code class="docutils literal notranslate"><span class="pre">https://demo.kheops.online/view/TfYXwbKAW7JYbAgZ7MyISf</span></code>), the token is the string after the last slash (<code class="docutils literal notranslate"><span class="pre">TfYXwbKAW7JYbAgZ7MyISf</span></code>).</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">selectModule</span><span class="p">(</span><span class="s2">&quot;DICOM&quot;</span><span class="p">)</span>  <span class="c1"># ensure DICOM database is initialized and</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">DICOMLib</span><span class="w"> </span><span class="kn">import</span> <span class="n">DICOMUtils</span>
<span class="n">DICOMUtils</span><span class="o">.</span><span class="n">importFromDICOMWeb</span><span class="p">(</span>
  <span class="n">dicomWebEndpoint</span><span class="o">=</span><span class="s2">&quot;https://demo.kheops.online/api&quot;</span><span class="p">,</span>
  <span class="n">studyInstanceUID</span><span class="o">=</span><span class="s2">&quot;1.3.6.1.4.1.14519.5.2.1.8421.4009.985792766370191766692237040819&quot;</span><span class="p">,</span>
  <span class="n">accessToken</span><span class="o">=</span><span class="s2">&quot;TfYXwbKAW7JYbAgZ7MyISf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="alternate-authentication-approaches">
<h4>Alternate Authentication Approaches<a class="headerlink" href="#alternate-authentication-approaches" title="Link to this heading"></a></h4>
<p>You can provide expanded authentication information to use in the DICOMweb request.
Authentication types extending the Python <code class="docutils literal notranslate"><span class="pre">requests.auth.AuthBase</span></code> are accepted.</p>
<p>In the example below we provide a basic username and password as a <code class="docutils literal notranslate"><span class="pre">requests.HTTPBasicAuth</span></code>
instance with the DICOMweb import request.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">DICOMUtils</span><span class="o">.</span><span class="n">importFromDICOMWeb</span><span class="p">(</span>
  <span class="n">dicomWebEndpoint</span><span class="o">=</span><span class="s2">&quot;https://demo.kheops.online/api&quot;</span><span class="p">,</span>
  <span class="n">studyInstanceUID</span><span class="o">=</span><span class="s2">&quot;1.3.6.1.4.1.14519.5.2.1.8421.4009.985792766370191766692237040819&quot;</span><span class="p">,</span>
  <span class="n">auth</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">HTTPBasicAuth</span><span class="p">(</span><span class="s1">&#39;&lt;user&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;password&gt;&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>See the <a class="reference external" href="https://requests.readthedocs.io/en/latest/user/authentication/#authentication">Python <code class="docutils literal notranslate"><span class="pre">requests</span></code> Authentication documentation</a>
for more information.</p>
</section>
<section id="configure-a-global-dicomweb-authentication">
<h4>Configure a Global DICOMweb Authentication<a class="headerlink" href="#configure-a-global-dicomweb-authentication" title="Link to this heading"></a></h4>
<p>You can set a global username and password combination in your local Slicer application
to be remembered across application sessions. <code class="docutils literal notranslate"><span class="pre">DICOMUtils.getGlobalDICOMAuth</span></code> provides
a convenient way to create a <code class="docutils literal notranslate"><span class="pre">HTTPBasicAuth</span></code> instance from the global configuration
with each call.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">qt</span><span class="o">.</span><span class="n">QSettings</span><span class="p">()</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">DICOMUtils</span><span class="o">.</span><span class="n">GLOBAL_DICOMWEB_USER_KEY</span><span class="p">,</span> <span class="s1">&#39;&lt;user&gt;&#39;</span><span class="p">)</span>
<span class="n">qt</span><span class="o">.</span><span class="n">QSettings</span><span class="p">()</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">DICOMUtils</span><span class="o">.</span><span class="n">GLOBAL_DICOMWEB_PASSWORD_KEY</span><span class="p">,</span> <span class="s1">&#39;&lt;pwd&gt;&#39;</span><span class="p">)</span>
<span class="n">DICOMUtils</span><span class="o">.</span><span class="n">importFromDICOMWeb</span><span class="p">(</span>
  <span class="n">dicomWebEndpoint</span><span class="o">=</span><span class="s2">&quot;https://remote-url/&quot;</span><span class="p">,</span>
  <span class="n">studyInstanceUID</span><span class="o">=</span><span class="s2">&quot;1.3.6.1.4.1.14519.5.2.1.8421.4009.985792766370191766692237040819&quot;</span><span class="p">,</span>
  <span class="n">auth</span><span class="o">=</span><span class="n">DICOMUtils</span><span class="o">.</span><span class="n">getGlobalDICOMAuth</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="access-top-level-tags-of-dicom-images-imported-into-slicer">
<h3>Access top level tags of DICOM images imported into Slicer<a class="headerlink" href="#access-top-level-tags-of-dicom-images-imported-into-slicer" title="Link to this heading"></a></h3>
<p>For example, to print the first patient’s first study’s first series’ “0020,0032” field:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">db</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">dicomDatabase</span>
<span class="n">patientList</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">patients</span><span class="p">()</span>
<span class="n">studyList</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">studiesForPatient</span><span class="p">(</span><span class="n">patientList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">seriesList</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">seriesForStudy</span><span class="p">(</span><span class="n">studyList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">fileList</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">filesForSeries</span><span class="p">(</span><span class="n">seriesList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># Note, fileValue accesses the database of cached top level tags</span>
<span class="c1"># (nested tags are not included)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">fileValue</span><span class="p">(</span><span class="n">fileList</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;0020,0032&quot;</span><span class="p">))</span>
<span class="c1"># Get tag group,number from dicom dictionary</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pydicom</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">dicom</span>
<span class="n">tagName</span> <span class="o">=</span> <span class="s2">&quot;StudyDate&quot;</span>
<span class="n">tagStr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dicom</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">Tag</span><span class="p">(</span><span class="n">tagName</span><span class="p">))[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">fileValue</span><span class="p">(</span><span class="n">fileList</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tagStr</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="access-dicom-tags-nested-in-a-sequence">
<h3>Access DICOM tags nested in a sequence<a class="headerlink" href="#access-dicom-tags-nested-in-a-sequence" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">db</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">dicomDatabase</span>
<span class="n">patientList</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">patients</span><span class="p">()</span>
<span class="n">studyList</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">studiesForPatient</span><span class="p">(</span><span class="n">patientList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">seriesList</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">seriesForStudy</span><span class="p">(</span><span class="n">studyList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">fileList</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">filesForSeries</span><span class="p">(</span><span class="n">seriesList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># Use pydicom to access the full header, which requires</span>
<span class="c1"># re-reading the dataset instead of using the database cache</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pydicom</span>
<span class="n">pydicom</span><span class="o">.</span><span class="n">dcmread</span><span class="p">(</span><span class="n">fileList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ds</span><span class="o">.</span><span class="n">CTExposureSequence</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ExposureModulationType</span>
</pre></div>
</div>
</section>
<section id="access-tag-of-a-scalar-volume-loaded-from-dicom">
<h3>Access tag of a scalar volume loaded from DICOM<a class="headerlink" href="#access-tag-of-a-scalar-volume-loaded-from-dicom" title="Link to this heading"></a></h3>
<p>Volumes loaded by <code class="docutils literal notranslate"><span class="pre">DICOMScalarVolumePlugin</span></code> store <code class="docutils literal notranslate"><span class="pre">SOP</span> <span class="pre">Instance</span> <span class="pre">UIDs</span></code> in the volume node’s <code class="docutils literal notranslate"><span class="pre">DICOM.instanceUIDs</span></code> attribute. For example, this can be used to get the patient position stored in a volume:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">volumeName</span> <span class="o">=</span> <span class="s2">&quot;2: ENT IMRT&quot;</span>
<span class="n">volumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="n">volumeName</span><span class="p">)</span>
<span class="n">instUids</span> <span class="o">=</span> <span class="n">volumeNode</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span><span class="s2">&quot;DICOM.instanceUIDs&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">dicomDatabase</span><span class="o">.</span><span class="n">fileForInstance</span><span class="p">(</span><span class="n">instUids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">dicomDatabase</span><span class="o">.</span><span class="n">fileValue</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;0018,5100&quot;</span><span class="p">))</span>  <span class="c1"># patient position</span>
</pre></div>
</div>
</section>
<section id="access-tag-of-an-item-in-the-subject-hierarchy-tree">
<h3>Access tag of an item in the Subject Hierarchy tree<a class="headerlink" href="#access-tag-of-an-item-in-the-subject-hierarchy-tree" title="Link to this heading"></a></h3>
<p>Data sets loaded by various DICOM plugins may not use <code class="docutils literal notranslate"><span class="pre">DICOM.instanceUIDs</span></code> attribute but instead they save the <code class="docutils literal notranslate"><span class="pre">Series</span> <span class="pre">Instance</span> <span class="pre">UID</span></code> to the subject hierarchy item. The <code class="docutils literal notranslate"><span class="pre">SOP</span> <span class="pre">Instance</span> <span class="pre">UIDs</span></code> can be retrieved based on the series instance UID, which then can be used to retrieve DICOM tags:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">volumeName</span> <span class="o">=</span> <span class="s2">&quot;2: ENT IMRT&quot;</span>
<span class="n">volumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="n">volumeName</span><span class="p">)</span>

<span class="c1"># Get series instance UID from subject hierarchy</span>
<span class="n">shNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLSubjectHierarchyNode</span><span class="o">.</span><span class="n">GetSubjectHierarchyNode</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="p">)</span>
<span class="n">volumeItemId</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemByDataNode</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">)</span>
<span class="n">seriesInstanceUID</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemUID</span><span class="p">(</span><span class="n">volumeItemId</span><span class="p">,</span> <span class="s1">&#39;DICOM&#39;</span><span class="p">)</span>

<span class="c1"># Get patient name (0010,0010) from the first file of the series</span>
<span class="n">instUids</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">dicomDatabase</span><span class="o">.</span><span class="n">instancesForSeries</span><span class="p">(</span><span class="n">seriesInstanceUID</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">dicomDatabase</span><span class="o">.</span><span class="n">instanceValue</span><span class="p">(</span><span class="n">instUids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;0010,0010&#39;</span><span class="p">))</span> <span class="c1"># patient name</span>
</pre></div>
</div>
<p>Another example, using referenced instance UIDs to get the content time tag of a structure set:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rtStructName</span> <span class="o">=</span> <span class="s2">&quot;3: RTSTRUCT: PROS&quot;</span>
<span class="n">rtStructNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="n">rtStructName</span><span class="p">)</span>
<span class="n">shNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLSubjectHierarchyNode</span><span class="o">.</span><span class="n">GetSubjectHierarchyNode</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="p">)</span>
<span class="n">rtStructShItemID</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemByDataNode</span><span class="p">(</span><span class="n">rtStructNode</span><span class="p">)</span>
<span class="n">ctSliceInstanceUids</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemAttribute</span><span class="p">(</span><span class="n">rtStructShItemID</span><span class="p">,</span> <span class="s2">&quot;DICOM.ReferencedInstanceUIDs&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">dicomDatabase</span><span class="o">.</span><span class="n">fileForInstance</span><span class="p">(</span><span class="n">ctSliceInstanceUids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">dicomDatabase</span><span class="o">.</span><span class="n">fileValue</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;0008,0033&quot;</span><span class="p">))</span>  <span class="c1"># content time</span>
</pre></div>
</div>
</section>
<section id="get-path-and-filename-of-a-scalar-volume-node-loaded-from-dicom">
<h3>Get path and filename of a scalar volume node loaded from DICOM<a class="headerlink" href="#get-path-and-filename-of-a-scalar-volume-node-loaded-from-dicom" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">pathFromNode</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
  <span class="n">storageNode</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">GetStorageNode</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">storageNode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># loaded via drag-drop</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">storageNode</span><span class="o">.</span><span class="n">GetFullNameFromFileName</span><span class="p">()</span>
  <span class="k">else</span><span class="p">:</span> <span class="c1"># Loaded via DICOM browser</span>
    <span class="n">instanceUIDs</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span><span class="s2">&quot;DICOM.instanceUIDs&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">dicomDatabase</span><span class="o">.</span><span class="n">fileForInstance</span><span class="p">(</span><span class="n">instUids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="k">return</span> <span class="n">filepath</span>

<span class="c1"># Example:</span>
<span class="n">node</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;volume1&quot;</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathFromNode</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DICOM path=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="convert-dicom-to-nrrd-on-the-command-line">
<h3>Convert DICOM to NRRD on the command line<a class="headerlink" href="#convert-dicom-to-nrrd-on-the-command-line" title="Link to this heading"></a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">/Applications/Slicer-4.6.2.app/Contents/MacOS/Slicer --no-main-window --python-code &quot;node=slicer.util.loadVolume(&#39;/tmp/series/im0.dcm&#39;); slicer.util.saveNode(node, &#39;/tmp/output.nrrd&#39;); exit()&quot;</span>
</pre></div>
</div>
<p>The same can be done on windows by using the top level Slicer.exe. Be sure to use forward slashes in the pathnames within quotes on the command line.</p>
</section>
<section id="export-a-volume-to-dicom-file-format">
<h3>Export a volume to DICOM file format<a class="headerlink" href="#export-a-volume-to-dicom-file-format" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">volumeNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;CTChest&quot;</span><span class="p">)</span>
<span class="n">outputFolder</span> <span class="o">=</span> <span class="s2">&quot;c:/tmp/dicom-output&quot;</span>

<span class="c1"># Create patient and study and put the volume under the study</span>
<span class="n">shNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLSubjectHierarchyNode</span><span class="o">.</span><span class="n">GetSubjectHierarchyNode</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="p">)</span>
<span class="c1"># set IDs. Note: these IDs are not specifying DICOM tags, but only the names that appear in the hierarchy tree</span>
<span class="n">patientItemID</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">CreateSubjectItem</span><span class="p">(</span><span class="n">shNode</span><span class="o">.</span><span class="n">GetSceneItemID</span><span class="p">(),</span> <span class="s2">&quot;test patient&quot;</span><span class="p">)</span>
<span class="n">studyItemID</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">CreateStudyItem</span><span class="p">(</span><span class="n">patientItemID</span><span class="p">,</span> <span class="s2">&quot;test study&quot;</span><span class="p">)</span>
<span class="n">volumeShItemID</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemByDataNode</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">)</span>
<span class="n">shNode</span><span class="o">.</span><span class="n">SetItemParent</span><span class="p">(</span><span class="n">volumeShItemID</span><span class="p">,</span> <span class="n">studyItemID</span><span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">DICOMScalarVolumePlugin</span>
<span class="n">exporter</span> <span class="o">=</span> <span class="n">DICOMScalarVolumePlugin</span><span class="o">.</span><span class="n">DICOMScalarVolumePluginClass</span><span class="p">()</span>
<span class="n">exportables</span> <span class="o">=</span> <span class="n">exporter</span><span class="o">.</span><span class="n">examineForExport</span><span class="p">(</span><span class="n">volumeShItemID</span><span class="p">)</span>
<span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">exportables</span><span class="p">:</span>
  <span class="c1"># set output folder</span>
  <span class="n">exp</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">outputFolder</span>
  <span class="c1"># here we set DICOM PatientID and StudyID tags</span>
  <span class="n">exp</span><span class="o">.</span><span class="n">setTag</span><span class="p">(</span><span class="s1">&#39;PatientID&#39;</span><span class="p">,</span> <span class="s2">&quot;test patient&quot;</span><span class="p">)</span>
  <span class="n">exp</span><span class="o">.</span><span class="n">setTag</span><span class="p">(</span><span class="s1">&#39;StudyID&#39;</span><span class="p">,</span> <span class="s2">&quot;test study&quot;</span><span class="p">)</span>

<span class="n">exporter</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">exportables</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="export-a-segmentation-to-dicom-segmentation-object">
<h3>Export a segmentation to DICOM segmentation object<a class="headerlink" href="#export-a-segmentation-to-dicom-segmentation-object" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">segmentationNode</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">referenceVolumeNode</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">outputFolder</span> <span class="o">=</span> <span class="s2">&quot;c:/tmp/dicom-output&quot;</span>

<span class="c1"># Associate segmentation node with a reference volume node</span>
<span class="n">shNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLSubjectHierarchyNode</span><span class="o">.</span><span class="n">GetSubjectHierarchyNode</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="p">)</span>
<span class="n">referenceVolumeShItem</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemByDataNode</span><span class="p">(</span><span class="n">referenceVolumeNode</span><span class="p">)</span>
<span class="n">studyShItem</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">referenceVolumeShItem</span><span class="p">)</span>
<span class="n">segmentationShItem</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemByDataNode</span><span class="p">(</span><span class="n">segmentationNode</span><span class="p">)</span>
<span class="n">shNode</span><span class="o">.</span><span class="n">SetItemParent</span><span class="p">(</span><span class="n">segmentationShItem</span><span class="p">,</span> <span class="n">studyShItem</span><span class="p">)</span>

<span class="c1"># Export to DICOM</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">DICOMSegmentationPlugin</span>
<span class="n">exporter</span> <span class="o">=</span> <span class="n">DICOMSegmentationPlugin</span><span class="o">.</span><span class="n">DICOMSegmentationPluginClass</span><span class="p">()</span>
<span class="n">exportables</span> <span class="o">=</span> <span class="n">exporter</span><span class="o">.</span><span class="n">examineForExport</span><span class="p">(</span><span class="n">segmentationShItem</span><span class="p">)</span>
<span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">exportables</span><span class="p">:</span>
  <span class="n">exp</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">outputFolder</span>

<span class="n">exporter</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">exportables</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="export-dicom-series-from-the-database-to-research-file-format">
<h3>Export DICOM series from the database to research file format<a class="headerlink" href="#export-dicom-series-from-the-database-to-research-file-format" title="Link to this heading"></a></h3>
<p>You can export the entire Slicer DICOM database content to nrrd (or nifti, etc.) file format with filtering of data type and naming of the output file based on DICOM tags like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">outputFolder</span> <span class="o">=</span> <span class="s2">&quot;c:/tmp/exptest/&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">DICOMLib</span><span class="w"> </span><span class="kn">import</span> <span class="n">DICOMUtils</span>
<span class="n">patientUIDs</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">dicomDatabase</span><span class="o">.</span><span class="n">patients</span><span class="p">()</span>
<span class="k">for</span> <span class="n">patientUID</span> <span class="ow">in</span> <span class="n">patientUIDs</span><span class="p">:</span>
    <span class="n">loadedNodeIDs</span> <span class="o">=</span> <span class="n">DICOMUtils</span><span class="o">.</span><span class="n">loadPatientByUID</span><span class="p">(</span><span class="n">patientUID</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">loadedNodeID</span> <span class="ow">in</span> <span class="n">loadedNodeIDs</span><span class="p">:</span>
        <span class="c1"># Check if we want to save this node</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetNodeByID</span><span class="p">(</span><span class="n">loadedNodeID</span><span class="p">)</span>
        <span class="c1"># Only export images</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">IsA</span><span class="p">(</span><span class="s1">&#39;vtkMRMLScalarVolumeNode&#39;</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="c1"># Construct filename</span>
        <span class="n">shNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetSubjectHierarchyNode</span><span class="p">()</span>
        <span class="n">seriesItem</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemByDataNode</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">studyItem</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">seriesItem</span><span class="p">)</span>
        <span class="n">patientItem</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">studyItem</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemAttribute</span><span class="p">(</span><span class="n">patientItem</span><span class="p">,</span> <span class="s1">&#39;DICOM.PatientID&#39;</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemAttribute</span><span class="p">(</span><span class="n">studyItem</span><span class="p">,</span> <span class="s1">&#39;DICOM.StudyDate&#39;</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemAttribute</span><span class="p">(</span><span class="n">seriesItem</span><span class="p">,</span> <span class="s1">&#39;DICOM.SeriesNumber&#39;</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemAttribute</span><span class="p">(</span><span class="n">seriesItem</span><span class="p">,</span> <span class="s1">&#39;DICOM.Modality&#39;</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ioManager</span><span class="p">()</span><span class="o">.</span><span class="n">forceFileNameValidCharacters</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.nrrd&quot;</span>
        <span class="c1"># Save node</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Write </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">success</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">saveNode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">outputFolder</span><span class="o">+</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">Clear</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="customize-table-columns-in-dicom-browser">
<h3>Customize table columns in DICOM browser<a class="headerlink" href="#customize-table-columns-in-dicom-browser" title="Link to this heading"></a></h3>
<p>Documentation of methods for changing DICOM browser columns: <a class="reference external" href="https://github.com/commontk/CTK/blob/master/Libs/DICOM/Core/ctkDICOMDatabase.h#L354-L375">https://github.com/commontk/CTK/blob/master/Libs/DICOM/Core/ctkDICOMDatabase.h#L354-L375</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get browser and database</span>
<span class="n">dicomBrowser</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">dicom</span><span class="o">.</span><span class="n">widgetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">self</span><span class="p">()</span><span class="o">.</span><span class="n">browserWidget</span><span class="o">.</span><span class="n">dicomBrowser</span>
<span class="n">dicomDatabase</span> <span class="o">=</span> <span class="n">dicomBrowser</span><span class="o">.</span><span class="n">database</span><span class="p">()</span>

<span class="c1"># Print list of available columns</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dicomDatabase</span><span class="o">.</span><span class="n">patientFieldNames</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dicomDatabase</span><span class="o">.</span><span class="n">studyFieldNames</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dicomDatabase</span><span class="o">.</span><span class="n">seriesFieldNames</span><span class="p">)</span>

<span class="c1"># Change column order</span>
<span class="n">dicomDatabase</span><span class="o">.</span><span class="n">setWeightForField</span><span class="p">(</span><span class="s2">&quot;Series&quot;</span><span class="p">,</span> <span class="s2">&quot;SeriesDescription&quot;</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">dicomDatabase</span><span class="o">.</span><span class="n">setWeightForField</span><span class="p">(</span><span class="s2">&quot;Studies&quot;</span><span class="p">,</span> <span class="s2">&quot;StudyDescription&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="c1"># Change column visibility</span>
<span class="n">dicomDatabase</span><span class="o">.</span><span class="n">setVisibilityForField</span><span class="p">(</span><span class="s2">&quot;Patients&quot;</span><span class="p">,</span> <span class="s2">&quot;PatientsBirthDate&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">dicomDatabase</span><span class="o">.</span><span class="n">setVisibilityForField</span><span class="p">(</span><span class="s2">&quot;Patients&quot;</span><span class="p">,</span> <span class="s2">&quot;PatientsComments&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">dicomDatabase</span><span class="o">.</span><span class="n">setWeightForField</span><span class="p">(</span><span class="s2">&quot;Patients&quot;</span><span class="p">,</span> <span class="s2">&quot;PatientsComments&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="c1"># Change column name</span>
<span class="n">dicomDatabase</span><span class="o">.</span><span class="n">setDisplayedNameForField</span><span class="p">(</span><span class="s2">&quot;Series&quot;</span><span class="p">,</span> <span class="s2">&quot;DisplayedCount&quot;</span><span class="p">,</span> <span class="s2">&quot;Number of images&quot;</span><span class="p">)</span>
<span class="c1"># Change column width to manual</span>
<span class="n">dicomDatabase</span><span class="o">.</span><span class="n">setFormatForField</span><span class="p">(</span><span class="s2">&quot;Series&quot;</span><span class="p">,</span> <span class="s2">&quot;SeriesDescription&quot;</span><span class="p">,</span> <span class="s1">&#39;{&quot;resizeMode&quot;:&quot;interactive&quot;}&#39;</span><span class="p">)</span>
<span class="c1"># Customize table manager in DICOM browser</span>
<span class="n">dicomTableManager</span> <span class="o">=</span> <span class="n">dicomBrowser</span><span class="o">.</span><span class="n">dicomTableManager</span><span class="p">()</span>
<span class="n">dicomTableManager</span><span class="o">.</span><span class="n">selectionMode</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">SingleSelection</span>
<span class="n">dicomTableManager</span><span class="o">.</span><span class="n">autoSelectSeries</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Force database views update</span>
<span class="n">dicomDatabase</span><span class="o">.</span><span class="n">closeDatabase</span><span class="p">()</span>
<span class="n">dicomDatabase</span><span class="o">.</span><span class="n">openDatabase</span><span class="p">(</span><span class="n">dicomBrowser</span><span class="o">.</span><span class="n">database</span><span class="p">()</span><span class="o">.</span><span class="n">databaseFilename</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="query-and-retrieve-data-from-a-pacs-using-classic-dimse-dicom-networking">
<h3>Query and retrieve data from a PACS using classic DIMSE DICOM networking<a class="headerlink" href="#query-and-retrieve-data-from-a-pacs-using-classic-dimse-dicom-networking" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Query</span>
<span class="n">dicomQuery</span> <span class="o">=</span> <span class="n">ctk</span><span class="o">.</span><span class="n">ctkDICOMQuery</span><span class="p">()</span>
<span class="n">dicomQuery</span><span class="o">.</span><span class="n">callingAETitle</span> <span class="o">=</span> <span class="s2">&quot;SLICER&quot;</span>
<span class="n">dicomQuery</span><span class="o">.</span><span class="n">calledAETitle</span> <span class="o">=</span> <span class="s2">&quot;ANYAE&quot;</span>
<span class="n">dicomQuery</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="s2">&quot;dicomserver.co.uk&quot;</span>
<span class="n">dicomQuery</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="mi">11112</span>
<span class="c1"># Change filter parameters in the next line if</span>
<span class="c1"># query does not find any series (try to use a different letter for &quot;Name&quot;, such as &quot;E&quot;)</span>
<span class="c1"># or there are too many hits (try to make &quot;Name&quot; more specific, such as &quot;An&quot;).</span>
<span class="n">dicomQuery</span><span class="o">.</span><span class="n">setFilters</span><span class="p">({</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;Modalities&quot;</span><span class="p">:</span><span class="s2">&quot;MR&quot;</span><span class="p">})</span>
<span class="c1"># temporary in-memory database for storing query results</span>
<span class="n">tempDb</span> <span class="o">=</span> <span class="n">ctk</span><span class="o">.</span><span class="n">ctkDICOMDatabase</span><span class="p">()</span>
<span class="n">tempDb</span><span class="o">.</span><span class="n">openDatabase</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">dicomQuery</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">tempDb</span><span class="p">)</span>

<span class="c1"># Retrieve</span>
<span class="c1"># Enable useCGET to retrieve using the query&#39;s connection (using C-GET).</span>
<span class="c1"># C-GET is simple, as it does not require configuring a DICOM receiver</span>
<span class="c1"># but C-GET is rarely allowed in clinical PACS.</span>
<span class="c1"># If useCGET is disabled then retrieve requests the PACS to send the data (using C-STORE)</span>
<span class="c1"># to Slicer. Slicer&#39;s AE title must be configured in the PACS settings. Slicer must have its</span>
<span class="c1"># DICOM receiver (C-STORE SCP) running.</span>
<span class="n">useCGET</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">dicomRetrieve</span> <span class="o">=</span> <span class="n">ctk</span><span class="o">.</span><span class="n">ctkDICOMRetrieve</span><span class="p">()</span>
<span class="n">dicomRetrieve</span><span class="o">.</span><span class="n">callingAETitle</span> <span class="o">=</span> <span class="n">dicomQuery</span><span class="o">.</span><span class="n">callingAETitle</span>
<span class="n">dicomRetrieve</span><span class="o">.</span><span class="n">calledAETitle</span> <span class="o">=</span> <span class="n">dicomQuery</span><span class="o">.</span><span class="n">calledAETitle</span>
<span class="n">dicomRetrieve</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">dicomQuery</span><span class="o">.</span><span class="n">host</span>
<span class="n">dicomRetrieve</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">dicomQuery</span><span class="o">.</span><span class="n">port</span>
<span class="n">dicomRetrieve</span><span class="o">.</span><span class="n">setDatabase</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">dicomDatabase</span><span class="p">)</span>
<span class="k">for</span> <span class="n">study</span><span class="p">,</span> <span class="n">series</span> <span class="ow">in</span> <span class="n">dicomQuery</span><span class="o">.</span><span class="n">studyAndSeriesInstanceUIDQueried</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ctkDICOMRetrieveTest: Retrieving </span><span class="si">{</span><span class="n">study</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">series</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">useCGET</span><span class="p">:</span>
    <span class="n">success</span> <span class="o">=</span> <span class="n">dicomRetrieve</span><span class="o">.</span><span class="n">getSeries</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">series</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">dicomRetrieve</span><span class="o">.</span><span class="n">moveDestinationAETitle</span> <span class="o">=</span> <span class="n">dicomQuery</span><span class="o">.</span><span class="n">callingAETitle</span>
    <span class="n">success</span> <span class="o">=</span> <span class="n">dicomRetrieve</span><span class="o">.</span><span class="n">moveSeries</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">series</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="s1">&#39;success&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">success</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;failed&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">slicer</span><span class="o">.</span><span class="n">dicomDatabase</span><span class="o">.</span><span class="n">updateDisplayedFields</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="query-and-retrieve-data-from-a-pacs-using-classic-dimse-dicom-networking-with-the-experimental-ctkdicomvisualbrowser">
<h3>Query and retrieve data from a PACS using classic DIMSE DICOM networking with the (experimental) ctkDICOMVisualBrowser<a class="headerlink" href="#query-and-retrieve-data-from-a-pacs-using-classic-dimse-dicom-networking-with-the-experimental-ctkdicomvisualbrowser" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># Get visual browser instance</span>
<span class="n">visualBrowser</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">dicom</span><span class="o">.</span><span class="n">widgetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">self</span><span class="p">()</span><span class="o">.</span><span class="n">browserWidget</span><span class="o">.</span><span class="n">dicomVisualBrowser</span>
<span class="n">dicomDatabase</span> <span class="o">=</span> <span class="n">visualBrowser</span><span class="o">.</span><span class="n">dicomDatabase</span><span class="p">()</span>

<span class="c1"># Disable query/retrieve for all existing servers</span>
<span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">visualBrowser</span><span class="o">.</span><span class="n">serversCount</span><span class="p">()):</span>
  <span class="n">server</span> <span class="o">=</span> <span class="n">visualBrowser</span><span class="o">.</span><span class="n">server</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
  <span class="n">server</span><span class="o">.</span><span class="n">queryRetrieveEnabled</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Add a new DICOM server</span>
<span class="n">server</span> <span class="o">=</span> <span class="n">ctk</span><span class="o">.</span><span class="n">ctkDICOMServer</span><span class="p">()</span>
<span class="n">server</span><span class="o">.</span><span class="n">connectionName</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span>
<span class="n">server</span><span class="o">.</span><span class="n">callingAETitle</span> <span class="o">=</span> <span class="s2">&quot;SLICER&quot;</span>
<span class="n">server</span><span class="o">.</span><span class="n">calledAETitle</span> <span class="o">=</span> <span class="s2">&quot;ANYAE&quot;</span>
<span class="n">server</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="s2">&quot;dicomserver.co.uk&quot;</span>
<span class="n">server</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="mi">104</span>
<span class="n">server</span><span class="o">.</span><span class="n">retrieveProtocol</span> <span class="o">=</span> <span class="n">ctk</span><span class="o">.</span><span class="n">ctkDICOMServer</span><span class="o">.</span><span class="n">CGET</span>

<span class="k">if</span> <span class="n">visualBrowser</span><span class="o">.</span><span class="n">addServer</span><span class="p">(</span><span class="n">server</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Failed to add server&quot;</span><span class="p">)</span>

<span class="c1"># Set the filters for the query</span>
<span class="n">visualBrowser</span><span class="o">.</span><span class="n">filteringPatientID</span> <span class="o">=</span> <span class="s2">&quot;PAT020&quot;</span>
<span class="c1">#visualBrowser.filteringPatientName = &quot;Name&quot;</span>
<span class="c1">#visualBrowser.filteringStudyDescription = &quot;Study description&quot;</span>
<span class="n">visualBrowser</span><span class="o">.</span><span class="n">filteringDate</span> <span class="o">=</span> <span class="n">ctk</span><span class="o">.</span><span class="n">ctkDICOMPatientItemWidget</span><span class="o">.</span><span class="n">LastYear</span>
<span class="c1">#Date options:</span>
<span class="c1">#Any,</span>
<span class="c1">#Today,</span>
<span class="c1">#Yesterday,</span>
<span class="c1">#LastWeek,</span>
<span class="c1">#LastMonth,</span>
<span class="c1">#LastYear</span>
<span class="c1">#visualBrowser.filteringSeriesDescription = &quot;Series description&quot;</span>
<span class="c1">#visualBrowser.filteringModalities = [&quot;CT&quot;, &quot;MR&quot;]</span>

<span class="c1"># Run patient query.</span>
<span class="c1"># NOTE: this will automatically also start query/retrieve jobs at study and series levels</span>
<span class="n">visualBrowser</span><span class="o">.</span><span class="n">onQueryRetrieveOptionToggled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">visualBrowser</span><span class="o">.</span><span class="n">onQueryPatients</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="query-and-retrieve-data-from-a-pacs-using-classic-dimse-dicom-networking-with-the-experimental-ctkdicomscheduler-no-ui-needed">
<h3>Query and retrieve data from a PACS using classic DIMSE DICOM networking with the (experimental) ctkDICOMScheduler (no UI needed)<a class="headerlink" href="#query-and-retrieve-data-from-a-pacs-using-classic-dimse-dicom-networking-with-the-experimental-ctkdicomscheduler-no-ui-needed" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="k">class</span><span class="w"> </span><span class="nc">Receiver</span><span class="p">(</span><span class="n">qt</span><span class="o">.</span><span class="n">QObject</span><span class="p">):</span>
  <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scheduler</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span> <span class="o">=</span> <span class="n">scheduler</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">progressJobDetail</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onProgressDetails</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">jobFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onJobFinished</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">jobFailed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onJobFailed</span><span class="p">)</span>

  <span class="k">def</span><span class="w"> </span><span class="nf">startQueryRetrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">setFilters</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">queryPatients</span><span class="p">()</span>

  <span class="k">def</span><span class="w"> </span><span class="nf">onJobFinished</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">details</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">detail</span> <span class="ow">in</span> <span class="n">details</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">detail</span><span class="o">.</span><span class="n">jobType</span><span class="p">()</span> <span class="o">==</span> <span class="n">ctk</span><span class="o">.</span><span class="n">ctkDICOMJobResponseSet</span><span class="o">.</span><span class="n">QueryPatients</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Query patients success. Connection : &quot;</span><span class="p">,</span> <span class="n">detail</span><span class="o">.</span><span class="n">connectionName</span><span class="p">())</span>
      <span class="k">elif</span> <span class="n">detail</span><span class="o">.</span><span class="n">jobType</span><span class="p">()</span> <span class="o">==</span> <span class="n">ctk</span><span class="o">.</span><span class="n">ctkDICOMJobResponseSet</span><span class="o">.</span><span class="n">QueryStudies</span><span class="p">:</span>
        <span class="n">patientID</span> <span class="o">=</span> <span class="n">detail</span><span class="o">.</span><span class="n">patientID</span><span class="p">()</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Query studies success for patientID: &quot;</span><span class="p">,</span> <span class="n">patientID</span><span class="p">,</span> <span class="s2">&quot;. Connection : &quot;</span><span class="p">,</span> <span class="n">detail</span><span class="o">.</span><span class="n">connectionName</span><span class="p">())</span>
      <span class="k">elif</span> <span class="n">detail</span><span class="o">.</span><span class="n">jobType</span><span class="p">()</span> <span class="o">==</span> <span class="n">ctk</span><span class="o">.</span><span class="n">ctkDICOMJobResponseSet</span><span class="o">.</span><span class="n">RetrieveStudy</span><span class="p">:</span>
        <span class="n">patientID</span> <span class="o">=</span> <span class="n">detail</span><span class="o">.</span><span class="n">patientID</span><span class="p">()</span>
        <span class="n">studyInstanceUID</span> <span class="o">=</span> <span class="n">detail</span><span class="o">.</span><span class="n">studyInstanceUID</span><span class="p">()</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Retrieve studies success for studyInstanceUID: &quot;</span><span class="p">,</span> <span class="n">studyInstanceUID</span><span class="p">,</span> <span class="s2">&quot; (patientID: &quot;</span><span class="p">,</span><span class="n">patientID</span><span class="p">,</span> <span class="s2">&quot;). Connection : &quot;</span><span class="p">,</span> <span class="n">detail</span><span class="o">.</span><span class="n">connectionName</span><span class="p">())</span>

  <span class="k">def</span><span class="w"> </span><span class="nf">onJobFailed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">details</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">detail</span> <span class="ow">in</span> <span class="n">details</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">detail</span><span class="o">.</span><span class="n">jobType</span><span class="p">()</span> <span class="o">==</span> <span class="n">ctk</span><span class="o">.</span><span class="n">ctkDICOMJobResponseSet</span><span class="o">.</span><span class="n">QueryPatients</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Query patients failed. Connection : &quot;</span><span class="p">,</span> <span class="n">detail</span><span class="o">.</span><span class="n">connectionName</span><span class="p">())</span>
      <span class="k">elif</span> <span class="n">detail</span><span class="o">.</span><span class="n">jobType</span><span class="p">()</span> <span class="o">==</span> <span class="n">ctk</span><span class="o">.</span><span class="n">ctkDICOMJobResponseSet</span><span class="o">.</span><span class="n">QueryStudies</span><span class="p">:</span>
        <span class="n">patientID</span> <span class="o">=</span> <span class="n">detail</span><span class="o">.</span><span class="n">patientID</span><span class="p">()</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Query studies failed for patientID: &quot;</span><span class="p">,</span> <span class="n">patientID</span><span class="p">,</span> <span class="s2">&quot;. Connection : &quot;</span><span class="p">,</span> <span class="n">detail</span><span class="o">.</span><span class="n">connectionName</span><span class="p">())</span>
      <span class="k">elif</span> <span class="n">detail</span><span class="o">.</span><span class="n">jobType</span><span class="p">()</span> <span class="o">==</span> <span class="n">ctk</span><span class="o">.</span><span class="n">ctkDICOMJobResponseSet</span><span class="o">.</span><span class="n">RetrieveStudy</span><span class="p">:</span>
        <span class="n">patientID</span> <span class="o">=</span> <span class="n">detail</span><span class="o">.</span><span class="n">patientID</span><span class="p">()</span>
        <span class="n">studyInstanceUID</span> <span class="o">=</span> <span class="n">detail</span><span class="o">.</span><span class="n">studyInstanceUID</span><span class="p">()</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Retrieve studies failed for studyInstanceUID: &quot;</span><span class="p">,</span> <span class="n">studyInstanceUID</span><span class="p">,</span> <span class="s2">&quot; (patientID: &quot;</span><span class="p">,</span> <span class="n">patientID</span><span class="p">,</span> <span class="s2">&quot;). Connection : &quot;</span><span class="p">,</span> <span class="n">detail</span><span class="o">.</span><span class="n">connectionName</span><span class="p">())</span>

  <span class="k">def</span><span class="w"> </span><span class="nf">onProgressDetails</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">details</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">detail</span> <span class="ow">in</span> <span class="n">details</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">detail</span><span class="o">.</span><span class="n">jobType</span><span class="p">()</span> <span class="o">==</span> <span class="n">ctk</span><span class="o">.</span><span class="n">ctkDICOMJobResponseSet</span><span class="o">.</span><span class="n">QueryPatients</span><span class="p">:</span>
        <span class="n">patientIDs</span> <span class="o">=</span> <span class="n">detail</span><span class="o">.</span><span class="n">queriedPatientIDs</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">patientID</span> <span class="ow">in</span> <span class="n">patientIDs</span><span class="p">:</span>
          <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Starting studies query for patient: &quot;</span><span class="p">,</span> <span class="n">patientID</span><span class="p">,</span> <span class="s2">&quot;. Connection : &quot;</span><span class="p">,</span> <span class="n">detail</span><span class="o">.</span><span class="n">connectionName</span><span class="p">())</span>
          <span class="n">scheduler</span><span class="o">.</span><span class="n">queryStudies</span><span class="p">(</span><span class="n">patientID</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">detail</span><span class="o">.</span><span class="n">jobType</span><span class="p">()</span> <span class="o">==</span> <span class="n">ctk</span><span class="o">.</span><span class="n">ctkDICOMJobResponseSet</span><span class="o">.</span><span class="n">QueryStudies</span><span class="p">:</span>
        <span class="n">studyInstanceUIDs</span> <span class="o">=</span> <span class="n">detail</span><span class="o">.</span><span class="n">queriedStudyInstanceUIDs</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">studyInstanceUID</span> <span class="ow">in</span> <span class="n">studyInstanceUIDs</span><span class="p">:</span>
          <span class="n">patientItem</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">dicomDatabase</span><span class="o">.</span><span class="n">patientForStudy</span><span class="p">(</span><span class="n">studyInstanceUID</span><span class="p">)</span>
          <span class="n">patientID</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">dicomDatabase</span><span class="o">.</span><span class="n">fieldForPatient</span><span class="p">(</span><span class="s2">&quot;PatientID&quot;</span><span class="p">,</span> <span class="n">patientItem</span><span class="p">)</span>
          <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Starting studies retrieve for studyInstanceUID: &quot;</span><span class="p">,</span> <span class="n">studyInstanceUID</span><span class="p">,</span> <span class="s2">&quot; (patientID: &quot;</span><span class="p">,</span><span class="n">patientID</span><span class="p">,</span> <span class="s2">&quot;). Connection : &quot;</span><span class="p">,</span> <span class="n">detail</span><span class="o">.</span><span class="n">connectionName</span><span class="p">())</span>
          <span class="n">scheduler</span><span class="o">.</span><span class="n">retrieveStudy</span><span class="p">(</span><span class="n">patientID</span><span class="p">,</span> <span class="n">studyInstanceUID</span><span class="p">)</span>


<span class="c1"># Add a new DICOM server</span>
<span class="n">server</span> <span class="o">=</span> <span class="n">ctk</span><span class="o">.</span><span class="n">ctkDICOMServer</span><span class="p">()</span>
<span class="n">server</span><span class="o">.</span><span class="n">connectionName</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span>
<span class="n">server</span><span class="o">.</span><span class="n">callingAETitle</span> <span class="o">=</span> <span class="s2">&quot;SLICER&quot;</span>
<span class="n">server</span><span class="o">.</span><span class="n">calledAETitle</span> <span class="o">=</span> <span class="s2">&quot;ANYAE&quot;</span>
<span class="n">server</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="s2">&quot;dicomserver.co.uk&quot;</span>
<span class="n">server</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="mi">104</span>
<span class="n">server</span><span class="o">.</span><span class="n">retrieveProtocol</span> <span class="o">=</span> <span class="n">ctk</span><span class="o">.</span><span class="n">ctkDICOMServer</span><span class="o">.</span><span class="n">CGET</span>

<span class="n">scheduler</span> <span class="o">=</span> <span class="n">ctk</span><span class="o">.</span><span class="n">ctkDICOMScheduler</span><span class="p">()</span>
<span class="n">scheduler</span><span class="o">.</span><span class="n">setDicomDatabase</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">dicomDatabase</span><span class="p">)</span>
<span class="n">scheduler</span><span class="o">.</span><span class="n">addServer</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>

<span class="n">receiver</span> <span class="o">=</span> <span class="n">Receiver</span><span class="p">(</span><span class="n">scheduler</span><span class="p">)</span>

<span class="c1"># Set the filters for the query</span>
<span class="n">nDays</span> <span class="o">=</span> <span class="mi">325</span>
<span class="n">endDate</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">QDate</span><span class="p">()</span><span class="o">.</span><span class="n">currentDate</span><span class="p">()</span>
<span class="n">startDate</span> <span class="o">=</span> <span class="n">endDate</span><span class="o">.</span><span class="n">addDays</span><span class="p">(</span><span class="o">-</span><span class="n">nDays</span><span class="p">)</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="s2">&quot;PAT020&quot;</span><span class="p">,</span>
  <span class="c1">#&quot;Name&quot;: &quot;Name&quot;,</span>
  <span class="c1">#&quot;Study&quot;: &quot;Study description&quot;,</span>
  <span class="c1">#&quot;Series&quot;: &quot;Series description&quot;,</span>
  <span class="c1">#&quot;Modalities&quot;: [&quot;CT&quot;, &quot;MR&quot;],</span>
  <span class="s2">&quot;StartDate&quot;</span><span class="p">:</span> <span class="n">startDate</span><span class="o">.</span><span class="n">toString</span><span class="p">(</span><span class="s2">&quot;yyyyMMdd&quot;</span><span class="p">),</span>
  <span class="s2">&quot;EndDate&quot;</span><span class="p">:</span> <span class="n">endDate</span><span class="o">.</span><span class="n">toString</span><span class="p">(</span><span class="s2">&quot;yyyyMMdd&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">receiver</span><span class="o">.</span><span class="n">startQueryRetrieve</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="send-data-to-a-pacs-using-classic-dimse-dicom-networking">
<h3>Send data to a PACS using classic DIMSE DICOM networking<a class="headerlink" href="#send-data-to-a-pacs-using-classic-dimse-dicom-networking" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">DICOMLib</span><span class="w"> </span><span class="kn">import</span> <span class="n">DICOMSender</span>
<span class="n">sender</span> <span class="o">=</span> <span class="n">DICOMSender</span><span class="p">(</span>
  <span class="n">files</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;path/to/0.dcm&#39;</span><span class="p">,</span><span class="s1">&#39;path/to/1.dcm&#39;</span><span class="p">],</span>
  <span class="n">address</span><span class="o">=</span><span class="s1">&#39;dicomserver.co.uk:9999&#39;</span>
  <span class="n">protocol</span><span class="o">=</span><span class="s2">&quot;DIMSE&quot;</span><span class="p">,</span>
  <span class="n">delayed</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">sender</span><span class="o">.</span><span class="n">send</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="send-data-to-a-pacs-using-dicomweb-networking">
<h3>Send data to a PACS using DICOMweb networking<a class="headerlink" href="#send-data-to-a-pacs-using-dicomweb-networking" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">DICOMLib</span><span class="w"> </span><span class="kn">import</span> <span class="n">DICOMSender</span>
<span class="n">sender</span> <span class="o">=</span> <span class="n">DICOMSender</span><span class="p">(</span>
  <span class="n">files</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;path/to/0.dcm&#39;</span><span class="p">,</span><span class="s1">&#39;path/to/1.dcm&#39;</span><span class="p">],</span>
  <span class="n">address</span><span class="o">=</span><span class="s1">&#39;dicomserver.co.uk:9999&#39;</span>
  <span class="n">protocol</span><span class="o">=</span><span class="s2">&quot;DICOMweb&quot;</span><span class="p">,</span>
  <span class="n">auth</span><span class="o">=</span><span class="n">DICOMUtils</span><span class="o">.</span><span class="n">getGlobalDICOMAuth</span><span class="p">(),</span>
  <span class="n">delayed</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">sender</span><span class="o">.</span><span class="n">send</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="convert-rt-structure-set-to-labelmap-nrrd-files">
<h3>Convert RT structure set to labelmap NRRD files<a class="headerlink" href="#convert-rt-structure-set-to-labelmap-nrrd-files" title="Link to this heading"></a></h3>
<p><a class="reference external" href="https://github.com/SlicerRt/SlicerRT/tree/master/BatchProcessing">SlicerRT batch processing</a> to batch convert RT structure sets to labelmap NRRD files.</p>
</section>
<section id="run-a-dcmtk-command-line-tool">
<h3>Run a DCMTK Command Line Tool<a class="headerlink" href="#run-a-dcmtk-command-line-tool" title="Link to this heading"></a></h3>
<p>The example below runs the DCMTK <code class="docutils literal notranslate"><span class="pre">img2dcm</span></code> tool to convert a PNG input image to
an output DICOM file on disk. <code class="docutils literal notranslate"><span class="pre">img2dcm</span></code> runs in a separate process and Slicer
waits until it completes before continuing.</p>
<p>See <a class="reference external" href="https://support.dcmtk.org/docs/pages.html">DCMTK documentation</a> for descriptions of
other DCMTK command line application tools.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">DICOMLib</span><span class="w"> </span><span class="kn">import</span> <span class="n">DICOMCommand</span>
<span class="n">command</span> <span class="o">=</span> <span class="n">DICOMCommand</span><span class="p">(</span><span class="s1">&#39;img2dcm&#39;</span><span class="p">,[</span><span class="s1">&#39;image.png&#39;</span><span class="p">,</span><span class="s1">&#39;output.dcm&#39;</span><span class="p">])</span>
<span class="n">stdout</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="c1"># run synchronously, block until img2dcm returns</span>
</pre></div>
</div>
</section>
<section id="additional-notes">
<h3>Additional Notes<a class="headerlink" href="#additional-notes" title="Link to this heading"></a></h3>
<p>See the DICOMLib scripted module for additional DICOM utilities.</p>
</section>
</section>
<section id="markups">
<h2>Markups<a class="headerlink" href="#markups" title="Link to this heading"></a></h2>
<section id="save-markups-to-file">
<h3>Save markups to file<a class="headerlink" href="#save-markups-to-file" title="Link to this heading"></a></h3>
<p>Any markup node can be saved as a <a class="reference internal" href="modules/markups.html#markups"><span class="std std-ref">markups json file</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">markupsNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">saveNode</span><span class="p">(</span><span class="n">markupsNode</span><span class="p">,</span> <span class="s2">&quot;/path/to/MyMarkups.mkp.json&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Generally the markups json file format is recommended for saving all properties of a markups node, but for exporting only control point information (name, position, and basic state) a <a class="reference internal" href="modules/markups.html#markups-control-points-table-file-format-csv-tsv"><span class="std std-ref">control points table can be exported in standard csv file format</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">markups</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">ExportControlPointsToCSV</span><span class="p">(</span><span class="n">markupsNode</span><span class="p">,</span> <span class="s2">&quot;/path/to/MyControlPoints.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="load-markups-from-file">
<h3>Load markups from file<a class="headerlink" href="#load-markups-from-file" title="Link to this heading"></a></h3>
<p>Any markup node can be loaded from a <a class="reference internal" href="modules/markups.html#markups"><span class="std std-ref">markups json file</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">markupsNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">loadMarkups</span><span class="p">(</span><span class="s2">&quot;/path/to/MyMarkups.mkp.json&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Control points can be loaded from <a class="reference internal" href="modules/markups.html#markups-control-points-table-file-format-csv-tsv"><span class="std std-ref">control points table csv file</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">markupsNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLMarkupsCurveNode&quot;</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">markups</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">ImportControlPointsFromCSV</span><span class="p">(</span><span class="n">markupsNode</span><span class="p">,</span> <span class="s2">&quot;/path/to/MyControlPoints.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="load-markups-point-list-from-file">
<h3>Load markups point list from file<a class="headerlink" href="#load-markups-point-list-from-file" title="Link to this heading"></a></h3>
<p>Markups point list can be loaded from legacy <a class="reference internal" href="modules/markups.html#markups-fiducial-point-list-file-format-fcsv"><span class="std std-ref">fcsv file format</span></a>. Note that this file format is no longer recommended, as it is not a standard csv file format and can only store a small fraction of information that is in a markups node.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">loadMarkupsFiducialList</span><span class="p">(</span><span class="s2">&quot;/path/to/list/F.fcsv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="adding-control-points-programmatically">
<h3>Adding control points Programmatically<a class="headerlink" href="#adding-control-points-programmatically" title="Link to this heading"></a></h3>
<p>Markups control points can be added to the currently active point list from the python console by using the following module logic command:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">markups</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">AddControlPoint</span><span class="p">()</span>
</pre></div>
</div>
<p>The command with no arguments will place a new control point at the origin. You can also pass it an initial location:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">markups</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">AddControlPoint</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.3</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="how-to-draw-a-curve-using-control-points-stored-in-a-numpy-array">
<h3>How to draw a curve using control points stored in a numpy array<a class="headerlink" href="#how-to-draw-a-curve-using-control-points-stored-in-a-numpy-array" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create random numpy array to use as input</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">pointPositions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>

<span class="c1"># Create curve from numpy array</span>
<span class="n">curveNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLMarkupsCurveNode&quot;</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">updateMarkupsControlPointsFromArray</span><span class="p">(</span><span class="n">curveNode</span><span class="p">,</span> <span class="n">pointPositions</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="add-a-button-to-module-gui-to-activate-control-point-placement">
<h3>Add a button to module GUI to activate control point placement<a class="headerlink" href="#add-a-button-to-module-gui-to-activate-control-point-placement" title="Link to this heading"></a></h3>
<p>This code snippet creates a toggle button, which activates control point placement when pressed (and deactivates when released).</p>
<p>The <a class="reference external" href="https://apidocs.slicer.org/main/classqSlicerMarkupsPlaceWidget.html">qSlicerMarkupsPlaceWidget widget</a> can automatically activate placement of multiple points and can show buttons for deleting points, changing colors, lock, and hide points.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">w</span><span class="o">=</span><span class="n">slicer</span><span class="o">.</span><span class="n">qSlicerMarkupsPlaceWidget</span><span class="p">()</span>
<span class="n">w</span><span class="o">.</span><span class="n">setMRMLScene</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="p">)</span>
<span class="n">markupsNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLMarkupsCurveNode&quot;</span><span class="p">)</span>
<span class="n">w</span><span class="o">.</span><span class="n">setCurrentNode</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetNodeByID</span><span class="p">(</span><span class="n">markupsNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">()))</span>
<span class="c1"># Hide all buttons and only show place button</span>
<span class="n">w</span><span class="o">.</span><span class="n">buttonsVisible</span><span class="o">=</span><span class="kc">False</span>
<span class="n">w</span><span class="o">.</span><span class="n">placeButton</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">w</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="adding-control-points-via-mouse-clicks">
<h3>Adding control points via mouse clicks<a class="headerlink" href="#adding-control-points-via-mouse-clicks" title="Link to this heading"></a></h3>
<p>You can also set the mouse mode into Markups control point placement by calling:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">placeModePersistence</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">markups</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">StartPlaceMode</span><span class="p">(</span><span class="n">placeModePersistence</span><span class="p">)</span>
</pre></div>
</div>
<p>A lower level way to do this is via the selection and interaction nodes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">selectionNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetNodeByID</span><span class="p">(</span><span class="s2">&quot;vtkMRMLSelectionNodeSingleton&quot;</span><span class="p">)</span>
<span class="n">selectionNode</span><span class="o">.</span><span class="n">SetReferenceActivePlaceNodeClassName</span><span class="p">(</span><span class="s2">&quot;vtkMRMLMarkupsFiducialNode&quot;</span><span class="p">)</span>
<span class="n">interactionNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetNodeByID</span><span class="p">(</span><span class="s2">&quot;vtkMRMLInteractionNodeSingleton&quot;</span><span class="p">)</span>
<span class="n">placeModePersistence</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">interactionNode</span><span class="o">.</span><span class="n">SetPlaceModePersistence</span><span class="p">(</span><span class="n">placeModePersistence</span><span class="p">)</span>
<span class="c1"># mode 1 is Place, can also be accessed via slicer.vtkMRMLInteractionNode().Place</span>
<span class="n">interactionNode</span><span class="o">.</span><span class="n">SetCurrentInteractionMode</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>To switch back to view transform once you’re done placing control points:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">interactionNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetNodeByID</span><span class="p">(</span><span class="s2">&quot;vtkMRMLInteractionNodeSingleton&quot;</span><span class="p">)</span>
<span class="n">interactionNode</span><span class="o">.</span><span class="n">SwitchToViewTransformMode</span><span class="p">()</span>
<span class="c1"># also turn off place mode persistence if required</span>
<span class="n">interactionNode</span><span class="o">.</span><span class="n">SetPlaceModePersistence</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="access-to-markups-point-list-properties">
<h3>Access to markups point list Properties<a class="headerlink" href="#access-to-markups-point-list-properties" title="Link to this heading"></a></h3>
<p>Each vtkMRMLMarkupsFiducialNode has a vector of control points in it which can be accessed from python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pointListNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;vtkMRMLMarkupsFiducialNode1&quot;</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">pointListNode</span><span class="o">.</span><span class="n">AddControlPoint</span><span class="p">([</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.0</span><span class="p">])</span>
<span class="n">pointListNode</span><span class="o">.</span><span class="n">SetNthControlPointLabel</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s2">&quot;new label&quot;</span><span class="p">)</span>
<span class="c1"># each control point is given a unique id which can be accessed from the superclass level</span>
<span class="n">id1</span> <span class="o">=</span> <span class="n">pointListNode</span><span class="o">.</span><span class="n">GetNthControlPointID</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="c1"># manually set the position</span>
<span class="n">pointListNode</span><span class="o">.</span><span class="n">SetNthControlPointPosition</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">)</span>
<span class="c1"># set the label</span>
<span class="n">pointListNode</span><span class="o">.</span><span class="n">SetNthControlPointLabel</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s2">&quot;New label&quot;</span><span class="p">)</span>
<span class="c1"># set the selected flag, only selected = 1 control points will be passed to CLIs</span>
<span class="n">pointListNode</span><span class="o">.</span><span class="n">SetNthControlPointSelected</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># set the visibility flag</span>
<span class="n">pointListNode</span><span class="o">.</span><span class="n">SetNthControlPointVisibility</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>You can loop over the control points in a list and get the coordinates:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pointListNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
<span class="n">numControlPoints</span> <span class="o">=</span> <span class="n">pointListNode</span><span class="o">.</span><span class="n">GetNumberOfControlPoints</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numControlPoints</span><span class="p">):</span>
  <span class="n">ras</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkVector3d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">pointListNode</span><span class="o">.</span><span class="n">GetNthControlPointPosition</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">ras</span><span class="p">)</span>
  <span class="c1"># the world position is the RAS position with any transform matrices applied</span>
  <span class="n">world</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
  <span class="n">pointListNode</span><span class="o">.</span><span class="n">GetNthControlPointPositionWorld</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">world</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s2">&quot;: RAS =&quot;</span><span class="p">,</span><span class="n">ras</span><span class="p">,</span><span class="s2">&quot;, world =&quot;</span><span class="p">,</span><span class="n">world</span><span class="p">)</span>
</pre></div>
</div>
<p>You can also look at the sample code in the <a class="reference external" href="https://github.com/Slicer/Slicer/blob/main/Modules/Scripted/Endoscopy/Endoscopy.py#L287">Endoscopy module</a> to see how python is used to access control points from a scripted module.</p>
</section>
<section id="define-edit-a-circular-region-of-interest-in-a-slice-viewer">
<h3>Define/edit a circular region of interest in a slice viewer<a class="headerlink" href="#define-edit-a-circular-region-of-interest-in-a-slice-viewer" title="Link to this heading"></a></h3>
<p>Drop two markups control points on a slice view and copy-paste the code below into the Python console. After this, as you move the control points you’ll see a circle following the markups.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Update the sphere from the control points</span>
<span class="k">def</span><span class="w"> </span><span class="nf">UpdateSphere</span><span class="p">(</span><span class="n">param1</span><span class="p">,</span> <span class="n">param2</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;Update the sphere from the control points</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
  <span class="n">pointListNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
  <span class="n">centerPointCoord</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
  <span class="n">pointListNode</span><span class="o">.</span><span class="n">GetNthControlPointPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">centerPointCoord</span><span class="p">)</span>
  <span class="n">circumferencePointCoord</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
  <span class="n">pointListNode</span><span class="o">.</span><span class="n">GetNthControlPointPosition</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">circumferencePointCoord</span><span class="p">)</span>
  <span class="n">sphere</span><span class="o">.</span><span class="n">SetCenter</span><span class="p">(</span><span class="n">centerPointCoord</span><span class="p">)</span>
  <span class="n">radius</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">centerPointCoord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">circumferencePointCoord</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">centerPointCoord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">circumferencePointCoord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">centerPointCoord</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">circumferencePointCoord</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">sphere</span><span class="o">.</span><span class="n">SetRadius</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>
  <span class="n">sphere</span><span class="o">.</span><span class="n">SetPhiResolution</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
  <span class="n">sphere</span><span class="o">.</span><span class="n">SetThetaResolution</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
  <span class="n">sphere</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>

<span class="c1"># Get point list node from scene</span>
<span class="n">pointListNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
<span class="n">sphere</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkSphereSource</span><span class="p">()</span>
<span class="n">UpdateSphere</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Create model node and add to scene</span>
<span class="n">modelsLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">modelsLogic</span><span class="o">.</span><span class="n">AddModel</span><span class="p">(</span><span class="n">sphere</span><span class="o">.</span><span class="n">GetOutput</span><span class="p">())</span>
<span class="n">model</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetSliceIntersectionVisibility</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetSliceIntersectionThickness</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Call UpdateSphere whenever the control points are changed</span>
<span class="n">pointListNode</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLMarkupsNode</span><span class="o">.</span><span class="n">PointModifiedEvent</span><span class="p">,</span> <span class="n">UpdateSphere</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="specify-a-sphere-by-multiple-control-points">
<h3>Specify a sphere by multiple control points<a class="headerlink" href="#specify-a-sphere-by-multiple-control-points" title="Link to this heading"></a></h3>
<p>Drop multiple markups control points at the boundary of the spherical object and and copy-paste the code below into the Python console to get best-fit sphere. A minimum of 4 control points are required. Tt is recommended to place the control points far away from each other for the most accurate fit.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get markup node from scene</span>
<span class="n">pointListNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">least_squares</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>

<span class="k">def</span><span class="w"> </span><span class="nf">fit_sphere_least_squares</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y_values</span><span class="p">,</span> <span class="n">z_values</span><span class="p">,</span> <span class="n">initial_parameters</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">((</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">),(</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">))):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Source: https://github.com/thompson318/scikit-surgery-sphere-fitting/blob/master/sksurgeryspherefitting/algorithms/sphere_fitting.py</span>
<span class="sd">  Uses scipy&#39;s least squares optimisor to fit a sphere to a set</span>
<span class="sd">  of 3D Points</span>
<span class="sd">  :return: x: an array containing the four fitted parameters</span>
<span class="sd">  :return: ier: int An integer flag. If it is equal to 1, 2, 3 or 4, the</span>
<span class="sd">          solution was found.</span>
<span class="sd">  :param: (x,y,z) three arrays of equal length containing the x, y, and z</span>
<span class="sd">          coordinates.</span>
<span class="sd">  :param: an array containing four initial values (centre, and radius)</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">return</span> <span class="n">least_squares</span><span class="p">(</span><span class="n">_calculate_residual_sphere</span><span class="p">,</span> <span class="n">initial_parameters</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;trf&quot;</span><span class="p">,</span> <span class="n">jac</span><span class="o">=</span><span class="s2">&quot;3-point&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y_values</span><span class="p">,</span> <span class="n">z_values</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_calculate_residual_sphere</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">x_values</span><span class="p">,</span> <span class="n">y_values</span><span class="p">,</span> <span class="n">z_values</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Source: https://github.com/thompson318/scikit-surgery-sphere-fitting/blob/master/sksurgeryspherefitting/algorithms/sphere_fitting.py</span>
<span class="sd">  Calculates the residual error for an x,y,z coordinates, fitted</span>
<span class="sd">  to a sphere with centre and radius defined by the parameters tuple</span>
<span class="sd">  :return: The residual error</span>
<span class="sd">  :param: A tuple of the parameters to be optimised, should contain [x_centre, y_centre, z_centre, radius]</span>
<span class="sd">  :param: arrays containing the x,y, and z coordinates.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="c1">#extract the parameters</span>
  <span class="n">x_centre</span><span class="p">,</span> <span class="n">y_centre</span><span class="p">,</span> <span class="n">z_centre</span><span class="p">,</span> <span class="n">radius</span> <span class="o">=</span> <span class="n">parameters</span>
  <span class="c1">#use numpy&#39;s sqrt function here, which works by element on arrays</span>
  <span class="n">distance_from_centre</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x_values</span> <span class="o">-</span> <span class="n">x_centre</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_values</span> <span class="o">-</span> <span class="n">y_centre</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">z_values</span> <span class="o">-</span> <span class="n">z_centre</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">distance_from_centre</span> <span class="o">-</span> <span class="n">radius</span>

<span class="c1"># Fit a sphere to the markups fidicual points</span>
<span class="n">markupsPositions</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromMarkupsControlPoints</span><span class="p">(</span><span class="n">pointListNode</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="c1"># initial guess</span>
<span class="n">center0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">markupsPositions</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">radius0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">markupsPositions</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">markupsPositions</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="o">/</span><span class="mf">2.0</span>
<span class="n">fittingResult</span> <span class="o">=</span> <span class="n">fit_sphere_least_squares</span><span class="p">(</span><span class="n">markupsPositions</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">markupsPositions</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">markupsPositions</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="n">center0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">center0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">center0</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">radius0</span><span class="p">])</span>
<span class="p">[</span><span class="n">centerX</span><span class="p">,</span> <span class="n">centerY</span><span class="p">,</span> <span class="n">centerZ</span><span class="p">,</span> <span class="n">radius</span><span class="p">]</span> <span class="o">=</span> <span class="n">fittingResult</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>

<span class="c1"># Create a sphere using the fitted parameters</span>
<span class="n">sphere</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkSphereSource</span><span class="p">()</span>
<span class="n">sphere</span><span class="o">.</span><span class="n">SetPhiResolution</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
<span class="n">sphere</span><span class="o">.</span><span class="n">SetThetaResolution</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
<span class="n">sphere</span><span class="o">.</span><span class="n">SetCenter</span><span class="p">(</span><span class="n">centerX</span><span class="p">,</span> <span class="n">centerY</span><span class="p">,</span> <span class="n">centerZ</span><span class="p">)</span>
<span class="n">sphere</span><span class="o">.</span><span class="n">SetRadius</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>
<span class="n">sphere</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>

<span class="c1"># Add the sphere to the scene</span>
<span class="n">modelsLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">modelsLogic</span><span class="o">.</span><span class="n">AddModel</span><span class="p">(</span><span class="n">sphere</span><span class="o">.</span><span class="n">GetOutput</span><span class="p">())</span>
<span class="n">model</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetSliceIntersectionVisibility</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetSliceIntersectionThickness</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="fit-markups-roi-to-volume">
<h3>Fit markups ROI to volume<a class="headerlink" href="#fit-markups-roi-to-volume" title="Link to this heading"></a></h3>
<p>This code snippet creates a new markups ROI and fits it to a volume node.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">volumeNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s1">&#39;MRHead&#39;</span><span class="p">)</span>

<span class="c1"># Create a new ROI that will be fit to volumeNode</span>
<span class="n">roiNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLMarkupsROINode&quot;</span><span class="p">)</span>

<span class="n">cropVolumeParameters</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLCropVolumeParametersNode&quot;</span><span class="p">)</span>
<span class="n">cropVolumeParameters</span><span class="o">.</span><span class="n">SetInputVolumeNodeID</span><span class="p">(</span><span class="n">volumeNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
<span class="n">cropVolumeParameters</span><span class="o">.</span><span class="n">SetROINodeID</span><span class="p">(</span><span class="n">roiNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">cropvolume</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">SnapROIToVoxelGrid</span><span class="p">(</span><span class="n">cropVolumeParameters</span><span class="p">)</span>  <span class="c1"># optional (rotates the ROI to match the volume axis directions)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">cropvolume</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">FitROIToInputVolume</span><span class="p">(</span><span class="n">cropVolumeParameters</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">RemoveNode</span><span class="p">(</span><span class="n">cropVolumeParameters</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="fit-markups-plane-to-model">
<h3>Fit markups plane to model<a class="headerlink" href="#fit-markups-plane-to-model" title="Link to this heading"></a></h3>
<p>This code snippet fits a plane a model node named <code class="docutils literal notranslate"><span class="pre">InputModel</span></code> and creates a new markups plane node to display this best fit plane.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">inputModel</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s1">&#39;InputModel&#39;</span><span class="p">)</span>

<span class="c1"># Compute best fit plane</span>
<span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
<span class="n">normal</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="n">vtk</span><span class="o">.</span><span class="n">vtkPlane</span><span class="o">.</span><span class="n">ComputeBestFittingPlane</span><span class="p">(</span><span class="n">inputModel</span><span class="o">.</span><span class="n">GetPolyData</span><span class="p">()</span><span class="o">.</span><span class="n">GetPoints</span><span class="p">(),</span> <span class="n">center</span><span class="p">,</span> <span class="n">normal</span><span class="p">)</span>

<span class="c1"># Display best fit plane as a markups plane</span>
<span class="n">planeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s1">&#39;vtkMRMLMarkupsPlaneNode&#39;</span><span class="p">)</span>
<span class="n">planeNode</span><span class="o">.</span><span class="n">SetCenter</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>
<span class="n">planeNode</span><span class="o">.</span><span class="n">SetNormal</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="measure-angle-between-two-markup-planes">
<h3>Measure angle between two markup planes<a class="headerlink" href="#measure-angle-between-two-markup-planes" title="Link to this heading"></a></h3>
<p>Measure angle between two markup plane nodes. Whenever any of the plane nodes are moved, the updated angle is printed on the console.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">planeNodeNames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;P_1&quot;</span><span class="p">]</span>

<span class="c1"># Print angles between slice nodes</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ShowAngle</span><span class="p">(</span><span class="n">unused1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unused2</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="n">planeNormalVectors</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">planeNodeName</span> <span class="ow">in</span> <span class="n">planeNodeNames</span><span class="p">:</span>
    <span class="n">planeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getFirstNodeByClassByName</span><span class="p">(</span><span class="s2">&quot;vtkMRMLMarkupsPlaneNode&quot;</span><span class="p">,</span> <span class="n">planeNodeName</span><span class="p">)</span>
    <span class="n">planeNormalVector</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">planeNode</span><span class="o">.</span><span class="n">GetNormalWorld</span><span class="p">(</span><span class="n">planeNormalVector</span><span class="p">)</span>
    <span class="n">planeNormalVectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">planeNormalVector</span><span class="p">)</span>
  <span class="n">angleRad</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMath</span><span class="o">.</span><span class="n">AngleBetweenVectors</span><span class="p">(</span><span class="n">planeNormalVectors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">planeNormalVectors</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
  <span class="n">angleDeg</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMath</span><span class="o">.</span><span class="n">DegreesFromRadians</span><span class="p">(</span><span class="n">angleRad</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Angle between planes </span><span class="si">{0}</span><span class="s2"> and </span><span class="si">{1}</span><span class="s2"> = </span><span class="si">{2:0.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">planeNodeNames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">planeNodeNames</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">angleDeg</span><span class="p">))</span>

<span class="c1"># Observe plane node changes</span>
<span class="k">for</span> <span class="n">planeNodeName</span> <span class="ow">in</span> <span class="n">planeNodeNames</span><span class="p">:</span>
  <span class="n">planeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getFirstNodeByClassByName</span><span class="p">(</span><span class="s2">&quot;vtkMRMLMarkupsPlaneNode&quot;</span><span class="p">,</span> <span class="n">planeNodeName</span><span class="p">)</span>
  <span class="n">planeNode</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLMarkupsPlaneNode</span><span class="o">.</span><span class="n">PointModifiedEvent</span><span class="p">,</span> <span class="n">ShowAngle</span><span class="p">)</span>

<span class="c1"># Print current angle</span>
<span class="n">ShowAngle</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="measure-angle-between-two-markup-lines">
<h3>Measure angle between two markup lines<a class="headerlink" href="#measure-angle-between-two-markup-lines" title="Link to this heading"></a></h3>
<p>Measure angle between two markup line nodes that are already added to the scene and have the names <code class="docutils literal notranslate"><span class="pre">L</span></code> and <code class="docutils literal notranslate"><span class="pre">L_1</span></code>. Whenever either line is moved, the updated angle is printed on the console. This is for illustration only, for standard angle measurements angle markups can be used.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lineNodeNames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;L_1&quot;</span><span class="p">]</span>

<span class="c1"># Print angles between slice nodes</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ShowAngle</span><span class="p">(</span><span class="n">unused1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unused2</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
  <span class="n">lineDirectionVectors</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">lineNodeName</span> <span class="ow">in</span> <span class="n">lineNodeNames</span><span class="p">:</span>
    <span class="n">lineNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getFirstNodeByClassByName</span><span class="p">(</span><span class="s2">&quot;vtkMRMLMarkupsLineNode&quot;</span><span class="p">,</span> <span class="n">lineNodeName</span><span class="p">)</span>
    <span class="n">lineStartPos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">lineEndPos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">lineNode</span><span class="o">.</span><span class="n">GetNthControlPointPositionWorld</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">lineStartPos</span><span class="p">)</span>
    <span class="n">lineNode</span><span class="o">.</span><span class="n">GetNthControlPointPositionWorld</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lineEndPos</span><span class="p">)</span>
    <span class="n">lineDirectionVector</span> <span class="o">=</span> <span class="p">(</span><span class="n">lineEndPos</span><span class="o">-</span><span class="n">lineStartPos</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">lineEndPos</span><span class="o">-</span><span class="n">lineStartPos</span><span class="p">)</span>
    <span class="n">lineDirectionVectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lineDirectionVector</span><span class="p">)</span>
  <span class="n">angleRad</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMath</span><span class="o">.</span><span class="n">AngleBetweenVectors</span><span class="p">(</span><span class="n">lineDirectionVectors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lineDirectionVectors</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
  <span class="n">angleDeg</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMath</span><span class="o">.</span><span class="n">DegreesFromRadians</span><span class="p">(</span><span class="n">angleRad</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Angle between lines </span><span class="si">{0}</span><span class="s2"> and </span><span class="si">{1}</span><span class="s2"> = </span><span class="si">{2:0.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lineNodeNames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lineNodeNames</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">angleDeg</span><span class="p">))</span>

<span class="c1"># Observe line node changes</span>
<span class="k">for</span> <span class="n">lineNodeName</span> <span class="ow">in</span> <span class="n">lineNodeNames</span><span class="p">:</span>
  <span class="n">lineNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getFirstNodeByClassByName</span><span class="p">(</span><span class="s2">&quot;vtkMRMLMarkupsLineNode&quot;</span><span class="p">,</span> <span class="n">lineNodeName</span><span class="p">)</span>
  <span class="n">lineNode</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLMarkupsLineNode</span><span class="o">.</span><span class="n">PointModifiedEvent</span><span class="p">,</span> <span class="n">ShowAngle</span><span class="p">)</span>

<span class="c1"># Print current angle</span>
<span class="n">ShowAngle</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="project-a-line-to-a-plane">
<h3>Project a line to a plane<a class="headerlink" href="#project-a-line-to-a-plane" title="Link to this heading"></a></h3>
<p>Create a new line (<code class="docutils literal notranslate"><span class="pre">projectedLineNode</span></code>) by projecting a line (<code class="docutils literal notranslate"><span class="pre">lineNode</span></code>) to a plane (<code class="docutils literal notranslate"><span class="pre">planeNode</span></code>).</p>
<p>Each control point is projected by computing coordinates in the plane coordinate system, zeroing the z coordinate (distance from plane) then transforming  back the coordinates to the world coordinate system.</p>
<p>Transformation require homogeneous coordinates (1.0 appended to the 3D position), therefore 1.0 is added to the position after getting from the line and the 1.0 is removed when the computed point is added to the output line.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lineNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">)</span>
<span class="n">planeNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">)</span>

<span class="c1"># Create new node for storing the projected line node</span>
<span class="n">projectedLineNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="n">lineNode</span><span class="o">.</span><span class="n">GetClassName</span><span class="p">(),</span> <span class="n">lineNode</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot; projected&quot;</span><span class="p">)</span>

<span class="c1"># Get transforms</span>
<span class="n">planeToWorld</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMatrix4x4</span><span class="p">()</span>
<span class="n">planeNode</span><span class="o">.</span><span class="n">GetObjectToWorldMatrix</span><span class="p">(</span><span class="n">planeToWorld</span><span class="p">)</span>
<span class="n">worldToPlane</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMatrix4x4</span><span class="p">()</span>
<span class="n">vtk</span><span class="o">.</span><span class="n">vtkMatrix4x4</span><span class="o">.</span><span class="n">Invert</span><span class="p">(</span><span class="n">planeToWorld</span><span class="p">,</span> <span class="n">worldToPlane</span><span class="p">)</span>

<span class="c1"># Project each point</span>
<span class="k">for</span> <span class="n">pointIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">point_World</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">lineNode</span><span class="o">.</span><span class="n">GetNthControlPointPositionWorld</span><span class="p">(</span><span class="n">pointIndex</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">]</span>
    <span class="n">point_Plane</span> <span class="o">=</span> <span class="n">worldToPlane</span><span class="o">.</span><span class="n">MultiplyPoint</span><span class="p">(</span><span class="n">point_World</span><span class="p">)</span>
    <span class="n">projectedPoint_Plane</span> <span class="o">=</span> <span class="p">[</span><span class="n">point_Plane</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">point_Plane</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
    <span class="n">projectedPoint_World</span> <span class="o">=</span> <span class="n">planeToWorld</span><span class="o">.</span><span class="n">MultiplyPoint</span><span class="p">(</span><span class="n">projectedPoint_Plane</span><span class="p">)</span>
    <span class="n">projectedLineNode</span><span class="o">.</span><span class="n">AddControlPoint</span><span class="p">(</span><span class="n">projectedPoint_World</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="measure-distances-of-points-from-a-plane">
<h3>Measure distances of points from a plane<a class="headerlink" href="#measure-distances-of-points-from-a-plane" title="Link to this heading"></a></h3>
<p>Place a plane (<code class="docutils literal notranslate"><span class="pre">P</span></code>) and add points to point list (<code class="docutils literal notranslate"><span class="pre">F</span></code>) using Markups module in a view and then run the following code snippet to compute distances of the points from the plane.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pointListNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
<span class="n">planeNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">)</span>

<span class="c1"># Get transformation that gets point coordinates relative to the plane</span>
<span class="n">planeToWorld</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMatrix4x4</span><span class="p">()</span>
<span class="n">planeNode</span><span class="o">.</span><span class="n">GetObjectToWorldMatrix</span><span class="p">(</span><span class="n">planeToWorld</span><span class="p">)</span>
<span class="n">worldToPlane</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMatrix4x4</span><span class="p">()</span>
<span class="n">vtk</span><span class="o">.</span><span class="n">vtkMatrix4x4</span><span class="o">.</span><span class="n">Invert</span><span class="p">(</span><span class="n">planeToWorld</span><span class="p">,</span> <span class="n">worldToPlane</span><span class="p">)</span>

<span class="k">for</span> <span class="n">pointIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pointListNode</span><span class="o">.</span><span class="n">GetNumberOfControlPoints</span><span class="p">()):</span>
    <span class="c1"># Get point position in world coordinate system</span>
    <span class="n">point_World</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">pointListNode</span><span class="o">.</span><span class="n">GetNthControlPointPositionWorld</span><span class="p">(</span><span class="n">pointIndex</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">]</span>
    <span class="c1"># Get point position in the plane coordinate system</span>
    <span class="n">point_Plane</span> <span class="o">=</span> <span class="n">worldToPlane</span><span class="o">.</span><span class="n">MultiplyPoint</span><span class="p">(</span><span class="n">point_World</span><span class="p">)</span>
    <span class="c1"># Third axis in the plane coordinate system is the plane normal direction, therefore the third coordinate</span>
    <span class="c1"># value is the distance from the plane</span>
    <span class="n">distanceFromPlane</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">point_Plane</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Distance of point </span><span class="si">{</span><span class="n">pointListNode</span><span class="o">.</span><span class="n">GetNthControlPointLabel</span><span class="p">(</span><span class="n">pointIndex</span><span class="p">)</span><span class="si">}</span><span class="s2"> from plane: </span><span class="si">{</span><span class="n">distanceFromPlane</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="measure-distances-of-points-from-a-line">
<h3>Measure distances of points from a line<a class="headerlink" href="#measure-distances-of-points-from-a-line" title="Link to this heading"></a></h3>
<p>Draw a markups line (<code class="docutils literal notranslate"><span class="pre">L</span></code>) and drop markups point list (<code class="docutils literal notranslate"><span class="pre">F</span></code>) in a view and then run the following code snippet to compute distances of the points from the line.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pointListNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
<span class="n">lineNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>

<span class="c1"># Get point list control point positions and line endpoints as numpy arrays</span>
<span class="n">points</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromMarkupsControlPoints</span><span class="p">(</span><span class="n">pointListNode</span><span class="p">)</span>
<span class="n">line</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromMarkupsControlPoints</span><span class="p">(</span><span class="n">lineNode</span><span class="p">)</span>
<span class="c1"># Compute distance of control points from the line</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">cross</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numpy.linalg</span><span class="w"> </span><span class="kn">import</span> <span class="n">norm</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">point</span><span class="o">-</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">norm</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Point </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: Position = </span><span class="si">{</span><span class="n">point</span><span class="si">}</span><span class="s2">. Distance from line = </span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="set-slice-position-and-orientation-from-3-markups-control-points">
<h3>Set slice position and orientation from 3 markups control points<a class="headerlink" href="#set-slice-position-and-orientation-from-3-markups-control-points" title="Link to this heading"></a></h3>
<p>Drop 3 markups control points in the scene and copy-paste the code below into the Python console. After this, as you move the control points you’ll see the red slice view position and orientation will be set to make it fit to the 3 points.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Update plane from control points</span>
<span class="k">def</span><span class="w"> </span><span class="nf">UpdateSlicePlane</span><span class="p">(</span><span class="n">param1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">param2</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="c1"># Get control point positions as numpy array</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
  <span class="n">nOfControlPoints</span> <span class="o">=</span> <span class="n">pointListNode</span><span class="o">.</span><span class="n">GetNumberOfControlPoints</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">nOfControlPoints</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
    <span class="k">return</span>  <span class="c1"># not enough control points</span>
  <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="n">nOfControlPoints</span><span class="p">])</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nOfControlPoints</span><span class="p">):</span>
    <span class="n">pointListNode</span><span class="o">.</span><span class="n">GetNthControlPointPosition</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">points</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
  <span class="c1"># Compute plane position and normal</span>
  <span class="n">planePosition</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">planeNormal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
  <span class="n">planeX</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">sliceNode</span><span class="o">.</span><span class="n">SetSliceToRASByNTP</span><span class="p">(</span><span class="n">planeNormal</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">planeNormal</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">planeNormal</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">planeX</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">planeX</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">planeX</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">planePosition</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">planePosition</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">planePosition</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Get point list node from scene</span>
<span class="n">sliceNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">sliceWidget</span><span class="p">(</span><span class="s2">&quot;Red&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mrmlSliceNode</span><span class="p">()</span>
<span class="n">pointListNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>

<span class="c1"># Update slice plane manually</span>
<span class="n">UpdateSlicePlane</span><span class="p">()</span>

<span class="c1"># Update slice plane automatically whenever points are changed</span>
<span class="n">pointListObservation</span> <span class="o">=</span> <span class="p">[</span><span class="n">pointListNode</span><span class="p">,</span> <span class="n">pointListNode</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLMarkupsNode</span><span class="o">.</span><span class="n">PointModifiedEvent</span><span class="p">,</span> <span class="n">UpdateSlicePlane</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
</pre></div>
</div>
<p>To stop automatic updates, run this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pointListObservation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">RemoveObserver</span><span class="p">(</span><span class="n">pointListObservation</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="switching-to-markups-control-point-placement-mode">
<h3>Switching to markups control point placement mode<a class="headerlink" href="#switching-to-markups-control-point-placement-mode" title="Link to this heading"></a></h3>
<p>To activate control point placement mode for a point list, both interaction mode has to be set and a point list node has to be selected:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">interactionNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">applicationLogic</span><span class="p">()</span><span class="o">.</span><span class="n">GetInteractionNode</span><span class="p">()</span>
<span class="n">selectionNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">applicationLogic</span><span class="p">()</span><span class="o">.</span><span class="n">GetSelectionNode</span><span class="p">()</span>
<span class="n">selectionNode</span><span class="o">.</span><span class="n">SetReferenceActivePlaceNodeClassName</span><span class="p">(</span><span class="s2">&quot;vtkMRMLMarkupsFiducialNode&quot;</span><span class="p">)</span>
<span class="n">pointListNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLMarkupsFiducialNode&quot;</span><span class="p">)</span>
<span class="n">selectionNode</span><span class="o">.</span><span class="n">SetActivePlaceNodeID</span><span class="p">(</span><span class="n">pointListNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
<span class="n">interactionNode</span><span class="o">.</span><span class="n">SetCurrentInteractionMode</span><span class="p">(</span><span class="n">interactionNode</span><span class="o">.</span><span class="n">Place</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively, <em>qSlicerMarkupsPlaceWidget</em> widget can be used to initiate markup placement:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Temporary markups point list node</span>
<span class="n">pointListNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLMarkupsFiducialNode&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">placementModeChanged</span><span class="p">(</span><span class="n">active</span><span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Placement: &quot;</span> <span class="o">+</span><span class="p">(</span><span class="s2">&quot;active&quot;</span> <span class="k">if</span> <span class="n">active</span> <span class="k">else</span> <span class="s2">&quot;inactive&quot;</span><span class="p">))</span>
  <span class="c1"># You can inspect what is in the markups node here, delete the temporary markup point list node, etc.</span>

<span class="c1"># Create and set up widget that contains a single &quot;place control point&quot; button. The widget can be placed in the module GUI.</span>
<span class="n">placeWidget</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">qSlicerMarkupsPlaceWidget</span><span class="p">()</span>
<span class="n">placeWidget</span><span class="o">.</span><span class="n">setMRMLScene</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="p">)</span>
<span class="n">placeWidget</span><span class="o">.</span><span class="n">setCurrentNode</span><span class="p">(</span><span class="n">pointListNode</span><span class="p">)</span>
<span class="n">placeWidget</span><span class="o">.</span><span class="n">buttonsVisible</span><span class="o">=</span><span class="kc">False</span>
<span class="n">placeWidget</span><span class="o">.</span><span class="n">placeButton</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">placeWidget</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;activeMarkupsFiducialPlaceModeChanged(bool)&quot;</span><span class="p">,</span> <span class="n">placementModeChanged</span><span class="p">)</span>
<span class="n">placeWidget</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="change-markup-point-list-display-properties">
<h3>Change markup point list display properties<a class="headerlink" href="#change-markup-point-list-display-properties" title="Link to this heading"></a></h3>
<p>Display properties are stored in display node(s) associated with the point list node.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pointListNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
<span class="n">pointListDisplayNode</span> <span class="o">=</span> <span class="n">pointListNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span>
<span class="n">pointListDisplayNode</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># Hide all points</span>
<span class="n">pointListDisplayNode</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Show all points</span>
<span class="n">pointListDisplayNode</span><span class="o">.</span><span class="n">SetSelectedColor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># Set color to yellow</span>
<span class="n">pointListDisplayNode</span><span class="o">.</span><span class="n">SetViewNodeIDs</span><span class="p">([</span><span class="s2">&quot;vtkMRMLSliceNodeRed&quot;</span><span class="p">,</span> <span class="s2">&quot;vtkMRMLViewNode1&quot;</span><span class="p">])</span> <span class="c1"># Only show in red slice view and first 3D view</span>
</pre></div>
</div>
</section>
<section id="get-a-notification-if-a-markup-control-point-position-is-modified">
<h3>Get a notification if a markup control point position is modified<a class="headerlink" href="#get-a-notification-if-a-markup-control-point-position-is-modified" title="Link to this heading"></a></h3>
<p>Event management of Slicer-4.11 version is still subject to change. The example below shows how control point manipulation can be observed now.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">onMarkupChanged</span><span class="p">(</span><span class="n">caller</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
  <span class="n">markupsNode</span> <span class="o">=</span> <span class="n">caller</span>
  <span class="n">sliceView</span> <span class="o">=</span> <span class="n">markupsNode</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLMarkupsDisplayNode</span><span class="o">.</span><span class="n">GetMovingInSliceViewAttributeName</span><span class="p">())</span>
  <span class="n">movingMarkupIndex</span> <span class="o">=</span> <span class="n">markupsNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">GetActiveControlPoint</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">movingMarkupIndex</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">markupsNode</span><span class="o">.</span><span class="n">GetNthControlPointPosition</span><span class="p">(</span><span class="n">movingMarkupIndex</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
    <span class="n">isPreview</span> <span class="o">=</span> <span class="n">markupsNode</span><span class="o">.</span><span class="n">GetNthControlPointPositionStatus</span><span class="p">(</span><span class="n">movingMarkupIndex</span><span class="p">)</span> <span class="o">==</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLMarkupsNode</span><span class="o">.</span><span class="n">PositionPreview</span>
    <span class="k">if</span> <span class="n">isPreview</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Point </span><span class="si">{0}</span><span class="s2"> is previewed at </span><span class="si">{1}</span><span class="s2"> in slice view </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">movingMarkupIndex</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">sliceView</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Point </span><span class="si">{0}</span><span class="s2"> was moved </span><span class="si">{1}</span><span class="s2"> in slice view </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">movingMarkupIndex</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">sliceView</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Points modified: slice view = </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sliceView</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">onMarkupStartInteraction</span><span class="p">(</span><span class="n">caller</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
  <span class="n">markupsNode</span> <span class="o">=</span> <span class="n">caller</span>
  <span class="n">sliceView</span> <span class="o">=</span> <span class="n">markupsNode</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLMarkupsDisplayNode</span><span class="o">.</span><span class="n">GetMovingInSliceViewAttributeName</span><span class="p">())</span>
  <span class="n">movingMarkupIndex</span> <span class="o">=</span> <span class="n">markupsNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">GetActiveControlPoint</span><span class="p">()</span>
  <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Start interaction: point ID = </span><span class="si">{0}</span><span class="s2">, slice view = </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">movingMarkupIndex</span><span class="p">,</span> <span class="n">sliceView</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">onMarkupEndInteraction</span><span class="p">(</span><span class="n">caller</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
  <span class="n">markupsNode</span> <span class="o">=</span> <span class="n">caller</span>
  <span class="n">sliceView</span> <span class="o">=</span> <span class="n">markupsNode</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLMarkupsDisplayNode</span><span class="o">.</span><span class="n">GetMovingInSliceViewAttributeName</span><span class="p">())</span>
  <span class="n">movingMarkupIndex</span> <span class="o">=</span> <span class="n">markupsNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">GetActiveControlPoint</span><span class="p">()</span>
  <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;End interaction: point ID = </span><span class="si">{0}</span><span class="s2">, slice view = </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">movingMarkupIndex</span><span class="p">,</span> <span class="n">sliceView</span><span class="p">))</span>

<span class="n">pointListNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLMarkupsFiducialNode&quot;</span><span class="p">)</span>
<span class="n">pointListNode</span><span class="o">.</span><span class="n">AddControlPoint</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">pointListNode</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLMarkupsNode</span><span class="o">.</span><span class="n">PointModifiedEvent</span><span class="p">,</span> <span class="n">onMarkupChanged</span><span class="p">)</span>
<span class="n">pointListNode</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLMarkupsNode</span><span class="o">.</span><span class="n">PointStartInteractionEvent</span><span class="p">,</span> <span class="n">onMarkupStartInteraction</span><span class="p">)</span>
<span class="n">pointListNode</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLMarkupsNode</span><span class="o">.</span><span class="n">PointEndInteractionEvent</span><span class="p">,</span> <span class="n">onMarkupEndInteraction</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="write-markup-control-point-positions-to-json-file">
<h3>Write markup control point positions to JSON file<a class="headerlink" href="#write-markup-control-point-positions-to-json-file" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pointListNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
<span class="n">outputFileName</span> <span class="o">=</span> <span class="s2">&quot;c:/tmp/test.json&quot;</span>

<span class="c1"># Get markup positions</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">fidIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pointListNode</span><span class="o">.</span><span class="n">GetNumberOfControlPoints</span><span class="p">()):</span>
  <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">pointListNode</span><span class="o">.</span><span class="n">GetNthControlPointPosition</span><span class="p">(</span><span class="n">fidIndex</span><span class="p">,</span><span class="n">coords</span><span class="p">)</span>
  <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">pointListNode</span><span class="o">.</span><span class="n">GetNthControlPointLabel</span><span class="p">(),</span> <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">coords</span><span class="p">})</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFileName</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
  <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="write-markup-roi-to-json-file">
<h3>Write markup ROI to JSON file<a class="headerlink" href="#write-markup-roi-to-json-file" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">roiNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">)</span>
<span class="n">outputFileName</span> <span class="o">=</span> <span class="s2">&quot;c:/tmp/test.json&quot;</span>

<span class="c1"># Get ROI data</span>
<span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">size</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">roiNode</span><span class="o">.</span><span class="n">GetCenterWorld</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>
<span class="n">roiNode</span><span class="o">.</span><span class="n">GetSizeWorld</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;center&quot;</span><span class="p">:</span> <span class="n">center</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">size</span><span class="p">}</span>

<span class="c1"># Write to json file</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFileName</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
  <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="create-markup-plane-json-file-outside-slicer">
<h3>Create markup plane JSON file - outside Slicer<a class="headerlink" href="#create-markup-plane-json-file-outside-slicer" title="Link to this heading"></a></h3>
<p>This code can be used in any Python environment to create a markup json file containing a simple plane.</p>
<p>If you specify a plane by a single point (<code class="docutils literal notranslate"><span class="pre">&quot;planeType&quot;:</span> <span class="pre">&quot;pointNormal&quot;</span></code>) then you only need to specify:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">plane</span> <span class="pre">position</span></code>: position of the one and only control point</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">plane</span> <span class="pre">orientation</span></code>: <code class="docutils literal notranslate"><span class="pre">baseToNode</span></code> matrix. Note that a plane in mathematical sense is specified by a position and a normal, but if you want to display a plane then you need to specify its rotation around that normal. <code class="docutils literal notranslate"><span class="pre">baseToNode</span></code> contains the two axis of the plane and the plane normal. If you don’t care about the rotation then you can choose an arbitrary orientation and use cross product with the normal vector to make it orthogonal to the normal vector. Translation component of baseToNode matrix is ignored (because position is set by the control point), so it can be set to <code class="docutils literal notranslate"><span class="pre">0.0,</span> <span class="pre">0.0,</span> <span class="pre">0.0</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">plane</span> <span class="pre">bounds</span></code>: specifies how far the plane extends in 4 directions (-x, +x, -y, +y) from the plane position</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">outputFileName</span> <span class="o">=</span> <span class="s2">&quot;path/to/MyPlane.mrk.json&quot;</span>
<span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="mf">3.6764886856933536</span><span class="p">,</span> <span class="o">-</span><span class="mf">52.2593679682938</span><span class="p">,</span> <span class="mf">41.715845278879044</span><span class="p">]</span>
<span class="n">normal</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.9552783445937983</span><span class="p">,</span> <span class="mf">0.2957081066696218</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
<span class="n">plane_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">50.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">50.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">]</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="n">normal</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>

<span class="c1"># Choose an arbitrary vector direction (x) that is not parallel to the normal</span>
<span class="n">axis1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">axis1</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>
  <span class="c1"># Almost parallel to the x axis, use another direction (y)</span>
  <span class="n">axis1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="c1"># Calculate a third axis of the plane coordinate system (orthogonal to the other two)</span>
<span class="n">axis2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">axis1</span><span class="p">)</span>
<span class="n">axis2</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">axis2</span><span class="p">)</span>

<span class="c1"># Get axis1 that is orthogonal to axis2 and normal</span>
<span class="n">axis1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">axis2</span><span class="p">,</span> <span class="n">normal</span><span class="p">)</span>
<span class="n">axis1</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">axis1</span><span class="p">)</span>

<span class="c1"># Construct the rotation-translation matrix baseToNode</span>
<span class="n">base_to_node_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">base_to_node_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">axis1</span>
<span class="n">base_to_node_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">axis2</span>
<span class="n">base_to_node_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">normal</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;@schema&quot;</span><span class="p">:</span> <span class="s2">&quot;https://raw.githubusercontent.com/slicer/slicer/master/Modules/Loadable/Markups/Resources/Schema/markups-schema-v1.0.3.json#&quot;</span><span class="p">,</span>
    <span class="s2">&quot;markups&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Plane&quot;</span><span class="p">,</span>
            <span class="s2">&quot;coordinateSystem&quot;</span><span class="p">:</span> <span class="s2">&quot;LPS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;coordinateUnits&quot;</span><span class="p">:</span> <span class="s2">&quot;mm&quot;</span><span class="p">,</span>
            <span class="s2">&quot;planeType&quot;</span><span class="p">:</span> <span class="s2">&quot;pointNormal&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sizeMode&quot;</span><span class="p">:</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
            <span class="s2">&quot;baseToNode&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">base_to_node_matrix</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">16</span><span class="p">)),</span>
            <span class="s2">&quot;planeBounds&quot;</span><span class="p">:</span> <span class="n">plane_bounds</span><span class="p">,</span>
            <span class="s2">&quot;controlPoints&quot;</span><span class="p">:</span> <span class="p">[{</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">center</span> <span class="p">}]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFileName</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
  <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="fit-slice-plane-to-markup-control-points">
<h3>Fit slice plane to markup control points<a class="headerlink" href="#fit-slice-plane-to-markup-control-points" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sliceNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetNodeByID</span><span class="p">(</span><span class="s2">&quot;vtkMRMLSliceNodeRed&quot;</span><span class="p">)</span>
<span class="n">pointListNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetFirstNodeByName</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
<span class="c1"># Get markup point positions as numpy arrays</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">p3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">pointListNode</span><span class="o">.</span><span class="n">GetNthControlPointPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>
<span class="n">pointListNode</span><span class="o">.</span><span class="n">GetNthControlPointPosition</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
<span class="n">pointListNode</span><span class="o">.</span><span class="n">GetNthControlPointPosition</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">p3</span><span class="p">)</span>
<span class="c1"># Get plane axis directions</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">p2</span><span class="o">-</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="o">-</span><span class="n">p3</span><span class="p">)</span> <span class="c1"># plane normal direction</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">)</span> <span class="c1"># plane transverse direction</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="c1"># Set slice plane orientation and position</span>
<span class="n">sliceNode</span><span class="o">.</span><span class="n">SetSliceToRASByNTP</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="change-color-of-a-markups-node">
<h3>Change color of a markups node<a class="headerlink" href="#change-color-of-a-markups-node" title="Link to this heading"></a></h3>
<p>Markups have <code class="docutils literal notranslate"><span class="pre">Color</span></code> and <code class="docutils literal notranslate"><span class="pre">SelectedColor</span></code> properties. <code class="docutils literal notranslate"><span class="pre">SelectedColor</span></code> is used if all control points are in “selected” state, which is the default. So, in most cases <code class="docutils literal notranslate"><span class="pre">SetSelectedColor</span></code> method must be used to change markups node color.</p>
</section>
<section id="display-list-of-control-points-in-my-module-s-gui">
<h3>Display list of control points in my module’s GUI<a class="headerlink" href="#display-list-of-control-points-in-my-module-s-gui" title="Link to this heading"></a></h3>
<p>The <a class="reference external" href="https://apidocs.slicer.org/main/classqSlicerSimpleMarkupsWidget.html">qSlicerSimpleMarkupsWidget</a> can be integrated into module widgets to display list of markups control points and initiate placement. An example of this use is in <a class="reference external" href="https://www.slicer.org/wiki/Documentation/Nightly/Modules/GelDosimetry">Gel Dosimetry module</a>.</p>
</section>
<section id="pre-populate-the-scene-with-measurements">
<h3>Pre-populate the scene with measurements<a class="headerlink" href="#pre-populate-the-scene-with-measurements" title="Link to this heading"></a></h3>
<p>This code snippet creates a set of predefined line markups (named A, B, C, D) in the scene when the user hits <kbd>Ctrl+N</kbd>.
How to use this:</p>
<ol class="arabic simple">
<li><p>Customize the code (replace A, B, C, D with your measurement names) and copy-paste the code into the Python console. This has to be done only once after Slicer is started. Add it to <a class="reference internal" href="../user_guide/settings.html#application-startup-file"><span class="std std-ref">.slicerrc.py file</span></a> so that it persists even if Slicer is restarted.</p></li>
<li><p>Load the data set that has to be measured</p></li>
<li><p>Hit Ctrl+N to create all the measurements</p></li>
<li><p>Go to Markups module to see the list of measurements</p></li>
<li><p>For each measurement: select it in the data tree, click on the place button on the toolbar then click in slice or 3D views</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">createMeasurements</span><span class="p">():</span>
  <span class="k">for</span> <span class="n">nodeName</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">]:</span>
    <span class="n">lineNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLMarkupsLineNode&quot;</span><span class="p">,</span> <span class="n">nodeName</span><span class="p">)</span>
    <span class="n">lineNode</span><span class="o">.</span><span class="n">CreateDefaultDisplayNodes</span><span class="p">()</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="n">lineNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span>
    <span class="c1"># Use crosshair glyph to allow more accurate point placement</span>
    <span class="n">dn</span><span class="o">.</span><span class="n">SetGlyphTypeFromString</span><span class="p">(</span><span class="s2">&quot;CrossDot2D&quot;</span><span class="p">)</span>
    <span class="c1"># Hide measurement result while markup up</span>
    <span class="n">lineNode</span><span class="o">.</span><span class="n">GetMeasurement</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">SetEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="n">shortcut1</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">QShortcut</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">())</span>
<span class="n">shortcut1</span><span class="o">.</span><span class="n">setKey</span><span class="p">(</span><span class="n">qt</span><span class="o">.</span><span class="n">QKeySequence</span><span class="p">(</span><span class="s2">&quot;Ctrl+n&quot;</span><span class="p">))</span>
<span class="n">shortcut1</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="s1">&#39;activated()&#39;</span><span class="p">,</span> <span class="n">createMeasurements</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="copy-all-measurements-in-the-scene-to-excel">
<h3>Copy all measurements in the scene to Excel<a class="headerlink" href="#copy-all-measurements-in-the-scene-to-excel" title="Link to this heading"></a></h3>
<p>This code snippet creates a set of predefined line markups (named A, B, C, D) in the scene when the user hits Ctrl+N.
How to use this:</p>
<ol class="arabic simple">
<li><p>Copy-paste the code into the Python console. This has to be done only once after Slicer is started. Add it to <a class="reference internal" href="../user_guide/settings.html#application-startup-file"><span class="std std-ref">.slicerrc.py file</span></a> so that it persists even if Slicer is restarted.</p></li>
<li><p>Load the data set that has to be measured and place line markups (you can use the “Pre-populate the scene with measurements” script above to help with this)</p></li>
<li><p>Hit Ctrl+M to copy all line measurents to the clipboard</p></li>
<li><p>Switch to Excel and hit Ctrl+V to paste the results there</p></li>
<li><p>Save the scene, just in case later you need to review your measurements</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">copyLineMeasurementsToClipboard</span><span class="p">():</span>
  <span class="n">measurements</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="c1"># Collect all line measurements from the scene</span>
  <span class="n">lineNodes</span> <span class="o">=</span> <span class="n">getNodesByClass</span><span class="p">(</span><span class="s1">&#39;vtkMRMLMarkupsLineNode&#39;</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">lineNode</span> <span class="ow">in</span> <span class="n">lineNodes</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">lineNode</span><span class="o">.</span><span class="n">GetNumberOfDefinedControlPoints</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
      <span class="c1"># incomplete line, skip it</span>
      <span class="k">continue</span>
    <span class="c1"># Get node filename that the length was measured on</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">volumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetNodeByID</span><span class="p">(</span><span class="n">lineNode</span><span class="o">.</span><span class="n">GetNthControlPointAssociatedNodeID</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
      <span class="n">imagePath</span> <span class="o">=</span> <span class="n">volumeNode</span><span class="o">.</span><span class="n">GetStorageNode</span><span class="p">()</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="n">imagePath</span> <span class="o">=</span> <span class="s1">&#39;(unknown)&#39;</span>
    <span class="c1"># Get line node n</span>
    <span class="n">measurementName</span> <span class="o">=</span> <span class="n">lineNode</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span>
    <span class="c1"># Get length measurement</span>
    <span class="n">lineNode</span><span class="o">.</span><span class="n">GetMeasurement</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">SetEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">lineNode</span><span class="o">.</span><span class="n">GetMeasurement</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
    <span class="c1"># Add fields to results</span>
    <span class="n">measurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">imagePath</span><span class="p">,</span> <span class="n">measurementName</span><span class="p">,</span> <span class="n">length</span><span class="p">]))</span>
  <span class="c1"># Copy all measurements to clipboard (to be pasted into Excel)</span>
  <span class="n">outputText</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">measurements</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">clipboard</span><span class="p">()</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">outputText</span><span class="p">)</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">delayDisplay</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Copied </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">measurements</span><span class="p">)</span><span class="si">}</span><span class="s2"> length measurements to the clipboard.&quot;</span><span class="p">)</span>

<span class="n">shortcut2</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">QShortcut</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">())</span>
<span class="n">shortcut2</span><span class="o">.</span><span class="n">setKey</span><span class="p">(</span><span class="n">qt</span><span class="o">.</span><span class="n">QKeySequence</span><span class="p">(</span><span class="s2">&quot;Ctrl+m&quot;</span><span class="p">))</span>
<span class="n">shortcut2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="s1">&#39;activated()&#39;</span><span class="p">,</span> <span class="n">copyLineMeasurementsToClipboard</span><span class="p">)</span>
</pre></div>
</div>
<p>To copy all measurement results to a file instead of copying it to the clipboard, replace <code class="docutils literal notranslate"><span class="pre">slicer.app.clipboard...</span></code> line by these lines:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;c:/tmp/results.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outputText</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="use-markups-json-files-in-python-outside-slicer">
<h3>Use markups json files in Python - outside Slicer<a class="headerlink" href="#use-markups-json-files-in-python-outside-slicer" title="Link to this heading"></a></h3>
<p>The examples below show how to use markups json files outside Slicer, in any Python environment.</p>
<p>To access content of a json file it can be either read as a json document or directly into a <a class="reference external" href="https://pandas.pydata.org/">pandas</a> dataframe using a single command.</p>
<section id="get-a-table-of-control-point-labels-and-positions">
<h4>Get a table of control point labels and positions<a class="headerlink" href="#get-a-table-of-control-point-labels-and-positions" title="Link to this heading"></a></h4>
<p>Get table from the first markups node in the file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="n">controlPointsTable</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">input_json_filename</span><span class="p">)[</span><span class="s1">&#39;markups&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;controlPoints&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Result:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">controlPointsTable</span>
<span class="go">  label                                        position</span>
<span class="go">0   F-1  [-53.388409961685824, -73.33572796934868, 0.0]</span>
<span class="go">1   F-2     [49.8682950191571, -88.58955938697324, 0.0]</span>
<span class="go">2   F-3   [-25.22749042145594, 59.255268199233726, 0.0]</span>
</pre></div>
</div>
</section>
<section id="access-position-of-control-points-positions-in-separate-x-y-z-columns">
<h4>Access position of control points positions in separate x, y, z columns<a class="headerlink" href="#access-position-of-control-points-positions-in-separate-x-y-z-columns" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">controlPointsTable</span><span class="p">[[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">controlPointsTable</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>
<span class="k">del</span> <span class="n">controlPointsTable</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="write-control-points-to-a-csv-file">
<h4>Write control points to a csv file<a class="headerlink" href="#write-control-points-to-a-csv-file" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">controlPointsTable</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_csv_filename</span><span class="p">)</span>
</pre></div>
</div>
<p>Resulting csv file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>   <span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span>
   <span class="mi">0</span><span class="p">,</span><span class="n">F</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mf">53.388409961685824</span><span class="p">,</span><span class="o">-</span><span class="mf">73.33572796934868</span><span class="p">,</span><span class="mf">0.0</span>
   <span class="mi">1</span><span class="p">,</span><span class="n">F</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mf">49.8682950191571</span><span class="p">,</span><span class="o">-</span><span class="mf">88.58955938697324</span><span class="p">,</span><span class="mf">0.0</span>
   <span class="mi">2</span><span class="p">,</span><span class="n">F</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mf">25.22749042145594</span><span class="p">,</span><span class="mf">59.255268199233726</span><span class="p">,</span><span class="mf">0.0</span>
</pre></div>
</div>
</section>
</section>
<section id="assign-custom-actions-to-markups">
<h3>Assign custom actions to markups<a class="headerlink" href="#assign-custom-actions-to-markups" title="Link to this heading"></a></h3>
<p>Custom actions can be assigned to markups, which can be triggered by any interaction event (mouse or keyboard action). The actions can be detected by adding observers to the markup node’s display node.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This example adds an action to the default double-click action on a markup</span>
<span class="c1"># and defines two new custom actions. It is done for all existing markups in the first 3D view.</span>
<span class="c1">#</span>
<span class="c1"># How to use:</span>
<span class="c1"># 1. Create markups nodes.</span>
<span class="c1"># 2. Run the script below.</span>
<span class="c1"># 3. Double-click on the markup -&gt; this triggers toggleLabelVisibilty.</span>
<span class="c1"># 4. Hover the mouse over a markup then pressing `q` and `w` keys -&gt; this triggers shrinkControlPoints and growControlPoints.</span>

<span class="n">threeDViewNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetNodeByID</span><span class="p">(</span><span class="s2">&quot;vtkMRMLViewNode1&quot;</span><span class="p">)</span>
<span class="n">appLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">applicationLogic</span><span class="p">()</span>
<span class="n">markupsDisplayableManager</span> <span class="o">=</span> <span class="n">appLogic</span><span class="o">.</span><span class="n">GetViewDisplayableManagerByClassName</span><span class="p">(</span><span class="n">threeDViewNode</span><span class="p">,</span> <span class="s2">&quot;vtkMRMLMarkupsDisplayableManager&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">shrinkControlPoints</span><span class="p">(</span><span class="n">caller</span><span class="p">,</span> <span class="n">eventId</span><span class="p">):</span>
  <span class="n">markupsDisplayNode</span> <span class="o">=</span> <span class="n">caller</span>
  <span class="n">markupsDisplayNode</span><span class="o">.</span><span class="n">SetGlyphScale</span><span class="p">(</span><span class="n">markupsDisplayNode</span><span class="o">.</span><span class="n">GetGlyphScale</span><span class="p">()</span><span class="o">/</span><span class="mf">1.1</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">growControlPoints</span><span class="p">(</span><span class="n">caller</span><span class="p">,</span> <span class="n">eventId</span><span class="p">):</span>
  <span class="n">markupsDisplayNode</span> <span class="o">=</span> <span class="n">caller</span>
  <span class="n">markupsDisplayNode</span><span class="o">.</span><span class="n">SetGlyphScale</span><span class="p">(</span><span class="n">markupsDisplayNode</span><span class="o">.</span><span class="n">GetGlyphScale</span><span class="p">()</span><span class="o">*</span><span class="mf">1.1</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">toggleLabelVisibility</span><span class="p">(</span><span class="n">caller</span><span class="p">,</span> <span class="n">eventId</span><span class="p">):</span>
  <span class="n">markupsDisplayNode</span> <span class="o">=</span> <span class="n">caller</span>
  <span class="n">markupsDisplayNode</span><span class="o">.</span><span class="n">SetPointLabelsVisibility</span><span class="p">(</span><span class="ow">not</span> <span class="n">markupsDisplayNode</span><span class="o">.</span><span class="n">GetPointLabelsVisibility</span><span class="p">())</span>

<span class="n">observations</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># store the observations so that later can be removed</span>
<span class="n">markupsDisplayNodes</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNodesByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLMarkupsDisplayNode&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">markupsDisplayNode</span> <span class="ow">in</span> <span class="n">markupsDisplayNodes</span><span class="p">:</span>
  <span class="c1"># Assign keyboard shortcut to trigger custom actions</span>
  <span class="n">markupsWidget</span> <span class="o">=</span> <span class="n">markupsDisplayableManager</span><span class="o">.</span><span class="n">GetWidget</span><span class="p">(</span><span class="n">markupsDisplayNode</span><span class="p">)</span>
  <span class="c1"># Left double-click interaction event is translated to markupsWidget.WidgetEventAction by default,</span>
  <span class="c1"># therefore we don&#39;t need to add an event translation for that. We just add two keyboard event translation for two custom actions</span>
  <span class="n">markupsWidget</span><span class="o">.</span><span class="n">SetKeyboardEventTranslation</span><span class="p">(</span><span class="n">markupsWidget</span><span class="o">.</span><span class="n">WidgetStateOnWidget</span><span class="p">,</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkEvent</span><span class="o">.</span><span class="n">NoModifier</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;q&quot;</span><span class="p">,</span> <span class="n">markupsWidget</span><span class="o">.</span><span class="n">WidgetEventCustomAction1</span><span class="p">)</span>
  <span class="n">markupsWidget</span><span class="o">.</span><span class="n">SetKeyboardEventTranslation</span><span class="p">(</span><span class="n">markupsWidget</span><span class="o">.</span><span class="n">WidgetStateOnWidget</span><span class="p">,</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkEvent</span><span class="o">.</span><span class="n">NoModifier</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">markupsWidget</span><span class="o">.</span><span class="n">WidgetEventCustomAction2</span><span class="p">)</span>
  <span class="c1"># Add observer to custom actions</span>
  <span class="n">observations</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">markupsDisplayNode</span><span class="p">,</span> <span class="n">markupsDisplayNode</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">markupsDisplayNode</span><span class="o">.</span><span class="n">ActionEvent</span><span class="p">,</span> <span class="n">toggleLabelVisibility</span><span class="p">)])</span>
  <span class="n">observations</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">markupsDisplayNode</span><span class="p">,</span> <span class="n">markupsDisplayNode</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">markupsDisplayNode</span><span class="o">.</span><span class="n">CustomActionEvent1</span><span class="p">,</span> <span class="n">shrinkControlPoints</span><span class="p">)])</span>
  <span class="n">observations</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">markupsDisplayNode</span><span class="p">,</span> <span class="n">markupsDisplayNode</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">markupsDisplayNode</span><span class="o">.</span><span class="n">CustomActionEvent2</span><span class="p">,</span> <span class="n">growControlPoints</span><span class="p">)])</span>

<span class="c1"># Remove observations when custom actions are not needed anymore by uncommenting these lines:</span>
<span class="k">for</span> <span class="n">observedNode</span><span class="p">,</span> <span class="n">observation</span> <span class="ow">in</span> <span class="n">observations</span><span class="p">:</span>
  <span class="n">observedNode</span><span class="o">.</span><span class="n">RemoveObserver</span><span class="p">(</span><span class="n">observation</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="models">
<h2>Models<a class="headerlink" href="#models" title="Link to this heading"></a></h2>
<section id="show-a-simple-surface-mesh-as-a-model-node">
<h3>Show a simple surface mesh as a model node<a class="headerlink" href="#show-a-simple-surface-mesh-as-a-model-node" title="Link to this heading"></a></h3>
<p>This example shows how to display a simple surface mesh (a box, created by a VTK source filter) as a model node.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create and set up polydata source</span>
<span class="n">box</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCubeSource</span><span class="p">()</span>
<span class="n">box</span><span class="o">.</span><span class="n">SetXLength</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
<span class="n">box</span><span class="o">.</span><span class="n">SetYLength</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">box</span><span class="o">.</span><span class="n">SetZLength</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="n">box</span><span class="o">.</span><span class="n">SetCenter</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Create a model node that displays output of the source</span>
<span class="n">boxNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">AddModel</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">GetOutputPort</span><span class="p">())</span>

<span class="c1"># Adjust display properties</span>
<span class="n">boxNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">boxNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetOpacity</span><span class="p">(</span><span class="mf">0.8</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="measure-distance-of-points-from-surface">
<h3>Measure distance of points from surface<a class="headerlink" href="#measure-distance-of-points-from-surface" title="Link to this heading"></a></h3>
<p>This example computes closest distance of points (markups point list <code class="docutils literal notranslate"><span class="pre">F</span></code>) from a surface (model node <code class="docutils literal notranslate"><span class="pre">mymodel</span></code>) and writes results into a table.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pointListNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
<span class="n">modelNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;mymodel&quot;</span><span class="p">)</span>

<span class="c1"># Transform model polydata to world coordinate system</span>
<span class="k">if</span> <span class="n">modelNode</span><span class="o">.</span><span class="n">GetParentTransformNode</span><span class="p">():</span>
  <span class="n">transformModelToWorld</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkGeneralTransform</span><span class="p">()</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLTransformNode</span><span class="o">.</span><span class="n">GetTransformBetweenNodes</span><span class="p">(</span><span class="n">modelNode</span><span class="o">.</span><span class="n">GetParentTransformNode</span><span class="p">(),</span> <span class="kc">None</span><span class="p">,</span> <span class="n">transformModelToWorld</span><span class="p">)</span>
  <span class="n">polyTransformToWorld</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkTransformPolyDataFilter</span><span class="p">()</span>
  <span class="n">polyTransformToWorld</span><span class="o">.</span><span class="n">SetTransform</span><span class="p">(</span><span class="n">transformModelToWorld</span><span class="p">)</span>
  <span class="n">polyTransformToWorld</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">modelNode</span><span class="o">.</span><span class="n">GetPolyData</span><span class="p">())</span>
  <span class="n">polyTransformToWorld</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
  <span class="n">surface_World</span> <span class="o">=</span> <span class="n">polyTransformToWorld</span><span class="o">.</span><span class="n">GetOutput</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
  <span class="n">surface_World</span> <span class="o">=</span> <span class="n">modelNode</span><span class="o">.</span><span class="n">GetPolyData</span><span class="p">()</span>

<span class="c1"># Create arrays to store results</span>
<span class="n">indexCol</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkIntArray</span><span class="p">()</span>
<span class="n">indexCol</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="s2">&quot;Index&quot;</span><span class="p">)</span>
<span class="n">labelCol</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkStringArray</span><span class="p">()</span>
<span class="n">labelCol</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">)</span>
<span class="n">distanceCol</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkDoubleArray</span><span class="p">()</span>
<span class="n">distanceCol</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="s2">&quot;Distance&quot;</span><span class="p">)</span>

<span class="n">distanceFilter</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkImplicitPolyDataDistance</span><span class="p">()</span>
<span class="n">distanceFilter</span><span class="o">.</span><span class="n">SetInput</span><span class="p">(</span><span class="n">surface_World</span><span class="p">)</span>
<span class="n">nOfControlPoints</span> <span class="o">=</span> <span class="n">pointListNode</span><span class="o">.</span><span class="n">GetNumberOfControlPoints</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nOfControlPoints</span><span class="p">):</span>
  <span class="n">point_World</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">pointListNode</span><span class="o">.</span><span class="n">GetNthControlPointPositionWorld</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">point_World</span><span class="p">)</span>
  <span class="n">closestPointOnSurface_World</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">closestPointDistance</span> <span class="o">=</span> <span class="n">distanceFilter</span><span class="o">.</span><span class="n">EvaluateFunctionAndGetClosestPoint</span><span class="p">(</span><span class="n">point_World</span><span class="p">,</span> <span class="n">closestPointOnSurface_World</span><span class="p">)</span>
  <span class="n">indexCol</span><span class="o">.</span><span class="n">InsertNextValue</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
  <span class="n">labelCol</span><span class="o">.</span><span class="n">InsertNextValue</span><span class="p">(</span><span class="n">pointListNode</span><span class="o">.</span><span class="n">GetNthControlPointLabel</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
  <span class="n">distanceCol</span><span class="o">.</span><span class="n">InsertNextValue</span><span class="p">(</span><span class="n">closestPointDistance</span><span class="p">)</span>

<span class="c1"># Create a table from result arrays</span>
<span class="n">resultTableNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLTableNode&quot;</span><span class="p">,</span> <span class="s2">&quot;Points from surface distance&quot;</span><span class="p">)</span>
<span class="n">resultTableNode</span><span class="o">.</span><span class="n">AddColumn</span><span class="p">(</span><span class="n">indexCol</span><span class="p">)</span>
<span class="n">resultTableNode</span><span class="o">.</span><span class="n">AddColumn</span><span class="p">(</span><span class="n">labelCol</span><span class="p">)</span>
<span class="n">resultTableNode</span><span class="o">.</span><span class="n">AddColumn</span><span class="p">(</span><span class="n">distanceCol</span><span class="p">)</span>

<span class="c1"># Show table in view layout</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLLayoutNode</span><span class="o">.</span><span class="n">SlicerLayoutFourUpTableView</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">applicationLogic</span><span class="p">()</span><span class="o">.</span><span class="n">GetSelectionNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetReferenceActiveTableID</span><span class="p">(</span><span class="n">resultTableNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">applicationLogic</span><span class="p">()</span><span class="o">.</span><span class="n">PropagateTableSelection</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="add-a-texture-mapped-plane-to-the-scene-as-a-model">
<h3>Add a texture mapped plane to the scene as a model<a class="headerlink" href="#add-a-texture-mapped-plane-to-the-scene-as-a-model" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create model node</span>
<span class="n">planeSource</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPlaneSource</span><span class="p">()</span>
<span class="n">planeSource</span><span class="o">.</span><span class="n">SetOrigin</span><span class="p">(</span><span class="o">-</span><span class="mf">50.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">50.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="n">planeSource</span><span class="o">.</span><span class="n">SetPoint1</span><span class="p">(</span><span class="mf">50.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">50.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="n">planeSource</span><span class="o">.</span><span class="n">SetPoint2</span><span class="p">(</span><span class="o">-</span><span class="mf">50.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">AddModel</span><span class="p">(</span><span class="n">planeSource</span><span class="o">.</span><span class="n">GetOutputPort</span><span class="p">())</span>

<span class="c1"># Tune display properties</span>
<span class="n">modelDisplay</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span>
<span class="n">modelDisplay</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># yellow</span>
<span class="n">modelDisplay</span><span class="o">.</span><span class="n">SetBackfaceCulling</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Add texture (just use image of an ellipsoid)</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkImageEllipsoidSource</span><span class="p">()</span>
<span class="n">modelDisplay</span><span class="o">.</span><span class="n">SetTextureImageDataConnection</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">GetOutputPort</span><span class="p">())</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Model textures are not exposed in the GUI and are not saved in the scene.</p>
</div>
</section>
<section id="get-scalar-values-at-surface-of-a-model">
<h3>Get scalar values at surface of a model<a class="headerlink" href="#get-scalar-values-at-surface-of-a-model" title="Link to this heading"></a></h3>
<p>The following script allows getting selected scalar value at a selected position of a model. Position can be selected by moving the mouse while holding down Shift key.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">modelNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;sphere&quot;</span><span class="p">)</span>
<span class="n">modelPointValues</span> <span class="o">=</span> <span class="n">modelNode</span><span class="o">.</span><span class="n">GetPolyData</span><span class="p">()</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span><span class="o">.</span><span class="n">GetArray</span><span class="p">(</span><span class="s2">&quot;Normals&quot;</span><span class="p">)</span>
<span class="n">pointListNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetFirstNodeByName</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">pointListNode</span><span class="p">:</span>
  <span class="n">pointListNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLMarkupsFiducialNode&quot;</span><span class="p">,</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>

<span class="n">pointsLocator</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPointLocator</span><span class="p">()</span> <span class="c1"># could try using vtk.vtkStaticPointLocator() if need to optimize</span>
<span class="n">pointsLocator</span><span class="o">.</span><span class="n">SetDataSet</span><span class="p">(</span><span class="n">modelNode</span><span class="o">.</span><span class="n">GetPolyData</span><span class="p">())</span>
<span class="n">pointsLocator</span><span class="o">.</span><span class="n">BuildLocator</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">onMouseMoved</span><span class="p">(</span><span class="n">observer</span><span class="p">,</span><span class="n">eventid</span><span class="p">):</span>
  <span class="n">ras</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">crosshairNode</span><span class="o">.</span><span class="n">GetCursorPositionRAS</span><span class="p">(</span><span class="n">ras</span><span class="p">)</span>
  <span class="n">closestPointId</span> <span class="o">=</span> <span class="n">pointsLocator</span><span class="o">.</span><span class="n">FindClosestPoint</span><span class="p">(</span><span class="n">ras</span><span class="p">)</span>
  <span class="n">ras</span> <span class="o">=</span> <span class="n">modelNode</span><span class="o">.</span><span class="n">GetPolyData</span><span class="p">()</span><span class="o">.</span><span class="n">GetPoint</span><span class="p">(</span><span class="n">closestPointId</span><span class="p">)</span>
  <span class="n">closestPointValue</span> <span class="o">=</span> <span class="n">modelPointValues</span><span class="o">.</span><span class="n">GetTuple</span><span class="p">(</span><span class="n">closestPointId</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">pointListNode</span><span class="o">.</span><span class="n">GetNumberOfControlPoints</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">pointListNode</span><span class="o">.</span><span class="n">AddControlPoint</span><span class="p">(</span><span class="n">ras</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">pointListNode</span><span class="o">.</span><span class="n">SetNthControlPointPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">*</span><span class="n">ras</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RAS=</span><span class="si">{</span><span class="n">ras</span><span class="si">}</span><span class="s2">  value=</span><span class="si">{</span><span class="n">closestPointValue</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">crosshairNode</span><span class="o">=</span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Crosshair&quot;</span><span class="p">)</span>
<span class="n">observationId</span> <span class="o">=</span> <span class="n">crosshairNode</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLCrosshairNode</span><span class="o">.</span><span class="n">CursorPositionModifiedEvent</span><span class="p">,</span> <span class="n">onMouseMoved</span><span class="p">)</span>

<span class="c1"># To stop printing of values run this:</span>
<span class="c1"># crosshairNode.RemoveObserver(observationId)</span>
</pre></div>
</div>
</section>
<section id="apply-vtk-filter-on-a-model-node">
<h3>Apply VTK filter on a model node<a class="headerlink" href="#apply-vtk-filter-on-a-model-node" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">modelNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;tip&quot;</span><span class="p">)</span>

<span class="c1"># Compute curvature</span>
<span class="n">curv</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCurvatures</span><span class="p">()</span>
<span class="n">curv</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">modelNode</span><span class="o">.</span><span class="n">GetPolyData</span><span class="p">())</span>
<span class="n">modelNode</span><span class="o">.</span><span class="n">SetPolyDataConnection</span><span class="p">(</span><span class="n">curv</span><span class="o">.</span><span class="n">GetOutputPort</span><span class="p">())</span>

<span class="c1"># Set up coloring by Curvature</span>
<span class="n">modelNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetActiveScalar</span><span class="p">(</span><span class="s2">&quot;Gauss_Curvature&quot;</span><span class="p">,</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkAssignAttribute</span><span class="o">.</span><span class="n">POINT_DATA</span><span class="p">)</span>
<span class="n">modelNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetAndObserveColorNodeID</span><span class="p">(</span><span class="s2">&quot;Viridis&quot;</span><span class="p">)</span>
<span class="n">modelNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetScalarVisibility</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="select-cells-of-a-model-using-markups-point-list">
<h3>Select cells of a model using markups point list<a class="headerlink" href="#select-cells-of-a-model-using-markups-point-list" title="Link to this heading"></a></h3>
<p>The following script selects cells of a model node that are closest to positions of markups control points.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get input nodes</span>
<span class="n">modelNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Segment_1&quot;</span><span class="p">)</span> <span class="c1"># select cells in this model</span>
<span class="n">pointListNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span> <span class="c1"># points will be selected at positions specified by this markups point list node</span>

<span class="c1"># Create scalar array that will store selection state</span>
<span class="n">cellScalars</span> <span class="o">=</span> <span class="n">modelNode</span><span class="o">.</span><span class="n">GetMesh</span><span class="p">()</span><span class="o">.</span><span class="n">GetCellData</span><span class="p">()</span>
<span class="n">selectionArray</span> <span class="o">=</span> <span class="n">cellScalars</span><span class="o">.</span><span class="n">GetArray</span><span class="p">(</span><span class="s2">&quot;selection&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">selectionArray</span><span class="p">:</span>
  <span class="n">selectionArray</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkIntArray</span><span class="p">()</span>
  <span class="n">selectionArray</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="s2">&quot;selection&quot;</span><span class="p">)</span>
  <span class="n">selectionArray</span><span class="o">.</span><span class="n">SetNumberOfValues</span><span class="p">(</span><span class="n">modelNode</span><span class="o">.</span><span class="n">GetMesh</span><span class="p">()</span><span class="o">.</span><span class="n">GetNumberOfCells</span><span class="p">())</span>
  <span class="n">selectionArray</span><span class="o">.</span><span class="n">Fill</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">cellScalars</span><span class="o">.</span><span class="n">AddArray</span><span class="p">(</span><span class="n">selectionArray</span><span class="p">)</span>

<span class="c1"># Set up coloring by selection array</span>
<span class="n">modelNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetActiveScalar</span><span class="p">(</span><span class="s2">&quot;selection&quot;</span><span class="p">,</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkAssignAttribute</span><span class="o">.</span><span class="n">CELL_DATA</span><span class="p">)</span>
<span class="n">modelNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetAndObserveColorNodeID</span><span class="p">(</span><span class="s2">&quot;vtkMRMLColorTableNodeWarm1&quot;</span><span class="p">)</span>
<span class="n">modelNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetScalarVisibility</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Initialize cell locator</span>
<span class="n">cell</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCellLocator</span><span class="p">()</span>
<span class="n">cell</span><span class="o">.</span><span class="n">SetDataSet</span><span class="p">(</span><span class="n">modelNode</span><span class="o">.</span><span class="n">GetMesh</span><span class="p">())</span>
<span class="n">cell</span><span class="o">.</span><span class="n">BuildLocator</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">onPointsModified</span><span class="p">(</span><span class="n">observer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">eventid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="k">global</span> <span class="n">pointListNode</span><span class="p">,</span> <span class="n">selectionArray</span>
  <span class="n">selectionArray</span><span class="o">.</span><span class="n">Fill</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># set all cells to non-selected by default</span>
  <span class="n">markupPoints</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromMarkupsControlPoints</span><span class="p">(</span><span class="n">pointListNode</span><span class="p">)</span>
  <span class="n">closestPoint</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
  <span class="n">cellObj</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkGenericCell</span><span class="p">()</span>
  <span class="n">cellId</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">mutable</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">subId</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">mutable</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">dist2</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">mutable</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">markupPoint</span> <span class="ow">in</span> <span class="n">markupPoints</span><span class="p">:</span>
    <span class="n">cell</span><span class="o">.</span><span class="n">FindClosestPoint</span><span class="p">(</span><span class="n">markupPoint</span><span class="p">,</span> <span class="n">closestPoint</span><span class="p">,</span> <span class="n">cellObj</span><span class="p">,</span> <span class="n">cellId</span><span class="p">,</span> <span class="n">subId</span><span class="p">,</span> <span class="n">dist2</span><span class="p">)</span>
    <span class="n">closestCell</span> <span class="o">=</span> <span class="n">cellId</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">closestCell</span> <span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
      <span class="n">selectionArray</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">closestCell</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="c1"># set selected cell&#39;s scalar value to non-zero</span>
  <span class="n">selectionArray</span><span class="o">.</span><span class="n">Modified</span><span class="p">()</span>

<span class="c1"># Initial update</span>
<span class="n">onPointsModified</span><span class="p">()</span>
<span class="c1"># Automatic update each time when a markup point is modified</span>
<span class="n">pointListNodeObserverTag</span> <span class="o">=</span> <span class="n">markupsNode</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLMarkupsFiducialNode</span><span class="o">.</span><span class="n">PointModifiedEvent</span><span class="p">,</span> <span class="n">onPointsModified</span><span class="p">)</span>

<span class="c1"># To stop updating selection, run this:</span>
<span class="c1"># pointListNode.RemoveObserver(pointListNodeObserverTag)</span>
</pre></div>
</div>
</section>
<section id="export-entire-scene-as-gltf">
<h3>Export entire scene as glTF<a class="headerlink" href="#export-entire-scene-as-gltf" title="Link to this heading"></a></h3>
<p>glTF is a modern and very efficient file format for surface meshes, which is supported by many web viewers, such as:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://3dviewer.net/">https://3dviewer.net/</a> (requires a single zip file that contains all the exported files)</p></li>
<li><p><a class="reference external" href="https://gltf-viewer.donmccurdy.com/">https://gltf-viewer.donmccurdy.com/</a> (the exported folder can be drag-and-dropped to the webpage)</p></li>
</ul>
<p><a class="reference external" href="https://github.com/PerkLab/SlicerOpenAnatomy/">SlicerOpenAnatomy extension</a> provides rich export of models and segmentations (preserving names, hierarchy, etc.), but for a basic export operation this code snippet can be used:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">exporter</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkGLTFExporter</span><span class="p">()</span>
<span class="n">exporter</span><span class="o">.</span><span class="n">SetRenderWindow</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">threeDWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">threeDView</span><span class="p">()</span><span class="o">.</span><span class="n">renderWindow</span><span class="p">())</span>
<span class="n">exporter</span><span class="o">.</span><span class="n">SetFileName</span><span class="p">(</span><span class="s2">&quot;c:/tmp/newfolder/mymodel.gltf&quot;</span><span class="p">)</span>
<span class="n">exporter</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="export-entire-scene-as-vrml">
<h3>Export entire scene as VRML<a class="headerlink" href="#export-entire-scene-as-vrml" title="Link to this heading"></a></h3>
<p>Save all surface meshes displayed in the scene (models, markups, etc). Solid colors and coloring by scalar is preserved. Textures are not supported.
VRML is a very old general-purpose scene file format, which is still supported by some software.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">exporter</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkVRMLExporter</span><span class="p">()</span>
<span class="n">exporter</span><span class="o">.</span><span class="n">SetRenderWindow</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">threeDWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">threeDView</span><span class="p">()</span><span class="o">.</span><span class="n">renderWindow</span><span class="p">())</span>
<span class="n">exporter</span><span class="o">.</span><span class="n">SetFileName</span><span class="p">(</span><span class="s2">&quot;C:/tmp/something.wrl&quot;</span><span class="p">)</span>
<span class="n">exporter</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="export-model-to-blender-including-color-by-scalar">
<h3>Export model to Blender, including color by scalar<a class="headerlink" href="#export-model-to-blender-including-color-by-scalar" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>   <span class="n">modelNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Model&quot;</span><span class="p">)</span>
   <span class="n">plyFilePath</span> <span class="o">=</span> <span class="s2">&quot;c:/tmp/model.ply&quot;</span>

   <span class="n">modelDisplayNode</span> <span class="o">=</span> <span class="n">modelNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span>
   <span class="n">triangles</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkTriangleFilter</span><span class="p">()</span>
   <span class="n">triangles</span><span class="o">.</span><span class="n">SetInputConnection</span><span class="p">(</span><span class="n">modelDisplayNode</span><span class="o">.</span><span class="n">GetOutputPolyDataConnection</span><span class="p">())</span>

   <span class="n">plyWriter</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPLYWriter</span><span class="p">()</span>
   <span class="n">plyWriter</span><span class="o">.</span><span class="n">SetInputConnection</span><span class="p">(</span><span class="n">triangles</span><span class="o">.</span><span class="n">GetOutputPort</span><span class="p">())</span>
   <span class="n">lut</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkLookupTable</span><span class="p">()</span>
   <span class="n">lut</span><span class="o">.</span><span class="n">DeepCopy</span><span class="p">(</span><span class="n">modelDisplayNode</span><span class="o">.</span><span class="n">GetColorNode</span><span class="p">()</span><span class="o">.</span><span class="n">GetLookupTable</span><span class="p">())</span>
   <span class="n">lut</span><span class="o">.</span><span class="n">SetRange</span><span class="p">(</span><span class="n">modelDisplayNode</span><span class="o">.</span><span class="n">GetScalarRange</span><span class="p">())</span>
   <span class="n">plyWriter</span><span class="o">.</span><span class="n">SetLookupTable</span><span class="p">(</span><span class="n">lut</span><span class="p">)</span>
   <span class="n">plyWriter</span><span class="o">.</span><span class="n">SetArrayName</span><span class="p">(</span><span class="n">modelDisplayNode</span><span class="o">.</span><span class="n">GetActiveScalarName</span><span class="p">())</span>

   <span class="n">plyWriter</span><span class="o">.</span><span class="n">SetFileName</span><span class="p">(</span><span class="n">plyFilePath</span><span class="p">)</span>
   <span class="n">plyWriter</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="show-comparison-view-of-all-model-files-a-folder">
<h3>Show comparison view of all model files a folder<a class="headerlink" href="#show-comparison-view-of-all-model-files-a-folder" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Inputs</span>
<span class="n">modelDir</span> <span class="o">=</span> <span class="s2">&quot;c:/some/folder/containing/models&quot;</span>
<span class="n">modelFileExt</span> <span class="o">=</span> <span class="s2">&quot;stl&quot;</span>
<span class="n">numberOfColumns</span> <span class="o">=</span> <span class="mi">4</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="n">modelFiles</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">modelDir</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">modelFileExt</span><span class="p">))</span>

<span class="c1"># Create a custom layout</span>
<span class="n">numberOfRows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">modelFiles</span><span class="p">)</span><span class="o">/</span><span class="n">numberOfColumns</span><span class="p">))</span>
<span class="n">customLayoutId</span><span class="o">=</span><span class="mi">567</span>  <span class="c1"># we pick a random id that is not used by others</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">setRenderPaused</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">customLayout</span> <span class="o">=</span> <span class="s1">&#39;&lt;layout type=&quot;vertical&quot;&gt;&#39;</span>
<span class="n">viewIndex</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">rowIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numberOfRows</span><span class="p">):</span>
  <span class="n">customLayout</span> <span class="o">+=</span> <span class="s1">&#39;&lt;item&gt;&lt;layout type=&quot;horizontal&quot;&gt;&#39;</span>
  <span class="k">for</span> <span class="n">colIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numberOfColumns</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">modelFiles</span><span class="p">[</span><span class="n">viewIndex</span><span class="p">])</span> <span class="k">if</span> <span class="n">viewIndex</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">modelFiles</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;compare &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">viewIndex</span><span class="p">)</span>
    <span class="n">customLayout</span> <span class="o">+=</span> <span class="s1">&#39;&lt;item&gt;&lt;view class=&quot;vtkMRMLViewNode&quot; singletontag=&quot;&#39;</span><span class="o">+</span><span class="n">name</span>
    <span class="n">customLayout</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&gt;&lt;property name=&quot;viewlabel&quot; action=&quot;default&quot;&gt;&#39;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;&lt;/property&gt;&lt;/view&gt;&lt;/item&gt;&#39;</span>
    <span class="n">viewIndex</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="n">customLayout</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/layout&gt;&lt;/item&gt;&#39;</span>

<span class="n">customLayout</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/layout&gt;&#39;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">layoutLogic</span><span class="p">()</span><span class="o">.</span><span class="n">GetLayoutNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetLayoutDescription</span><span class="p">(</span><span class="n">customLayoutId</span><span class="p">,</span> <span class="n">customLayout</span><span class="p">):</span>
    <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">layoutLogic</span><span class="p">()</span><span class="o">.</span><span class="n">GetLayoutNode</span><span class="p">()</span><span class="o">.</span><span class="n">AddLayoutDescription</span><span class="p">(</span><span class="n">customLayoutId</span><span class="p">,</span> <span class="n">customLayout</span><span class="p">)</span>

<span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">customLayoutId</span><span class="p">)</span>

<span class="c1"># Load and show each model in a view</span>
<span class="k">for</span> <span class="n">modelIndex</span><span class="p">,</span> <span class="n">modelFile</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">modelFiles</span><span class="p">):</span>
  <span class="c1"># Show only one model in each view</span>
  <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">modelFile</span><span class="p">)</span>
  <span class="n">viewNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetSingletonNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;vtkMRMLViewNode&quot;</span><span class="p">)</span>
  <span class="n">viewNode</span><span class="o">.</span><span class="n">LinkedControlOn</span><span class="p">()</span>
  <span class="n">modelNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">loadModel</span><span class="p">(</span><span class="n">modelDir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">modelFile</span><span class="p">)</span>
  <span class="n">modelNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">AddViewNodeID</span><span class="p">(</span><span class="n">viewNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>

<span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">setRenderPaused</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="rasterize-a-model-and-save-it-to-a-series-of-image-files">
<h3>Rasterize a model and save it to a series of image files<a class="headerlink" href="#rasterize-a-model-and-save-it-to-a-series-of-image-files" title="Link to this heading"></a></h3>
<p>This example shows how to generate a stack of image files from an STL file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">inputModelFile</span> <span class="o">=</span> <span class="s2">&quot;/some/input/folder/SomeShape.stl&quot;</span>
<span class="n">outputDir</span> <span class="o">=</span> <span class="s2">&quot;/some/output/folder&quot;</span>
<span class="n">outputVolumeLabelValue</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">outputVolumeSpacingMm</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
<span class="n">outputVolumeMarginMm</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]</span>

<span class="c1"># Read model</span>
<span class="n">inputModel</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">loadModel</span><span class="p">(</span><span class="n">inputModelFile</span><span class="p">)</span>

<span class="c1"># Determine output volume geometry and create a corresponding reference volume</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="n">inputModel</span><span class="o">.</span><span class="n">GetBounds</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>
<span class="n">imageData</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkImageData</span><span class="p">()</span>
<span class="n">imageSize</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">int</span><span class="p">((</span><span class="n">bounds</span><span class="p">[</span><span class="n">axis</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">bounds</span><span class="p">[</span><span class="n">axis</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">outputVolumeMarginMm</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">*</span><span class="mf">2.0</span><span class="p">)</span><span class="o">/</span><span class="n">outputVolumeSpacingMm</span><span class="p">[</span><span class="n">axis</span><span class="p">])</span> <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">]</span>
<span class="n">imageOrigin</span> <span class="o">=</span> <span class="p">[</span> <span class="n">bounds</span><span class="p">[</span><span class="n">axis</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">outputVolumeMarginMm</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">]</span>
<span class="n">imageData</span><span class="o">.</span><span class="n">SetDimensions</span><span class="p">(</span><span class="n">imageSize</span><span class="p">)</span>
<span class="n">imageData</span><span class="o">.</span><span class="n">AllocateScalars</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">VTK_UNSIGNED_CHAR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">imageData</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span><span class="o">.</span><span class="n">GetScalars</span><span class="p">()</span><span class="o">.</span><span class="n">Fill</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">referenceVolumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLScalarVolumeNode&quot;</span><span class="p">)</span>
<span class="n">referenceVolumeNode</span><span class="o">.</span><span class="n">SetOrigin</span><span class="p">(</span><span class="n">imageOrigin</span><span class="p">)</span>
<span class="n">referenceVolumeNode</span><span class="o">.</span><span class="n">SetSpacing</span><span class="p">(</span><span class="n">outputVolumeSpacingMm</span><span class="p">)</span>
<span class="n">referenceVolumeNode</span><span class="o">.</span><span class="n">SetAndObserveImageData</span><span class="p">(</span><span class="n">imageData</span><span class="p">)</span>
<span class="n">referenceVolumeNode</span><span class="o">.</span><span class="n">CreateDefaultDisplayNodes</span><span class="p">()</span>

<span class="c1"># Convert model to labelmap</span>
<span class="n">seg</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLSegmentationNode&quot;</span><span class="p">)</span>
<span class="n">seg</span><span class="o">.</span><span class="n">SetReferenceImageGeometryParameterFromVolumeNode</span><span class="p">(</span><span class="n">referenceVolumeNode</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">segmentations</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">ImportModelToSegmentationNode</span><span class="p">(</span><span class="n">inputModel</span><span class="p">,</span> <span class="n">seg</span><span class="p">)</span>
<span class="n">seg</span><span class="o">.</span><span class="n">CreateBinaryLabelmapRepresentation</span><span class="p">()</span>
<span class="n">outputLabelmapVolumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLLabelMapVolumeNode&quot;</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">segmentations</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">ExportVisibleSegmentsToLabelmapNode</span><span class="p">(</span><span class="n">seg</span><span class="p">,</span> <span class="n">outputLabelmapVolumeNode</span><span class="p">,</span> <span class="n">referenceVolumeNode</span><span class="p">)</span>
<span class="n">outputLabelmapVolumeArray</span> <span class="o">=</span> <span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromVolume</span><span class="p">(</span><span class="n">outputLabelmapVolumeNode</span><span class="p">)</span> <span class="o">*</span> <span class="n">outputVolumeLabelValue</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int8&quot;</span><span class="p">)</span>

<span class="c1"># Install dependencies</span>
<span class="k">try</span><span class="p">:</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">imageio</span>
<span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">pip_install</span><span class="p">(</span><span class="s2">&quot;imageio&quot;</span><span class="p">)</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">imageio</span>

<span class="c1"># Write labelmap volume to series of TIFF files</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">outputLabelmapVolumeArray</span><span class="p">)):</span>
  <span class="n">imageio</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outputDir</span><span class="si">}</span><span class="s2">/image_</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">03</span><span class="si">}</span><span class="s2">.tiff&quot;</span><span class="p">,</span> <span class="n">outputLabelmapVolumeArray</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>To learn how to use <a class="reference internal" href="slicer.html#slicer.util.pip_install" title="slicer.util.pip_install"><code class="xref py py-func docutils literal notranslate"><span class="pre">slicer.util.pip_install()</span></code></a> within a Slicer module, refer to the <a class="reference internal" href="#install-a-python-package"><span class="std std-ref">Install a Python package</span></a> example in the Script Repository.</p>
</div>
</section>
</section>
<section id="plots">
<h2>Plots<a class="headerlink" href="#plots" title="Link to this heading"></a></h2>
<section id="slicer-plots-displayed-in-view-layout">
<h3>Slicer plots displayed in view layout<a class="headerlink" href="#slicer-plots-displayed-in-view-layout" title="Link to this heading"></a></h3>
<p>Create histogram plot of a volume and show it embedded in the view layout. More information: <a class="reference external" href="https://www.slicer.org/wiki/Documentation/Nightly/Developers/Plots">https://www.slicer.org/wiki/Documentation/Nightly/Developers/Plots</a></p>
</section>
<section id="using-slicer-util-plot-utility-function">
<h3>Using <a class="reference internal" href="slicer.html#slicer.util.plot" title="slicer.util.plot"><code class="xref py py-func docutils literal notranslate"><span class="pre">slicer.util.plot()</span></code></a> utility function<a class="headerlink" href="#using-slicer-util-plot-utility-function" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get a volume from SampleData and compute its histogram</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">SampleData</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">volumeNode</span> <span class="o">=</span> <span class="n">SampleData</span><span class="o">.</span><span class="n">SampleDataLogic</span><span class="p">()</span><span class="o">.</span><span class="n">downloadMRHead</span><span class="p">()</span>
<span class="n">histogram</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">arrayFromVolume</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="n">chartNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">histogram</span><span class="p">,</span> <span class="n">xColumnIndex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">chartNode</span><span class="o">.</span><span class="n">SetYAxisRangeAuto</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">chartNode</span><span class="o">.</span><span class="n">SetYAxisRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">4e5</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="Plot displayed using Slicer's plotting module" src="https://www.slicer.org/w/img_auth.php/9/9c/SlicerPlot.png" /></p>
<section id="using-mrml-classes-only">
<h4>Using MRML classes only<a class="headerlink" href="#using-mrml-classes-only" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get a volume from SampleData</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">SampleData</span>
<span class="n">volumeNode</span> <span class="o">=</span> <span class="n">SampleData</span><span class="o">.</span><span class="n">SampleDataLogic</span><span class="p">()</span><span class="o">.</span><span class="n">downloadMRHead</span><span class="p">()</span>

<span class="c1"># Compute histogram values</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">histogram</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">arrayFromVolume</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="c1"># Save results to a new table node</span>
<span class="n">tableNode</span><span class="o">=</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLTableNode&quot;</span><span class="p">)</span>
<span class="n">updateTableFromArray</span><span class="p">(</span><span class="n">tableNode</span><span class="p">,</span> <span class="n">histogram</span><span class="p">)</span>
<span class="n">tableNode</span><span class="o">.</span><span class="n">GetTable</span><span class="p">()</span><span class="o">.</span><span class="n">GetColumn</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">)</span>
<span class="n">tableNode</span><span class="o">.</span><span class="n">GetTable</span><span class="p">()</span><span class="o">.</span><span class="n">GetColumn</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="s2">&quot;Intensity&quot;</span><span class="p">)</span>

<span class="c1"># Create plot</span>
<span class="n">plotSeriesNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLPlotSeriesNode&quot;</span><span class="p">,</span> <span class="n">volumeNode</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; histogram&quot;</span><span class="p">)</span>
<span class="n">plotSeriesNode</span><span class="o">.</span><span class="n">SetAndObserveTableNodeID</span><span class="p">(</span><span class="n">tableNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
<span class="n">plotSeriesNode</span><span class="o">.</span><span class="n">SetXColumnName</span><span class="p">(</span><span class="s2">&quot;Intensity&quot;</span><span class="p">)</span>
<span class="n">plotSeriesNode</span><span class="o">.</span><span class="n">SetYColumnName</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">)</span>
<span class="n">plotSeriesNode</span><span class="o">.</span><span class="n">SetPlotType</span><span class="p">(</span><span class="n">plotSeriesNode</span><span class="o">.</span><span class="n">PlotTypeScatterBar</span><span class="p">)</span>
<span class="n">plotSeriesNode</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

<span class="c1"># Create chart and add plot</span>
<span class="n">plotChartNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLPlotChartNode&quot;</span><span class="p">)</span>
<span class="n">plotChartNode</span><span class="o">.</span><span class="n">AddAndObservePlotSeriesNodeID</span><span class="p">(</span><span class="n">plotSeriesNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
<span class="n">plotChartNode</span><span class="o">.</span><span class="n">YAxisRangeAutoOff</span><span class="p">()</span>
<span class="n">plotChartNode</span><span class="o">.</span><span class="n">SetYAxisRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500000</span><span class="p">)</span>

<span class="c1"># Show plot in layout</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">ShowChartInLayout</span><span class="p">(</span><span class="n">plotChartNode</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="save-a-plot-as-vector-graphics-svg">
<h3>Save a plot as vector graphics (.svg)<a class="headerlink" href="#save-a-plot-as-vector-graphics-svg" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plotView</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">plotWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plotView</span><span class="p">()</span>
<span class="n">plotView</span><span class="o">.</span><span class="n">saveAsSVG</span><span class="p">(</span><span class="s2">&quot;c:/tmp/test.svg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="using-matplotlib">
<h3>Using matplotlib<a class="headerlink" href="#using-matplotlib" title="Link to this heading"></a></h3>
<p>Matplotlib may be used from within Slicer, but the default Tk backend locks up and crashes Slicer. However, Matplotlib may still be used through other backends. More details can be found on the <a class="reference external" href="https://matplotlib.org/">MatPlotLib</a> pages.</p>
<section id="non-interactive-plot">
<h4>Non-interactive plot<a class="headerlink" href="#non-interactive-plot" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span>
<span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">pip_install</span><span class="p">(</span><span class="s2">&quot;matplotlib&quot;</span><span class="p">)</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span>

<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;Agg&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pylab</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="n">t1</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">)</span>
<span class="n">t3</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>

<span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">t1</span><span class="p">)</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t1</span><span class="p">),</span> <span class="s2">&quot;bo&quot;</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">t2</span><span class="p">)</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t2</span><span class="p">),</span> <span class="s2">&quot;k&quot;</span><span class="p">)</span>
<span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s2">&quot;A tale of 2 subplots&quot;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Damped&quot;</span><span class="p">)</span>

<span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t3</span><span class="p">,</span> <span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">t3</span><span class="p">),</span> <span class="s2">&quot;r--&quot;</span><span class="p">)</span>
<span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;time (s)&quot;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Undamped&quot;</span><span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;MatplotlibExample.png&quot;</span><span class="p">)</span>

<span class="c1"># Static image view</span>
<span class="n">pm</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">QPixmap</span><span class="p">(</span><span class="s2">&quot;MatplotlibExample.png&quot;</span><span class="p">)</span>
<span class="n">imageWidget</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">QLabel</span><span class="p">()</span>
<span class="n">imageWidget</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">pm</span><span class="p">)</span>
<span class="n">imageWidget</span><span class="o">.</span><span class="n">setScaledContents</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">imageWidget</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>To learn how to use <a class="reference internal" href="slicer.html#slicer.util.pip_install" title="slicer.util.pip_install"><code class="xref py py-func docutils literal notranslate"><span class="pre">slicer.util.pip_install()</span></code></a> within a Slicer module, refer to the <a class="reference internal" href="#install-a-python-package"><span class="std std-ref">Install a Python package</span></a> example in the Script Repository.</p>
</div>
<p><img alt="Matplotlib example" src="https://www.slicer.org/w/img_auth.php/a/ab/MatplotlibExample.png" /></p>
</section>
<section id="plot-in-slicer-jupyter-notebook">
<h4>Plot in Slicer Jupyter notebook<a class="headerlink" href="#plot-in-slicer-jupyter-notebook" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">JupyterNotebooksLib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">slicernb</span>
<span class="k">try</span><span class="p">:</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span>
<span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
  <span class="n">pip_install</span><span class="p">(</span><span class="s2">&quot;matplotlib&quot;</span><span class="p">)</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span>

<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;Agg&quot;</span><span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
  <span class="n">s1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
  <span class="n">e1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">s1</span> <span class="o">*</span> <span class="n">e1</span>

<span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">)</span>
<span class="n">t3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">t1</span><span class="p">),</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">t2</span><span class="p">),</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;subplot 1&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;distance (m)&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Damped oscillation&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;This is a somewhat long figure title&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">t3</span><span class="p">),</span> <span class="s2">&quot;--&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time (s)&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;subplot 2&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Undamped&quot;</span><span class="p">)</span>

<span class="n">slicernb</span><span class="o">.</span><span class="n">MatplotlibDisplay</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="Example for using Matplotlib in a Slicer Jupyter Notebook" src="https://www.slicer.org/w/img_auth.php/a/a2/JupyterNotebookMatplotlibExample.png" /></p>
</section>
<section id="interactive-plot-using-wxwidgets-gui-toolkit">
<h4>Interactive plot using wxWidgets GUI toolkit<a class="headerlink" href="#interactive-plot-using-wxwidgets-gui-toolkit" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">wx</span>
<span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
  <span class="n">pip_install</span><span class="p">(</span><span class="s2">&quot;matplotlib wxPython&quot;</span><span class="p">)</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span>

<span class="c1"># Get a volume from SampleData and compute its histogram</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">SampleData</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">volumeNode</span> <span class="o">=</span> <span class="n">SampleData</span><span class="o">.</span><span class="n">SampleDataLogic</span><span class="p">()</span><span class="o">.</span><span class="n">downloadMRHead</span><span class="p">()</span>
<span class="n">histogram</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">arrayFromVolume</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="c1"># Set matplotlib to use WXAgg backend</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;WXAgg&quot;</span><span class="p">)</span>

<span class="c1"># Show an interactive plot</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">histogram</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span> <span class="n">histogram</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mf">4e5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>To learn how to use <a class="reference internal" href="slicer.html#slicer.util.pip_install" title="slicer.util.pip_install"><code class="xref py py-func docutils literal notranslate"><span class="pre">slicer.util.pip_install()</span></code></a> within a Slicer module, refer to the <a class="reference internal" href="#install-a-python-package"><span class="std std-ref">Install a Python package</span></a> example in the Script Repository.</p>
</div>
<p><img alt="Interactive Matplotlib Example" src="https://www.slicer.org/w/img_auth.php/d/d2/InteractiveMatplotlibExample.png" /></p>
</section>
</section>
</section>
<section id="screen-capture">
<h2>Screen Capture<a class="headerlink" href="#screen-capture" title="Link to this heading"></a></h2>
<section id="capture-the-full-slicer-screen-and-save-it-into-a-file">
<h3>Capture the full Slicer screen and save it into a file<a class="headerlink" href="#capture-the-full-slicer-screen-and-save-it-into-a-file" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">img</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">QPixmap</span><span class="o">.</span><span class="n">grabWidget</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">())</span><span class="o">.</span><span class="n">toImage</span><span class="p">()</span>
<span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;c:/tmp/test.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="capture-all-the-views-save-it-into-a-file">
<h3>Capture all the views save it into a file<a class="headerlink" href="#capture-all-the-views-save-it-into-a-file" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">ScreenCapture</span>
<span class="n">cap</span> <span class="o">=</span> <span class="n">ScreenCapture</span><span class="o">.</span><span class="n">ScreenCaptureLogic</span><span class="p">()</span>
<span class="n">cap</span><span class="o">.</span><span class="n">showViewControllers</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">cap</span><span class="o">.</span><span class="n">captureImageFromView</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;c:/tmp/test.png&quot;</span><span class="p">)</span>
<span class="n">cap</span><span class="o">.</span><span class="n">showViewControllers</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="capture-a-single-view">
<h3>Capture a single view<a class="headerlink" href="#capture-a-single-view" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">viewNodeID</span> <span class="o">=</span> <span class="s2">&quot;vtkMRMLViewNode1&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ScreenCapture</span>
<span class="n">cap</span> <span class="o">=</span> <span class="n">ScreenCapture</span><span class="o">.</span><span class="n">ScreenCaptureLogic</span><span class="p">()</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">viewFromNode</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetNodeByID</span><span class="p">(</span><span class="n">viewNodeID</span><span class="p">))</span>
<span class="n">cap</span><span class="o">.</span><span class="n">captureImageFromView</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="s2">&quot;c:/tmp/test.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Common values for viewNodeID: vtkMRMLSliceNodeRed, vtkMRMLSliceNodeYellow, vtkMRMLSliceNodeGreen, vtkMRMLViewNode1, vtkMRMLViewNode2. The ScreenCapture module can also create video animations of rotating views, slice sweeps, etc.</p>
</section>
<section id="capture-a-slice-view-sweep-into-a-series-of-png-files">
<h3>Capture a slice view sweep into a series of PNG files<a class="headerlink" href="#capture-a-slice-view-sweep-into-a-series-of-png-files" title="Link to this heading"></a></h3>
<p>For example, Red slice view, 30 images, from position -125.0 to 75.0, into c:/tmp folder, with name image_00001.png, image_00002.png, …</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">ScreenCapture</span>
<span class="n">ScreenCapture</span><span class="o">.</span><span class="n">ScreenCaptureLogic</span><span class="p">()</span><span class="o">.</span><span class="n">captureSliceSweep</span><span class="p">(</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;vtkMRMLSliceNodeRed&quot;</span><span class="p">),</span> <span class="o">-</span><span class="mf">125.0</span><span class="p">,</span> <span class="mf">75.0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="s2">&quot;c:/tmp&quot;</span><span class="p">,</span> <span class="s2">&quot;image_</span><span class="si">%05d</span><span class="s2">.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="capture-3d-view-into-png-file-with-transparent-background">
<h3>Capture 3D view into PNG file with transparent background<a class="headerlink" href="#capture-3d-view-into-png-file-with-transparent-background" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set background to black (required for transparent background)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">threeDWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">threeDView</span><span class="p">()</span>
<span class="n">view</span><span class="o">.</span><span class="n">mrmlViewNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetBackgroundColor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">view</span><span class="o">.</span><span class="n">mrmlViewNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetBackgroundColor2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">view</span><span class="o">.</span><span class="n">forceRender</span><span class="p">()</span>
<span class="c1"># Capture RGBA image</span>
<span class="n">renderWindow</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">renderWindow</span><span class="p">()</span>
<span class="n">renderWindow</span><span class="o">.</span><span class="n">SetAlphaBitPlanes</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">wti</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkWindowToImageFilter</span><span class="p">()</span>
<span class="n">wti</span><span class="o">.</span><span class="n">SetInputBufferTypeToRGBA</span><span class="p">()</span>
<span class="n">wti</span><span class="o">.</span><span class="n">SetInput</span><span class="p">(</span><span class="n">renderWindow</span><span class="p">)</span>
<span class="n">writer</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPNGWriter</span><span class="p">()</span>
<span class="n">writer</span><span class="o">.</span><span class="n">SetFileName</span><span class="p">(</span><span class="s2">&quot;c:/tmp/screenshot.png&quot;</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">SetInputConnection</span><span class="p">(</span><span class="n">wti</span><span class="o">.</span><span class="n">GetOutputPort</span><span class="p">())</span>
<span class="n">writer</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="capture-slice-view-into-png-file-with-white-background">
<h3>Capture slice view into PNG file with white background<a class="headerlink" href="#capture-slice-view-into-png-file-with-white-background" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sliceViewName</span> <span class="o">=</span> <span class="s2">&quot;Red&quot;</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;c:/tmp/screenshot.png&quot;</span>

<span class="c1"># Set view background to white</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">sliceWidget</span><span class="p">(</span><span class="n">sliceViewName</span><span class="p">)</span><span class="o">.</span><span class="n">sliceView</span><span class="p">()</span>
<span class="n">view</span><span class="o">.</span><span class="n">setBackgroundColor</span><span class="p">(</span><span class="n">qt</span><span class="o">.</span><span class="n">QColor</span><span class="o">.</span><span class="n">fromRgbF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">view</span><span class="o">.</span><span class="n">forceRender</span><span class="p">()</span>

<span class="c1"># Capture a screenshot</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ScreenCapture</span>
<span class="n">cap</span> <span class="o">=</span> <span class="n">ScreenCapture</span><span class="o">.</span><span class="n">ScreenCaptureLogic</span><span class="p">()</span>
<span class="n">cap</span><span class="o">.</span><span class="n">captureImageFromView</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="save-a-series-of-images-from-a-slice-view">
<h3>Save a series of images from a slice view<a class="headerlink" href="#save-a-series-of-images-from-a-slice-view" title="Link to this heading"></a></h3>
<p>You can use ScreenCapture module to capture series of images. To do it programmatically, save the following into a file such as <code class="docutils literal notranslate"><span class="pre">/tmp/record.py</span></code> and then in the Slicer python console type <code class="docutils literal notranslate"><span class="pre">execfile(&quot;/tmp/record.py&quot;)</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">layoutName</span> <span class="o">=</span> <span class="s2">&quot;Green&quot;</span>
<span class="n">imagePathPattern</span> <span class="o">=</span> <span class="s2">&quot;/tmp/image-</span><span class="si">%03d</span><span class="s2">.png&quot;</span>
<span class="n">steps</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">widget</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">sliceWidget</span><span class="p">(</span><span class="n">layoutName</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">sliceView</span><span class="p">()</span>
<span class="n">logic</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">sliceLogic</span><span class="p">()</span>
<span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,]</span><span class="o">*</span><span class="mi">6</span>
<span class="n">logic</span><span class="o">.</span><span class="n">GetSliceBounds</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>

<span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
  <span class="n">offset</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">step</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">*</span><span class="n">steps</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">-</span><span class="n">bounds</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
  <span class="n">logic</span><span class="o">.</span><span class="n">SetSliceOffset</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
  <span class="n">view</span><span class="o">.</span><span class="n">forceRender</span><span class="p">()</span>
  <span class="n">image</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">QPixmap</span><span class="o">.</span><span class="n">grabWidget</span><span class="p">(</span><span class="n">view</span><span class="p">)</span><span class="o">.</span><span class="n">toImage</span><span class="p">()</span>
  <span class="n">image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">imagePathPattern</span> <span class="o">%</span> <span class="n">step</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="segmentations">
<h2>Segmentations<a class="headerlink" href="#segmentations" title="Link to this heading"></a></h2>
<section id="load-a-3d-image-or-model-file-as-segmentation">
<h3>Load a 3D image or model file as segmentation<a class="headerlink" href="#load-a-3d-image-or-model-file-as-segmentation" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load segmentation from .seg.nrrd file (includes segment names and colors)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">loadSegmentation</span><span class="p">(</span><span class="s2">&quot;c:/tmp/tmp/Segmentation.nrrd&quot;</span><span class="p">)</span>

<span class="c1"># Create segmentation from a NIFTI + color table file</span>
<span class="n">colorNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">loadColorTable</span><span class="p">(</span><span class="s1">&#39;c:/tmp/tmp/Segmentation-label_ColorTable.ctbl&#39;</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">loadSegmentation</span><span class="p">(</span><span class="s2">&quot;c:/tmp/tmp/Segmentation.nii&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;colorNodeID&#39;</span><span class="p">:</span> <span class="n">colorNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">()})</span>

<span class="c1"># Create segmentation from a STL file</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">loadSegmentation</span><span class="p">(</span><span class="s2">&quot;c:/tmp/Segment_1.stl&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="create-a-segmentation-from-a-labelmap-volume-and-display-in-3d">
<h3>Create a segmentation from a labelmap volume and display in 3D<a class="headerlink" href="#create-a-segmentation-from-a-labelmap-volume-and-display-in-3d" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">labelmapVolumeNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">)</span>
<span class="n">seg</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLSegmentationNode&quot;</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">segmentations</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">ImportLabelmapToSegmentationNode</span><span class="p">(</span><span class="n">labelmapVolumeNode</span><span class="p">,</span> <span class="n">seg</span><span class="p">)</span>
<span class="n">seg</span><span class="o">.</span><span class="n">CreateClosedSurfaceRepresentation</span><span class="p">()</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">RemoveNode</span><span class="p">(</span><span class="n">labelmapVolumeNode</span><span class="p">)</span>
</pre></div>
</div>
<p>The last line is optional. It removes the original labelmap volume so that the same information is not shown twice.</p>
</section>
<section id="create-segmentation-from-a-model-node">
<h3>Create segmentation from a model node<a class="headerlink" href="#create-segmentation-from-a-model-node" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create some model that will be added to a segmentation node</span>
<span class="n">sphere</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkSphereSource</span><span class="p">()</span>
<span class="n">sphere</span><span class="o">.</span><span class="n">SetCenter</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>
<span class="n">sphere</span><span class="o">.</span><span class="n">SetRadius</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">modelNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">AddModel</span><span class="p">(</span><span class="n">sphere</span><span class="o">.</span><span class="n">GetOutputPort</span><span class="p">())</span>

<span class="c1"># Create segmentation</span>
<span class="n">segmentationNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLSegmentationNode&quot;</span><span class="p">)</span>
<span class="n">segmentationNode</span><span class="o">.</span><span class="n">CreateDefaultDisplayNodes</span><span class="p">()</span> <span class="c1"># only needed for display</span>

<span class="c1"># Import the model into the segmentation node</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">segmentations</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">ImportModelToSegmentationNode</span><span class="p">(</span><span class="n">modelNode</span><span class="p">,</span> <span class="n">segmentationNode</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="export-labelmap-node-from-segmentation-node">
<h3>Export labelmap node from segmentation node<a class="headerlink" href="#export-labelmap-node-from-segmentation-node" title="Link to this heading"></a></h3>
<p>Export labelmap matching reference geometry of the segmentation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">segmentationNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Segmentation&quot;</span><span class="p">)</span>
<span class="n">labelmapVolumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLLabelMapVolumeNode&quot;</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">segmentations</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">ExportAllSegmentsToLabelmapNode</span><span class="p">(</span><span class="n">segmentationNode</span><span class="p">,</span> <span class="n">labelmapVolumeNode</span><span class="p">,</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkSegmentation</span><span class="o">.</span><span class="n">EXTENT_REFERENCE_GEOMETRY</span><span class="p">)</span>
</pre></div>
</div>
<p>Export smallest possible labelmap:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">segmentationNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Segmentation&quot;</span><span class="p">)</span>
<span class="n">labelmapVolumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLLabelMapVolumeNode&quot;</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">segmentations</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">ExportAllSegmentsToLabelmapNode</span><span class="p">(</span><span class="n">segmentationNode</span><span class="p">,</span> <span class="n">labelmapVolumeNode</span><span class="p">)</span>
</pre></div>
</div>
<p>Export labelmap that matches geometry of a chosen reference volume:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">segmentationNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Segmentation&quot;</span><span class="p">)</span>
<span class="n">labelmapVolumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLLabelMapVolumeNode&quot;</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">segmentations</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">ExportVisibleSegmentsToLabelmapNode</span><span class="p">(</span><span class="n">segmentationNode</span><span class="p">,</span> <span class="n">labelmapVolumeNode</span><span class="p">,</span> <span class="n">referenceVolumeNode</span><span class="p">)</span>
</pre></div>
</div>
<p>Export a selection of segments (identified by their names):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">segmentNames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Prostate&quot;</span><span class="p">,</span> <span class="s2">&quot;Urethra&quot;</span><span class="p">]</span>
<span class="n">segmentIds</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkStringArray</span><span class="p">()</span>
<span class="k">for</span> <span class="n">segmentName</span> <span class="ow">in</span> <span class="n">segmentNames</span><span class="p">:</span>
  <span class="n">segmentId</span> <span class="o">=</span> <span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetSegmentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetSegmentIdBySegmentName</span><span class="p">(</span><span class="n">segmentName</span><span class="p">)</span>
  <span class="n">segmentIds</span><span class="o">.</span><span class="n">InsertNextValue</span><span class="p">(</span><span class="n">segmentId</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">vtkSlicerSegmentationsModuleLogic</span><span class="o">.</span><span class="n">ExportSegmentsToLabelmapNode</span><span class="p">(</span><span class="n">segmentationNode</span><span class="p">,</span> <span class="n">segmentIds</span><span class="p">,</span> <span class="n">labelmapVolumeNode</span><span class="p">,</span> <span class="n">referenceVolumeNode</span><span class="p">)</span>
</pre></div>
</div>
<p>Export to file by pressing <kbd>Ctrl+Shift+S</kbd> key:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">outputPath</span> <span class="o">=</span> <span class="s2">&quot;c:/tmp&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">exportLabelmap</span><span class="p">():</span>
  <span class="n">segmentationNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetFirstNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLSegmentationNode&quot;</span><span class="p">)</span>
  <span class="n">referenceVolumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetFirstNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLScalarVolumeNode&quot;</span><span class="p">)</span>
  <span class="n">labelmapVolumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLLabelMapVolumeNode&quot;</span><span class="p">)</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">segmentations</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">ExportVisibleSegmentsToLabelmapNode</span><span class="p">(</span><span class="n">segmentationNode</span><span class="p">,</span> <span class="n">labelmapVolumeNode</span><span class="p">,</span> <span class="n">referenceVolumeNode</span><span class="p">)</span>
  <span class="n">filepath</span> <span class="o">=</span> <span class="n">outputPath</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">referenceVolumeNode</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;-label.nrrd&quot;</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">saveNode</span><span class="p">(</span><span class="n">labelmapVolumeNode</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">RemoveNode</span><span class="p">(</span><span class="n">labelmapVolumeNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">GetColorNode</span><span class="p">())</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">RemoveNode</span><span class="p">(</span><span class="n">labelmapVolumeNode</span><span class="p">)</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">delayDisplay</span><span class="p">(</span><span class="s2">&quot;Segmentation saved to &quot;</span> <span class="o">+</span> <span class="n">filepath</span><span class="p">)</span>

<span class="n">shortcut</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">QShortcut</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">())</span>
<span class="n">shortcut</span><span class="o">.</span><span class="n">setKey</span><span class="p">(</span><span class="n">qt</span><span class="o">.</span><span class="n">QKeySequence</span><span class="p">(</span><span class="s2">&quot;Ctrl+Shift+s&quot;</span><span class="p">))</span>
<span class="n">shortcut</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="s2">&quot;activated()&quot;</span><span class="p">,</span> <span class="n">exportLabelmap</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="import-export-labelmap-node-using-custom-label-value-mapping">
<h3>Import/export labelmap node using custom label value mapping<a class="headerlink" href="#import-export-labelmap-node-using-custom-label-value-mapping" title="Link to this heading"></a></h3>
<p>While in segmentation nodes segments are identified by segment ID, name, or terminology; in labelmap nodes a segment can be identified only by its label value.
Slicer can import a labelmap volume into segmentation, visualize/edit the segmentation, then export the segmentation into labelmap volume - preserving the label values in the output. This is achieved by using a color node during labelmap node import and export, which assigns a name for each label value. Segment corresponding to a label value is found by matching the color name to the segment name.</p>
<section id="create-color-table-node">
<h4>Create color table node<a class="headerlink" href="#create-color-table-node" title="Link to this heading"></a></h4>
<p>A color table node can be loaded from a <a class="reference internal" href="modules/colors.html#color-table-text-file-format-txt-ctbl"><span class="std std-ref">color table file</span></a> or created from scratch like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">segment_names_to_labels</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;ribs&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;right lung&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;left lung&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)]</span>

<span class="n">colorTableNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">CreateNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLColorTableNode&quot;</span><span class="p">)</span>
<span class="n">colorTableNode</span><span class="o">.</span><span class="n">SetTypeToUser</span><span class="p">()</span>
<span class="n">colorTableNode</span><span class="o">.</span><span class="n">HideFromEditorsOff</span><span class="p">()</span>  <span class="c1"># make the color table selectable in the GUI outside Colors module</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNode</span><span class="p">(</span><span class="n">colorTableNode</span><span class="p">);</span> <span class="n">colorTableNode</span><span class="o">.</span><span class="n">UnRegister</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="n">largestLabelValue</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">name_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">name_value</span> <span class="ow">in</span> <span class="n">segment_names_to_labels</span><span class="p">])</span>
<span class="n">colorTableNode</span><span class="o">.</span><span class="n">SetNumberOfColors</span><span class="p">(</span><span class="n">largestLabelValue</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="k">for</span> <span class="n">segmentName</span><span class="p">,</span> <span class="n">labelValue</span> <span class="ow">in</span> <span class="n">segment_names_to_labels</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">success</span> <span class="o">=</span> <span class="n">colorTableNode</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">labelValue</span><span class="p">,</span> <span class="n">segmentName</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="export-labelmap-node-from-segmentation-node-using-custom-label-value-mapping">
<h4>Export labelmap node from segmentation node using custom label value mapping<a class="headerlink" href="#export-labelmap-node-from-segmentation-node-using-custom-label-value-mapping" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">segmentationNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s1">&#39;Segmentation&#39;</span><span class="p">)</span>  <span class="c1"># source segmentation node</span>
<span class="n">labelmapVolumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLLabelMapVolumeNode&quot;</span><span class="p">)</span>  <span class="c1"># export to new labelmap volume</span>
<span class="n">referenceVolumeNode</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># it could be set to the master volume</span>
<span class="n">segmentIds</span> <span class="o">=</span> <span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetSegmentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetSegmentIDs</span><span class="p">()</span>  <span class="c1"># export all segments</span>
<span class="n">colorTableNode</span> <span class="o">=</span> <span class="o">...</span>  <span class="c1"># created from scratch or loaded from file</span>

<span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">segmentations</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">ExportSegmentsToLabelmapNode</span><span class="p">(</span><span class="n">segmentationNode</span><span class="p">,</span> <span class="n">segmentIds</span><span class="p">,</span> <span class="n">labelmapVolumeNode</span><span class="p">,</span> <span class="n">referenceVolumeNode</span><span class="p">,</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkSegmentation</span><span class="o">.</span><span class="n">EXTENT_REFERENCE_GEOMETRY</span><span class="p">,</span> <span class="n">colorTableNode</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="import-labelmap-node-into-segmentation-node-using-custom-label-value-mapping">
<h4>Import labelmap node into segmentation node using custom label value mapping<a class="headerlink" href="#import-labelmap-node-into-segmentation-node-using-custom-label-value-mapping" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">labelmapVolumeNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s1">&#39;Volume-label&#39;</span><span class="p">)</span>
<span class="n">segmentationNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLSegmentationNode&quot;</span><span class="p">)</span>  <span class="c1"># import into new segmentation node</span>
<span class="n">colorTableNode</span> <span class="o">=</span> <span class="o">...</span>  <span class="c1"># created from scratch or loaded from file</span>

<span class="n">labelmapVolumeNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetAndObserveColorNodeID</span><span class="p">(</span><span class="n">colorTableNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>  <span class="c1"># just in case the custom color table has not been already associated with the labelmap volume</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">segmentations</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">ImportLabelmapToSegmentationNode</span><span class="p">(</span><span class="n">labelmapVolumeNode</span><span class="p">,</span> <span class="n">segmentationNode</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="export-model-nodes-from-segmentation-node">
<h3>Export model nodes from segmentation node<a class="headerlink" href="#export-model-nodes-from-segmentation-node" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">segmentationNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Segmentation&quot;</span><span class="p">)</span>
<span class="n">shNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetSubjectHierarchyNode</span><span class="p">()</span>
<span class="n">exportFolderItemId</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">CreateFolderItem</span><span class="p">(</span><span class="n">shNode</span><span class="o">.</span><span class="n">GetSceneItemID</span><span class="p">(),</span> <span class="s2">&quot;Segments&quot;</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">segmentations</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">ExportAllSegmentsToModels</span><span class="p">(</span><span class="n">segmentationNode</span><span class="p">,</span> <span class="n">exportFolderItemId</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="create-a-hollow-model-from-boundary-of-solid-segment">
<h3>Create a hollow model from boundary of solid segment<a class="headerlink" href="#create-a-hollow-model-from-boundary-of-solid-segment" title="Link to this heading"></a></h3>
<p>In most cases, the most robust and flexible tool for creating empty shell models (e.g., vessel wall model from contrast agent segmentation) is the “Hollow” effect in Segment Editor module. However, for very thin shells, extrusion of the exported surface mesh representation may be just as robust and require less memory and computation time. In this case it may be a better approach to to export the segment to a mesh and extrude it along surface normal direction:</p>
<p>Example using Dynamic Modeler module (allows real-time update of parameters, using GUI in Dynamic Modeler module):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">segmentationNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Segmentation&quot;</span><span class="p">)</span>

<span class="c1"># Export segments to models</span>
<span class="n">shNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetSubjectHierarchyNode</span><span class="p">()</span>
<span class="n">exportFolderItemId</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">CreateFolderItem</span><span class="p">(</span><span class="n">shNode</span><span class="o">.</span><span class="n">GetSceneItemID</span><span class="p">(),</span> <span class="s2">&quot;Segments&quot;</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">segmentations</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">ExportAllSegmentsToModels</span><span class="p">(</span><span class="n">segmentationNode</span><span class="p">,</span> <span class="n">exportFolderItemId</span><span class="p">)</span>
<span class="n">segmentModels</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCollection</span><span class="p">()</span>
<span class="n">shNode</span><span class="o">.</span><span class="n">GetDataNodesInBranch</span><span class="p">(</span><span class="n">exportFolderItemId</span><span class="p">,</span> <span class="n">segmentModels</span><span class="p">)</span>
<span class="c1"># Get exported model of first segment</span>
<span class="n">modelNode</span> <span class="o">=</span> <span class="n">segmentModels</span><span class="o">.</span><span class="n">GetItemAsObject</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Set up Hollow tool</span>
<span class="n">hollowModeler</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLDynamicModelerNode&quot;</span><span class="p">)</span>
<span class="n">hollowModeler</span><span class="o">.</span><span class="n">SetToolName</span><span class="p">(</span><span class="s2">&quot;Hollow&quot;</span><span class="p">)</span>
<span class="n">hollowModeler</span><span class="o">.</span><span class="n">SetNodeReferenceID</span><span class="p">(</span><span class="s2">&quot;Hollow.InputModel&quot;</span><span class="p">,</span> <span class="n">modelNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
<span class="n">hollowedModelNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLModelNode&quot;</span><span class="p">)</span>  <span class="c1"># this node will store the hollow model</span>
<span class="n">hollowModeler</span><span class="o">.</span><span class="n">SetNodeReferenceID</span><span class="p">(</span><span class="s2">&quot;Hollow.OutputModel&quot;</span><span class="p">,</span> <span class="n">hollowedModelNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
<span class="n">hollowModeler</span><span class="o">.</span><span class="n">SetAttribute</span><span class="p">(</span><span class="s2">&quot;ShellThickness&quot;</span><span class="p">,</span> <span class="s2">&quot;2.5&quot;</span><span class="p">)</span>  <span class="c1"># grow outside</span>
<span class="n">hollowModeler</span><span class="o">.</span><span class="n">SetContinuousUpdate</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># auto-update output model if input parameters are changed</span>

<span class="c1"># Hide inputs, show output</span>
<span class="n">segmentation</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">modelNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">hollowedModelNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetOpacity</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<p>Example using VTK filters:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get closed surface representation of the segment</span>
<span class="n">shellThickness</span> <span class="o">=</span> <span class="mf">3.0</span>  <span class="c1"># mm</span>
<span class="n">segmentationNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Segmentation&quot;</span><span class="p">)</span>
<span class="n">segmentationNode</span><span class="o">.</span><span class="n">CreateClosedSurfaceRepresentation</span><span class="p">()</span>
<span class="n">polyData</span> <span class="o">=</span> <span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetClosedSurfaceInternalRepresentation</span><span class="p">(</span><span class="s2">&quot;Segment_1&quot;</span><span class="p">)</span>

<span class="c1"># Create shell</span>
<span class="n">extrude</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkLinearExtrusionFilter</span><span class="p">()</span>
<span class="n">extrude</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">polyData</span><span class="p">)</span>
<span class="n">extrude</span><span class="o">.</span><span class="n">SetExtrusionTypeToNormalExtrusion</span><span class="p">()</span>
<span class="n">extrude</span><span class="o">.</span><span class="n">SetScaleFactor</span><span class="p">(</span><span class="n">shellThickness</span><span class="p">)</span>

<span class="c1"># Compute consistent surface normals</span>
<span class="n">triangle_filter</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkTriangleFilter</span><span class="p">()</span>
<span class="n">triangle_filter</span><span class="o">.</span><span class="n">SetInputConnection</span><span class="p">(</span><span class="n">extrude</span><span class="o">.</span><span class="n">GetOutputPort</span><span class="p">())</span>
<span class="n">normals</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPolyDataNormals</span><span class="p">()</span>
<span class="n">normals</span><span class="o">.</span><span class="n">SetInputConnection</span><span class="p">(</span><span class="n">triangle_filter</span><span class="o">.</span><span class="n">GetOutputPort</span><span class="p">())</span>
<span class="n">normals</span><span class="o">.</span><span class="n">FlipNormalsOn</span><span class="p">()</span>

<span class="c1"># Save result into new model node</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">AddModel</span><span class="p">(</span><span class="n">normals</span><span class="o">.</span><span class="n">GetOutputPort</span><span class="p">())</span>
</pre></div>
</div>
</section>
<section id="show-a-segmentation-in-3d">
<h3>Show a segmentation in 3D<a class="headerlink" href="#show-a-segmentation-in-3d" title="Link to this heading"></a></h3>
<p>Segmentation can only be shown in 3D if closed surface representation (or other 3D-displayable representation) is available. To create closed surface representation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">segmentation</span><span class="o">.</span><span class="n">CreateClosedSurfaceRepresentation</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="modify-segmentation-display-options">
<h3>Modify segmentation display options<a class="headerlink" href="#modify-segmentation-display-options" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">segmentation</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s1">&#39;Segmentation&#39;</span><span class="p">)</span>
<span class="n">segmentID</span> <span class="o">=</span> <span class="s1">&#39;Segment_1&#39;</span>

<span class="n">displayNode</span> <span class="o">=</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span>
<span class="n">displayNode</span><span class="o">.</span><span class="n">SetOpacity3D</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>  <span class="c1"># Set overall opacity of the segmentation</span>
<span class="n">displayNode</span><span class="o">.</span><span class="n">SetSegmentOpacity3D</span><span class="p">(</span><span class="n">segmentID</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>  <span class="c1"># Set opacity of a single segment</span>

<span class="c1"># Segment color is not just a display property, but it is stored in the segment itself (and stored in the segmentation file)</span>
<span class="n">segment</span> <span class="o">=</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">GetSegmentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetSegment</span><span class="p">(</span><span class="n">segmentID</span><span class="p">)</span>
<span class="n">segment</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># red</span>

<span class="c1"># In very special cases (for example, when a segment&#39;s color only need to be changed in a specific view)</span>
<span class="c1"># the segment color can be overridden in the display node.</span>
<span class="c1"># This is not recommended for general use.</span>
<span class="n">displayNode</span><span class="o">.</span><span class="n">SetSegmentOverrideColor</span><span class="p">(</span><span class="n">segmentID</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># blue</span>
</pre></div>
</div>
</section>
<section id="get-a-representation-of-a-segment">
<h3>Get a representation of a segment<a class="headerlink" href="#get-a-representation-of-a-segment" title="Link to this heading"></a></h3>
<p>Access binary labelmap stored in a segmentation node (without exporting it to a volume node) - if it does not exist, it will return None:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">image</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkOrientedImageData</span><span class="p">()</span>
<span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetBinaryLabelmapRepresentation</span><span class="p">(</span><span class="n">segmentID</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
</pre></div>
</div>
<p>Get closed surface, if it does not exist, it will return None:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">outputPolyData</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPolyData</span><span class="p">()</span>
<span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetClosedSurfaceRepresentation</span><span class="p">(</span><span class="n">segmentID</span><span class="p">,</span> <span class="n">outputPolyData</span><span class="p">)</span>
</pre></div>
</div>
<p>Get binary labelmap representation. If it does not exist then it will be created for that single segment. Applies parent transforms by default (if not desired, another argument needs to be added to the end: false):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">vtkSegmentationCorePython</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">vtkSegmentationCore</span>
<span class="n">outputOrientedImageData</span> <span class="o">=</span> <span class="n">vtkSegmentationCore</span><span class="o">.</span><span class="n">vtkOrientedImageData</span><span class="p">()</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">vtkSlicerSegmentationsModuleLogic</span><span class="o">.</span><span class="n">GetSegmentBinaryLabelmapRepresentation</span><span class="p">(</span><span class="n">segmentationNode</span><span class="p">,</span> <span class="n">segmentID</span><span class="p">,</span> <span class="n">outputOrientedImageData</span><span class="p">)</span>
</pre></div>
</div>
<p>Same as above, for closed surface representation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">outputPolyData</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPolyData</span><span class="p">()</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">vtkSlicerSegmentationsModuleLogic</span><span class="o">.</span><span class="n">GetSegmentClosedSurfaceRepresentation</span><span class="p">(</span><span class="n">segmentationNode</span><span class="p">,</span> <span class="n">segmentID</span><span class="p">,</span> <span class="n">outputPolyData</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="convert-all-segments-using-default-path-and-conversion-parameters">
<h3>Convert all segments using default path and conversion parameters<a class="headerlink" href="#convert-all-segments-using-default-path-and-conversion-parameters" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">segmentationNode</span><span class="o">.</span><span class="n">CreateBinaryLabelmapRepresentation</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="convert-all-segments-using-custom-path-or-conversion-parameters">
<h3>Convert all segments using custom path or conversion parameters<a class="headerlink" href="#convert-all-segments-using-custom-path-or-conversion-parameters" title="Link to this heading"></a></h3>
<p>Change reference image geometry parameter based on an existing referenceImageData image:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">referenceGeometry</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkSegmentationConverter</span><span class="o">.</span><span class="n">SerializeImageGeometry</span><span class="p">(</span><span class="n">referenceImageData</span><span class="p">)</span>
<span class="n">segmentation</span><span class="o">.</span><span class="n">SetConversionParameter</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkSegmentationConverter</span><span class="o">.</span><span class="n">GetReferenceImageGeometryParameterName</span><span class="p">(),</span> <span class="n">referenceGeometry</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="re-convert-using-a-modified-conversion-parameter">
<h3>Re-convert using a modified conversion parameter<a class="headerlink" href="#re-convert-using-a-modified-conversion-parameter" title="Link to this heading"></a></h3>
<p>Changing smoothing factor for closed surface generation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">vtkSegmentationCorePython</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">vtkSegmentationCore</span>
<span class="n">segmentation</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Segmentation&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">GetSegmentation</span><span class="p">()</span>

<span class="c1"># Turn of surface smoothing</span>
<span class="n">segmentation</span><span class="o">.</span><span class="n">SetConversionParameter</span><span class="p">(</span><span class="s2">&quot;Smoothing factor&quot;</span><span class="p">,</span><span class="s2">&quot;0.0&quot;</span><span class="p">)</span>

<span class="c1"># Recreate representation using modified parameters (and default conversion path)</span>
<span class="n">segmentation</span><span class="o">.</span><span class="n">RemoveRepresentation</span><span class="p">(</span><span class="n">vtkSegmentationCore</span><span class="o">.</span><span class="n">vtkSegmentationConverter</span><span class="o">.</span><span class="n">GetSegmentationClosedSurfaceRepresentationName</span><span class="p">())</span>
<span class="n">segmentation</span><span class="o">.</span><span class="n">CreateRepresentation</span><span class="p">(</span><span class="n">vtkSegmentationCore</span><span class="o">.</span><span class="n">vtkSegmentationConverter</span><span class="o">.</span><span class="n">GetSegmentationClosedSurfaceRepresentationName</span><span class="p">())</span>
</pre></div>
</div>
</section>
<section id="create-keyboard-shortcut-for-toggling-sphere-brush-for-paint-and-erase-effects">
<h3>Create keyboard shortcut for toggling sphere brush for paint and erase effects<a class="headerlink" href="#create-keyboard-shortcut-for-toggling-sphere-brush-for-paint-and-erase-effects" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">toggleSphereBrush</span><span class="p">():</span>
  <span class="n">segmentEditorWidget</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">segmenteditor</span><span class="o">.</span><span class="n">widgetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">self</span><span class="p">()</span><span class="o">.</span><span class="n">editor</span>
  <span class="n">paintEffect</span> <span class="o">=</span> <span class="n">segmentEditorWidget</span><span class="o">.</span><span class="n">effectByName</span><span class="p">(</span><span class="s2">&quot;Paint&quot;</span><span class="p">)</span>
  <span class="n">isSphere</span> <span class="o">=</span> <span class="n">paintEffect</span><span class="o">.</span><span class="n">integerParameter</span><span class="p">(</span><span class="s2">&quot;BrushSphere&quot;</span><span class="p">)</span>
  <span class="c1"># BrushSphere is &quot;common&quot; parameter (shared between paint and erase)</span>
  <span class="n">paintEffect</span><span class="o">.</span><span class="n">setCommonParameter</span><span class="p">(</span><span class="s2">&quot;BrushSphere&quot;</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">isSphere</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">shortcut</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">QShortcut</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">())</span>
<span class="n">shortcut</span><span class="o">.</span><span class="n">setKey</span><span class="p">(</span><span class="n">qt</span><span class="o">.</span><span class="n">QKeySequence</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">))</span>
<span class="n">shortcut</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;activated()&quot;</span><span class="p">,</span> <span class="n">toggleSphereBrush</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="create-keyboard-shortcut-for-toggling-visibility-of-a-set-of-segments">
<h3>Create keyboard shortcut for toggling visibility of a set of segments<a class="headerlink" href="#create-keyboard-shortcut-for-toggling-visibility-of-a-set-of-segments" title="Link to this heading"></a></h3>
<p>This script toggles visibility of “completed” segments if Ctrl-k keyboard shortcut is pressed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">slicer</span><span class="o">.</span><span class="n">segmentationNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s1">&#39;Segmentation&#39;</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">toggledSegmentState</span><span class="o">=</span><span class="s2">&quot;completed&quot;</span>  <span class="c1"># it could be &quot;inprogress&quot;, &quot;completed&quot;, &quot;flagged&quot;</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">def</span><span class="w"> </span><span class="nf">toggleSegmentVisibility</span><span class="p">():</span>
    <span class="n">slicer</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">slicer</span><span class="o">.</span><span class="n">visibility</span>
    <span class="n">segmentation</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetSegmentation</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">segmentIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">segmentation</span><span class="o">.</span><span class="n">GetNumberOfSegments</span><span class="p">()):</span>
        <span class="n">segmentId</span> <span class="o">=</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">GetNthSegmentID</span><span class="p">(</span><span class="n">segmentIndex</span><span class="p">)</span>
        <span class="n">segmentationStatus</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">mutable</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">GetSegment</span><span class="p">(</span><span class="n">segmentId</span><span class="p">)</span><span class="o">.</span><span class="n">GetTag</span><span class="p">(</span><span class="s2">&quot;Segmentation.Status&quot;</span><span class="p">,</span> <span class="n">segmentationStatus</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">segmentationStatus</span> <span class="o">!=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">toggledSegmentState</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">slicer</span><span class="o">.</span><span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetSegmentVisibility</span><span class="p">(</span><span class="n">segmentId</span><span class="p">,</span> <span class="n">slicer</span><span class="o">.</span><span class="n">visibility</span><span class="p">)</span>

<span class="n">shortcut</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">QShortcut</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">())</span>
<span class="n">shortcut</span><span class="o">.</span><span class="n">setKey</span><span class="p">(</span><span class="n">qt</span><span class="o">.</span><span class="n">QKeySequence</span><span class="p">(</span><span class="s2">&quot;Ctrl+k&quot;</span><span class="p">))</span>
<span class="n">shortcut</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="s2">&quot;activated()&quot;</span><span class="p">,</span> <span class="n">toggleSegmentVisibility</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="customize-list-of-displayed-segment-editor-effects">
<h3>Customize list of displayed Segment editor effects<a class="headerlink" href="#customize-list-of-displayed-segment-editor-effects" title="Link to this heading"></a></h3>
<p>Only show Paint and Erase effects:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">segmentEditorWidget</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">segmenteditor</span><span class="o">.</span><span class="n">widgetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">self</span><span class="p">()</span><span class="o">.</span><span class="n">editor</span>
<span class="n">segmentEditorWidget</span><span class="o">.</span><span class="n">setEffectNameOrder</span><span class="p">([</span><span class="s2">&quot;Paint&quot;</span><span class="p">,</span> <span class="s2">&quot;Erase&quot;</span><span class="p">])</span>
<span class="n">segmentEditorWidget</span><span class="o">.</span><span class="n">unorderedEffectsVisible</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Show list of all available effect names:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">segmentEditorWidget</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">segmenteditor</span><span class="o">.</span><span class="n">widgetRepresentation</span><span class="p">()</span><span class="o">.</span><span class="n">self</span><span class="p">()</span><span class="o">.</span><span class="n">editor</span>
<span class="nb">print</span><span class="p">(</span><span class="n">segmentEditorWidget</span><span class="o">.</span><span class="n">availableEffectNames</span><span class="p">())</span>
</pre></div>
</div>
</section>
<section id="center-all-views-on-a-segment">
<h3>Center all views on a segment<a class="headerlink" href="#center-all-views-on-a-segment" title="Link to this heading"></a></h3>
<p>This example shows how to center all slice views and 3D views on a segment. The segment’s center is not the segment’s centroid, but the centroid of the largest island in the effect, because the centroid can be in an empty region if the segment is made up of multiple islands.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">segmentationNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Segmentation&quot;</span><span class="p">)</span>
<span class="n">segmentId</span> <span class="o">=</span> <span class="s2">&quot;Segment_2&quot;</span>

<span class="n">position</span> <span class="o">=</span> <span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetSegmentCenterRAS</span><span class="p">(</span><span class="n">segmentId</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>

<span class="c1"># Center slice views and cameras on this position</span>
<span class="k">for</span> <span class="n">sliceNode</span> <span class="ow">in</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNodesByClass</span><span class="p">(</span><span class="s1">&#39;vtkMRMLSliceNode&#39;</span><span class="p">):</span>
    <span class="n">sliceNode</span><span class="o">.</span><span class="n">JumpSliceByCentering</span><span class="p">(</span><span class="o">*</span><span class="n">position</span><span class="p">)</span>
<span class="k">for</span> <span class="n">camera</span> <span class="ow">in</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNodesByClass</span><span class="p">(</span><span class="s1">&#39;vtkMRMLCameraNode&#39;</span><span class="p">):</span>
    <span class="n">camera</span><span class="o">.</span><span class="n">SetFocalPoint</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="read-and-write-a-segment-as-a-numpy-array">
<h3>Read and write a segment as a numpy array<a class="headerlink" href="#read-and-write-a-segment-as-a-numpy-array" title="Link to this heading"></a></h3>
<p>This example shows how to read and write voxels of binary labelmap representation of a segment as a numpy array.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">volumeNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s1">&#39;MRHead&#39;</span><span class="p">)</span>
<span class="n">segmentationNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s1">&#39;Segmentation&#39;</span><span class="p">)</span>
<span class="n">segmentId</span> <span class="o">=</span> <span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetSegmentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetSegmentIdBySegmentName</span><span class="p">(</span><span class="s1">&#39;Segment_1&#39;</span><span class="p">)</span>

<span class="c1"># Get segment as numpy array</span>
<span class="n">segmentArray</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromSegmentBinaryLabelmap</span><span class="p">(</span><span class="n">segmentationNode</span><span class="p">,</span> <span class="n">segmentId</span><span class="p">,</span> <span class="n">volumeNode</span><span class="p">)</span>

<span class="c1"># Modify the segmentation</span>
<span class="n">segmentArray</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># clear the segmentation</span>
<span class="n">segmentArray</span><span class="p">[</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromVolume</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">80</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># create segment by simple thresholding of an image</span>
<span class="n">segmentArray</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="mi">80</span><span class="p">,</span> <span class="mi">40</span><span class="p">:</span><span class="mi">90</span><span class="p">,</span> <span class="mi">30</span><span class="p">:</span><span class="mi">70</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># fill a rectangular region using numpy indexing</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">updateSegmentBinaryLabelmapFromArray</span><span class="p">(</span><span class="n">segmentArray</span><span class="p">,</span> <span class="n">segmentationNode</span><span class="p">,</span> <span class="n">segmentId</span><span class="p">,</span> <span class="n">volumeNode</span><span class="p">)</span>
</pre></div>
</div>
<p>Segment arrays can also be used in numpy operations to read/write the corresponding region of a volume:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get voxels of a volume within the segmentation and compute some statistics</span>
<span class="n">volumeArray</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromVolume</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">)</span>
<span class="n">volumeVoxelsInSegmentArray</span> <span class="o">=</span> <span class="n">volumeArray</span><span class="p">[</span> <span class="n">segmentArray</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lowest voxel value in segment: </span><span class="si">{</span><span class="n">volumeVoxelsInSegmentArray</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Highest voxel value in segment: </span><span class="si">{</span><span class="n">volumeVoxelsInSegmentArray</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Modify the volume</span>
<span class="c1"># For example, increase the contrast inside the selected segment by a factor of 4x:</span>
<span class="n">volumeArray</span><span class="p">[</span> <span class="n">segmentArray</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span> <span class="n">volumeArray</span><span class="p">[</span> <span class="n">segmentArray</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
<span class="c1"># Indicate that we have completed modifications on the volume array</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromVolumeModified</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="get-centroid-of-a-segment-in-world-ras-coordinates">
<h3>Get centroid of a segment in world (RAS) coordinates<a class="headerlink" href="#get-centroid-of-a-segment-in-world-ras-coordinates" title="Link to this heading"></a></h3>
<p>This example shows how to get centroid of a segment in world coordinates and show that position in all slice views.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">segmentationNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Segmentation&quot;</span><span class="p">)</span>
<span class="n">segmentId</span> <span class="o">=</span> <span class="s2">&quot;Segment_1&quot;</span>

<span class="c1"># Get array voxel coordinates</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">seg</span><span class="o">=</span><span class="n">arrayFromSegment</span><span class="p">(</span><span class="n">segmentation_node</span><span class="p">,</span> <span class="n">segmentId</span><span class="p">)</span>
<span class="c1"># numpy array has voxel coordinates in reverse order (KJI instead of IJK)</span>
<span class="c1"># and the array is cropped to minimum size in the segmentation</span>
<span class="n">mean_KjiCropped</span> <span class="o">=</span> <span class="p">[</span><span class="n">coords</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">coords</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">seg</span><span class="p">)]</span>

<span class="c1"># Get segmentation voxel coordinates</span>
<span class="n">segImage</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkOrientedImageData</span><span class="p">()</span>
<span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetBinaryLabelmapRepresentation</span><span class="p">(</span><span class="n">segmentId</span><span class="p">,</span> <span class="n">segImage</span><span class="p">)</span>
<span class="n">segImageExtent</span> <span class="o">=</span> <span class="n">segImage</span><span class="o">.</span><span class="n">GetExtent</span><span class="p">()</span>
<span class="c1"># origin of the array in voxel coordinates is determined by the start extent</span>
<span class="n">mean_Ijk</span> <span class="o">=</span> <span class="p">[</span><span class="n">mean_KjiCropped</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">mean_KjiCropped</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mean_KjiCropped</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">segImageExtent</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">segImageExtent</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">segImageExtent</span><span class="p">[</span><span class="mi">4</span><span class="p">]])</span>

<span class="c1"># Get segmentation physical coordinates</span>
<span class="n">ijkToWorld</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMatrix4x4</span><span class="p">()</span>
<span class="n">segImage</span><span class="o">.</span><span class="n">GetImageToWorldMatrix</span><span class="p">(</span><span class="n">ijkToWorld</span><span class="p">)</span>
<span class="n">mean_World</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">ijkToWorld</span><span class="o">.</span><span class="n">MultiplyPoint</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_Ijk</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span> <span class="n">mean_World</span><span class="p">)</span>
<span class="n">mean_World</span> <span class="o">=</span> <span class="n">mean_World</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>

<span class="c1"># If segmentation node is transformed, apply that transform to get RAS coordinates</span>
<span class="n">transformWorldToRas</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkGeneralTransform</span><span class="p">()</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLTransformNode</span><span class="o">.</span><span class="n">GetTransformBetweenNodes</span><span class="p">(</span><span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetParentTransformNode</span><span class="p">(),</span> <span class="kc">None</span><span class="p">,</span> <span class="n">transformWorldToRas</span><span class="p">)</span>
<span class="n">mean_Ras</span> <span class="o">=</span> <span class="n">transformWorldToRas</span><span class="o">.</span><span class="n">TransformPoint</span><span class="p">(</span><span class="n">mean_World</span><span class="p">)</span>

<span class="c1"># Show mean position value and jump to it in all slice viewers</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mean_Ras</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">markups</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">JumpSlicesToLocation</span><span class="p">(</span><span class="n">mean_Ras</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mean_Ras</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mean_Ras</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="get-histogram-of-a-segmented-region">
<h3>Get histogram of a segmented region<a class="headerlink" href="#get-histogram-of-a-segmented-region" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate example input data (volumeNode, segmentationNode, segmentId)</span>
<span class="c1">################################################</span>

<span class="c1"># Load source volume</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">SampleData</span>
<span class="n">sampleDataLogic</span> <span class="o">=</span> <span class="n">SampleData</span><span class="o">.</span><span class="n">SampleDataLogic</span><span class="p">()</span>
<span class="n">volumeNode</span> <span class="o">=</span> <span class="n">sampleDataLogic</span><span class="o">.</span><span class="n">downloadMRBrainTumor1</span><span class="p">()</span>

<span class="c1"># Create segmentation</span>
<span class="n">segmentationNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLSegmentationNode</span><span class="p">()</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNode</span><span class="p">(</span><span class="n">segmentationNode</span><span class="p">)</span>
<span class="n">segmentationNode</span><span class="o">.</span><span class="n">CreateDefaultDisplayNodes</span><span class="p">()</span> <span class="c1"># only needed for display</span>
<span class="n">segmentationNode</span><span class="o">.</span><span class="n">SetReferenceImageGeometryParameterFromVolumeNode</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">)</span>

<span class="c1"># Create segment</span>
<span class="n">tumorSeed</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkSphereSource</span><span class="p">()</span>
<span class="n">tumorSeed</span><span class="o">.</span><span class="n">SetCenter</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>
<span class="n">tumorSeed</span><span class="o">.</span><span class="n">SetRadius</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
<span class="n">tumorSeed</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
<span class="n">segmentId</span> <span class="o">=</span> <span class="n">segmentationNode</span><span class="o">.</span><span class="n">AddSegmentFromClosedSurfaceRepresentation</span><span class="p">(</span><span class="n">tumorSeed</span><span class="o">.</span><span class="n">GetOutput</span><span class="p">(),</span> <span class="s2">&quot;Segment A&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span>

<span class="c1"># Compute histogram</span>
<span class="c1">################################################</span>

<span class="c1"># Get voxel values of volume in the segmented region</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">volumeArray</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromVolume</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">)</span>
<span class="n">segmentArray</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromSegmentBinaryLabelmap</span><span class="p">(</span><span class="n">segmentationNode</span><span class="p">,</span> <span class="n">segmentId</span><span class="p">,</span> <span class="n">volumeNode</span><span class="p">)</span>
<span class="n">segmentVoxels</span> <span class="o">=</span> <span class="n">volumeArray</span><span class="p">[</span><span class="n">segmentArray</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>

<span class="c1"># Compute histogram</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">histogram</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">segmentVoxels</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="c1"># Plot histogram</span>
<span class="c1">################################################</span>

<span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">histogram</span><span class="p">,</span> <span class="n">xColumnIndex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="get-segments-visible-at-a-selected-position">
<h3>Get segments visible at a selected position<a class="headerlink" href="#get-segments-visible-at-a-selected-position" title="Link to this heading"></a></h3>
<p>Show in the console names of segments visible at a markups control point position:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">segmentationNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetFirstNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLSegmentationNode&quot;</span><span class="p">)</span>
<span class="n">pointListNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetFirstNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLMarkupsFiducialNode&quot;</span><span class="p">)</span>
<span class="n">sliceViewLabel</span> <span class="o">=</span> <span class="s2">&quot;Red&quot;</span>  <span class="c1"># any slice view where segmentation node is visible works</span>

<span class="k">def</span><span class="w"> </span><span class="nf">printSegmentNames</span><span class="p">(</span><span class="n">unused1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unused2</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

  <span class="n">sliceViewNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetNodeByID</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;vtkMRMLSliceNode</span><span class="si">{</span><span class="n">sliceViewLabel</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="n">appLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">applicationLogic</span><span class="p">()</span>
  <span class="n">segmentationsDisplayableManager</span> <span class="o">=</span> <span class="n">appLogic</span><span class="o">.</span><span class="n">GetViewDisplayableManagerByClassName</span><span class="p">(</span><span class="n">sliceViewNode</span><span class="p">,</span> <span class="s2">&quot;vtkMRMLSegmentationsDisplayableManager2D&quot;</span><span class="p">)</span>
  <span class="n">ras</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">pointListNode</span><span class="o">.</span><span class="n">GetNthControlPointPositionWorld</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ras</span><span class="p">)</span>
  <span class="n">segmentIds</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkStringArray</span><span class="p">()</span>
  <span class="n">segmentationsDisplayableManager</span><span class="o">.</span><span class="n">GetVisibleSegmentsForPosition</span><span class="p">(</span><span class="n">ras</span><span class="p">,</span> <span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">(),</span> <span class="n">segmentIds</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">idIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">segmentIds</span><span class="o">.</span><span class="n">GetNumberOfValues</span><span class="p">()):</span>
    <span class="n">segment</span> <span class="o">=</span> <span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetSegmentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetSegment</span><span class="p">(</span><span class="n">segmentIds</span><span class="o">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">idIndex</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Segment found at position </span><span class="si">{0}</span><span class="s2">: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ras</span><span class="p">,</span> <span class="n">segment</span><span class="o">.</span><span class="n">GetName</span><span class="p">()))</span>

<span class="c1"># Observe markup node changes</span>
<span class="n">pointListNode</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLMarkupsPlaneNode</span><span class="o">.</span><span class="n">PointModifiedEvent</span><span class="p">,</span> <span class="n">printSegmentNames</span><span class="p">)</span>
<span class="n">printSegmentNames</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="set-default-segmentation-options">
<h3>Set default segmentation options<a class="headerlink" href="#set-default-segmentation-options" title="Link to this heading"></a></h3>
<p>Allow segments to overlap each other by default:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">defaultSegmentEditorNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLSegmentEditorNode</span><span class="p">()</span>
<span class="n">defaultSegmentEditorNode</span><span class="o">.</span><span class="n">SetOverwriteMode</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLSegmentEditorNode</span><span class="o">.</span><span class="n">OverwriteNone</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddDefaultNode</span><span class="p">(</span><span class="n">defaultSegmentEditorNode</span><span class="p">)</span>
</pre></div>
</div>
<p>To always make this the default, add the lines above to your <a class="reference internal" href="../user_guide/settings.html#application-startup-file"><span class="std std-ref">.slicerrc.py file</span></a>.</p>
</section>
<section id="how-to-run-segment-editor-effects-from-a-script">
<h3>How to run segment editor effects from a script<a class="headerlink" href="#how-to-run-segment-editor-effects-from-a-script" title="Link to this heading"></a></h3>
<p>Editor effects are complex because they need to handle changing source volumes, undo/redo, masking operations, etc. Therefore, it is recommended to use the effect by instantiating a qMRMLSegmentEditorWidget or use/extract processing logic of the effect and use that from a script.</p>
<section id="use-segment-editor-effects-from-script-qmrmlsegmenteditorwidget">
<h4>Use Segment editor effects from script (qMRMLSegmentEditorWidget)<a class="headerlink" href="#use-segment-editor-effects-from-script-qmrmlsegmenteditorwidget" title="Link to this heading"></a></h4>
<p>Examples:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://gist.github.com/lassoan/2d5a5b73645f65a5eb6f8d5f97abf31b">brain tumor segmentation using grow from seeds effect</a></p></li>
<li><p><a class="reference external" href="https://gist.github.com/lassoan/ef30bc27a22a648ead7f82243f5cc7d5">AI-assisted brain tumor segmentation</a></p></li>
<li><p><a class="reference external" href="https://gist.github.com/lassoan/1673b25d8e7913cbc245b4f09ed853f9">skin surface extraction using thresholding and smoothing</a></p></li>
<li><p><a class="reference external" href="https://gist.github.com/lassoan/2f5071c562108dac8efe277c78f2620f">mask a volume with segments and compute histogram for each region</a></p></li>
<li><p><a class="reference external" href="https://gist.github.com/lassoan/5ad51c89521d3cd9c5faf65767506b37">create fat/muscle/bone segment by thresholding and report volume of each segment</a></p></li>
<li><p><a class="reference external" href="https://gist.github.com/lassoan/4d0b94bda52d5b099432e424e03aa2b1">segment cranial cavity automatically in dry bone skull CT</a></p></li>
<li><p><a class="reference external" href="https://gist.github.com/lassoan/84d1f9a093dbb6a46c0fcc89279d8088">remove patient table from CT image</a></p></li>
<li><p><a class="reference external" href="https://gist.github.com/lassoan/0f45db8bae792ea19ccad36ceefbf52d">fill holes inside bones</a></p></li>
</ul>
<p>Description of effect parameters are available <a class="reference internal" href="modules/segmenteditor.html#effect-parameters"><span class="std std-ref">here</span></a>.</p>
</section>
<section id="use-logic-of-effect-from-a-script">
<h4>Use logic of effect from a script<a class="headerlink" href="#use-logic-of-effect-from-a-script" title="Link to this heading"></a></h4>
<p>This example shows how to perform operations on segmentations using VTK filters <em>extracted</em> from an effect:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://gist.github.com/lassoan/7c94c334653010696b2bf96abc0ac8e7">brain tumor segmentation using grow from seeds effect</a></p></li>
</ul>
</section>
</section>
<section id="process-segment-using-a-vtk-filter">
<h3>Process segment using a VTK filter<a class="headerlink" href="#process-segment-using-a-vtk-filter" title="Link to this heading"></a></h3>
<p>This example shows how to apply a VTK filter to a segment that dilates the image by a specified margin.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">segmentationNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Segmentation&quot;</span><span class="p">)</span>
<span class="n">segmentId</span> <span class="o">=</span> <span class="s2">&quot;Segment_1&quot;</span>
<span class="n">kernelSize</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>

<span class="c1"># Export segment as vtkImageData (via temporary labelmap volume node)</span>
<span class="n">segmentIds</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkStringArray</span><span class="p">()</span>
<span class="n">segmentIds</span><span class="o">.</span><span class="n">InsertNextValue</span><span class="p">(</span><span class="n">segmentId</span><span class="p">)</span>
<span class="n">labelmapVolumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLLabelMapVolumeNode&quot;</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">segmentations</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">ExportSegmentsToLabelmapNode</span><span class="p">(</span><span class="n">segmentationNode</span><span class="p">,</span> <span class="n">segmentIds</span><span class="p">,</span> <span class="n">labelmapVolumeNode</span><span class="p">)</span>

<span class="c1"># Process segmentation</span>
<span class="n">segmentImageData</span> <span class="o">=</span> <span class="n">labelmapVolumeNode</span><span class="o">.</span><span class="n">GetImageData</span><span class="p">()</span>
<span class="n">erodeDilate</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkImageDilateErode3D</span><span class="p">()</span>
<span class="n">erodeDilate</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">segmentImageData</span><span class="p">)</span>
<span class="n">erodeDilate</span><span class="o">.</span><span class="n">SetDilateValue</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">erodeDilate</span><span class="o">.</span><span class="n">SetErodeValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">erodeDilate</span><span class="o">.</span><span class="n">SetKernelSize</span><span class="p">(</span><span class="o">*</span><span class="n">kernelSize</span><span class="p">)</span>
<span class="n">erodeDilate</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
<span class="n">segmentImageData</span><span class="o">.</span><span class="n">DeepCopy</span><span class="p">(</span><span class="n">erodeDilate</span><span class="o">.</span><span class="n">GetOutput</span><span class="p">())</span>

<span class="c1"># Import segment from vtkImageData</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">segmentations</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">ImportLabelmapToSegmentationNode</span><span class="p">(</span><span class="n">labelmapVolumeNode</span><span class="p">,</span> <span class="n">segmentationNode</span><span class="p">,</span> <span class="n">segmentIds</span><span class="p">)</span>

<span class="c1"># Cleanup temporary nodes</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">RemoveNode</span><span class="p">(</span><span class="n">labelmapVolumeNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">GetColorNode</span><span class="p">())</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">RemoveNode</span><span class="p">(</span><span class="n">labelmapVolumeNode</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="use-segmentation-files-in-python-outside-slicer">
<h3>Use segmentation files in Python - outside Slicer<a class="headerlink" href="#use-segmentation-files-in-python-outside-slicer" title="Link to this heading"></a></h3>
<p>You can use <a class="reference external" href="https://pypi.org/project/slicerio/">slicerio</a> Python package (in any Python environment, not just within Slicer) to get information from segmentation (.seg.nrrd) files.</p>
<p>For example, a common need when training AI tools is to assemble data sets from various sources, which use different label values for the same segments.
If data sets are in .seg.nrrd format, then segment names or standard terminology can be used to identify segments and then assign label values consistently.</p>
<section id="extract-selected-segments-by-standard-terminology">
<h4>Extract selected segments by standard terminology<a class="headerlink" href="#extract-selected-segments-by-standard-terminology" title="Link to this heading"></a></h4>
<p><a class="reference external" href="https://github.com/lassoan/slicerio/blob/main/UsingStandardTerminology.md">Segments cannot be reliably identified using “name” (simple string label)</a>. Instead, it is recommended to use a standard terminology. This code snippet extracts selected segments from a segmentation and writes the result into a nrrd file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># pip install slicerio</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">slicerio</span>

<span class="n">input_filename</span> <span class="o">=</span> <span class="s2">&quot;path/to/Segmentation.seg.nrrd&quot;</span>
<span class="n">output_filename</span> <span class="o">=</span> <span class="s2">&quot;path/to/SegmentationExtracted.seg.nrrd&quot;</span>
<span class="n">segments_to_labels</span> <span class="o">=</span> <span class="p">[</span>
   <span class="p">({</span><span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;SCT&quot;</span><span class="p">,</span> <span class="s2">&quot;123037004&quot;</span><span class="p">,</span> <span class="s2">&quot;Anatomical Structure&quot;</span><span class="p">],</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;SCT&quot;</span><span class="p">,</span> <span class="s2">&quot;113197003&quot;</span><span class="p">,</span> <span class="s2">&quot;Ribs&quot;</span><span class="p">]},</span> <span class="mi">1</span><span class="p">),</span>
   <span class="p">({</span><span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;SCT&quot;</span><span class="p">,</span> <span class="s2">&quot;123037004&quot;</span><span class="p">,</span> <span class="s2">&quot;Anatomical Structure&quot;</span><span class="p">],</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;SCT&quot;</span><span class="p">,</span> <span class="s2">&quot;39607008&quot;</span><span class="p">,</span> <span class="s2">&quot;Lung&quot;</span><span class="p">],</span> <span class="s2">&quot;typeModifier&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;SCT&quot;</span><span class="p">,</span> <span class="s2">&quot;24028007&quot;</span><span class="p">,</span> <span class="s2">&quot;Right&quot;</span><span class="p">]},</span> <span class="mi">3</span><span class="p">)</span>
   <span class="p">]</span>

<span class="n">segmentation</span> <span class="o">=</span> <span class="n">slicerio</span><span class="o">.</span><span class="n">read_segmentation</span><span class="p">(</span><span class="n">input_filename</span><span class="p">)</span>
<span class="n">extracted_segmentation</span> <span class="o">=</span> <span class="n">slicerio</span><span class="o">.</span><span class="n">extract_segments</span><span class="p">(</span><span class="n">segmentation</span><span class="p">,</span> <span class="n">segments_to_labels</span><span class="p">)</span>
<span class="n">slicerio</span><span class="o">.</span><span class="n">write_segmentation</span><span class="p">(</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">extracted_segmentation</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="extract-selected-segments-by-segment-name">
<h4>Extract selected segments by segment name<a class="headerlink" href="#extract-selected-segments-by-segment-name" title="Link to this heading"></a></h4>
<p>This code snippet extracts selected segments from a segmentation by segment name and writes it into a nrrd file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># pip install slicerio</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">slicerio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">nrrd</span>

<span class="n">input_filename</span> <span class="o">=</span> <span class="s2">&quot;path/to/Segmentation.seg.nrrd&quot;</span>
<span class="n">output_filename</span> <span class="o">=</span> <span class="s2">&quot;path/to/SegmentationExtracted.seg.nrrd&quot;</span>
<span class="n">segment_names_to_labels</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;ribs&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;right lung&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;left lung&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)]</span>

<span class="c1"># Read voxels and metadata from a .seg.nrrd file</span>
<span class="n">voxels</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="n">nrrd</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">input_filename</span><span class="p">)</span>
<span class="c1"># Get selected segments in a 3D numpy array and updated segment metadata</span>
<span class="n">extracted_voxels</span><span class="p">,</span> <span class="n">extracted_header</span> <span class="o">=</span> <span class="n">slicerio</span><span class="o">.</span><span class="n">extract_segments</span><span class="p">(</span><span class="n">voxels</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">segmentation_info</span><span class="p">,</span> <span class="n">segment_names_to_labels</span><span class="p">)</span>
<span class="c1"># Write extracted segments and metadata to .seg.nrrd file</span>
<span class="n">nrrd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">extracted_voxels</span><span class="p">,</span> <span class="n">extracted_header</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="clone-a-segment">
<h3>Clone a segment<a class="headerlink" href="#clone-a-segment" title="Link to this heading"></a></h3>
<p>A copy of the segment can be created by using <code class="docutils literal notranslate"><span class="pre">CopySegmentFromSegmentation</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">segmentationNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Segmentation&quot;</span><span class="p">)</span>
<span class="n">sourceSegmentName</span> <span class="o">=</span> <span class="s2">&quot;Segment_1&quot;</span>

<span class="n">segmentation</span> <span class="o">=</span> <span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetSegmentation</span><span class="p">()</span>
<span class="n">sourceSegmentId</span> <span class="o">=</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">GetSegmentIdBySegmentName</span><span class="p">(</span><span class="n">sourceSegmentName</span><span class="p">)</span>
<span class="n">segmentation</span><span class="o">.</span><span class="n">CopySegmentFromSegmentation</span><span class="p">(</span><span class="n">segmentation</span><span class="p">,</span> <span class="n">sourceSegmentId</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="resample-segmentation-to-higher-resolution">
<h3>Resample segmentation to higher resolution<a class="headerlink" href="#resample-segmentation-to-higher-resolution" title="Link to this heading"></a></h3>
<p>This code snippet can be used to resample internal binary labelmap representation of a segmentation to allow segmenting finer details</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set inputs</span>
<span class="n">volumeNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;MRHead&quot;</span><span class="p">)</span>
<span class="n">segmentationNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Segmentation&quot;</span><span class="p">)</span>

<span class="c1"># The higher the oversampling factor is the finer resolution the segmentation will be,</span>
<span class="c1"># at the cost of more memory usage and longer computation times.</span>
<span class="c1"># Note that oversampling by a factor of 2 increases memory usage by a factor of 2 * 2 * 2 = 8.</span>
<span class="n">oversamplingFactor</span> <span class="o">=</span> <span class="mf">2.0</span>

<span class="c1"># Make spacing value uniform for all axes.</span>
<span class="c1"># It is useful for removing staircase artifacts in 3D reconstructions but may increase</span>
<span class="c1"># memory usage and computation time.</span>
<span class="n">isotropicSpacing</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Update geometry of internal binary labelmap representation in segmentation node</span>
<span class="n">segmentationGeometryLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkSlicerSegmentationGeometryLogic</span><span class="p">()</span>
<span class="n">segmentationGeometryLogic</span><span class="o">.</span><span class="n">SetInputSegmentationNode</span><span class="p">(</span><span class="n">segmentationNode</span><span class="p">)</span>
<span class="n">segmentationGeometryLogic</span><span class="o">.</span><span class="n">SetSourceGeometryNode</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">)</span>
<span class="n">segmentationGeometryLogic</span><span class="o">.</span><span class="n">SetOversamplingFactor</span><span class="p">(</span><span class="n">oversamplingFactor</span><span class="p">)</span>
<span class="n">segmentationGeometryLogic</span><span class="o">.</span><span class="n">SetIsotropicSpacing</span><span class="p">(</span><span class="n">isotropicSpacing</span><span class="p">)</span>
<span class="n">segmentationGeometryLogic</span><span class="o">.</span><span class="n">CalculateOutputGeometry</span><span class="p">()</span>
<span class="n">segmentationGeometryLogic</span><span class="o">.</span><span class="n">SetReferenceImageGeometryInSegmentationNode</span><span class="p">()</span>
<span class="n">segmentationGeometryLogic</span><span class="o">.</span><span class="n">ResampleLabelmapsInSegmentationNode</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="quantifying-segments">
<h3>Quantifying segments<a class="headerlink" href="#quantifying-segments" title="Link to this heading"></a></h3>
<section id="get-volume-of-each-segment">
<h4>Get volume of each segment<a class="headerlink" href="#get-volume-of-each-segment" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">segmentationNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Segmentation&quot;</span><span class="p">)</span>

<span class="c1"># Compute segment statistics</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">SegmentStatistics</span>
<span class="n">segStatLogic</span> <span class="o">=</span> <span class="n">SegmentStatistics</span><span class="o">.</span><span class="n">SegmentStatisticsLogic</span><span class="p">()</span>
<span class="n">segStatLogic</span><span class="o">.</span><span class="n">getParameterNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetParameter</span><span class="p">(</span><span class="s2">&quot;Segmentation&quot;</span><span class="p">,</span> <span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
<span class="n">segStatLogic</span><span class="o">.</span><span class="n">computeStatistics</span><span class="p">()</span>
<span class="n">stats</span> <span class="o">=</span> <span class="n">segStatLogic</span><span class="o">.</span><span class="n">getStatistics</span><span class="p">()</span>

<span class="c1"># Display volume of each segment</span>
<span class="k">for</span> <span class="n">segmentId</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;SegmentIDs&quot;</span><span class="p">]:</span>
  <span class="n">volume_cm3</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="n">segmentId</span><span class="p">,</span><span class="s2">&quot;LabelmapSegmentStatisticsPlugin.volume_cm3&quot;</span><span class="p">]</span>
  <span class="n">segmentName</span> <span class="o">=</span> <span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetSegmentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetSegment</span><span class="p">(</span><span class="n">segmentId</span><span class="p">)</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">segmentName</span><span class="si">}</span><span class="s2"> volume = </span><span class="si">{</span><span class="n">volume_cm3</span><span class="si">}</span><span class="s2"> cm3&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="get-centroid-of-each-segment">
<h4>Get centroid of each segment<a class="headerlink" href="#get-centroid-of-each-segment" title="Link to this heading"></a></h4>
<p>Place a markups control point at the centroid of each segment.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">segmentationNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Segmentation&quot;</span><span class="p">)</span>

<span class="c1"># Compute centroids</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">SegmentStatistics</span>
<span class="n">segStatLogic</span> <span class="o">=</span> <span class="n">SegmentStatistics</span><span class="o">.</span><span class="n">SegmentStatisticsLogic</span><span class="p">()</span>
<span class="n">segStatLogic</span><span class="o">.</span><span class="n">getParameterNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetParameter</span><span class="p">(</span><span class="s2">&quot;Segmentation&quot;</span><span class="p">,</span> <span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
<span class="n">segStatLogic</span><span class="o">.</span><span class="n">getParameterNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetParameter</span><span class="p">(</span><span class="s2">&quot;LabelmapSegmentStatisticsPlugin.centroid_ras.enabled&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
<span class="n">segStatLogic</span><span class="o">.</span><span class="n">computeStatistics</span><span class="p">()</span>
<span class="n">stats</span> <span class="o">=</span> <span class="n">segStatLogic</span><span class="o">.</span><span class="n">getStatistics</span><span class="p">()</span>

<span class="c1"># Place a markup point in each centroid</span>
<span class="n">pointListNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLMarkupsFiducialNode&quot;</span><span class="p">)</span>
<span class="n">pointListNode</span><span class="o">.</span><span class="n">CreateDefaultDisplayNodes</span><span class="p">()</span>
<span class="k">for</span> <span class="n">segmentId</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;SegmentIDs&quot;</span><span class="p">]:</span>
  <span class="n">centroid_ras</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="n">segmentId</span><span class="p">,</span><span class="s2">&quot;LabelmapSegmentStatisticsPlugin.centroid_ras&quot;</span><span class="p">]</span>
  <span class="n">segmentName</span> <span class="o">=</span> <span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetSegmentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetSegment</span><span class="p">(</span><span class="n">segmentId</span><span class="p">)</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span>
  <span class="n">pointListNode</span><span class="o">.</span><span class="n">AddFiducialFromArray</span><span class="p">(</span><span class="n">centroid_ras</span><span class="p">,</span> <span class="n">segmentName</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="get-size-position-and-orientation-of-each-segment">
<h4>Get size, position, and orientation of each segment<a class="headerlink" href="#get-size-position-and-orientation-of-each-segment" title="Link to this heading"></a></h4>
<p>Get oriented bounding box and display them using markups ROI node.</p>
<section id="markups-roi">
<h5>Markups ROI<a class="headerlink" href="#markups-roi" title="Link to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">segmentationNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Segmentation&quot;</span><span class="p">)</span>

<span class="c1"># Compute bounding boxes</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">SegmentStatistics</span>
<span class="n">segStatLogic</span> <span class="o">=</span> <span class="n">SegmentStatistics</span><span class="o">.</span><span class="n">SegmentStatisticsLogic</span><span class="p">()</span>
<span class="n">segStatLogic</span><span class="o">.</span><span class="n">getParameterNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetParameter</span><span class="p">(</span><span class="s2">&quot;Segmentation&quot;</span><span class="p">,</span> <span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
<span class="n">segStatLogic</span><span class="o">.</span><span class="n">getParameterNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetParameter</span><span class="p">(</span><span class="s2">&quot;LabelmapSegmentStatisticsPlugin.obb_origin_ras.enabled&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
<span class="n">segStatLogic</span><span class="o">.</span><span class="n">getParameterNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetParameter</span><span class="p">(</span><span class="s2">&quot;LabelmapSegmentStatisticsPlugin.obb_diameter_mm.enabled&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
<span class="n">segStatLogic</span><span class="o">.</span><span class="n">getParameterNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetParameter</span><span class="p">(</span><span class="s2">&quot;LabelmapSegmentStatisticsPlugin.obb_direction_ras_x.enabled&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
<span class="n">segStatLogic</span><span class="o">.</span><span class="n">getParameterNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetParameter</span><span class="p">(</span><span class="s2">&quot;LabelmapSegmentStatisticsPlugin.obb_direction_ras_y.enabled&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
<span class="n">segStatLogic</span><span class="o">.</span><span class="n">getParameterNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetParameter</span><span class="p">(</span><span class="s2">&quot;LabelmapSegmentStatisticsPlugin.obb_direction_ras_z.enabled&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
<span class="n">segStatLogic</span><span class="o">.</span><span class="n">computeStatistics</span><span class="p">()</span>
<span class="n">stats</span> <span class="o">=</span> <span class="n">segStatLogic</span><span class="o">.</span><span class="n">getStatistics</span><span class="p">()</span>

<span class="c1"># Draw ROI for each oriented bounding box</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="k">for</span> <span class="n">segmentId</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;SegmentIDs&quot;</span><span class="p">]:</span>
  <span class="c1"># Get bounding box</span>
  <span class="n">obb_origin_ras</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="n">segmentId</span><span class="p">,</span><span class="s2">&quot;LabelmapSegmentStatisticsPlugin.obb_origin_ras&quot;</span><span class="p">])</span>
  <span class="n">obb_diameter_mm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="n">segmentId</span><span class="p">,</span><span class="s2">&quot;LabelmapSegmentStatisticsPlugin.obb_diameter_mm&quot;</span><span class="p">])</span>
  <span class="n">obb_direction_ras_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="n">segmentId</span><span class="p">,</span><span class="s2">&quot;LabelmapSegmentStatisticsPlugin.obb_direction_ras_x&quot;</span><span class="p">])</span>
  <span class="n">obb_direction_ras_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="n">segmentId</span><span class="p">,</span><span class="s2">&quot;LabelmapSegmentStatisticsPlugin.obb_direction_ras_y&quot;</span><span class="p">])</span>
  <span class="n">obb_direction_ras_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="n">segmentId</span><span class="p">,</span><span class="s2">&quot;LabelmapSegmentStatisticsPlugin.obb_direction_ras_z&quot;</span><span class="p">])</span>
  <span class="c1"># Create ROI</span>
  <span class="n">segment</span> <span class="o">=</span> <span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetSegmentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetSegment</span><span class="p">(</span><span class="n">segmentId</span><span class="p">)</span>
  <span class="n">roi</span><span class="o">=</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLMarkupsROINode&quot;</span><span class="p">)</span>
  <span class="n">roi</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; OBB&quot;</span><span class="p">)</span>
  <span class="n">roi</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetHandlesInteractive</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># do not let the user resize the box</span>
  <span class="n">roi</span><span class="o">.</span><span class="n">SetSize</span><span class="p">(</span><span class="n">obb_diameter_mm</span><span class="p">)</span>
  <span class="c1"># Position and orient ROI using a transform</span>
  <span class="n">obb_center_ras</span> <span class="o">=</span> <span class="n">obb_origin_ras</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">obb_diameter_mm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">obb_direction_ras_x</span> <span class="o">+</span> <span class="n">obb_diameter_mm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">obb_direction_ras_y</span> <span class="o">+</span> <span class="n">obb_diameter_mm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">obb_direction_ras_z</span><span class="p">)</span>
  <span class="n">boundingBoxToRasTransform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">row_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">obb_direction_ras_x</span><span class="p">,</span> <span class="n">obb_direction_ras_y</span><span class="p">,</span> <span class="n">obb_direction_ras_z</span><span class="p">,</span> <span class="n">obb_center_ras</span><span class="p">)),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
  <span class="n">boundingBoxToRasTransformMatrix</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">vtkMatrixFromArray</span><span class="p">(</span><span class="n">boundingBoxToRasTransform</span><span class="p">)</span>
  <span class="n">roi</span><span class="o">.</span><span class="n">SetAndObserveObjectToNodeMatrix</span><span class="p">(</span><span class="n">boundingBoxToRasTransformMatrix</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Complete list of available segment statistics parameters can be obtained by running <code class="docutils literal notranslate"><span class="pre">segStatLogic.getParameterNode().GetParameterNames()</span></code>.</p>
</div>
</section>
</section>
</section>
</section>
<section id="registration">
<h2>Registration<a class="headerlink" href="#registration" title="Link to this heading"></a></h2>
<section id="register-two-images-with-brainsfit">
<h3>Register two images with BRAINSFit<a class="headerlink" href="#register-two-images-with-brainsfit" title="Link to this heading"></a></h3>
<p>Register two brain MRI images of the same patient acquired at different timepoints using BRAINSFit (“General registration (BRAINS)” module).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get sample input data</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">SampleData</span>
<span class="n">sampleDataLogic</span> <span class="o">=</span> <span class="n">SampleData</span><span class="o">.</span><span class="n">SampleDataLogic</span><span class="p">()</span>
<span class="n">fixedVolumeNode</span> <span class="o">=</span> <span class="n">sampleDataLogic</span><span class="o">.</span><span class="n">downloadMRBrainTumor1</span><span class="p">()</span>
<span class="n">movingVolumeNode</span> <span class="o">=</span> <span class="n">sampleDataLogic</span><span class="o">.</span><span class="n">downloadMRBrainTumor2</span><span class="p">()</span>
<span class="c1"># Create new nodes for output</span>
<span class="n">transformedMovingVolumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLScalarVolumeNode&quot;</span><span class="p">)</span>
<span class="n">transformNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLTransformNode&quot;</span><span class="p">)</span>

<span class="c1"># Run registration</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;fixedVolume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fixedVolumeNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">()</span>
<span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;movingVolume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">movingVolumeNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">()</span>
<span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;outputVolume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transformedMovingVolumeNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">()</span>
<span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;linearTransform&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transformNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">()</span>
<span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;useRigid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># options include: &quot;useRigid&quot;, &quot;useAffine&quot;, &quot;useBSpline&quot;</span>
<span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;initializeTransformMode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;useGeometryAlign&quot;</span>
<span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;samplingPercentage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.02</span>
<span class="n">cliBrainsFitRigidNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">brainsfit</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">wait_for_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Display fused result. Computed transformNode is automatically applied to the movingVolumeNode.</span>
<span class="c1"># Ctrl + left-click-and-drag up/down to change opacity in slice views.</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">setSliceViewerLayers</span><span class="p">(</span><span class="n">fixedVolumeNode</span><span class="p">,</span> <span class="n">movingVolumeNode</span><span class="p">,</span> <span class="n">foregroundOpacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<p>All parameters for BRAINSFit can be found <a class="reference external" href="https://github.com/BRAINSia/BRAINSTools/blob/main/BRAINSFit/BRAINSFit.xml">here</a>.
The module can register any kind of images, not just brains, but for general-purpose registration extensions consider using more robust registration tools, such as SlicerElastix and SlicerANTs extensions.</p>
</section>
</section>
<section id="sequences">
<h2>Sequences<a class="headerlink" href="#sequences" title="Link to this heading"></a></h2>
<section id="access-voxels-of-a-4d-volume-as-numpy-array">
<h3>Access voxels of a 4D volume as numpy array<a class="headerlink" href="#access-voxels-of-a-4d-volume-as-numpy-array" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get sequence node</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">SampleData</span>
<span class="n">sequenceNode</span> <span class="o">=</span> <span class="n">SampleData</span><span class="o">.</span><span class="n">SampleDataLogic</span><span class="p">()</span><span class="o">.</span><span class="n">downloadSample</span><span class="p">(</span><span class="s2">&quot;CTPCardioSeq&quot;</span><span class="p">)</span>
<span class="c1"># Alternatively, get the first sequence node in the scene:</span>
<span class="c1"># sequenceNode = slicer.util.getNodesByClass(&quot;vtkMRMLSequenceNode&quot;)</span>

<span class="c1"># Get voxels of itemIndex&#39;th volume as numpy array</span>
<span class="n">itemIndex</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">voxelArray</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromVolume</span><span class="p">(</span><span class="n">sequenceNode</span><span class="o">.</span><span class="n">GetNthDataNode</span><span class="p">(</span><span class="n">itemIndex</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="access-voxels-of-a-4d-volume-as-a-single-numpy-array">
<h3>Access voxels of a 4D volume as a single numpy array<a class="headerlink" href="#access-voxels-of-a-4d-volume-as-a-single-numpy-array" title="Link to this heading"></a></h3>
<p>Get all voxels of a 4D volume (3D volume sequence) as a numpy array called <code class="docutils literal notranslate"><span class="pre">voxelArray</span></code>. Dimensions of the array: <code class="docutils literal notranslate"><span class="pre">k</span></code>, <code class="docutils literal notranslate"><span class="pre">j</span></code>, <code class="docutils literal notranslate"><span class="pre">i</span></code>, <code class="docutils literal notranslate"><span class="pre">t</span></code> (first three are voxel coordinates, fourth is the volume index).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sequenceNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetFirstNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLSequenceNode&quot;</span><span class="p">)</span>

<span class="c1"># Preallocate a 4D numpy array that will hold the entire sequence</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">dims</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromVolume</span><span class="p">(</span><span class="n">sequenceNode</span><span class="o">.</span><span class="n">GetNthDataNode</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">shape</span>
<span class="n">voxelArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">sequenceNode</span><span class="o">.</span><span class="n">GetNumberOfDataNodes</span><span class="p">()])</span>
<span class="c1"># Fill in the 4D array from the sequence node</span>
<span class="k">for</span> <span class="n">volumeIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sequenceNode</span><span class="o">.</span><span class="n">GetNumberOfDataNodes</span><span class="p">()):</span>
    <span class="n">voxelArray</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">volumeIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromVolume</span><span class="p">(</span><span class="n">sequenceNode</span><span class="o">.</span><span class="n">GetNthDataNode</span><span class="p">(</span><span class="n">volumeIndex</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="get-index-value">
<h3>Get index value<a class="headerlink" href="#get-index-value" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Index value of </span><span class="si">{0}</span><span class="s2">th item: </span><span class="si">{1}</span><span class="s2"> = </span><span class="si">{2}</span><span class="s2"> </span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
  <span class="n">itemIndex</span><span class="p">,</span>
  <span class="n">sequenceNode</span><span class="o">.</span><span class="n">GetIndexName</span><span class="p">(),</span>
  <span class="n">sequenceNode</span><span class="o">.</span><span class="n">GetNthIndexValue</span><span class="p">(</span><span class="n">itemIndex</span><span class="p">),</span>
  <span class="n">sequenceNode</span><span class="o">.</span><span class="n">GetIndexUnit</span><span class="p">()))</span>
</pre></div>
</div>
</section>
<section id="browse-a-sequence-and-access-currently-displayed-nodes">
<h3>Browse a sequence and access currently displayed nodes<a class="headerlink" href="#browse-a-sequence-and-access-currently-displayed-nodes" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get a sequence node</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">SampleData</span>
<span class="n">sequenceNode</span> <span class="o">=</span> <span class="n">SampleData</span><span class="o">.</span><span class="n">SampleDataLogic</span><span class="p">()</span><span class="o">.</span><span class="n">downloadSample</span><span class="p">(</span><span class="s2">&quot;CTPCardioSeq&quot;</span><span class="p">)</span>

<span class="c1"># Find corresponding sequence browser node</span>
<span class="n">browserNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">GetFirstBrowserNodeForSequenceNode</span><span class="p">(</span><span class="n">sequenceNode</span><span class="p">)</span>

<span class="c1"># Print sequence information</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of items in the sequence: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">browserNode</span><span class="o">.</span><span class="n">GetNumberOfItems</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Index name: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">browserNode</span><span class="o">.</span><span class="n">GetMasterSequenceNode</span><span class="p">()</span><span class="o">.</span><span class="n">GetIndexName</span><span class="p">()))</span>

<span class="c1"># Jump to a selected sequence item</span>
<span class="n">browserNode</span><span class="o">.</span><span class="n">SetSelectedItemNumber</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Get currently displayed volume node voxels as numpy array</span>
<span class="n">volumeNode</span> <span class="o">=</span> <span class="n">browserNode</span><span class="o">.</span><span class="n">GetProxyNode</span><span class="p">(</span><span class="n">sequenceNode</span><span class="p">)</span>
<span class="n">voxelArray</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromVolume</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="concatenate-all-sequences-in-the-scene-into-a-new-sequence">
<h3>Concatenate all sequences in the scene into a new sequence<a class="headerlink" href="#concatenate-all-sequences-in-the-scene-into-a-new-sequence" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get all sequence nodes in the scene</span>
<span class="n">sequenceNodes</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNodesByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLSequenceNode&quot;</span><span class="p">)</span>
<span class="n">mergedSequenceNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLSequenceNode&quot;</span><span class="p">,</span> <span class="s2">&quot;Merged sequence&quot;</span><span class="p">)</span>

<span class="c1"># Merge all sequence nodes into a new sequence node</span>
<span class="n">mergedIndexValue</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">sequenceNode</span> <span class="ow">in</span> <span class="n">sequenceNodes</span><span class="p">:</span>
  <span class="k">for</span> <span class="n">itemIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sequenceNode</span><span class="o">.</span><span class="n">GetNumberOfDataNodes</span><span class="p">()):</span>
    <span class="n">dataNode</span> <span class="o">=</span> <span class="n">sequenceNode</span><span class="o">.</span><span class="n">GetNthDataNode</span><span class="p">(</span><span class="n">itemIndex</span><span class="p">)</span>
    <span class="n">mergedSequenceNode</span><span class="o">.</span><span class="n">SetDataNodeAtValue</span><span class="p">(</span><span class="n">dataNode</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">mergedIndexValue</span><span class="p">))</span>
    <span class="n">mergedIndexValue</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="c1"># Delete the sequence node we copied the data from, to prevent sharing of the same</span>
  <span class="c1"># node by multiple sequences</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">RemoveNode</span><span class="p">(</span><span class="n">sequenceNode</span><span class="p">)</span>

<span class="c1"># Create a sequence browser node for the new merged sequence</span>
<span class="n">mergedSequenceBrowserNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLSequenceBrowserNode&quot;</span><span class="p">,</span> <span class="s2">&quot;Merged&quot;</span><span class="p">)</span>
<span class="n">mergedSequenceBrowserNode</span><span class="o">.</span><span class="n">AddSynchronizedSequenceNode</span><span class="p">(</span><span class="n">mergedSequenceNode</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">toolBar</span><span class="p">()</span><span class="o">.</span><span class="n">setActiveBrowserNode</span><span class="p">(</span><span class="n">mergedSequenceBrowserNode</span><span class="p">)</span>
<span class="c1"># Show proxy node in slice viewers</span>
<span class="n">mergedProxyNode</span> <span class="o">=</span> <span class="n">mergedSequenceBrowserNode</span><span class="o">.</span><span class="n">GetProxyNode</span><span class="p">(</span><span class="n">mergedSequenceNode</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">setSliceViewerLayers</span><span class="p">(</span><span class="n">background</span><span class="o">=</span><span class="n">mergedProxyNode</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="plot-segments-average-intensity-over-time">
<h3>Plot segments average intensity over time<a class="headerlink" href="#plot-segments-average-intensity-over-time" title="Link to this heading"></a></h3>
<p>This code snippet can be used to plot average intensity in specific regions (designated using segments in a segmentation node) of a volume sequence over time.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># inputs</span>
<span class="n">volumeSequenceProxyNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetFirstNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLScalarVolumeNode&quot;</span><span class="p">)</span>
<span class="n">segmentationNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetFirstNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLSegmentationNode&quot;</span><span class="p">)</span>

<span class="c1"># get volume sequence as numpy array</span>
<span class="n">volumeSequenceBrowserNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">GetFirstBrowserNodeForProxyNode</span><span class="p">(</span><span class="n">volumeSequenceProxyNode</span><span class="p">)</span>
<span class="n">volumeSequenceNode</span> <span class="o">=</span> <span class="n">volumeSequenceBrowserNode</span><span class="o">.</span><span class="n">GetSequenceNode</span><span class="p">(</span><span class="n">volumeSequenceProxyNode</span><span class="p">)</span>

<span class="c1"># get voxels of visible segments as numpy arrays</span>
<span class="n">segmentNames</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">segmentArrays</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">visibleSegmentIds</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkStringArray</span><span class="p">()</span>
<span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">GetVisibleSegmentIDs</span><span class="p">(</span><span class="n">visibleSegmentIds</span><span class="p">)</span>
<span class="k">for</span> <span class="n">segmentIdIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">visibleSegmentIds</span><span class="o">.</span><span class="n">GetNumberOfValues</span><span class="p">()):</span>
    <span class="n">segmentId</span> <span class="o">=</span> <span class="n">visibleSegmentIds</span><span class="o">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">segmentIdIndex</span><span class="p">)</span>
    <span class="n">segmentArrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromSegmentBinaryLabelmap</span><span class="p">(</span><span class="n">segmentationNode</span><span class="p">,</span> <span class="n">segmentId</span><span class="p">,</span> <span class="n">volumeSequenceProxyNode</span><span class="p">))</span>
    <span class="n">segmentNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetSegmentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetSegment</span><span class="p">(</span><span class="n">segmentId</span><span class="p">)</span><span class="o">.</span><span class="n">GetName</span><span class="p">())</span>

<span class="c1"># Create table that will contain time values and mean intensity value for each segment for each time point</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">intensityTable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">volumeSequenceNode</span><span class="o">.</span><span class="n">GetNumberOfDataNodes</span><span class="p">(),</span> <span class="nb">len</span><span class="p">(</span><span class="n">segmentArrays</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
<span class="n">intensityTableTimeColumn</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">intensityTableColumnNames</span> <span class="o">=</span> <span class="p">[</span><span class="n">volumeSequenceNode</span><span class="o">.</span><span class="n">GetIndexName</span><span class="p">()]</span> <span class="o">+</span> <span class="n">segmentNames</span>
<span class="k">for</span> <span class="n">volumeIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">volumeSequenceNode</span><span class="o">.</span><span class="n">GetNumberOfDataNodes</span><span class="p">()):</span>
    <span class="n">intensityTable</span><span class="p">[</span><span class="n">volumeIndex</span><span class="p">,</span> <span class="n">intensityTableTimeColumn</span><span class="p">]</span> <span class="o">=</span> <span class="n">volumeSequenceNode</span><span class="o">.</span><span class="n">GetNthIndexValue</span><span class="p">(</span><span class="n">volumeIndex</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">segmentIndex</span><span class="p">,</span> <span class="n">segmentArray</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">segmentArrays</span><span class="p">):</span>
        <span class="n">voxelArray</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromVolume</span><span class="p">(</span><span class="n">volumeSequenceNode</span><span class="o">.</span><span class="n">GetNthDataNode</span><span class="p">(</span><span class="n">volumeIndex</span><span class="p">))</span>
        <span class="n">intensityTable</span><span class="p">[</span><span class="n">volumeIndex</span><span class="p">,</span> <span class="n">segmentIndex</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">voxelArray</span><span class="p">[</span><span class="n">segmentArray</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># Plot results</span>
<span class="n">plotNodes</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">intensityTable</span><span class="p">,</span> <span class="n">intensityTableTimeColumn</span><span class="p">,</span> <span class="n">intensityTableColumnNames</span><span class="p">,</span> <span class="s2">&quot;Intensity&quot;</span><span class="p">,</span> <span class="n">nodes</span><span class="o">=</span><span class="n">plotNodes</span><span class="p">)</span>
<span class="c1"># Set color and name of plots to match segment names and colors</span>
<span class="k">for</span> <span class="n">segmentIdIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">visibleSegmentIds</span><span class="o">.</span><span class="n">GetNumberOfValues</span><span class="p">()):</span>
    <span class="n">segment</span> <span class="o">=</span> <span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetSegmentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetSegment</span><span class="p">(</span><span class="n">visibleSegmentIds</span><span class="o">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">segmentIdIndex</span><span class="p">))</span>
    <span class="n">seriesNode</span> <span class="o">=</span> <span class="n">plotNodes</span><span class="p">[</span><span class="s1">&#39;series&#39;</span><span class="p">][</span><span class="n">segmentIdIndex</span><span class="p">]</span>
    <span class="n">seriesNode</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">GetColor</span><span class="p">())</span>
    <span class="n">seriesNode</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">GetName</span><span class="p">())</span>
</pre></div>
</div>
</section>
<section id="export-nodes-warped-by-transform-sequence">
<h3>Export nodes warped by transform sequence<a class="headerlink" href="#export-nodes-warped-by-transform-sequence" title="Link to this heading"></a></h3>
<p>Warp a segmentation with a sequence of transforms and write each transformed segmentation to a ply file. It can be used on sequence registration results created as shown in this <a class="reference external" href="https://youtu.be/qVgXdXEEVFU">tutorial video</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Inputs</span>
<span class="n">transformSequenceNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;OutputTransforms&quot;</span><span class="p">)</span>
<span class="n">segmentationNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Segmentation&quot;</span><span class="p">)</span>
<span class="n">segmentIndex</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">outputFilePrefix</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;c:/tmp/20220312/seg&quot;</span>

<span class="c1"># Ensure the segmentation contains closed surface representation</span>
<span class="n">segmentationNode</span><span class="o">.</span><span class="n">CreateClosedSurfaceRepresentation</span><span class="p">()</span>
<span class="c1"># Create temporary node that will be warped</span>
<span class="n">segmentModelNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s1">&#39;vtkMRMLModelNode&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">itemIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">transformSequenceNode</span><span class="o">.</span><span class="n">GetNumberOfDataNodes</span><span class="p">()):</span>
  <span class="c1"># Get a copy of the segment that will be transformed</span>
  <span class="n">segment</span> <span class="o">=</span> <span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetSegmentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetNthSegment</span><span class="p">(</span><span class="n">segmentIndex</span><span class="p">)</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">segmentations</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">ExportSegmentToRepresentationNode</span><span class="p">(</span><span class="n">segment</span><span class="p">,</span> <span class="n">segmentModelNode</span><span class="p">)</span>
  <span class="c1"># Apply the transform</span>
  <span class="n">transform</span> <span class="o">=</span> <span class="n">transformSequenceNode</span><span class="o">.</span><span class="n">GetNthDataNode</span><span class="p">(</span><span class="n">itemIndex</span><span class="p">)</span><span class="o">.</span><span class="n">GetTransformToParent</span><span class="p">()</span>
  <span class="n">segmentModelNode</span><span class="o">.</span><span class="n">ApplyTransform</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span>
  <span class="c1"># Write to file</span>
  <span class="n">outputFileName</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outputFilePrefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">itemIndex</span><span class="si">:</span><span class="s2">03</span><span class="si">}</span><span class="s2">.ply&quot;</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">outputFileName</span><span class="p">)</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">saveNode</span><span class="p">(</span><span class="n">segmentModelNode</span><span class="p">,</span> <span class="n">outputFileName</span><span class="p">)</span>

<span class="c1"># Delete temporary node</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">RemoveNode</span><span class="p">(</span><span class="n">segmentModelNode</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="create-a-4d-volume-in-python-outside-slicer">
<h3>Create a 4D volume in Python - outside Slicer<a class="headerlink" href="#create-a-4d-volume-in-python-outside-slicer" title="Link to this heading"></a></h3>
<p>You can write a seq.nrrd file (that Slicer can load as a volume sequence) from an img numpy array of with dimensions <code class="docutils literal notranslate"><span class="pre">t</span></code>, <code class="docutils literal notranslate"><span class="pre">i</span></code>, <code class="docutils literal notranslate"><span class="pre">j</span></code>, <code class="docutils literal notranslate"><span class="pre">k</span></code> (volume index, followed by voxel coordinates). <code class="docutils literal notranslate"><span class="pre">space</span> <span class="pre">origin</span></code> specifies the image origin. <code class="docutils literal notranslate"><span class="pre">space</span> <span class="pre">directions</span></code> specify the image axis directions and spacing (spacing is the Euclidean norm of the axis vector).</p>
<p>Prerequisite: install <a class="reference external" href="https://pypi.org/project/pynrrd/">pynrrd</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">nrrd</span>
<span class="n">header</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">,</span>
    <span class="s1">&#39;dimension&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s1">&#39;space&#39;</span><span class="p">:</span> <span class="s1">&#39;right-anterior-superior&#39;</span><span class="p">,</span>
    <span class="s1">&#39;space directions&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)],</span> <span class="p">[</span><span class="mf">1.953125</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.953125</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.953125</span><span class="p">]],</span>
    <span class="s1">&#39;kinds&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;domain&#39;</span><span class="p">,</span> <span class="s1">&#39;domain&#39;</span><span class="p">,</span> <span class="s1">&#39;domain&#39;</span><span class="p">],</span>
    <span class="s1">&#39;labels&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;frame&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">],</span>
    <span class="s1">&#39;endian&#39;</span><span class="p">:</span> <span class="s1">&#39;little&#39;</span><span class="p">,</span>
    <span class="s1">&#39;encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;raw&#39;</span><span class="p">,</span>
    <span class="s1">&#39;space origin&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">137.16099548</span><span class="p">,</span>  <span class="o">-</span><span class="mf">36.80649948</span><span class="p">,</span> <span class="o">-</span><span class="mf">309.71899414</span><span class="p">],</span>
    <span class="s1">&#39;measurement frame&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]],</span>
    <span class="s1">&#39;axis 0 index type&#39;</span><span class="p">:</span> <span class="s1">&#39;numeric&#39;</span><span class="p">,</span>
    <span class="s1">&#39;axis 0 index values&#39;</span><span class="p">:</span> <span class="s1">&#39;0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25&#39;</span>
<span class="p">}</span>
<span class="n">nrrd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;c:/tmp/test.seq.nrrd&quot;</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">header</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="subject-hierarchy">
<h2>Subject hierarchy<a class="headerlink" href="#subject-hierarchy" title="Link to this heading"></a></h2>
<section id="get-the-pseudo-singleton-subject-hierarchy-node">
<h3>Get the pseudo-singleton subject hierarchy node<a class="headerlink" href="#get-the-pseudo-singleton-subject-hierarchy-node" title="Link to this heading"></a></h3>
<p>It manages the whole hierarchy and provides functions to access and manipulate</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">shNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetSubjectHierarchyNode</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="create-subject-hierarchy-item">
<h3>Create subject hierarchy item<a class="headerlink" href="#create-subject-hierarchy-item" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># If it is for a data node, it is automatically created, but the create function can be used to set parent:</span>
<span class="n">shNode</span><span class="o">.</span><span class="n">CreateItem</span><span class="p">(</span><span class="n">parentItemID</span><span class="p">,</span> <span class="n">dataNode</span><span class="p">)</span>
<span class="c1"># If it is a hierarchy item without a data node, then the create function must be used:</span>
<span class="n">shNode</span><span class="o">.</span><span class="n">CreateSubjectItem</span><span class="p">(</span><span class="n">parentItemID</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="n">shNode</span><span class="o">.</span><span class="n">CreateFolderItem</span><span class="p">(</span><span class="n">parentItemID</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="n">shNode</span><span class="o">.</span><span class="n">CreateHierarchyItem</span><span class="p">(</span><span class="n">parentItemID</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span> <span class="c1"># Advanced method to set level attribute manually (usually subject, study, or folder, but it can be a virtual branch for example)</span>
</pre></div>
</div>
</section>
<section id="get-subject-hierarchy-item">
<h3>Get subject hierarchy item<a class="headerlink" href="#get-subject-hierarchy-item" title="Link to this heading"></a></h3>
<p>Items in subject hierarchy are uniquely identified by integer IDs</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get scene item ID first because it is the root item:</span>
<span class="n">sceneItemID</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">GetSceneItemID</span><span class="p">()</span>
<span class="c1"># Get direct child by name</span>
<span class="n">subjectItemID</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemChildWithName</span><span class="p">(</span><span class="n">sceneItemID</span><span class="p">,</span> <span class="s2">&quot;Subject_1&quot;</span><span class="p">)</span>
<span class="c1"># Get item for data node</span>
<span class="n">itemID</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemByDataNode</span><span class="p">(</span><span class="n">dataNode</span><span class="p">)</span>
<span class="c1"># Get item by UID (such as DICOM)</span>
<span class="n">itemID</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemByUID</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLSubjectHierarchyConstants</span><span class="o">.</span><span class="n">GetDICOMUIDName</span><span class="p">(),</span> <span class="n">seriesInstanceUid</span><span class="p">)</span>
<span class="n">itemID</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemByUIDList</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLSubjectHierarchyConstants</span><span class="o">.</span><span class="n">GetDICOMInstanceUIDName</span><span class="p">(),</span> <span class="n">instanceUID</span><span class="p">)</span>
<span class="c1"># Invalid item ID for checking validity of a given ID (most functions return the invalid ID when item is not found)</span>
<span class="n">invalidItemID</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLSubjectHierarchyNode</span><span class="o">.</span><span class="n">GetInvalidItemID</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="traverse-children-of-a-subject-hierarchy-item">
<h3>Traverse children of a subject hierarchy item<a class="headerlink" href="#traverse-children-of-a-subject-hierarchy-item" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">children</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkIdList</span><span class="p">()</span>
<span class="n">shNode</span><span class="o">.</span><span class="n">GetItemChildren</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="c1"># Add a third argument with value True for recursive query</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">children</span><span class="o">.</span><span class="n">GetNumberOfIds</span><span class="p">()):</span>
  <span class="n">child</span> <span class="o">=</span> <span class="n">children</span><span class="o">.</span><span class="n">GetId</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
  <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="manipulate-subject-hierarchy-item">
<h3>Manipulate subject hierarchy item<a class="headerlink" href="#manipulate-subject-hierarchy-item" title="Link to this heading"></a></h3>
<p>Instead of node operations on the individual subject hierarchy nodes, item operations are performed on the one subject hierarchy node.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set item name</span>
<span class="n">shNode</span><span class="o">.</span><span class="n">SetItemName</span><span class="p">(</span><span class="n">itemID</span><span class="p">,</span> <span class="s2">&quot;NewName&quot;</span><span class="p">)</span>
<span class="c1"># Set item parent (reparent)</span>
<span class="n">shNode</span><span class="o">.</span><span class="n">SetItemParent</span><span class="p">(</span><span class="n">itemID</span><span class="p">,</span> <span class="n">newParentItemID</span><span class="p">)</span>
<span class="c1"># Set visibility of data node associated to an item</span>
<span class="n">shNode</span><span class="o">.</span><span class="n">SetItemDisplayVisibility</span><span class="p">(</span><span class="n">itemID</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># Set visibility of whole branch</span>
<span class="c1"># Note: Folder-type items (fodler, subject, study, etc.) create their own display nodes when show/hiding from UI.</span>
<span class="c1">#       The displayable managers use SH information to determine visibility of an item, so no need to show/hide individual leaf nodes any more.</span>
<span class="c1">#       Once the folder display node is created, it can be shown hidden simply using shNode.SetItemDisplayVisibility</span>
<span class="c1"># From python, this is how to trigger creating a folder display node</span>
<span class="n">pluginHandler</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">qSlicerSubjectHierarchyPluginHandler</span><span class="p">()</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
<span class="n">folderPlugin</span> <span class="o">=</span> <span class="n">pluginHandler</span><span class="o">.</span><span class="n">pluginByName</span><span class="p">(</span><span class="s2">&quot;Folder&quot;</span><span class="p">)</span>
<span class="n">folderPlugin</span><span class="o">.</span><span class="n">setDisplayVisibility</span><span class="p">(</span><span class="n">folderItemID</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="filter-items-in-treeview-or-combobox">
<h3>Filter items in TreeView or ComboBox<a class="headerlink" href="#filter-items-in-treeview-or-combobox" title="Link to this heading"></a></h3>
<p>Displayed items can be filtered using <em>setAttributeFilter</em> method. An example of the usage can be found in the <a class="reference external" href="https://github.com/Slicer/Slicer/blob/53fb5b8acd41cb36eafbc5c4b66ff39c8434f4c6/Applications/SlicerApp/Testing/Python/SubjectHierarchyGenericSelfTest.py#L352-L360">unit test</a>. Modified version here:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">shTreeView</span><span class="o">.</span><span class="n">displayedItemCount</span><span class="p">())</span> <span class="c1"># 5</span>
<span class="n">shTreeView</span><span class="o">.</span><span class="n">setAttributeFilter</span><span class="p">(</span><span class="s2">&quot;DICOM.Modality&quot;</span><span class="p">)</span> <span class="c1"># Nodes must have this attribute</span>
<span class="nb">print</span><span class="p">(</span><span class="n">shTreeView</span><span class="o">.</span><span class="n">displayedItemCount</span><span class="p">())</span> <span class="c1"># 3</span>
<span class="n">shTreeView</span><span class="o">.</span><span class="n">setAttributeFilter</span><span class="p">(</span><span class="s2">&quot;DICOM.Modality&quot;</span><span class="p">,</span><span class="s2">&quot;CT&quot;</span><span class="p">)</span> <span class="c1"># Have attribute and equal ``CT``</span>
<span class="nb">print</span><span class="p">(</span><span class="n">shTreeView</span><span class="o">.</span><span class="n">displayedItemCount</span><span class="p">())</span> <span class="c1"># 1</span>
<span class="n">shTreeView</span><span class="o">.</span><span class="n">removeAttributeFilter</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">shTreeView</span><span class="o">.</span><span class="n">displayedItemCount</span><span class="p">())</span> <span class="c1"># 5</span>
</pre></div>
</div>
</section>
<section id="listen-to-subject-hierarchy-item-events">
<h3>Listen to subject hierarchy item events<a class="headerlink" href="#listen-to-subject-hierarchy-item-events" title="Link to this heading"></a></h3>
<p>The subject hierarchy node sends the node item id as calldata. Item IDs are vtkIdType, which are NOT vtkObjects. You need to use vtk.calldata_type(vtk.VTK_LONG) (otherwise the application crashes).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MyListenerClass</span><span class="p">(</span><span class="n">VTKObservationMixin</span><span class="p">):</span>
  <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">VTKObservationMixin</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="n">shNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLSubjectHierarchyNode</span><span class="o">.</span><span class="n">GetSubjectHierarchyNode</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">addObserver</span><span class="p">(</span><span class="n">shNode</span><span class="p">,</span> <span class="n">shNode</span><span class="o">.</span><span class="n">SubjectHierarchyItemModifiedEvent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shItemModifiedEvent</span><span class="p">)</span>

  <span class="nd">@vtk</span><span class="o">.</span><span class="n">calldata_type</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">VTK_LONG</span><span class="p">)</span>
  <span class="k">def</span><span class="w"> </span><span class="nf">shItemModifiedEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">caller</span><span class="p">,</span> <span class="n">eventId</span><span class="p">,</span> <span class="n">callData</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SH Node modified&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SH item ID: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">callData</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="subject-hierarchy-plugin-offering-view-context-menu-action">
<h3>Subject hierarchy plugin offering view context menu action<a class="headerlink" href="#subject-hierarchy-plugin-offering-view-context-menu-action" title="Link to this heading"></a></h3>
<p>If an object that supports view context menus (e.g. markups) is right-clicked in a slice or 3D view, it can offer custom actions.</p>
<p>Due to internal limitations, in order to use view menus in scripted plugins, it needs to be registered differently, so that the Python API can be fully built by the time this function is called. The following changes are necessary compared to regular initialization:</p>
<ol class="arabic simple">
<li><p>Remove the following line from constructor</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AbstractScriptedSubjectHierarchyPlugin</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scriptedPlugin</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>In addition to the initialization where the scripted plugin is instantialized and the source set, the plugin also needs to be registered manually:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pluginHandler</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">qSlicerSubjectHierarchyPluginHandler</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
<span class="n">pluginHandler</span><span class="o">.</span><span class="n">registerPlugin</span><span class="p">(</span><span class="n">scriptedPlugin</span><span class="p">)</span>
</pre></div>
</div>
<p>This is a complete example. It must be saved as <code class="docutils literal notranslate"><span class="pre">ViewContextMenu.py</span></code> and placed in a folder that is added to “Additional module paths” in Application Settings / Modules section.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">vtk</span><span class="o">,</span><span class="w"> </span><span class="nn">qt</span><span class="o">,</span><span class="w"> </span><span class="nn">ctk</span><span class="o">,</span><span class="w"> </span><span class="nn">slicer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">slicer.ScriptedLoadableModule</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">slicer.util</span><span class="w"> </span><span class="kn">import</span> <span class="n">VTKObservationMixin</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">SubjectHierarchyPlugins</span><span class="w"> </span><span class="kn">import</span> <span class="n">AbstractScriptedSubjectHierarchyPlugin</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ViewContextMenu</span><span class="p">(</span><span class="n">ScriptedLoadableModule</span><span class="p">):</span>

  <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
    <span class="n">ScriptedLoadableModule</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Context menu example&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">categories</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Examples&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">contributors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Steve Pieper (Isomics, Inc.)&quot;</span><span class="p">]</span>
    <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;startupCompleted()&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onStartupCompleted</span><span class="p">)</span>

  <span class="k">def</span><span class="w"> </span><span class="nf">onStartupCompleted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;register subject hierarchy plugin once app is initialized&quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">SubjectHierarchyPlugins</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">ViewContextMenu</span><span class="w"> </span><span class="kn">import</span> <span class="n">ViewContextMenuSubjectHierarchyPlugin</span>
    <span class="n">scriptedPlugin</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">qSlicerSubjectHierarchyScriptedPlugin</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">scriptedPlugin</span><span class="o">.</span><span class="n">setPythonSource</span><span class="p">(</span><span class="n">ViewContextMenuSubjectHierarchyPlugin</span><span class="o">.</span><span class="n">filePath</span><span class="p">)</span>
    <span class="n">pluginHandler</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">qSlicerSubjectHierarchyPluginHandler</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
    <span class="n">pluginHandler</span><span class="o">.</span><span class="n">registerPlugin</span><span class="p">(</span><span class="n">scriptedPlugin</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ViewContextMenuSubjectHierarchyPlugin loaded&quot;</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ViewContextMenuSubjectHierarchyPlugin</span><span class="p">(</span><span class="n">AbstractScriptedSubjectHierarchyPlugin</span><span class="p">):</span>

  <span class="c1"># Necessary static member to be able to set python source to scripted subject hierarchy plugin</span>
  <span class="n">filePath</span> <span class="o">=</span> <span class="vm">__file__</span>

  <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scriptedPlugin</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">viewAction</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;CUSTOM VIEW...&quot;</span><span class="p">,</span> <span class="n">scriptedPlugin</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">viewAction</span><span class="o">.</span><span class="n">objectName</span> <span class="o">=</span> <span class="s2">&quot;CustomViewAction&quot;</span>
    <span class="c1"># Set the action&#39;s position in the menu: by using `SectionNode+5` we place the action in a new section, after &quot;node actions&quot; section.</span>
    <span class="n">slicer</span><span class="o">.</span><span class="n">qSlicerSubjectHierarchyAbstractPlugin</span><span class="o">.</span><span class="n">setActionPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewAction</span><span class="p">,</span> <span class="n">slicer</span><span class="o">.</span><span class="n">qSlicerSubjectHierarchyAbstractPlugin</span><span class="o">.</span><span class="n">SectionNode</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">viewAction</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;triggered()&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onViewAction</span><span class="p">)</span>

  <span class="k">def</span><span class="w"> </span><span class="nf">viewContextMenuActions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">viewAction</span><span class="p">]</span>

  <span class="k">def</span><span class="w"> </span><span class="nf">showViewContextMenuActionsForItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemID</span><span class="p">,</span> <span class="n">eventData</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># We can decide here if we want to show this action based on the itemID or eventData (ViewNodeID, ...).</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;itemID: </span><span class="si">{</span><span class="n">itemID</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;eventData: </span><span class="si">{</span><span class="n">eventData</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">viewAction</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span>

  <span class="k">def</span><span class="w"> </span><span class="nf">onViewAction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Custom view action is called&quot;</span><span class="p">)</span>
    <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">messageBox</span><span class="p">(</span><span class="s2">&quot;This works!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="use-allowlist-to-customize-view-menu">
<h3>Use allowlist to customize view menu<a class="headerlink" href="#use-allowlist-to-customize-view-menu" title="Link to this heading"></a></h3>
<p>When right-clicking certain types of nodes in the 2D/3D views, a subject hierarchy menu pops up. If menu actions need to be removed, an allowlist can be used to specify the ones that should show up.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pluginHandler</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">qSlicerSubjectHierarchyPluginHandler</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
<span class="n">pluginLogic</span> <span class="o">=</span> <span class="n">pluginHandler</span><span class="o">.</span><span class="n">pluginLogic</span><span class="p">()</span>

<span class="c1"># Display list of all available view context menu action names.</span>
<span class="c1"># This will print something like this: &#39;EditPropertiesAction&#39;, &#39;MouseModeViewTransformAction&#39;, &#39;MouseModeAdjustWindowLevelAction&#39;, &#39;MouseModePlaceAction&#39;, ...).</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pluginLogic</span><span class="o">.</span><span class="n">registeredViewContextMenuActionNames</span><span class="p">)</span>

<span class="c1"># Hide all the other menu items and show only &quot;Rename point&quot;:</span>
<span class="n">pluginLogic</span><span class="o">.</span><span class="n">allowedViewContextMenuActionNames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;RenamePointAction&quot;</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="save-files-to-directory-structure-matching-subject-hierarchy-folders">
<h3>Save files to directory structure matching subject hierarchy folders<a class="headerlink" href="#save-files-to-directory-structure-matching-subject-hierarchy-folders" title="Link to this heading"></a></h3>
<p>This code snippet saves all the storable files (volumes, transforms, markups, etc.) into a folder structure that mirrors the structure of the subject hierarchy tree (file folders have the same name as subject hierarchy folders).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">exportNodes</span><span class="p">(</span><span class="n">shFolderItemId</span><span class="p">,</span> <span class="n">outputFolder</span><span class="p">):</span>
    <span class="c1"># Get items in the folder</span>
    <span class="n">childIds</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkIdList</span><span class="p">()</span>
    <span class="n">shNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLSubjectHierarchyNode</span><span class="o">.</span><span class="n">GetSubjectHierarchyNode</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="p">)</span>
    <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemChildren</span><span class="p">(</span><span class="n">shFolderItemId</span><span class="p">,</span> <span class="n">childIds</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">childIds</span><span class="o">.</span><span class="n">GetNumberOfIds</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="c1"># Create output folder</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outputFolder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Write each child item to file</span>
    <span class="k">for</span> <span class="n">itemIdIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">childIds</span><span class="o">.</span><span class="n">GetNumberOfIds</span><span class="p">()):</span>
        <span class="n">shItemId</span> <span class="o">=</span> <span class="n">childIds</span><span class="o">.</span><span class="n">GetId</span><span class="p">(</span><span class="n">itemIdIndex</span><span class="p">)</span>
        <span class="c1"># Write node to file (if storable)</span>
        <span class="n">dataNode</span> <span class="o">=</span> <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemDataNode</span><span class="p">(</span><span class="n">shItemId</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dataNode</span> <span class="ow">and</span> <span class="n">dataNode</span><span class="o">.</span><span class="n">IsA</span><span class="p">(</span><span class="s2">&quot;vtkMRMLStorableNode&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">dataNode</span><span class="o">.</span><span class="n">GetStorageNode</span><span class="p">():</span>
            <span class="n">storageNode</span> <span class="o">=</span> <span class="n">dataNode</span><span class="o">.</span><span class="n">GetStorageNode</span><span class="p">()</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">storageNode</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">())</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">outputFolder</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">filename</span>
            <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">exportNode</span><span class="p">(</span><span class="n">dataNode</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>
        <span class="c1"># Write all children of this child item</span>
        <span class="n">grandChildIds</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkIdList</span><span class="p">()</span>
        <span class="n">shNode</span><span class="o">.</span><span class="n">GetItemChildren</span><span class="p">(</span><span class="n">shItemId</span><span class="p">,</span> <span class="n">grandChildIds</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">grandChildIds</span><span class="o">.</span><span class="n">GetNumberOfIds</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">exportNodes</span><span class="p">(</span><span class="n">shItemId</span><span class="p">,</span> <span class="n">outputFolder</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">shNode</span><span class="o">.</span><span class="n">GetItemName</span><span class="p">(</span><span class="n">shItemId</span><span class="p">))</span>

<span class="n">shNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLSubjectHierarchyNode</span><span class="o">.</span><span class="n">GetSubjectHierarchyNode</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="p">)</span>
<span class="n">outputFolder</span> <span class="o">=</span> <span class="s2">&quot;c:/tmp/test20211123&quot;</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ioManager</span><span class="p">()</span><span class="o">.</span><span class="n">addDefaultStorageNodes</span><span class="p">()</span>
<span class="n">exportNodes</span><span class="p">(</span><span class="n">shNode</span><span class="o">.</span><span class="n">GetSceneItemID</span><span class="p">(),</span> <span class="n">outputFolder</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="tractography">
<h2>Tractography<a class="headerlink" href="#tractography" title="Link to this heading"></a></h2>
<section id="export-a-tract-fiberbundle-to-blender-including-color">
<h3>Export a tract (FiberBundle) to Blender, including color<a class="headerlink" href="#export-a-tract-fiberbundle-to-blender-including-color" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An interactive version of this script is now included in the <a class="reference external" href="https://dmri.slicer.org">SlicerDMRI extension</a> (<a class="reference external" href="https://github.com/SlicerDMRI/SlicerDMRI/tree/master/Modules/Scripted/TractographyExportPLY">module code</a>). After installing SlicerDMRI, go to <em>Modules -&gt; Diffusion -&gt; Import and Export -&gt; Export tractography to PLY (mesh)</em>.</p>
</div>
<p>The example below shows how to export a tractography “FiberBundleNode” to a PLY file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lineDisplayNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;*LineDisplay*&quot;</span><span class="p">)</span>
<span class="n">plyFilePath</span> <span class="o">=</span> <span class="s2">&quot;/tmp/fibers.ply&quot;</span>
<span class="n">outputCoordinateSystem</span> <span class="o">=</span> <span class="s2">&quot;RAS&quot;</span>  <span class="c1"># can be &quot;RAS&quot; (still used in neuroimaging) or &quot;LPS&quot; (most commonly used coordinate system in medical image computing)</span>

<span class="n">tuber</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkTubeFilter</span><span class="p">()</span>
<span class="n">tuber</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">lineDisplayNode</span><span class="o">.</span><span class="n">GetOutputPolyData</span><span class="p">())</span>
<span class="n">tuber</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
<span class="n">tubes</span> <span class="o">=</span> <span class="n">tuber</span><span class="o">.</span><span class="n">GetOutputDataObject</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">scalars</span> <span class="o">=</span> <span class="n">tubes</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span><span class="o">.</span><span class="n">GetArray</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">scalars</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="s2">&quot;scalars&quot;</span><span class="p">)</span>

<span class="n">triangles</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkTriangleFilter</span><span class="p">()</span>
<span class="n">triangles</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">tubes</span><span class="p">)</span>
<span class="n">triangles</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>

<span class="n">colorNode</span> <span class="o">=</span> <span class="n">lineDisplayNode</span><span class="o">.</span><span class="n">GetColorNode</span><span class="p">()</span>
<span class="n">lookupTable</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkLookupTable</span><span class="p">()</span>
<span class="n">lookupTable</span><span class="o">.</span><span class="n">DeepCopy</span><span class="p">(</span><span class="n">colorNode</span><span class="o">.</span><span class="n">GetLookupTable</span><span class="p">())</span>
<span class="n">lookupTable</span><span class="o">.</span><span class="n">SetTableRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plyWriter</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPLYWriter</span><span class="p">()</span>

<span class="k">if</span> <span class="n">outputCoordinateSystem</span> <span class="o">==</span> <span class="s2">&quot;RAS&quot;</span><span class="p">:</span>
    <span class="n">plyWriter</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">triangles</span><span class="o">.</span><span class="n">GetOutput</span><span class="p">())</span>
<span class="k">elif</span> <span class="n">outputCoordinateSystem</span> <span class="o">==</span> <span class="s2">&quot;LPS&quot;</span><span class="p">:</span>
    <span class="n">transformRasToLps</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkTransformPolyDataFilter</span><span class="p">()</span>
    <span class="n">rasToLps</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkTransform</span><span class="p">()</span>
    <span class="n">rasToLps</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">transformRasToLps</span><span class="o">.</span><span class="n">SetTransform</span><span class="p">(</span><span class="n">rasToLps</span><span class="p">)</span>
    <span class="n">transformRasToLps</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">triangles</span><span class="o">.</span><span class="n">GetOutput</span><span class="p">())</span>
    <span class="n">plyWriter</span><span class="o">.</span><span class="n">SetInputConnection</span><span class="p">(</span><span class="n">transformRasToLps</span><span class="o">.</span><span class="n">GetOutputPort</span><span class="p">())</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Invalid output coordinate system&quot;</span><span class="p">)</span>

<span class="n">plyWriter</span><span class="o">.</span><span class="n">SetLookupTable</span><span class="p">(</span><span class="n">lookupTable</span><span class="p">)</span>
<span class="n">plyWriter</span><span class="o">.</span><span class="n">SetArrayName</span><span class="p">(</span><span class="s2">&quot;scalars&quot;</span><span class="p">)</span>

<span class="n">plyWriter</span><span class="o">.</span><span class="n">SetFileName</span><span class="p">(</span><span class="n">plyFilePath</span><span class="p">)</span>
<span class="n">plyWriter</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="iterate-over-tract-fiberbundle-streamline-points">
<h3>Iterate over tract (FiberBundle) streamline points<a class="headerlink" href="#iterate-over-tract-fiberbundle-streamline-points" title="Link to this heading"></a></h3>
<p>This example shows how to access the points in each line of a FiberBundle as a numpy array (view).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">vtk.util.numpy_support</span><span class="w"> </span><span class="kn">import</span> <span class="n">vtk_to_numpy</span>

<span class="n">fb</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;FiberBundle_F&quot;</span><span class="p">)</span> <span class="c1"># &lt;- fill in node ID here</span>

<span class="c1"># get point data as 1d array</span>
<span class="n">points</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromModelPoints</span><span class="p">(</span><span class="n">fb</span><span class="p">)</span>

<span class="c1"># get line cell ids as 1d array</span>
<span class="n">line_ids</span> <span class="o">=</span> <span class="n">vtk_to_numpy</span><span class="p">(</span><span class="n">fb</span><span class="o">.</span><span class="n">GetPolyData</span><span class="p">()</span><span class="o">.</span><span class="n">GetLines</span><span class="p">()</span><span class="o">.</span><span class="n">GetData</span><span class="p">())</span>

<span class="c1"># VTK cell ids are stored as</span>
<span class="c1">#   [ N0 c0_id0 ... c0_id0</span>
<span class="c1">#     N1 c1_id0 ... c1_idN1 ]</span>
<span class="c1"># so we need to</span>
<span class="c1"># - read point count for each line (cell)</span>
<span class="c1"># - grab the ids in that range from `line_ids` array defined above</span>
<span class="c1"># - index the `points` array by those ids</span>
<span class="n">cur_idx</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">GetLines</span><span class="p">()</span><span class="o">.</span><span class="n">GetNumberOfCells</span><span class="p">()):</span>
  <span class="c1"># - read point count for this line (cell)</span>
  <span class="n">count</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">cur_idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
  <span class="c1"># - grab the ids in that range from `lines`</span>
  <span class="n">index_array</span> <span class="o">=</span> <span class="n">line_ids</span><span class="p">[</span> <span class="n">cur_idx</span> <span class="p">:</span> <span class="n">cur_idx</span> <span class="o">+</span> <span class="n">count</span><span class="p">]</span>
  <span class="c1"># update to the next range</span>
  <span class="n">cur_idx</span> <span class="o">+=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
  <span class="c1"># - index the point array by those ids</span>
  <span class="n">line_points</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">index_array</span><span class="p">]</span>
  <span class="c1"># do work here</span>
</pre></div>
</div>
</section>
</section>
<section id="transforms">
<h2>Transforms<a class="headerlink" href="#transforms" title="Link to this heading"></a></h2>
<section id="get-a-notification-if-a-transform-is-modified">
<h3>Get a notification if a transform is modified<a class="headerlink" href="#get-a-notification-if-a-transform-is-modified" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">onTransformNodeModified</span><span class="p">(</span><span class="n">transformNode</span><span class="p">,</span> <span class="n">unusedArg2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unusedArg3</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="n">transformMatrix</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMatrix4x4</span><span class="p">()</span>
   <span class="n">transformNode</span><span class="o">.</span><span class="n">GetMatrixTransformToWorld</span><span class="p">(</span><span class="n">transformMatrix</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Position: [</span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">, </span><span class="si">{2}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">transformMatrix</span><span class="o">.</span><span class="n">GetElement</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">transformMatrix</span><span class="o">.</span><span class="n">GetElement</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">transformMatrix</span><span class="o">.</span><span class="n">GetElement</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>

<span class="n">transformNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLTransformNode&quot;</span><span class="p">)</span>
<span class="n">transformNode</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLTransformNode</span><span class="o">.</span><span class="n">TransformModifiedEvent</span><span class="p">,</span> <span class="n">onTransformNodeModified</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="rotate-a-node-around-a-specified-point">
<h3>Rotate a node around a specified point<a class="headerlink" href="#rotate-a-node-around-a-specified-point" title="Link to this heading"></a></h3>
<p>Set up the scene:</p>
<ul class="simple">
<li><p>Add a markup point list node (centerOfRotationMarkupsNode) with a single point to specify center of rotation.</p></li>
<li><p>Add a rotation transform (rotationTransformNode) that will be edited in Transforms module to specify rotation angles.</p></li>
<li><p>Add a transform (finalTransformNode) and apply it (not harden) to those nodes (images, models, etc.) that you want to rotate around the center of rotation point.</p></li>
</ul>
<p>Then run the script below, go to Transforms module, select rotationTransformNode, and move rotation sliders.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This markups point list node specifies the center of rotation</span>
<span class="n">centerOfRotationMarkupsNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
<span class="c1"># This transform can be  edited in Transforms module</span>
<span class="n">rotationTransformNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;LinearTransform_3&quot;</span><span class="p">)</span>
<span class="c1"># This transform has to be applied to the image, model, etc.</span>
<span class="n">finalTransformNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;LinearTransform_4&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">updateFinalTransform</span><span class="p">(</span><span class="n">unusedArg1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unusedArg2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unusedArg3</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="n">rotationMatrix</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMatrix4x4</span><span class="p">()</span>
  <span class="n">rotationTransformNode</span><span class="o">.</span><span class="n">GetMatrixTransformToParent</span><span class="p">(</span><span class="n">rotationMatrix</span><span class="p">)</span>
  <span class="n">rotationCenterPointCoord</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
  <span class="n">centerOfRotationMarkupsNode</span><span class="o">.</span><span class="n">GetNthControlPointPositionWorld</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rotationCenterPointCoord</span><span class="p">)</span>
  <span class="n">finalTransform</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkTransform</span><span class="p">()</span>
  <span class="n">finalTransform</span><span class="o">.</span><span class="n">Translate</span><span class="p">(</span><span class="n">rotationCenterPointCoord</span><span class="p">)</span>
  <span class="n">finalTransform</span><span class="o">.</span><span class="n">Concatenate</span><span class="p">(</span><span class="n">rotationMatrix</span><span class="p">)</span>
  <span class="n">finalTransform</span><span class="o">.</span><span class="n">Translate</span><span class="p">(</span><span class="o">-</span><span class="n">rotationCenterPointCoord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">rotationCenterPointCoord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">rotationCenterPointCoord</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
  <span class="n">finalTransformNode</span><span class="o">.</span><span class="n">SetAndObserveMatrixTransformToParent</span><span class="p">(</span><span class="n">finalTransform</span><span class="o">.</span><span class="n">GetMatrix</span><span class="p">())</span>

<span class="c1"># Manual initial update</span>
<span class="n">updateFinalTransform</span><span class="p">()</span>

<span class="c1"># Automatic update when point is moved or transform is modified</span>
<span class="n">rotationTransformNodeObserver</span> <span class="o">=</span> <span class="n">rotationTransformNode</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLTransformNode</span><span class="o">.</span><span class="n">TransformModifiedEvent</span><span class="p">,</span> <span class="n">updateFinalTransform</span><span class="p">)</span>
<span class="n">centerOfRotationMarkupsNodeObserver</span> <span class="o">=</span> <span class="n">centerOfRotationMarkupsNode</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLMarkupsNode</span><span class="o">.</span><span class="n">PointModifiedEvent</span><span class="p">,</span> <span class="n">updateFinalTransform</span><span class="p">)</span>

<span class="c1"># Execute these lines to stop automatic updates:</span>
<span class="c1"># rotationTransformNode.RemoveObserver(rotationTransformNodeObserver)</span>
<span class="c1"># centerOfRotationMarkupsNode.RemoveObserver(centerOfRotationMarkupsNodeObserver)</span>
</pre></div>
</div>
</section>
<section id="rotate-a-node-around-a-specified-line">
<h3>Rotate a node around a specified line<a class="headerlink" href="#rotate-a-node-around-a-specified-line" title="Link to this heading"></a></h3>
<p>Set up the scene:</p>
<ul class="simple">
<li><p>Add a markup line node (rotationAxisMarkupsNode) with 2 points to specify rotation axis.</p></li>
<li><p>Add a rotation transform (rotationTransformNode) that will be edited in Transforms module to specify rotation angle.</p></li>
<li><p>Add a transform (finalTransformNode) and apply it (not harden) to those nodes (images, models, etc.) that you want to rotate around the line.</p></li>
</ul>
<p>Then run the script below, go to Transforms module, select rotationTransformNode, and move Edit / Rotation / IS slider.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This markups point list node specifies the center of rotation</span>
<span class="n">rotationAxisMarkupsNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
<span class="c1"># This transform can be edited in Transforms module (Edit / Rotation / IS slider)</span>
<span class="n">rotationTransformNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;LinearTransform_3&quot;</span><span class="p">)</span>
<span class="c1"># This transform has to be applied to the image, model, etc.</span>
<span class="n">finalTransformNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;LinearTransform_4&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">updateFinalTransform</span><span class="p">(</span><span class="n">unusedArg1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unusedArg2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unusedArg3</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
  <span class="n">rotationAxisPoint1_World</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
  <span class="n">rotationAxisMarkupsNode</span><span class="o">.</span><span class="n">GetNthControlPointPositionWorld</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rotationAxisPoint1_World</span><span class="p">)</span>
  <span class="n">rotationAxisPoint2_World</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
  <span class="n">rotationAxisMarkupsNode</span><span class="o">.</span><span class="n">GetNthControlPointPositionWorld</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rotationAxisPoint2_World</span><span class="p">)</span>
  <span class="n">axisDirectionZ_World</span> <span class="o">=</span> <span class="n">rotationAxisPoint2_World</span><span class="o">-</span><span class="n">rotationAxisPoint1_World</span>
  <span class="n">axisDirectionZ_World</span> <span class="o">=</span> <span class="n">axisDirectionZ_World</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">axisDirectionZ_World</span><span class="p">)</span>
  <span class="c1"># Get transformation between world coordinate system and rotation axis aligned coordinate system</span>
  <span class="n">worldToRotationAxisTransform</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMatrix4x4</span><span class="p">()</span>
  <span class="n">p</span><span class="o">=</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkPlaneSource</span><span class="p">()</span>
  <span class="n">p</span><span class="o">.</span><span class="n">SetNormal</span><span class="p">(</span><span class="n">axisDirectionZ_World</span><span class="p">)</span>
  <span class="n">axisOrigin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">GetOrigin</span><span class="p">())</span>
  <span class="n">axisDirectionX_World</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">GetPoint1</span><span class="p">())</span><span class="o">-</span><span class="n">axisOrigin</span>
  <span class="n">axisDirectionY_World</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">GetPoint2</span><span class="p">())</span><span class="o">-</span><span class="n">axisOrigin</span>
  <span class="n">rotationAxisToWorldTransform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">row_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">axisDirectionX_World</span><span class="p">,</span> <span class="n">axisDirectionY_World</span><span class="p">,</span> <span class="n">axisDirectionZ_World</span><span class="p">,</span> <span class="n">rotationAxisPoint1_World</span><span class="p">)),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
  <span class="n">rotationAxisToWorldTransformMatrix</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">vtkMatrixFromArray</span><span class="p">(</span><span class="n">rotationAxisToWorldTransform</span><span class="p">)</span>
  <span class="n">worldToRotationAxisTransformMatrix</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">vtkMatrixFromArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">rotationAxisToWorldTransform</span><span class="p">))</span>
  <span class="c1"># Compute transformation chain</span>
  <span class="n">rotationMatrix</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMatrix4x4</span><span class="p">()</span>
  <span class="n">rotationTransformNode</span><span class="o">.</span><span class="n">GetMatrixTransformToParent</span><span class="p">(</span><span class="n">rotationMatrix</span><span class="p">)</span>
  <span class="n">finalTransform</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkTransform</span><span class="p">()</span>
  <span class="n">finalTransform</span><span class="o">.</span><span class="n">Concatenate</span><span class="p">(</span><span class="n">rotationAxisToWorldTransformMatrix</span><span class="p">)</span>
  <span class="n">finalTransform</span><span class="o">.</span><span class="n">Concatenate</span><span class="p">(</span><span class="n">rotationMatrix</span><span class="p">)</span>
  <span class="n">finalTransform</span><span class="o">.</span><span class="n">Concatenate</span><span class="p">(</span><span class="n">worldToRotationAxisTransformMatrix</span><span class="p">)</span>
  <span class="n">finalTransformNode</span><span class="o">.</span><span class="n">SetAndObserveMatrixTransformToParent</span><span class="p">(</span><span class="n">finalTransform</span><span class="o">.</span><span class="n">GetMatrix</span><span class="p">())</span>

<span class="c1"># Manual initial update</span>
<span class="n">updateFinalTransform</span><span class="p">()</span>

<span class="c1"># Automatic update when point is moved or transform is modified</span>
<span class="n">rotationTransformNodeObserver</span> <span class="o">=</span> <span class="n">rotationTransformNode</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLTransformNode</span><span class="o">.</span><span class="n">TransformModifiedEvent</span><span class="p">,</span> <span class="n">updateFinalTransform</span><span class="p">)</span>
<span class="n">rotationAxisMarkupsNodeObserver</span> <span class="o">=</span> <span class="n">rotationAxisMarkupsNode</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLMarkupsNode</span><span class="o">.</span><span class="n">PointModifiedEvent</span><span class="p">,</span> <span class="n">updateFinalTransform</span><span class="p">)</span>

<span class="c1"># Execute these lines to stop automatic updates:</span>
<span class="c1"># rotationTransformNode.RemoveObserver(rotationTransformNodeObserver)</span>
<span class="c1"># rotationAxisMarkupsNode.RemoveObserver(rotationAxisMarkupsNodeObserver)</span>
</pre></div>
</div>
</section>
<section id="convert-between-itk-and-slicer-linear-transforms">
<h3>Convert between ITK and Slicer linear transforms<a class="headerlink" href="#convert-between-itk-and-slicer-linear-transforms" title="Link to this heading"></a></h3>
<p>ITK transform files store the resampling transform (“transform from parent”) in LPS coordinate system. Slicer displays the modeling transform (“transform to parent”) in RAS coordinate system. The following code snippets show how to compute the matrix that Slicer displays from an ITK transform file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copy the content between the following triple-quotes to a file called &#39;LinearTransform.tfm&#39;, and load into Slicer</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">#Insight Transform File V1.0</span>
<span class="sd">#Transform 0</span>
<span class="sd">Transform: AffineTransform_double_3_3</span>
<span class="sd">Parameters: -0.213789703753722 -0.7715409537503184 0.5991815411500568 -0.6877744504386172 0.5544585467133546 0.46855311897413043 -0.6937292468195099 -0.3119299226790803 -0.6491836839020759 -6.080443282989144 10.318378593490745 159.38003926210894</span>
<span class="sd">FixedParameters: -4.363375593759671 -23.302979114450725 -56.27550193307294</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

<span class="k">def</span><span class="w"> </span><span class="nf">read_itk_affine_transform</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="c1"># Extract Parameters</span>
    <span class="n">params_line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Parameters:&#39;</span><span class="p">))</span>
    <span class="n">params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">params_line</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="s1">&#39;Parameters:&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
    <span class="n">rotation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="p">[:</span><span class="mi">9</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">translation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">12</span><span class="p">])</span>

    <span class="c1"># Extract FixedParameters (center of rotation)</span>
    <span class="n">fixed_params_line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;FixedParameters:&#39;</span><span class="p">))</span>
    <span class="n">rotation_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">fixed_params_line</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="s1">&#39;FixedParameters:&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())))</span>

    <span class="c1"># Get homogeneous transformation matrix translation component from transform parameters and fixed parameters.</span>
    <span class="c1"># The homogeneous transformation matrix rotation part is the same as rotation stored in parameters.</span>
    <span class="c1"># However, the translation part is not directly stored in these values, but it is computed from the fixed and moving parameters (and the value is called &quot;offset&quot;).</span>
    <span class="c1"># See computation implementation in MatrixOffsetTransformBase::ComputeOffset</span>
    <span class="c1"># https://github.com/InsightSoftwareConsortium/ITK/blob/09305ce7c3509139ab0ca12047f8e6793b01db74/Modules/Core/Transform/include/itkMatrixOffsetTransformBase.hxx#L611-L629</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="n">translation</span> <span class="o">+</span> <span class="n">rotation_center</span> <span class="o">-</span> <span class="n">rotation</span> <span class="o">@</span> <span class="n">rotation_center</span>

    <span class="c1"># Construct homogeneous transformation matrix</span>
    <span class="n">transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">transform</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotation</span>
    <span class="n">transform</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">offset</span>

    <span class="k">return</span> <span class="n">transform</span>

<span class="k">def</span><span class="w"> </span><span class="nf">itk_to_slicer_transform</span><span class="p">(</span><span class="n">itk_transform</span><span class="p">):</span>
    <span class="c1"># ITK transform: from parent, using LPS coordinate system</span>
    <span class="c1"># Transform displayed in Slicer: to parent, using RAS coordinate system</span>
    <span class="n">transform_from_parent_LPS</span> <span class="o">=</span> <span class="n">itk_transform</span>
    <span class="n">ras2lps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">transform_from_parent_RAS</span> <span class="o">=</span> <span class="n">ras2lps</span> <span class="o">@</span> <span class="n">transform_from_parent_LPS</span> <span class="o">@</span> <span class="n">ras2lps</span>
    <span class="n">transform_to_parent_RAS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">transform_from_parent_RAS</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">transform_to_parent_RAS</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;path/to/LinearTransform.tfm&quot;</span>
<span class="n">itk_tfm</span> <span class="o">=</span> <span class="n">read_itk_affine_transform</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">slicer_tfm</span> <span class="o">=</span> <span class="n">itk_to_slicer_transform</span><span class="p">(</span><span class="n">itk_tfm</span><span class="p">)</span>
<span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">slicer_tfm</span><span class="p">)</span>

<span class="c1"># Running the code above in Python should print the following output.</span>
<span class="c1"># This output should match the display the loaded .tfm file in the Transforms module:</span>
<span class="c1"># [[  0.929794  -0.269457  -0.25075  -52.64097 ]</span>
<span class="c1">#  [  0.038348   0.748446  -0.662086  46.126957]</span>
<span class="c1">#  [  0.366077   0.605988   0.706234   0.481854]</span>
<span class="c1">#  [  0.         0.         0.         1.      ]]</span>
</pre></div>
</div>
</section>
<section id="apply-a-transform-to-a-transformable-node">
<h3>Apply a transform to a transformable node<a class="headerlink" href="#apply-a-transform-to-a-transformable-node" title="Link to this heading"></a></h3>
<p>Python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">transformToParentMatrix</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMatrix4x4</span><span class="p">()</span>
<span class="o">...</span>
<span class="n">transformNode</span><span class="o">.</span><span class="n">SetMatrixTransformToParent</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
<span class="n">transformableNode</span><span class="o">.</span><span class="n">SetAndObserveTransformNodeID</span><span class="p">(</span><span class="n">transformNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
</pre></div>
</div>
<p>C++:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">vtkNew</span><span class="o">&lt;</span><span class="n">vtkMRMLTransformNode</span><span class="o">&gt;</span><span class="w"> </span><span class="n">transformNode</span><span class="p">;</span>
<span class="n">scene</span><span class="o">-&gt;</span><span class="n">AddNode</span><span class="p">(</span><span class="n">transformNode</span><span class="p">.</span><span class="n">GetPointer</span><span class="p">());</span>
<span class="p">...</span>
<span class="n">vtkNew</span><span class="o">&lt;</span><span class="n">vtkMatrix4x4</span><span class="o">&gt;</span><span class="w"> </span><span class="n">matrix</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">transform</span><span class="o">-&gt;</span><span class="n">SetMatrixTransformToParent</span><span class="p">(</span><span class="w"> </span><span class="n">matrix</span><span class="p">.</span><span class="n">GetPointer</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="p">...</span>
<span class="n">vtkMRMLVolumeNode</span><span class="o">*</span><span class="w"> </span><span class="n">transformableNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span><span class="w"> </span><span class="c1">// or vtkMRMLModelNode*...</span>
<span class="n">transformableNode</span><span class="o">-&gt;</span><span class="n">SetAndObserveTransformNodeID</span><span class="p">(</span><span class="w"> </span><span class="n">transformNode</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="set-a-transformation-matrix-from-a-numpy-array">
<h3>Set a transformation matrix from a numpy array<a class="headerlink" href="#set-a-transformation-matrix-from-a-numpy-array" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a 4x4 transformation matrix as numpy array</span>
<span class="n">transformNode</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">transformMatrixNP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
  <span class="p">[[</span><span class="mf">0.92979</span><span class="p">,</span><span class="o">-</span><span class="mf">0.26946</span><span class="p">,</span><span class="o">-</span><span class="mf">0.25075</span><span class="p">,</span><span class="mf">52.64097</span><span class="p">],</span>
  <span class="p">[</span><span class="mf">0.03835</span><span class="p">,</span> <span class="mf">0.74845</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.66209</span><span class="p">,</span> <span class="o">-</span><span class="mf">46.12696</span><span class="p">],</span>
  <span class="p">[</span><span class="mf">0.36608</span><span class="p">,</span> <span class="mf">0.60599</span><span class="p">,</span> <span class="mf">0.70623</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.48185</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>

<span class="c1"># Update matrix in transform node</span>
<span class="n">transformNode</span><span class="o">.</span><span class="n">SetAndObserveMatrixTransformToParent</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">vtkMatrixFromArray</span><span class="p">(</span><span class="n">transformMatrixNP</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="example-of-moving-a-volume-along-a-trajectory-using-a-transform">
<h3>Example of moving a volume along a trajectory using a transform<a class="headerlink" href="#example-of-moving-a-volume-along-a-trajectory-using-a-transform" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load sample volume</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">SampleData</span>
<span class="n">sampleDataLogic</span> <span class="o">=</span> <span class="n">SampleData</span><span class="o">.</span><span class="n">SampleDataLogic</span><span class="p">()</span>
<span class="n">mrHead</span> <span class="o">=</span> <span class="n">sampleDataLogic</span><span class="o">.</span><span class="n">downloadMRHead</span><span class="p">()</span>

<span class="c1"># Create transform and apply to sample volume</span>
<span class="n">transformNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLTransformNode</span><span class="p">()</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNode</span><span class="p">(</span><span class="n">transformNode</span><span class="p">)</span>
<span class="n">mrHead</span><span class="o">.</span><span class="n">SetAndObserveTransformNodeID</span><span class="p">(</span><span class="n">transformNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>

<span class="c1"># How to move a volume along a trajectory using a transform:</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="n">transformMatrix</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMatrix4x4</span><span class="p">()</span>
<span class="k">for</span> <span class="n">xPos</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">):</span>
  <span class="n">transformMatrix</span><span class="o">.</span><span class="n">SetElement</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">xPos</span><span class="p">)</span>
  <span class="n">transformMatrix</span><span class="o">.</span><span class="n">SetElement</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">xPos</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>
  <span class="n">transformNode</span><span class="o">.</span><span class="n">SetMatrixTransformToParent</span><span class="p">(</span><span class="n">transformMatrix</span><span class="p">)</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
  <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.02</span><span class="p">)</span>
<span class="c1"># Note: for longer animations use qt.QTimer.singleShot(100, callbackFunction)</span>
<span class="c1"># instead of a for loop.</span>
</pre></div>
</div>
</section>
<section id="combine-multiple-transforms">
<h3>Combine multiple transforms<a class="headerlink" href="#combine-multiple-transforms" title="Link to this heading"></a></h3>
<p>Because a transform node is also a transformable node, it is possible to concatenate transforms with each other.</p>
<p>Python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">transformNode2</span><span class="o">.</span><span class="n">SetAndObserveTransformNodeID</span><span class="p">(</span><span class="n">transformNode1</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
<span class="n">transformableNode</span><span class="o">.</span><span class="n">SetAndObserveTransformNodeID</span><span class="p">(</span><span class="n">transformNode2</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
</pre></div>
</div>
<p>C++:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">vtkMRMLTransformNode</span><span class="o">*</span><span class="w"> </span><span class="n">transformNode1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="n">vtkMRMLTransformNode</span><span class="o">*</span><span class="w"> </span><span class="n">transformNode2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="n">transformNode2</span><span class="o">-&gt;</span><span class="n">SetAndObserveTransformNodeID</span><span class="p">(</span><span class="n">transformNode1</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">());</span>
<span class="n">transformable</span><span class="o">-&gt;</span><span class="n">SetAndObserveTransformNodeID</span><span class="p">(</span><span class="n">transformNode2</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">());</span>
</pre></div>
</div>
</section>
<section id="convert-the-transform-to-a-grid-transform">
<h3>Convert the transform to a grid transform<a class="headerlink" href="#convert-the-transform-to-a-grid-transform" title="Link to this heading"></a></h3>
<p>Any transform can be converted to a grid transform (also known as displacement field transform):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">transformNode</span><span class="o">=</span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s1">&#39;LinearTransform_3&#39;</span><span class="p">)</span>
<span class="n">referenceVolumeNode</span><span class="o">=</span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s1">&#39;MRHead&#39;</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">ConvertToGridTransform</span><span class="p">(</span><span class="n">transformNode</span><span class="p">,</span> <span class="n">referenceVolumeNode</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Conversion to grid transform is useful because some software cannot use inverse transforms or can only use grid transforms.</p></li>
<li><p>Displacement field transforms are saved to file differently than displacement field volumes: displacement vectors in transforms are converted to LPS coordinate system on saving, displacement vectors in volumes are saved to file unchanged.</p></li>
</ul>
</div>
</section>
<section id="export-the-displacement-magnitude-of-the-transform-as-a-volume">
<h3>Export the displacement magnitude of the transform as a volume<a class="headerlink" href="#export-the-displacement-magnitude-of-the-transform-as-a-volume" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">transformNode</span><span class="o">=</span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s1">&#39;LinearTransform_3&#39;</span><span class="p">)</span>
<span class="n">referenceVolumeNode</span><span class="o">=</span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s1">&#39;MRHead&#39;</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">CreateDisplacementVolumeFromTransform</span><span class="p">(</span><span class="n">transformNode</span><span class="p">,</span> <span class="n">referenceVolumeNode</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="visualize-the-displacement-magnitude-as-a-color-volume">
<h3>Visualize the displacement magnitude as a color volume<a class="headerlink" href="#visualize-the-displacement-magnitude-as-a-color-volume" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">transformNode</span><span class="o">=</span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s1">&#39;LinearTransform_3&#39;</span><span class="p">)</span>
<span class="n">referenceVolumeNode</span><span class="o">=</span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s1">&#39;MRHead&#39;</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">CreateDisplacementVolumeFromTransform</span><span class="p">(</span><span class="n">transformNode</span><span class="p">,</span> <span class="n">referenceVolumeNode</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="volumes">
<h2>Volumes<a class="headerlink" href="#volumes" title="Link to this heading"></a></h2>
<section id="load-volume-from-file">
<h3>Load volume from file<a class="headerlink" href="#load-volume-from-file" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">loadedVolumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">loadVolume</span><span class="p">(</span><span class="s2">&quot;c:/Users/abc/Documents/MRHead.nrrd&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Additional options may be specified in <code class="docutils literal notranslate"><span class="pre">properties</span></code> argument. For example, load an image stack by disabling <code class="docutils literal notranslate"><span class="pre">singleFile</span></code> option:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">loadedVolumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">loadVolume</span><span class="p">(</span><span class="s2">&quot;c:/Users/abc/Documents/SomeImage/file001.png&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;singleFile&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following options can be passed to load volumes programmatically when using <code class="docutils literal notranslate"><span class="pre">qSlicerVolumesReader</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> (string): Node name to set for the loaded volume</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">labelmap</span></code> (bool, default=false): Load the file as labelmap volume</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">singleFile</span></code> (bool, default=false): Force loading this file only (otherwise the loader may look for similar files in the same folder to load multiple slices as a 3D volume)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">autoWindowLevel</span></code> (bool, default=true): Automatically compute the window level based on the volume pixel intensities</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">show</span></code> (bool, default=true): Show the volume in views after loading</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">center</span></code> (bool, default=false): Apply a transform that places the volume in the patient coordinate system origin</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">discardOrientation</span></code> (bool, default=false): Discard file orientation information.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fileNames</span></code> (string list): List of files to be loaded as a volume</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">colorNodeID</span></code> (string): ID of the color node used to display the volume. Default is <code class="docutils literal notranslate"><span class="pre">vtkMRMLColorTableNodeGrey</span></code> for scalar volume and <code class="docutils literal notranslate"><span class="pre">vtkMRMLColorTableNodeFileGenericColors.txt</span></code> for labelmap volume.</p></li>
</ul>
</div>
</section>
<section id="save-volume-to-file">
<h3>Save volume to file<a class="headerlink" href="#save-volume-to-file" title="Link to this heading"></a></h3>
<p>Get the first volume node in the scene and save as .nrrd file. To save in any other supported file format, change the output file name.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">volumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetFirstNodeByClass</span><span class="p">(</span><span class="s1">&#39;vtkMRMLScalarVolumeNode&#39;</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">exportNode</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">,</span> <span class="s2">&quot;c:/tmp/test.nrrd&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you are saving to a format with optional compression, like nrrd, compression is on by default.  Saving is much faster with compression turned off but the files may be much larger (about 3x for medical images).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">exportNode</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">,</span> <span class="n">imagePath</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;useCompression&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
</pre></div>
</div>
<p>By default, parent transforms are ignored. To export the node in the world coordinate system (all transforms hardened), set <code class="docutils literal notranslate"><span class="pre">world=True</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">exportNode</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">,</span> <span class="n">imagePath</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;useCompression&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="n">world</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">saveNode</span></code> method can be used instead of <code class="docutils literal notranslate"><span class="pre">exportNode</span></code> to update the current storage options (filename, compression options, etc.) in the scene.</p>
</section>
<section id="load-volume-from-vti-file">
<h3>Load volume from .vti file<a class="headerlink" href="#load-volume-from-vti-file" title="Link to this heading"></a></h3>
<p>Slicer does not provide reader for VTK XML image data file format (as they are not commonly used for storing medical images and they cannot store image axis directions) but such files can be read by using this script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">reader</span><span class="o">=</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkXMLImageDataReader</span><span class="p">()</span>
<span class="n">reader</span><span class="o">.</span><span class="n">SetFileName</span><span class="p">(</span><span class="s2">&quot;/path/to/file.vti&quot;</span><span class="p">)</span>
<span class="n">reader</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
<span class="n">imageData</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">GetOutput</span><span class="p">()</span>
<span class="n">spacing</span> <span class="o">=</span> <span class="n">imageData</span><span class="o">.</span><span class="n">GetSpacing</span><span class="p">()</span>
<span class="n">origin</span> <span class="o">=</span> <span class="n">imageData</span><span class="o">.</span><span class="n">GetOrigin</span><span class="p">()</span>
<span class="n">imageData</span><span class="o">.</span><span class="n">SetOrigin</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">imageData</span><span class="o">.</span><span class="n">SetSpacing</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">volumeNode</span><span class="o">=</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLScalarVolumeNode&quot;</span><span class="p">)</span>
<span class="n">volumeNode</span><span class="o">.</span><span class="n">SetAndObserveImageData</span><span class="p">(</span><span class="n">imageData</span><span class="p">)</span>
<span class="n">volumeNode</span><span class="o">.</span><span class="n">SetSpacing</span><span class="p">(</span><span class="n">spacing</span><span class="p">)</span>
<span class="n">volumeNode</span><span class="o">.</span><span class="n">SetOrigin</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">setSliceViewerLayers</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="load-volume-from-a-remote-server">
<h3>Load volume from a remote server<a class="headerlink" href="#load-volume-from-a-remote-server" title="Link to this heading"></a></h3>
<p>Download a volume from a remote server by an URL and load it into the scene using the code snippets below.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Downloaded data is temporarily stored in the application’s cache folder and if the checksum of the already downloaded data
matches the specified checksum (:) then the file is retrieved from the cache instead of being downloaded
again. To compute digest with algo <em>SHA256</em>, you can run <code class="xref py py-func docutils literal notranslate"><span class="pre">slicer.util.computeChecksum(&quot;SHA256&quot;,</span> <span class="pre">&quot;path/to/file&quot;)()</span></code>.</p>
</div>
<section id="simple-download">
<h4>Simple download<a class="headerlink" href="#simple-download" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">SampleData</span>
<span class="n">sampleDataLogic</span> <span class="o">=</span> <span class="n">SampleData</span><span class="o">.</span><span class="n">SampleDataLogic</span><span class="p">()</span>
<span class="n">loadedNodes</span> <span class="o">=</span> <span class="n">sampleDataLogic</span><span class="o">.</span><span class="n">downloadFromURL</span><span class="p">(</span>
  <span class="n">nodeNames</span><span class="o">=</span><span class="s2">&quot;MRHead&quot;</span><span class="p">,</span>
  <span class="n">fileNames</span><span class="o">=</span><span class="s2">&quot;MR-head25.nrrd&quot;</span><span class="p">,</span>
  <span class="n">uris</span><span class="o">=</span><span class="s2">&quot;https://github.com/Slicer/SlicerTestingData/releases/download/SHA256/cc211f0dfd9a05ca3841ce1141b292898b2dd2d3f08286affadf823a7e58df93&quot;</span><span class="p">,</span>
  <span class="n">checksums</span><span class="o">=</span><span class="s2">&quot;SHA256:cc211f0dfd9a05ca3841ce1141b292898b2dd2d3f08286affadf823a7e58df93&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="download-with-interruptible-progress-reporting">
<h4>Download with interruptible progress reporting<a class="headerlink" href="#download-with-interruptible-progress-reporting" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">SampleData</span>

<span class="k">def</span><span class="w"> </span><span class="nf">reportProgress</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="c1"># Print progress in the console</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading... </span><span class="si">{0}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sampleDataLogic</span><span class="o">.</span><span class="n">downloadPercent</span><span class="p">))</span>
  <span class="c1"># Abort download if cancel is clicked in progress bar</span>
  <span class="k">if</span> <span class="n">slicer</span><span class="o">.</span><span class="n">progressWindow</span><span class="o">.</span><span class="n">wasCanceled</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;download aborted&quot;</span><span class="p">)</span>
  <span class="c1"># Update progress window</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">progressWindow</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">progressWindow</span><span class="o">.</span><span class="n">activateWindow</span><span class="p">()</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">progressWindow</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sampleDataLogic</span><span class="o">.</span><span class="n">downloadPercent</span><span class="p">))</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">progressWindow</span><span class="o">.</span><span class="n">setLabelText</span><span class="p">(</span><span class="s2">&quot;Downloading...&quot;</span><span class="p">)</span>
  <span class="c1"># Process events to allow screen to refresh</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

<span class="k">try</span><span class="p">:</span>
  <span class="n">volumeNode</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">progressWindow</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">createProgressDialog</span><span class="p">()</span>
  <span class="n">sampleDataLogic</span> <span class="o">=</span> <span class="n">SampleData</span><span class="o">.</span><span class="n">SampleDataLogic</span><span class="p">()</span>
  <span class="n">sampleDataLogic</span><span class="o">.</span><span class="n">logMessage</span> <span class="o">=</span> <span class="n">reportProgress</span>
  <span class="n">loadedNodes</span> <span class="o">=</span> <span class="n">sampleDataLogic</span><span class="o">.</span><span class="n">downloadFromURL</span><span class="p">(</span>
    <span class="n">nodeNames</span><span class="o">=</span><span class="s2">&quot;MRHead&quot;</span><span class="p">,</span>
    <span class="n">fileNames</span><span class="o">=</span><span class="s2">&quot;MR-head25.nrrd&quot;</span><span class="p">,</span>
    <span class="n">uris</span><span class="o">=</span><span class="s2">&quot;https://github.com/Slicer/SlicerTestingData/releases/download/SHA256/cc211f0dfd9a05ca3841ce1141b292898b2dd2d3f08286affadf823a7e58df93&quot;</span><span class="p">,</span>
    <span class="n">checksums</span><span class="o">=</span><span class="s2">&quot;SHA256:cc211f0dfd9a05ca3841ce1141b292898b2dd2d3f08286affadf823a7e58df93&quot;</span><span class="p">)</span>
  <span class="n">volumeNode</span> <span class="o">=</span> <span class="n">loadedNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">finally</span><span class="p">:</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">progressWindow</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="show-volume-rendering-automatically-when-a-volume-is-loaded">
<h3>Show volume rendering automatically when a volume is loaded<a class="headerlink" href="#show-volume-rendering-automatically-when-a-volume-is-loaded" title="Link to this heading"></a></h3>
<p>To show volume rendering of a volume automatically when it is loaded, add the lines below to your <a class="reference internal" href="../user_guide/settings.html#application-startup-file"><span class="std std-ref">.slicerrc.py file</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@vtk</span><span class="o">.</span><span class="n">calldata_type</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">VTK_OBJECT</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">onNodeAdded</span><span class="p">(</span><span class="n">caller</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">calldata</span><span class="p">):</span>
  <span class="n">node</span> <span class="o">=</span> <span class="n">calldata</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLVolumeNode</span><span class="p">):</span>
    <span class="c1"># Call showVolumeRendering using a timer instead of calling it directly</span>
    <span class="c1"># to allow the volume loading to fully complete.</span>
    <span class="n">qt</span><span class="o">.</span><span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">showVolumeRendering</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">showVolumeRendering</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Show volume rendering of node &quot;</span> <span class="o">+</span> <span class="n">volumeNode</span><span class="o">.</span><span class="n">GetName</span><span class="p">())</span>
  <span class="n">volRenLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">volumerendering</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span>
  <span class="n">displayNode</span> <span class="o">=</span> <span class="n">volRenLogic</span><span class="o">.</span><span class="n">CreateDefaultVolumeRenderingNodes</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">)</span>
  <span class="n">displayNode</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">scalarRange</span> <span class="o">=</span> <span class="n">volumeNode</span><span class="o">.</span><span class="n">GetImageData</span><span class="p">()</span><span class="o">.</span><span class="n">GetScalarRange</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">scalarRange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">scalarRange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1500</span><span class="p">:</span>
    <span class="c1"># Small dynamic range, probably MRI</span>
    <span class="n">displayNode</span><span class="o">.</span><span class="n">GetVolumePropertyNode</span><span class="p">()</span><span class="o">.</span><span class="n">Copy</span><span class="p">(</span><span class="n">volRenLogic</span><span class="o">.</span><span class="n">GetPresetByName</span><span class="p">(</span><span class="s2">&quot;MR-Default&quot;</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="c1"># Larger dynamic range, probably CT</span>
    <span class="n">displayNode</span><span class="o">.</span><span class="n">GetVolumePropertyNode</span><span class="p">()</span><span class="o">.</span><span class="n">Copy</span><span class="p">(</span><span class="n">volRenLogic</span><span class="o">.</span><span class="n">GetPresetByName</span><span class="p">(</span><span class="s2">&quot;CT-Chest-Contrast-Enhanced&quot;</span><span class="p">))</span>

<span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLScene</span><span class="o">.</span><span class="n">NodeAddedEvent</span><span class="p">,</span> <span class="n">onNodeAdded</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="show-volume-rendering-using-maximum-intensity-projection">
<h3>Show volume rendering using maximum intensity projection<a class="headerlink" href="#show-volume-rendering-using-maximum-intensity-projection" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">showVolumeRenderingMIP</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">,</span> <span class="n">useSliceViewColors</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;Render volume using maximum intensity projection</span>
<span class="sd">  :param useSliceViewColors: use the same colors as in slice views.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="c1"># Get/create volume rendering display node</span>
  <span class="n">volRenLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">volumerendering</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span>
  <span class="n">displayNode</span> <span class="o">=</span> <span class="n">volRenLogic</span><span class="o">.</span><span class="n">GetFirstVolumeRenderingDisplayNode</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">)</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">displayNode</span><span class="p">:</span>
    <span class="n">displayNode</span> <span class="o">=</span> <span class="n">volRenLogic</span><span class="o">.</span><span class="n">CreateDefaultVolumeRenderingNodes</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">)</span>
  <span class="c1"># Choose MIP volume rendering preset</span>
  <span class="k">if</span> <span class="n">useSliceViewColors</span><span class="p">:</span>
    <span class="n">volRenLogic</span><span class="o">.</span><span class="n">CopyDisplayToVolumeRenderingDisplayNode</span><span class="p">(</span><span class="n">displayNode</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">scalarRange</span> <span class="o">=</span> <span class="n">volumeNode</span><span class="o">.</span><span class="n">GetImageData</span><span class="p">()</span><span class="o">.</span><span class="n">GetScalarRange</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">scalarRange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">scalarRange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1500</span><span class="p">:</span>
      <span class="c1"># Small dynamic range, probably MRI</span>
      <span class="n">displayNode</span><span class="o">.</span><span class="n">GetVolumePropertyNode</span><span class="p">()</span><span class="o">.</span><span class="n">Copy</span><span class="p">(</span><span class="n">volRenLogic</span><span class="o">.</span><span class="n">GetPresetByName</span><span class="p">(</span><span class="s2">&quot;MR-MIP&quot;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># Larger dynamic range, probably CT</span>
      <span class="n">displayNode</span><span class="o">.</span><span class="n">GetVolumePropertyNode</span><span class="p">()</span><span class="o">.</span><span class="n">Copy</span><span class="p">(</span><span class="n">volRenLogic</span><span class="o">.</span><span class="n">GetPresetByName</span><span class="p">(</span><span class="s2">&quot;CT-MIP&quot;</span><span class="p">))</span>
  <span class="c1"># Switch views to MIP mode</span>
  <span class="k">for</span> <span class="n">viewNode</span> <span class="ow">in</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNodesByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLViewNode&quot;</span><span class="p">):</span>
    <span class="n">viewNode</span><span class="o">.</span><span class="n">SetRaycastTechnique</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLViewNode</span><span class="o">.</span><span class="n">MaximumIntensityProjection</span><span class="p">)</span>
  <span class="c1"># Show volume rendering</span>
  <span class="n">displayNode</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">volumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetFirstNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLScalarVolumeNode&quot;</span><span class="p">)</span>
<span class="n">showVolumeRenderingMIP</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="show-volume-rendering-making-soft-tissues-transparent">
<h3>Show volume rendering making soft tissues transparent<a class="headerlink" href="#show-volume-rendering-making-soft-tissues-transparent" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">showTransparentRendering</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">,</span> <span class="n">maxOpacity</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">gradientThreshold</span><span class="o">=</span><span class="mf">30.0</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;Make constant regions transparent and the entire volume somewhat transparent</span>
<span class="sd">  :param maxOpacity: lower value makes the volume more transparent overall</span>
<span class="sd">    (value is between 0.0 and 1.0)</span>
<span class="sd">  :param gradientThreshold: regions that has gradient value below this threshold will be made transparent</span>
<span class="sd">    (minimum value is 0.0, higher values make more tissues transparent, starting with soft tissues)</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="c1"># Get/create volume rendering display node</span>
  <span class="n">volRenLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">volumerendering</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span>
  <span class="n">displayNode</span> <span class="o">=</span> <span class="n">volRenLogic</span><span class="o">.</span><span class="n">GetFirstVolumeRenderingDisplayNode</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">)</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">displayNode</span><span class="p">:</span>
    <span class="n">displayNode</span> <span class="o">=</span> <span class="n">volRenLogic</span><span class="o">.</span><span class="n">CreateDefaultVolumeRenderingNodes</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">)</span>
  <span class="c1"># Set up gradient vs opacity transfer function</span>
  <span class="n">gradientOpacityTransferFunction</span> <span class="o">=</span> <span class="n">displayNode</span><span class="o">.</span><span class="n">GetVolumePropertyNode</span><span class="p">()</span><span class="o">.</span><span class="n">GetVolumeProperty</span><span class="p">()</span><span class="o">.</span><span class="n">GetGradientOpacity</span><span class="p">()</span>
  <span class="n">gradientOpacityTransferFunction</span><span class="o">.</span><span class="n">RemoveAllPoints</span><span class="p">()</span>
  <span class="n">gradientOpacityTransferFunction</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
  <span class="n">gradientOpacityTransferFunction</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">gradientThreshold</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
  <span class="n">gradientOpacityTransferFunction</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">gradientThreshold</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxOpacity</span><span class="p">)</span>
  <span class="c1"># Show volume rendering</span>
  <span class="n">displayNode</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">volumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetFirstNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLScalarVolumeNode&quot;</span><span class="p">)</span>
<span class="n">showTransparentRendering</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="automatically-load-volumes-that-are-copied-into-a-folder">
<h3>Automatically load volumes that are copied into a folder<a class="headerlink" href="#automatically-load-volumes-that-are-copied-into-a-folder" title="Link to this heading"></a></h3>
<p>This example shows how to implement a simple background task by using a timer. The background task is to check for any new volume files in folder and if there is any then automatically load it.</p>
<p>There are more efficient methods for file system monitoring or exchanging image data in real-time (for example, using OpenIGTLink), the example below is just for demonstration purposes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">incomingVolumeFolder</span> <span class="o">=</span> <span class="s2">&quot;c:/tmp/incoming&quot;</span>
<span class="n">incomingVolumesProcessed</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">checkForNewVolumes</span><span class="p">():</span>
  <span class="c1"># Check if there is a new file in the</span>
  <span class="kn">from</span><span class="w"> </span><span class="nn">os</span><span class="w"> </span><span class="kn">import</span> <span class="n">listdir</span>
  <span class="kn">from</span><span class="w"> </span><span class="nn">os.path</span><span class="w"> </span><span class="kn">import</span> <span class="n">isfile</span><span class="p">,</span> <span class="n">join</span>
  <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">listdir</span><span class="p">(</span><span class="n">incomingVolumeFolder</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">incomingVolumesProcessed</span><span class="p">:</span>
      <span class="c1"># This is an incoming file, it was already there</span>
      <span class="k">continue</span>
    <span class="n">filePath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">incomingVolumeFolder</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">isfile</span><span class="p">(</span><span class="n">filePath</span><span class="p">):</span>
      <span class="c1"># ignore directories</span>
      <span class="k">continue</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading new file: &quot;</span> <span class="o">+</span> <span class="n">f</span><span class="p">)</span>
    <span class="n">incomingVolumesProcessed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">loadVolume</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>
  <span class="c1"># Check again in 3000ms</span>
  <span class="n">qt</span><span class="o">.</span><span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="n">checkForNewVolumes</span><span class="p">)</span>

<span class="c1"># Start monitoring</span>
<span class="n">checkForNewVolumes</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="extract-slice-from-volume">
<h3>Extract slice from volume<a class="headerlink" href="#extract-slice-from-volume" title="Link to this heading"></a></h3>
<p>This code snippet can extract arbitrarily oriented slice from a volume. The slice position, orientation, and size is specified by a markup plane node.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Inputs</span>
<span class="n">volumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetFirstNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLScalarVolumeNode&quot;</span><span class="p">)</span>  <span class="c1"># input 3D volume</span>
<span class="n">planeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetFirstNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLMarkupsPlaneNode&quot;</span><span class="p">)</span>  <span class="c1"># input markup plane</span>
<span class="n">spacing</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>  <span class="c1"># spacing of the extracted image slice</span>

<span class="c1"># Create slice image node</span>
<span class="n">sliceImageNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLScalarVolumeNode&quot;</span><span class="p">)</span>
<span class="n">sliceImageNode</span><span class="o">.</span><span class="n">CreateDefaultDisplayNodes</span><span class="p">()</span>
<span class="n">imageData</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkImageData</span><span class="p">()</span>
<span class="n">sliceImageNode</span><span class="o">.</span><span class="n">SetAndObserveImageData</span><span class="p">(</span><span class="n">imageData</span><span class="p">)</span>
<span class="c1"># Set image size</span>
<span class="n">sizeWorld</span> <span class="o">=</span> <span class="n">planeNode</span><span class="o">.</span><span class="n">GetSizeWorld</span><span class="p">()</span>
<span class="n">imageData</span><span class="o">.</span><span class="n">SetExtent</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sizeWorld</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">spacing</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sizeWorld</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">spacing</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">imageData</span><span class="o">.</span><span class="n">AllocateScalars</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">VTK_UNSIGNED_CHAR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># Set spacing</span>
<span class="n">sliceImageNode</span><span class="o">.</span><span class="n">SetSpacing</span><span class="p">(</span><span class="n">spacing</span><span class="p">)</span>
<span class="c1"># Set directions</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">ijkToRASDirections</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">planeNode</span><span class="o">.</span><span class="n">GetAxesWorld</span><span class="p">(</span><span class="n">ijkToRASDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ijkToRASDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ijkToRASDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">sliceImageNode</span><span class="o">.</span><span class="n">SetIJKToRASDirections</span><span class="p">(</span><span class="n">ijkToRASDirections</span><span class="p">)</span>
<span class="c1"># Set origin</span>
<span class="n">origin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">planeNode</span><span class="o">.</span><span class="n">GetCenter</span><span class="p">())</span> <span class="o">-</span> <span class="n">ijkToRASDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">sizeWorld</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">ijkToRASDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">sizeWorld</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">sliceImageNode</span><span class="o">.</span><span class="n">SetOrigin</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span>

<span class="c1"># Resample the volume to the slice image node</span>
<span class="n">referenceVolumeNode</span> <span class="o">=</span> <span class="n">sliceImageNode</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;inputVolume&quot;</span><span class="p">:</span> <span class="n">volumeNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">(),</span>
    <span class="s2">&quot;outputVolume&quot;</span><span class="p">:</span> <span class="n">sliceImageNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">(),</span>
    <span class="s2">&quot;referenceVolume&quot;</span><span class="p">:</span> <span class="n">sliceImageNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">(),</span>
    <span class="s2">&quot;interpolationType&quot;</span><span class="p">:</span> <span class="s2">&quot;linear&quot;</span>
<span class="p">}</span>
<span class="n">parameterNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">resamplescalarvectordwivolume</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">wait_for_completion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">update_display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">RemoveNode</span><span class="p">(</span><span class="n">parameterNode</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="extract-randomly-oriented-slabs-of-given-shape-from-a-volume">
<h3>Extract randomly oriented slabs of given shape from a volume<a class="headerlink" href="#extract-randomly-oriented-slabs-of-given-shape-from-a-volume" title="Link to this heading"></a></h3>
<p>Returns a numpy array of sliceCount random tiles.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">randomSlices</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="n">sliceCount</span><span class="p">,</span> <span class="n">sliceShape</span><span class="p">):</span>
  <span class="n">layoutManager</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span>
  <span class="n">redWidget</span> <span class="o">=</span> <span class="n">layoutManager</span><span class="o">.</span><span class="n">sliceWidget</span><span class="p">(</span><span class="s2">&quot;Red&quot;</span><span class="p">)</span>
  <span class="n">sliceNode</span> <span class="o">=</span> <span class="n">redWidget</span><span class="o">.</span><span class="n">mrmlSliceNode</span><span class="p">()</span>
  <span class="n">sliceNode</span><span class="o">.</span><span class="n">SetDimensions</span><span class="p">(</span><span class="o">*</span><span class="n">sliceShape</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="n">sliceNode</span><span class="o">.</span><span class="n">SetFieldOfView</span><span class="p">(</span><span class="o">*</span><span class="n">sliceShape</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span>
  <span class="n">volume</span><span class="o">.</span><span class="n">GetRASBounds</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>
  <span class="n">imageReslice</span> <span class="o">=</span> <span class="n">redWidget</span><span class="o">.</span><span class="n">sliceLogic</span><span class="p">()</span><span class="o">.</span><span class="n">GetBackgroundLayer</span><span class="p">()</span><span class="o">.</span><span class="n">GetReslice</span><span class="p">()</span>

  <span class="n">sliceSize</span> <span class="o">=</span> <span class="n">sliceShape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">sliceShape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">sliceCount</span><span class="p">,</span> <span class="n">sliceSize</span><span class="p">])</span>

  <span class="k">for</span> <span class="n">sliceIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sliceCount</span><span class="p">):</span>
    <span class="n">position</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
      <span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
      <span class="n">bounds</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">-</span><span class="n">bounds</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">position</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
    <span class="n">normal</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">normal</span> <span class="o">=</span> <span class="n">normal</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>
    <span class="n">transverse</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">orientation</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">sliceNode</span><span class="o">.</span><span class="n">SetSliceToRASByNTP</span><span class="p">(</span> <span class="n">normal</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">normal</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">normal</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
      <span class="n">transverse</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">transverse</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">transverse</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
      <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">position</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
      <span class="n">orientation</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sliceIndex</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
    <span class="n">imageReslice</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
    <span class="n">imageData</span> <span class="o">=</span> <span class="n">imageReslice</span><span class="o">.</span><span class="n">GetOutputDataObject</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">numpy_support</span><span class="o">.</span><span class="n">vtk_to_numpy</span><span class="p">(</span><span class="n">imageData</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span><span class="o">.</span><span class="n">GetScalars</span><span class="p">())</span>
    <span class="n">X</span><span class="p">[</span><span class="n">sliceIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span>
  <span class="k">return</span> <span class="n">X</span>
</pre></div>
</div>
</section>
<section id="clone-a-volume">
<h3>Clone a volume<a class="headerlink" href="#clone-a-volume" title="Link to this heading"></a></h3>
<p>This example shows how to clone the MRHead sample volume, including its pixel data and display settings.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sourceVolumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;MRHead&quot;</span><span class="p">)</span>
<span class="n">volumesLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">volumes</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span>
<span class="n">clonedVolumeNode</span> <span class="o">=</span> <span class="n">volumesLogic</span><span class="o">.</span><span class="n">CloneVolume</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="p">,</span> <span class="n">sourceVolumeNode</span><span class="p">,</span> <span class="s2">&quot;Cloned volume&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="create-a-new-volume">
<h3>Create a new volume<a class="headerlink" href="#create-a-new-volume" title="Link to this heading"></a></h3>
<p>This example shows how to create a new empty volume. The “Image Maker” extension contains a module that allows creating a volume from scratch without programming.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nodeName</span> <span class="o">=</span> <span class="s2">&quot;MyNewVolume&quot;</span>
<span class="n">imageSize</span> <span class="o">=</span> <span class="p">[</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">]</span>
<span class="n">voxelType</span><span class="o">=</span><span class="n">vtk</span><span class="o">.</span><span class="n">VTK_UNSIGNED_CHAR</span>
<span class="n">imageOrigin</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
<span class="n">imageSpacing</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="n">imageDirections</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">fillVoxelValue</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Create an empty image volume, filled with fillVoxelValue</span>
<span class="n">imageData</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkImageData</span><span class="p">()</span>
<span class="n">imageData</span><span class="o">.</span><span class="n">SetDimensions</span><span class="p">(</span><span class="n">imageSize</span><span class="p">)</span>
<span class="n">imageData</span><span class="o">.</span><span class="n">AllocateScalars</span><span class="p">(</span><span class="n">voxelType</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">imageData</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span><span class="o">.</span><span class="n">GetScalars</span><span class="p">()</span><span class="o">.</span><span class="n">Fill</span><span class="p">(</span><span class="n">fillVoxelValue</span><span class="p">)</span>
<span class="c1"># Create volume node</span>
<span class="n">volumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLScalarVolumeNode&quot;</span><span class="p">,</span> <span class="n">nodeName</span><span class="p">)</span>
<span class="n">volumeNode</span><span class="o">.</span><span class="n">SetOrigin</span><span class="p">(</span><span class="n">imageOrigin</span><span class="p">)</span>
<span class="n">volumeNode</span><span class="o">.</span><span class="n">SetSpacing</span><span class="p">(</span><span class="n">imageSpacing</span><span class="p">)</span>
<span class="n">volumeNode</span><span class="o">.</span><span class="n">SetIJKToRASDirections</span><span class="p">(</span><span class="n">imageDirections</span><span class="p">)</span>
<span class="n">volumeNode</span><span class="o">.</span><span class="n">SetAndObserveImageData</span><span class="p">(</span><span class="n">imageData</span><span class="p">)</span>
<span class="n">volumeNode</span><span class="o">.</span><span class="n">CreateDefaultDisplayNodes</span><span class="p">()</span>
<span class="n">volumeNode</span><span class="o">.</span><span class="n">CreateDefaultStorageNode</span><span class="p">()</span>
</pre></div>
</div>
<p>C++:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">vtkNew</span><span class="o">&lt;</span><span class="n">vtkImageData</span><span class="o">&gt;</span><span class="w"> </span><span class="n">imageData</span><span class="p">;</span>
<span class="n">imageData</span><span class="o">-&gt;</span><span class="n">SetDimensions</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span><span class="w"> </span><span class="c1">// image size</span>
<span class="n">imageData</span><span class="o">-&gt;</span><span class="n">AllocateScalars</span><span class="p">(</span><span class="n">VTK_UNSIGNED_CHAR</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// image type and number of components</span>
<span class="c1">// initialize the pixels here</span>

<span class="n">vtkNew</span><span class="o">&lt;</span><span class="n">vtkMRMLScalarVolumeNode</span><span class="o">&gt;</span><span class="w"> </span><span class="n">volumeNode</span><span class="p">;</span>
<span class="n">volumeNode</span><span class="o">-&gt;</span><span class="n">SetAndObserveImageData</span><span class="p">(</span><span class="n">imageData</span><span class="p">);</span>
<span class="n">volumeNode</span><span class="o">-&gt;</span><span class="n">SetOrigin</span><span class="p">(</span><span class="w"> </span><span class="mf">-10.</span><span class="p">,</span><span class="w"> </span><span class="mf">-10.</span><span class="p">,</span><span class="w"> </span><span class="mf">-10.</span><span class="p">);</span>
<span class="n">volumeNode</span><span class="o">-&gt;</span><span class="n">SetSpacing</span><span class="p">(</span><span class="w"> </span><span class="mf">2.</span><span class="p">,</span><span class="w"> </span><span class="mf">2.</span><span class="p">,</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="p">);</span>
<span class="n">mrmlScene</span><span class="o">-&gt;</span><span class="n">AddNode</span><span class="p">(</span><span class="w"> </span><span class="n">volumeNode</span><span class="p">.</span><span class="n">GetPointer</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>

<span class="n">volumeNode</span><span class="o">-&gt;</span><span class="n">CreateDefaultDisplayNodes</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Origin and spacing must be set on the volume node instead of the image data.</p>
</div>
</section>
<section id="create-a-new-volume-from-roi">
<h3>Create a new volume from ROI<a class="headerlink" href="#create-a-new-volume-from-roi" title="Link to this heading"></a></h3>
<p>This example shows how to create a new empty volume with a specified voxel size, with axis directions and extents set from a markups ROI node.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">createVolumeFromRoi</span><span class="p">(</span><span class="n">exportRoi</span><span class="p">,</span> <span class="n">spacingMm</span><span class="p">,</span> <span class="n">fillValue</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">numberOfComponents</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
    <span class="n">roiDiameter</span> <span class="o">=</span> <span class="n">exportRoi</span><span class="o">.</span><span class="n">GetSize</span><span class="p">()</span>
    <span class="n">roiOrigin_Roi</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">roiDiameter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">roiDiameter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">roiDiameter</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">roiToRas</span> <span class="o">=</span> <span class="n">exportRoi</span><span class="o">.</span><span class="n">GetObjectToWorldMatrix</span><span class="p">()</span>
    <span class="n">exportVolumeSize</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">diameterComponent</span><span class="o">/</span><span class="n">spacingMm</span><span class="p">))</span> <span class="k">for</span> <span class="n">diameterComponent</span> <span class="ow">in</span> <span class="n">roiDiameter</span><span class="p">]</span>
    <span class="c1"># Create image data</span>
    <span class="n">exportImageData</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkImageData</span><span class="p">()</span>
    <span class="n">exportImageData</span><span class="o">.</span><span class="n">SetExtent</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">exportVolumeSize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">exportVolumeSize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">exportVolumeSize</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">exportImageData</span><span class="o">.</span><span class="n">AllocateScalars</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">VTK_DOUBLE</span><span class="p">,</span> <span class="n">numberOfComponents</span><span class="p">)</span>
    <span class="n">exportImageData</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span><span class="o">.</span><span class="n">GetScalars</span><span class="p">()</span><span class="o">.</span><span class="n">Fill</span><span class="p">(</span><span class="n">fillValue</span><span class="p">)</span>
    <span class="c1"># Create volume node</span>
    <span class="n">exportVolume</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLScalarVolumeNode&quot;</span> <span class="k">if</span> <span class="n">numberOfComponents</span><span class="o">==</span><span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;vtkMRMLVectorVolumeNode&quot;</span><span class="p">)</span>
    <span class="n">exportVolume</span><span class="o">.</span><span class="n">SetAndObserveImageData</span><span class="p">(</span><span class="n">exportImageData</span><span class="p">)</span>
    <span class="n">exportVolume</span><span class="o">.</span><span class="n">SetIJKToRASDirections</span><span class="p">(</span><span class="n">roiToRas</span><span class="o">.</span><span class="n">GetElement</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">roiToRas</span><span class="o">.</span><span class="n">GetElement</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">roiToRas</span><span class="o">.</span><span class="n">GetElement</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">roiToRas</span><span class="o">.</span><span class="n">GetElement</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">roiToRas</span><span class="o">.</span><span class="n">GetElement</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">roiToRas</span><span class="o">.</span><span class="n">GetElement</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">roiToRas</span><span class="o">.</span><span class="n">GetElement</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">roiToRas</span><span class="o">.</span><span class="n">GetElement</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">roiToRas</span><span class="o">.</span><span class="n">GetElement</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">exportVolume</span><span class="o">.</span><span class="n">SetSpacing</span><span class="p">(</span><span class="n">spacingMm</span><span class="p">,</span> <span class="n">spacingMm</span><span class="p">,</span> <span class="n">spacingMm</span><span class="p">)</span>
    <span class="n">roiOrigin_Ras</span> <span class="o">=</span> <span class="n">roiToRas</span><span class="o">.</span><span class="n">MultiplyPoint</span><span class="p">(</span><span class="n">roiOrigin_Roi</span><span class="p">)</span>
    <span class="n">exportVolume</span><span class="o">.</span><span class="n">SetOrigin</span><span class="p">(</span><span class="n">roiOrigin_Ras</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">exportVolume</span>

<span class="c1"># Create volume node from ROI node &quot;R&quot;</span>
<span class="n">roiNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">)</span>
<span class="n">volumeNode</span> <span class="o">=</span> <span class="n">createVolumeFromRoi</span><span class="p">(</span><span class="n">roiNode</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span>
<span class="c1"># Show in slice views and set its window/level</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">setSliceViewerLayers</span><span class="p">(</span><span class="n">background</span><span class="o">=</span><span class="n">volumeNode</span><span class="p">)</span>
<span class="n">volumeNode</span><span class="o">.</span><span class="n">GetScalarVolumeDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">AutoWindowLevelOff</span><span class="p">()</span>
<span class="n">volumeNode</span><span class="o">.</span><span class="n">GetScalarVolumeDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetWindowLevel</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span><span class="mi">130</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="get-value-of-a-volume-at-specific-voxel-coordinates">
<h3>Get value of a volume at specific voxel coordinates<a class="headerlink" href="#get-value-of-a-volume-at-specific-voxel-coordinates" title="Link to this heading"></a></h3>
<p>This example shows how to get voxel value of “volumeNode” at “ijk” volume voxel coordinates.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">volumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;MRHead&quot;</span><span class="p">)</span>
<span class="n">ijk</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">30</span><span class="p">]</span>  <span class="c1"># volume voxel coordinates</span>

<span class="n">voxels</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromVolume</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">)</span>  <span class="c1"># get voxels as a numpy array</span>
<span class="n">voxelValue</span> <span class="o">=</span> <span class="n">voxels</span><span class="p">[</span><span class="n">ijk</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ijk</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ijk</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1"># note that numpy array index order is kji (not ijk)</span>
</pre></div>
</div>
</section>
<section id="modify-voxels-in-a-volume">
<h3>Modify voxels in a volume<a class="headerlink" href="#modify-voxels-in-a-volume" title="Link to this heading"></a></h3>
<p>Typically the fastest and simplest way of modifying voxels is by using numpy operators. Voxels can be retrieved in a numpy array using the <code class="docutils literal notranslate"><span class="pre">array</span></code> method and modified using standard numpy methods. For example, threshold a volume:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nodeName</span> <span class="o">=</span> <span class="s2">&quot;MRHead&quot;</span>
<span class="n">thresholdValue</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">voxelArray</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">nodeName</span><span class="p">)</span> <span class="c1"># get voxels as numpy array</span>
<span class="n">voxelArray</span><span class="p">[</span><span class="n">voxelArray</span> <span class="o">&lt;</span> <span class="n">thresholdValue</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># modify voxel values</span>
<span class="n">getNode</span><span class="p">(</span><span class="n">nodeName</span><span class="p">)</span><span class="o">.</span><span class="n">Modified</span><span class="p">()</span> <span class="c1"># at the end of all processing, notify Slicer that the image modification is completed</span>
</pre></div>
</div>
<p>This example shows how to change voxels values of the MRHead sample volume. The values will be computed by function <code class="docutils literal notranslate"><span class="pre">f(r,a,s,)</span> <span class="pre">=</span> <span class="pre">(r-10)*(r-10)+(a+15)*(a+15)+s*s</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">volumeNode</span><span class="o">=</span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;MRHead&quot;</span><span class="p">)</span>
<span class="n">ijkToRas</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMatrix4x4</span><span class="p">()</span>
<span class="n">volumeNode</span><span class="o">.</span><span class="n">GetIJKToRASMatrix</span><span class="p">(</span><span class="n">ijkToRas</span><span class="p">)</span>
<span class="n">imageData</span><span class="o">=</span><span class="n">volumeNode</span><span class="o">.</span><span class="n">GetImageData</span><span class="p">()</span>
<span class="n">extent</span> <span class="o">=</span> <span class="n">imageData</span><span class="o">.</span><span class="n">GetExtent</span><span class="p">()</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">extent</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">extent</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
      <span class="n">position_Ijk</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
      <span class="n">position_Ras</span><span class="o">=</span><span class="n">ijkToRas</span><span class="o">.</span><span class="n">MultiplyPoint</span><span class="p">(</span><span class="n">position_Ijk</span><span class="p">)</span>
      <span class="n">r</span><span class="o">=</span><span class="n">position_Ras</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">a</span><span class="o">=</span><span class="n">position_Ras</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">s</span><span class="o">=</span><span class="n">position_Ras</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
      <span class="n">functionValue</span><span class="o">=</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mi">15</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mi">15</span><span class="p">)</span><span class="o">+</span><span class="n">s</span><span class="o">*</span><span class="n">s</span>
      <span class="n">imageData</span><span class="o">.</span><span class="n">SetScalarComponentFromDouble</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">functionValue</span><span class="p">)</span>
<span class="n">imageData</span><span class="o">.</span><span class="n">Modified</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="get-volume-voxel-coordinates-from-markup-control-point-ras-coordinates">
<h3>Get volume voxel coordinates from markup control point RAS coordinates<a class="headerlink" href="#get-volume-voxel-coordinates-from-markup-control-point-ras-coordinates" title="Link to this heading"></a></h3>
<p>This example shows how to get voxel coordinate of a volume corresponding to a markup control point position.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Inputs</span>
<span class="n">volumeNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;MRHead&quot;</span><span class="p">)</span>
<span class="n">pointListNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
<span class="n">markupsIndex</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Get point coordinate in RAS</span>
<span class="n">point_Ras</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">pointListNode</span><span class="o">.</span><span class="n">GetNthControlPointPositionWorld</span><span class="p">(</span><span class="n">markupsIndex</span><span class="p">,</span> <span class="n">point_Ras</span><span class="p">)</span>

<span class="c1"># If volume node is transformed, apply that transform to get volume&#39;s RAS coordinates</span>
<span class="n">transformRasToVolumeRas</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkGeneralTransform</span><span class="p">()</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLTransformNode</span><span class="o">.</span><span class="n">GetTransformBetweenNodes</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">volumeNode</span><span class="o">.</span><span class="n">GetParentTransformNode</span><span class="p">(),</span> <span class="n">transformRasToVolumeRas</span><span class="p">)</span>
<span class="n">point_VolumeRas</span> <span class="o">=</span> <span class="n">transformRasToVolumeRas</span><span class="o">.</span><span class="n">TransformPoint</span><span class="p">(</span><span class="n">point_Ras</span><span class="p">)</span>

<span class="c1"># Get voxel coordinates from physical coordinates</span>
<span class="n">volumeRasToIjk</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMatrix4x4</span><span class="p">()</span>
<span class="n">volumeNode</span><span class="o">.</span><span class="n">GetRASToIJKMatrix</span><span class="p">(</span><span class="n">volumeRasToIjk</span><span class="p">)</span>
<span class="n">point_Ijk</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">volumeRasToIjk</span><span class="o">.</span><span class="n">MultiplyPoint</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point_VolumeRas</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span> <span class="n">point_Ijk</span><span class="p">)</span>
<span class="n">point_Ijk</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">point_Ijk</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="p">]</span>

<span class="c1"># Print output</span>
<span class="nb">print</span><span class="p">(</span><span class="n">point_Ijk</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="get-markup-control-point-ras-coordinates-from-volume-voxel-coordinates">
<h3>Get markup control point RAS coordinates from volume voxel coordinates<a class="headerlink" href="#get-markup-control-point-ras-coordinates-from-volume-voxel-coordinates" title="Link to this heading"></a></h3>
<p>This example shows how to get position of maximum intensity voxel of a volume (determined by numpy, in IJK coordinates) in RAS coordinates so that it can be marked with a markup control point.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Inputs</span>
<span class="n">volumeNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;MRHead&quot;</span><span class="p">)</span>
<span class="n">pointListNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>

<span class="c1"># Get voxel position in IJK coordinate system</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">volumeArray</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromVolume</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">)</span>
<span class="c1"># Get position of highest voxel value</span>
<span class="n">point_Kji</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">volumeArray</span> <span class="o">==</span> <span class="n">volumeArray</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">point_Ijk</span> <span class="o">=</span> <span class="p">[</span><span class="n">point_Kji</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">point_Kji</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">point_Kji</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>

<span class="c1"># Get physical coordinates from voxel coordinates</span>
<span class="n">volumeIjkToRas</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMatrix4x4</span><span class="p">()</span>
<span class="n">volumeNode</span><span class="o">.</span><span class="n">GetIJKToRASMatrix</span><span class="p">(</span><span class="n">volumeIjkToRas</span><span class="p">)</span>
<span class="n">point_VolumeRas</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">volumeIjkToRas</span><span class="o">.</span><span class="n">MultiplyPoint</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point_Ijk</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span> <span class="n">point_VolumeRas</span><span class="p">)</span>

<span class="c1"># If volume node is transformed, apply that transform to get volume&#39;s RAS coordinates</span>
<span class="n">transformVolumeRasToRas</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkGeneralTransform</span><span class="p">()</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLTransformNode</span><span class="o">.</span><span class="n">GetTransformBetweenNodes</span><span class="p">(</span><span class="n">volumeNode</span><span class="o">.</span><span class="n">GetParentTransformNode</span><span class="p">(),</span> <span class="kc">None</span><span class="p">,</span> <span class="n">transformVolumeRasToRas</span><span class="p">)</span>
<span class="n">point_Ras</span> <span class="o">=</span> <span class="n">transformVolumeRasToRas</span><span class="o">.</span><span class="n">TransformPoint</span><span class="p">(</span><span class="n">point_VolumeRas</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>

<span class="c1"># Add a markup at the computed position and print its coordinates</span>
<span class="n">pointListNode</span><span class="o">.</span><span class="n">AddControlPoint</span><span class="p">((</span><span class="n">point_Ras</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">point_Ras</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">point_Ras</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="s2">&quot;max&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">point_Ras</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="get-the-values-of-all-voxels-for-a-label-value">
<h3>Get the values of all voxels for a label value<a class="headerlink" href="#get-the-values-of-all-voxels-for-a-label-value" title="Link to this heading"></a></h3>
<p>If you have a background image called ‘Volume’ and a mask called ‘Volume-label’ created with the Segment Editor you could do something like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<span class="n">volume</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s2">&quot;Volume&quot;</span><span class="p">)</span>
<span class="n">label</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s2">&quot;Volume-label&quot;</span><span class="p">)</span>
<span class="n">points</span>  <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">label</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span>  <span class="c1"># or use another label number depending on what you segmented</span>
<span class="n">values</span>  <span class="o">=</span> <span class="n">volume</span><span class="p">[</span><span class="n">points</span><span class="p">]</span> <span class="c1"># this will be a list of the label values</span>
<span class="n">values</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="c1"># should match the mean value of LabelStatistics calculation as a double-check</span>
<span class="n">numpy</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s2">&quot;values.txt&quot;</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="access-values-in-a-dti-tensor-volume">
<h3>Access values in a DTI tensor volume<a class="headerlink" href="#access-values-in-a-dti-tensor-volume" title="Link to this heading"></a></h3>
<p>This example shows how to access individual tensors at the voxel level.</p>
<p>First load your DWI volume and estimate tensors to produce a DTI volume called ‘Output DTI Volume’.</p>
<p>Then open the python window: View-&gt;Python console.</p>
<p>Use this command to access tensors through numpy:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tensors</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s2">&quot;Output DTI Volume&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Type the following code into the Python window to access all tensor components using vtk commands:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">volumeNode</span><span class="o">=</span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Output DTI Volume&quot;</span><span class="p">)</span>
<span class="n">imageData</span><span class="o">=</span><span class="n">volumeNode</span><span class="o">.</span><span class="n">GetImageData</span><span class="p">()</span>
<span class="n">tensors</span> <span class="o">=</span> <span class="n">imageData</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span><span class="o">.</span><span class="n">GetTensors</span><span class="p">()</span>
<span class="n">extent</span> <span class="o">=</span> <span class="n">imageData</span><span class="o">.</span><span class="n">GetExtent</span><span class="p">()</span>
<span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">extent</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">extent</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
      <span class="n">tensors</span><span class="o">.</span><span class="n">GetTuple9</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
      <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</section>
<section id="change-window-level-brightness-contrast-or-colormap-of-a-volume">
<h3>Change window/level (brightness/contrast) or colormap of a volume<a class="headerlink" href="#change-window-level-brightness-contrast-or-colormap-of-a-volume" title="Link to this heading"></a></h3>
<p>This example shows how to change window/level of the MRHead sample volume.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">volumeNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;MRHead&quot;</span><span class="p">)</span>
<span class="n">displayNode</span> <span class="o">=</span> <span class="n">volumeNode</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span>
<span class="n">displayNode</span><span class="o">.</span><span class="n">AutoWindowLevelOff</span><span class="p">()</span>
<span class="n">displayNode</span><span class="o">.</span><span class="n">SetWindow</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="n">displayNode</span><span class="o">.</span><span class="n">SetLevel</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>Change color mapping from grayscale to rainbow:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">displayNode</span><span class="o">.</span><span class="n">SetAndObserveColorNodeID</span><span class="p">(</span><span class="s2">&quot;vtkMRMLColorTableNodeRainbow&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="make-mouse-left-click-and-drag-on-the-image-adjust-window-level">
<h3>Make mouse left-click and drag on the image adjust window/level<a class="headerlink" href="#make-mouse-left-click-and-drag-on-the-image-adjust-window-level" title="Link to this heading"></a></h3>
<p>In older Slicer versions, by default, left-click and drag in a slice view adjusted window/level of the displayed image. Window/level adjustment is now a new mouse mode that can be activated by clicking on its toolbar button or running this code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">applicationLogic</span><span class="p">()</span><span class="o">.</span><span class="n">GetInteractionNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetCurrentInteractionMode</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLInteractionNode</span><span class="o">.</span><span class="n">AdjustWindowLevel</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="reset-field-of-view-to-show-background-volume-maximized">
<h3>Reset field of view to show background volume maximized<a class="headerlink" href="#reset-field-of-view-to-show-background-volume-maximized" title="Link to this heading"></a></h3>
<p>Equivalent to click small rectangle button (“Adjust the slice viewer’s field of view…”) in the slice view controller.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">resetSliceViews</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="rotate-slice-views-to-volume-plane">
<h3>Rotate slice views to volume plane<a class="headerlink" href="#rotate-slice-views-to-volume-plane" title="Link to this heading"></a></h3>
<p>Aligns slice views to volume axes, shows original image acquisition planes in slice views.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">volumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;MRHead&quot;</span><span class="p">)</span>
<span class="n">layoutManager</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span>
<span class="k">for</span> <span class="n">sliceViewName</span> <span class="ow">in</span> <span class="n">layoutManager</span><span class="o">.</span><span class="n">sliceViewNames</span><span class="p">():</span>
  <span class="n">layoutManager</span><span class="o">.</span><span class="n">sliceWidget</span><span class="p">(</span><span class="n">sliceViewName</span><span class="p">)</span><span class="o">.</span><span class="n">mrmlSliceNode</span><span class="p">()</span><span class="o">.</span><span class="n">RotateToVolumePlane</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="iterate-over-current-visible-slice-views-and-set-foreground-and-background-images">
<h3>Iterate over current visible slice views, and set foreground and background images<a class="headerlink" href="#iterate-over-current-visible-slice-views-and-set-foreground-and-background-images" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">setSliceViewerLayers</span><span class="p">(</span><span class="n">background</span><span class="o">=</span><span class="n">mrVolume</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="n">ctVolume</span><span class="p">)</span>
</pre></div>
</div>
<p>Internally, this method performs something like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">layoutManager</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span>
<span class="k">for</span> <span class="n">sliceViewName</span> <span class="ow">in</span> <span class="n">layoutManager</span><span class="o">.</span><span class="n">sliceViewNames</span><span class="p">():</span>
  <span class="n">compositeNode</span> <span class="o">=</span> <span class="n">layoutManager</span><span class="o">.</span><span class="n">sliceWidget</span><span class="p">(</span><span class="n">sliceViewName</span><span class="p">)</span><span class="o">.</span><span class="n">sliceLogic</span><span class="p">()</span><span class="o">.</span><span class="n">GetSliceCompositeNode</span><span class="p">()</span>
  <span class="c1"># Setup background volume</span>
  <span class="n">compositeNode</span><span class="o">.</span><span class="n">SetBackgroundVolumeID</span><span class="p">(</span><span class="n">mrVolume</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
  <span class="c1"># Setup foreground volume</span>
  <span class="n">compositeNode</span><span class="o">.</span><span class="n">SetForegroundVolumeID</span><span class="p">(</span><span class="n">ctVolume</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
  <span class="c1"># Change opacity</span>
  <span class="n">compositeNode</span><span class="o">.</span><span class="n">SetForegroundOpacity</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="show-a-volume-in-slice-views">
<h3>Show a volume in slice views<a class="headerlink" href="#show-a-volume-in-slice-views" title="Link to this heading"></a></h3>
<p>Recommended:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">volumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;YourVolumeNode&quot;</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">setSliceViewerLayers</span><span class="p">(</span><span class="n">background</span><span class="o">=</span><span class="n">volumeNode</span><span class="p">)</span>
</pre></div>
</div>
<p>or</p>
<p>Show volume in all visible views where volume selection propagation is enabled:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">volumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;YourVolumeNode&quot;</span><span class="p">)</span>
<span class="n">applicationLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">applicationLogic</span><span class="p">()</span>
<span class="n">selectionNode</span> <span class="o">=</span> <span class="n">applicationLogic</span><span class="o">.</span><span class="n">GetSelectionNode</span><span class="p">()</span>
<span class="n">selectionNode</span><span class="o">.</span><span class="n">SetSecondaryVolumeID</span><span class="p">(</span><span class="n">volumeNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
<span class="n">applicationLogic</span><span class="o">.</span><span class="n">PropagateForegroundVolumeSelection</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>or</p>
<p>Show volume in selected views:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span>  <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;YourVolumeNode&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Red&quot;</span><span class="p">,</span> <span class="s2">&quot;Yellow&quot;</span><span class="p">,</span> <span class="s2">&quot;Green&quot;</span><span class="p">]:</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span><span class="o">.</span><span class="n">sliceWidget</span><span class="p">(</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">sliceLogic</span><span class="p">()</span><span class="o">.</span><span class="n">GetSliceCompositeNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetForegroundVolumeID</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
</pre></div>
</div>
</section>
<section id="change-opacity-of-foreground-volume-in-slice-views">
<h3>Change opacity of foreground volume in slice views<a class="headerlink" href="#change-opacity-of-foreground-volume-in-slice-views" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">setSliceViewerLayers</span><span class="p">(</span><span class="n">foregroundOpacity</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
</pre></div>
</div>
<p>or</p>
<p>Change opacity in a selected view</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lm</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">layoutManager</span><span class="p">()</span>
<span class="n">sliceLogic</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">sliceWidget</span><span class="p">(</span><span class="s2">&quot;Red&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sliceLogic</span><span class="p">()</span>
<span class="n">compositeNode</span> <span class="o">=</span> <span class="n">sliceLogic</span><span class="o">.</span><span class="n">GetSliceCompositeNode</span><span class="p">()</span>
<span class="n">compositeNode</span><span class="o">.</span><span class="n">SetForegroundOpacity</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="turning-off-interpolation">
<h3>Turning off interpolation<a class="headerlink" href="#turning-off-interpolation" title="Link to this heading"></a></h3>
<p>You can turn off interpolation for newly loaded volumes with this script from Steve Pieper.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">NoInterpolate</span><span class="p">(</span><span class="n">caller</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">getNodes</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">IsA</span><span class="p">(</span><span class="s2">&quot;vtkMRMLScalarVolumeDisplayNode&quot;</span><span class="p">):</span>
      <span class="n">node</span><span class="o">.</span><span class="n">SetInterpolate</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">NodeAddedEvent</span><span class="p">,</span> <span class="n">NoInterpolate</span><span class="p">)</span>
</pre></div>
</div>
<p>You can place this code snippet in your <a class="reference internal" href="../user_guide/settings.html#application-startup-file"><span class="std std-ref">.slicerrc.py file</span></a> to always disable interpolation by default.</p>
</section>
<section id="running-an-itk-filter-in-python-using-simpleitk">
<h3>Running an ITK filter in Python using SimpleITK<a class="headerlink" href="#running-an-itk-filter-in-python-using-simpleitk" title="Link to this heading"></a></h3>
<p>Open the “Sample Data” module and download “MR Head”, then paste the following snippet in Python console:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">SampleData</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">SimpleITK</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sitk</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sitkUtils</span>

<span class="c1"># Get input volume node</span>
<span class="n">inputVolumeNode</span> <span class="o">=</span> <span class="n">SampleData</span><span class="o">.</span><span class="n">SampleDataLogic</span><span class="p">()</span><span class="o">.</span><span class="n">downloadMRHead</span><span class="p">()</span>
<span class="c1"># Create new volume node for output</span>
<span class="n">outputVolumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLScalarVolumeNode&quot;</span><span class="p">,</span> <span class="s2">&quot;MRHeadFiltered&quot;</span><span class="p">)</span>

<span class="c1"># Run processing</span>
<span class="n">inputImage</span> <span class="o">=</span> <span class="n">sitkUtils</span><span class="o">.</span><span class="n">PullVolumeFromSlicer</span><span class="p">(</span><span class="n">inputVolumeNode</span><span class="p">)</span>
<span class="nb">filter</span> <span class="o">=</span> <span class="n">sitk</span><span class="o">.</span><span class="n">SignedMaurerDistanceMapImageFilter</span><span class="p">()</span>
<span class="n">outputImage</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">inputImage</span><span class="p">)</span>
<span class="n">sitkUtils</span><span class="o">.</span><span class="n">PushVolumeToSlicer</span><span class="p">(</span><span class="n">outputImage</span><span class="p">,</span> <span class="n">outputVolumeNode</span><span class="p">)</span>

<span class="c1"># Show processing result</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">setSliceViewerLayers</span><span class="p">(</span><span class="n">background</span><span class="o">=</span><span class="n">outputVolumeNode</span><span class="p">)</span>
</pre></div>
</div>
<p>More information:</p>
<ul class="simple">
<li><p>See the SimpleITK documentation for SimpleITK examples: <a class="reference external" href="https://simpleitk.org/doxygen/latest/html/examples.html">https://simpleitk.org/doxygen/latest/html/examples.html</a></p></li>
<li><p>sitkUtils in Slicer is used for pushing and pulling images from Slicer to SimpleITK: <a class="reference external" href="https://github.com/Slicer/Slicer/blob/main/Base/Python/sitkUtils.py">https://github.com/Slicer/Slicer/blob/main/Base/Python/sitkUtils.py</a></p></li>
</ul>
</section>
<section id="get-axial-slice-as-numpy-array">
<h3>Get axial slice as numpy array<a class="headerlink" href="#get-axial-slice-as-numpy-array" title="Link to this heading"></a></h3>
<p>An axis-aligned (axial/sagittal/coronal/) slices of a volume can be extracted using simple numpy array indexing. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">SampleData</span>
<span class="n">volumeNode</span> <span class="o">=</span> <span class="n">SampleData</span><span class="o">.</span><span class="n">SampleDataLogic</span><span class="p">()</span><span class="o">.</span><span class="n">downloadMRHead</span><span class="p">()</span>
<span class="n">sliceIndex</span> <span class="o">=</span> <span class="mi">12</span>

<span class="n">voxels</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromVolume</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">)</span>  <span class="c1"># Get volume as numpy array</span>
<span class="nb">slice</span> <span class="o">=</span> <span class="n">voxels</span><span class="p">[</span><span class="n">sliceIndex</span><span class="p">:,:]</span>  <span class="c1"># Get one slice of the volume as numpy array</span>
</pre></div>
</div>
</section>
<section id="get-reformatted-image-from-a-slice-viewer-as-numpy-array">
<h3>Get reformatted image from a slice viewer as numpy array<a class="headerlink" href="#get-reformatted-image-from-a-slice-viewer-as-numpy-array" title="Link to this heading"></a></h3>
<p>Set up <code class="docutils literal notranslate"><span class="pre">red</span></code> slice viewer to show thick slab reconstructed from 3 slices:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sliceNodeID</span> <span class="o">=</span> <span class="s2">&quot;vtkMRMLSliceNodeRed&quot;</span>

<span class="c1"># Get image data from slice view</span>
<span class="n">sliceNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetNodeByID</span><span class="p">(</span><span class="n">sliceNodeID</span><span class="p">)</span>
<span class="n">appLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">applicationLogic</span><span class="p">()</span>
<span class="n">sliceLogic</span> <span class="o">=</span> <span class="n">appLogic</span><span class="o">.</span><span class="n">GetSliceLogic</span><span class="p">(</span><span class="n">sliceNode</span><span class="p">)</span>
<span class="n">sliceLayerLogic</span> <span class="o">=</span> <span class="n">sliceLogic</span><span class="o">.</span><span class="n">GetBackgroundLayer</span><span class="p">()</span>
<span class="n">reslice</span> <span class="o">=</span> <span class="n">sliceLayerLogic</span><span class="o">.</span><span class="n">GetReslice</span><span class="p">()</span>
<span class="n">reslicedImage</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkImageData</span><span class="p">()</span>
<span class="n">reslicedImage</span><span class="o">.</span><span class="n">DeepCopy</span><span class="p">(</span><span class="n">reslice</span><span class="o">.</span><span class="n">GetOutput</span><span class="p">())</span>

<span class="c1"># Create new volume node using resliced image</span>
<span class="n">volumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLScalarVolumeNode&quot;</span><span class="p">)</span>
<span class="n">volumeNode</span><span class="o">.</span><span class="n">SetIJKToRASMatrix</span><span class="p">(</span><span class="n">sliceNode</span><span class="o">.</span><span class="n">GetXYToRAS</span><span class="p">())</span>
<span class="n">volumeNode</span><span class="o">.</span><span class="n">SetAndObserveImageData</span><span class="p">(</span><span class="n">reslicedImage</span><span class="p">)</span>
<span class="n">volumeNode</span><span class="o">.</span><span class="n">CreateDefaultDisplayNodes</span><span class="p">()</span>
<span class="n">volumeNode</span><span class="o">.</span><span class="n">CreateDefaultStorageNode</span><span class="p">()</span>

<span class="c1"># Get voxels as a numpy array</span>
<span class="n">voxels</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromVolume</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">voxels</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="combine-multiple-volumes-into-one">
<h3>Combine multiple volumes into one<a class="headerlink" href="#combine-multiple-volumes-into-one" title="Link to this heading"></a></h3>
<p>This example combines two volumes into a new one by subtracting one from the other.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">SampleData</span>
<span class="p">[</span><span class="n">input1Volume</span><span class="p">,</span> <span class="n">input2Volume</span><span class="p">]</span> <span class="o">=</span> <span class="n">SampleData</span><span class="o">.</span><span class="n">SampleDataLogic</span><span class="p">()</span><span class="o">.</span><span class="n">downloadDentalSurgery</span><span class="p">()</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">slicer.util</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromVolume</span><span class="p">(</span><span class="n">input1Volume</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromVolume</span><span class="p">(</span><span class="n">input2Volume</span><span class="p">)</span>

<span class="c1"># `a` and `b` are numpy arrays,</span>
<span class="c1"># they can be combined using any numpy array operations</span>
<span class="c1"># to produce the result array `c`</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a</span>

<span class="n">volumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">volumes</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">CloneVolume</span><span class="p">(</span><span class="n">input1Volume</span><span class="p">,</span> <span class="s2">&quot;Difference&quot;</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">updateVolumeFromArray</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<span class="n">setSliceViewerLayers</span><span class="p">(</span><span class="n">background</span><span class="o">=</span><span class="n">volumeNode</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="add-noise-to-image">
<h3>Add noise to image<a class="headerlink" href="#add-noise-to-image" title="Link to this heading"></a></h3>
<p>This example shows how to add simulated noise to a volume.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">SampleData</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># Get a sample input volume node</span>
<span class="n">volumeNode</span> <span class="o">=</span> <span class="n">SampleData</span><span class="o">.</span><span class="n">SampleDataLogic</span><span class="p">()</span><span class="o">.</span><span class="n">downloadMRHead</span><span class="p">()</span>

<span class="c1"># Get volume as numpy array and add noise</span>
<span class="n">voxels</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromVolume</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">)</span>
<span class="n">voxels</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">voxels</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">voxels</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromVolumeModified</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="mask-volume-using-segmentation">
<h3>Mask volume using segmentation<a class="headerlink" href="#mask-volume-using-segmentation" title="Link to this heading"></a></h3>
<p>This example shows how to blank out voxels of a volume outside all segments.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Input nodes</span>
<span class="n">volumeNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;MRHead&quot;</span><span class="p">)</span>
<span class="n">segmentationNode</span> <span class="o">=</span> <span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;Segmentation&quot;</span><span class="p">)</span>

<span class="c1"># Write segmentation to labelmap volume node with a geometry that matches the volume node</span>
<span class="n">labelmapVolumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLLabelMapVolumeNode&quot;</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">segmentations</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">ExportVisibleSegmentsToLabelmapNode</span><span class="p">(</span><span class="n">segmentationNode</span><span class="p">,</span> <span class="n">labelmapVolumeNode</span><span class="p">,</span> <span class="n">volumeNode</span><span class="p">)</span>

<span class="c1"># Masking</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">voxels</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromVolume</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">)</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">arrayFromVolume</span><span class="p">(</span><span class="n">labelmapVolumeNode</span><span class="p">)</span>
<span class="n">maskedVoxels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">voxels</span><span class="p">)</span>  <span class="c1"># we don&#39;t want to modify the original volume</span>
<span class="n">maskedVoxels</span><span class="p">[</span><span class="n">mask</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Write masked volume to volume node and show it</span>
<span class="n">maskedVolumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">volumes</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">CloneVolume</span><span class="p">(</span><span class="n">volumeNode</span><span class="p">,</span> <span class="s2">&quot;Masked&quot;</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">updateVolumeFromArray</span><span class="p">(</span><span class="n">maskedVolumeNode</span><span class="p">,</span> <span class="n">maskedVoxels</span><span class="p">)</span>
<span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">setSliceViewerLayers</span><span class="p">(</span><span class="n">maskedVolumeNode</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="apply-random-deformations-to-image">
<h3>Apply random deformations to image<a class="headerlink" href="#apply-random-deformations-to-image" title="Link to this heading"></a></h3>
<p>This example shows how to apply random translation, rotation, and deformations to a volume to simulate variation in patient positioning, soft tissue motion, and random anatomical variations. Control points are placed on a regularly spaced grid and then each control point is displaced by a random amount. Thin-plate spline transform is computed from the original and transformed point list.</p>
<p><a class="reference external" href="https://gist.github.com/lassoan/428af5285da75dc033d32ebff65ba940">https://gist.github.com/lassoan/428af5285da75dc033d32ebff65ba940</a></p>
</section>
<section id="thick-slab-reconstruction-and-maximum-minimum-intensity-volume-projections">
<h3>Thick slab reconstruction and maximum/minimum intensity volume projections<a class="headerlink" href="#thick-slab-reconstruction-and-maximum-minimum-intensity-volume-projections" title="Link to this heading"></a></h3>
<p>Set up <code class="docutils literal notranslate"><span class="pre">red</span></code> slice viewer to show thick slab reconstructed from 3 slices:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sliceNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetNodeByID</span><span class="p">(</span><span class="s2">&quot;vtkMRMLSliceNodeRed&quot;</span><span class="p">)</span>
<span class="n">appLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">applicationLogic</span><span class="p">()</span>
<span class="n">sliceLogic</span> <span class="o">=</span> <span class="n">appLogic</span><span class="o">.</span><span class="n">GetSliceLogic</span><span class="p">(</span><span class="n">sliceNode</span><span class="p">)</span>
<span class="n">sliceLayerLogic</span> <span class="o">=</span> <span class="n">sliceLogic</span><span class="o">.</span><span class="n">GetBackgroundLayer</span><span class="p">()</span>
<span class="n">reslice</span> <span class="o">=</span> <span class="n">sliceLayerLogic</span><span class="o">.</span><span class="n">GetReslice</span><span class="p">()</span>
<span class="n">reslice</span><span class="o">.</span><span class="n">SetSlabModeToMean</span><span class="p">()</span>
<span class="n">reslice</span><span class="o">.</span><span class="n">SetSlabNumberOfSlices</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># mean of 10 slices will computed</span>
<span class="n">reslice</span><span class="o">.</span><span class="n">SetSlabSliceSpacingFraction</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span> <span class="c1"># spacing between each slice is 0.3 pixel (total 10 * 0.3 = 3 pixel neighborhood)</span>
<span class="n">sliceNode</span><span class="o">.</span><span class="n">Modified</span><span class="p">()</span>
</pre></div>
</div>
<p>Set up <code class="docutils literal notranslate"><span class="pre">red</span></code> slice viewer to show maximum intensity projection (MIP):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sliceNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetNodeByID</span><span class="p">(</span><span class="s2">&quot;vtkMRMLSliceNodeRed&quot;</span><span class="p">)</span>
<span class="n">appLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">applicationLogic</span><span class="p">()</span>
<span class="n">sliceLogic</span> <span class="o">=</span> <span class="n">appLogic</span><span class="o">.</span><span class="n">GetSliceLogic</span><span class="p">(</span><span class="n">sliceNode</span><span class="p">)</span>
<span class="n">sliceLayerLogic</span> <span class="o">=</span> <span class="n">sliceLogic</span><span class="o">.</span><span class="n">GetBackgroundLayer</span><span class="p">()</span>
<span class="n">reslice</span> <span class="o">=</span> <span class="n">sliceLayerLogic</span><span class="o">.</span><span class="n">GetReslice</span><span class="p">()</span>
<span class="n">reslice</span><span class="o">.</span><span class="n">SetSlabModeToMax</span><span class="p">()</span>
<span class="n">reslice</span><span class="o">.</span><span class="n">SetSlabNumberOfSlices</span><span class="p">(</span><span class="mi">600</span><span class="p">)</span> <span class="c1"># use a large number of slices (600) to cover the entire volume</span>
<span class="n">reslice</span><span class="o">.</span><span class="n">SetSlabSliceSpacingFraction</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span> <span class="c1"># spacing between slices are 0.5 pixel (supersampling is useful to reduce interpolation artifacts)</span>
<span class="n">sliceNode</span><span class="o">.</span><span class="n">Modified</span><span class="p">()</span>
</pre></div>
</div>
<p>The projected image is available in a <code class="docutils literal notranslate"><span class="pre">vtkImageData</span></code> object by calling <code class="docutils literal notranslate"><span class="pre">reslice.GetOutput()</span></code>.</p>
</section>
<section id="display-volume-using-volume-rendering">
<h3>Display volume using volume rendering<a class="headerlink" href="#display-volume-using-volume-rendering" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>  <span class="n">logic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">volumerendering</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span>
  <span class="n">volumeNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">GetNodeByID</span><span class="p">(</span><span class="s1">&#39;vtkMRMLScalarVolumeNode1&#39;</span><span class="p">)</span>
  <span class="n">displayNode</span> <span class="o">=</span> <span class="n">logic</span><span class="o">.</span><span class="n">CreateVolumeRenderingDisplayNode</span><span class="p">()</span>
  <span class="n">displayNode</span><span class="o">.</span><span class="n">UnRegister</span><span class="p">(</span><span class="n">logic</span><span class="p">)</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNode</span><span class="p">(</span><span class="n">displayNode</span><span class="p">)</span>
  <span class="n">volumeNode</span><span class="o">.</span><span class="n">AddAndObserveDisplayNodeID</span><span class="p">(</span><span class="n">displayNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
  <span class="n">logic</span><span class="o">.</span><span class="n">UpdateDisplayNodeFromVolumeNode</span><span class="p">(</span><span class="n">displayNode</span><span class="p">,</span> <span class="n">volumeNode</span><span class="p">)</span>
</pre></div>
</div>
<p>C++:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">qSlicerAbstractCoreModule</span><span class="o">*</span><span class="w"> </span><span class="n">volumeRenderingModule</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="n">qSlicerCoreApplication</span><span class="o">::</span><span class="n">application</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">moduleManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="k">module</span><span class="p">(</span><span class="s">&quot;VolumeRendering&quot;</span><span class="p">);</span>
<span class="n">vtkSlicerVolumeRenderingLogic</span><span class="o">*</span><span class="w"> </span><span class="n">volumeRenderingLogic</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="n">volumeRenderingModule</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">vtkSlicerVolumeRenderingLogic</span><span class="o">::</span><span class="n">SafeDownCast</span><span class="p">(</span><span class="n">volumeRenderingModule</span><span class="o">-&gt;</span><span class="n">logic</span><span class="p">())</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">vtkMRMLVolumeNode</span><span class="o">*</span><span class="w"> </span><span class="n">volumeNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mrmlScene</span><span class="o">-&gt;</span><span class="n">GetNodeByID</span><span class="p">(</span><span class="s">&quot;vtkMRMLScalarVolumeNode1&quot;</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">volumeRenderingLogic</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">  </span><span class="n">vtkSmartPointer</span><span class="o">&lt;</span><span class="n">vtkMRMLVolumeRenderingDisplayNode</span><span class="o">&gt;</span><span class="w"> </span><span class="n">displayNode</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">vtkSmartPointer</span><span class="o">&lt;</span><span class="n">vtkMRMLVolumeRenderingDisplayNode</span><span class="o">&gt;::</span><span class="n">Take</span><span class="p">(</span><span class="n">volumeRenderingLogic</span><span class="o">-&gt;</span><span class="n">CreateVolumeRenderingDisplayNode</span><span class="p">());</span>
<span class="w">  </span><span class="n">mrmlScene</span><span class="o">-&gt;</span><span class="n">AddNode</span><span class="p">(</span><span class="n">displayNode</span><span class="p">);</span>
<span class="w">  </span><span class="n">volumeNode</span><span class="o">-&gt;</span><span class="n">AddAndObserveDisplayNodeID</span><span class="p">(</span><span class="n">displayNode</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">());</span>
<span class="w">  </span><span class="n">volumeRenderingLogic</span><span class="o">-&gt;</span><span class="n">UpdateDisplayNodeFromVolumeNode</span><span class="p">(</span><span class="n">displayNode</span><span class="p">,</span><span class="w"> </span><span class="n">volumeNode</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="apply-a-custom-volume-rendering-color-opacity-transfer-function">
<h3>Apply a custom volume rendering color/opacity transfer function<a class="headerlink" href="#apply-a-custom-volume-rendering-color-opacity-transfer-function" title="Link to this heading"></a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">vtkColorTransferFunction</span><span class="o">*</span><span class="w"> </span><span class="n">colors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span>
<span class="n">vtkPiecewiseFunction</span><span class="o">*</span><span class="w"> </span><span class="n">opacities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span>
<span class="n">vtkMRMLVolumeRenderingDisplayNode</span><span class="o">*</span><span class="w"> </span><span class="n">displayNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span>
<span class="n">vtkMRMLVolumePropertyNode</span><span class="o">*</span><span class="w"> </span><span class="n">propertyNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">displayNode</span><span class="o">-&gt;</span><span class="n">GetVolumePropertyNode</span><span class="p">();</span>
<span class="n">propertyNode</span><span class="o">-&gt;</span><span class="n">SetColor</span><span class="p">(</span><span class="n">colorTransferFunction</span><span class="p">);</span>
<span class="n">propertyNode</span><span class="o">-&gt;</span><span class="n">SetScalarOpacity</span><span class="p">(</span><span class="n">opacities</span><span class="p">);</span>
<span class="c1">// optionally set the gradients opacities with SetGradientOpacity</span>
</pre></div>
</div>
<p>Volume rendering logic has utility functions to help you create those transfer functions: <a class="reference external" href="https://apidocs.slicer.org/main/classvtkSlicerVolumeRenderingLogic.html#a3436ef769a321ff287d58f17118e8550">SetWindowLevelToVolumeProp</a>, <a class="reference external" href="https://apidocs.slicer.org/main/classvtkSlicerVolumeRenderingLogic.html#a1dcbe614493f3cbb9aa50c68a64764ca">SetThresholdToVolumeProp</a>, <a class="reference external" href="https://apidocs.slicer.org/main/classvtkSlicerVolumeRenderingLogic.html#a359314889c2b386fd4c3ffe5414522da">SetLabelMapToVolumeProp</a>.</p>
</section>
<section id="limit-volume-rendering-to-a-specific-region-of-the-volume">
<h3>Limit volume rendering to a specific region of the volume<a class="headerlink" href="#limit-volume-rendering-to-a-specific-region-of-the-volume" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">displayNode</span><span class="o">.</span><span class="n">SetAndObserveROINodeID</span><span class="p">(</span><span class="n">roiNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
<span class="n">displayNode</span><span class="o">.</span><span class="n">CroppingEnabled</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>C++:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">vtkMRMLMarkupsROINode</span><span class="o">*</span><span class="w"> </span><span class="n">roiNode</span><span class="w"> </span><span class="o">=</span><span class="p">...</span>
<span class="n">vtkMRMLVolumeRenderingDisplayNode</span><span class="o">*</span><span class="w"> </span><span class="n">displayNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span>
<span class="n">displayNode</span><span class="o">-&gt;</span><span class="n">SetAndObserveROINodeID</span><span class="p">(</span><span class="n">roiNode</span><span class="o">-&gt;</span><span class="n">GetID</span><span class="p">());</span>
<span class="n">displayNode</span><span class="o">-&gt;</span><span class="n">SetCroppingEnabled</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="register-a-new-volume-rendering-mapper">
<h3>Register a new Volume Rendering mapper<a class="headerlink" href="#register-a-new-volume-rendering-mapper" title="Link to this heading"></a></h3>
<p>You need to derive from <a class="reference external" href="https://apidocs.slicer.org/main/classvtkMRMLVolumeRenderingDisplayNode.html#">vtkMRMLVolumeRenderingDisplayNode</a> and register your class within <a class="reference external" href="https://apidocs.slicer.org/main/classvtkSlicerVolumeRenderingLogic.html#">vtkSlicerVolumeRenderingLogic</a>.</p>
<p>C++:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">qSlicerMyABCVolumeRenderingModule::setup</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">vtkMRMLThreeDViewDisplayableManagerFactory</span><span class="o">::</span><span class="n">GetInstance</span><span class="p">()</span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">RegisterDisplayableManager</span><span class="p">(</span><span class="s">&quot;vtkMRMLMyABCVolumeRenderingDisplayableManager&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Superclass</span><span class="o">::</span><span class="n">setup</span><span class="p">();</span>

<span class="w">  </span><span class="n">qSlicerAbstractCoreModule</span><span class="o">*</span><span class="w"> </span><span class="n">volumeRenderingModule</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">qSlicerCoreApplication</span><span class="o">::</span><span class="n">application</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">moduleManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="k">module</span><span class="p">(</span><span class="s">&quot;VolumeRendering&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">volumeRenderingModule</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">    </span><span class="n">vtkNew</span><span class="o">&lt;</span><span class="n">vtkMRMLMyABCVolumeRenderingDisplayNode</span><span class="o">&gt;</span><span class="w"> </span><span class="n">displayNode</span><span class="p">;</span>
<span class="w">    </span><span class="n">vtkSlicerVolumeRenderingLogic</span><span class="o">*</span><span class="w"> </span><span class="n">volumeRenderingLogic</span><span class="w"> </span><span class="o">=</span>
<span class="w">      </span><span class="n">vtkSlicerVolumeRenderingLogic</span><span class="o">::</span><span class="n">SafeDownCast</span><span class="p">(</span><span class="n">volumeRenderingModule</span><span class="o">-&gt;</span><span class="n">logic</span><span class="p">());</span>
<span class="w">    </span><span class="n">volumeRenderingLogic</span><span class="o">-&gt;</span><span class="n">RegisterRenderingMethod</span><span class="p">(</span>
<span class="w">      </span><span class="s">&quot;My ABC Volume Rendering&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">displayNode</span><span class="o">-&gt;</span><span class="n">GetClassName</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="k">else</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">    </span><span class="n">qWarning</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Volume Rendering module is not found&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you want to expose control widgets for your volume rendering method, then register your widget with <a class="reference external" href="https://apidocs.slicer.org/main/classqSlicerVolumeRenderingModuleWidget.html#acd9cdb60f1fd260f3ebf74428bb7c45b">addRenderingMethodWidget()</a>.</p>
</section>
<section id="register-custom-volume-rendering-presets">
<h3>Register custom volume rendering presets<a class="headerlink" href="#register-custom-volume-rendering-presets" title="Link to this heading"></a></h3>
<p>Custom presets can be added to the volume rendering module by calling AddPreset() method of the volume rendering module logic. The example below shows how to define multiple custom volume rendering presets in an external MRML scene file and add them to the volume rendering module user interface.</p>
<p>Create a <em>MyPresets.mrml</em> file that describes two custom volume rendering presets:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;MRML</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;Slicer4.4.0&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;VolumeProperty</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;vtkMRMLVolumeProperty1&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;MyPreset1&quot;</span><span class="w">     </span><span class="na">references=</span><span class="s">&quot;IconVolume:vtkMRMLVectorVolumeNode1;&quot;</span><span class="w"> </span><span class="na">interpolation=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">shade=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">diffuse=</span><span class="s">&quot;0.66&quot;</span><span class="w"> </span><span class="na">ambient=</span><span class="s">&quot;0.1&quot;</span><span class="w"> </span><span class="na">specular=</span><span class="s">&quot;0.62&quot;</span><span class="w"> </span><span class="na">specularPower=</span><span class="s">&quot;14&quot;</span><span class="w"> </span><span class="na">scalarOpacity=</span><span class="s">&quot;10 -3.52844023704529 0 56.7852325439453 0 79.2550277709961 0.428571432828903 415.119384765625 1 641 1&quot;</span><span class="w"> </span><span class="na">gradientOpacity=</span><span class="s">&quot;4 0 1 160.25 1&quot;</span><span class="w"> </span><span class="na">colorTransfer=</span><span class="s">&quot;16 0 0 0 0 98.7223 0.196078431372549 0.945098039215686 0.956862745098039 412.406 0 0.592157 0.807843 641 1 1 1&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;VectorVolume</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;vtkMRMLVectorVolumeNode1&quot;</span><span class="w"> </span><span class="na">references=</span><span class="s">&quot;storage:vtkMRMLVolumeArchetypeStorageNode1;&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;VolumeArchetypeStorage</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;vtkMRMLVolumeArchetypeStorageNode1&quot;</span><span class="w"> </span><span class="na">fileName=</span><span class="s">&quot;MyPreset1.png&quot;</span><span class="w">  </span><span class="na">fileListMember0=</span><span class="s">&quot;MyPreset1.png&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="nt">&lt;VolumeProperty</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;vtkMRMLVolumeProperty2&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;MyPreset2&quot;</span><span class="w">     </span><span class="na">references=</span><span class="s">&quot;IconVolume:vtkMRMLVectorVolumeNode2;&quot;</span><span class="w"> </span><span class="na">interpolation=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">shade=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">diffuse=</span><span class="s">&quot;0.66&quot;</span><span class="w"> </span><span class="na">ambient=</span><span class="s">&quot;0.1&quot;</span><span class="w"> </span><span class="na">specular=</span><span class="s">&quot;0.62&quot;</span><span class="w"> </span><span class="na">specularPower=</span><span class="s">&quot;14&quot;</span><span class="w"> </span><span class="na">scalarOpacity=</span><span class="s">&quot;10 -3.52844023704529 0 56.7852325439453 0 79.2550277709961 0.428571432828903 415.119384765625 1 641 1&quot;</span><span class="w"> </span><span class="na">gradientOpacity=</span><span class="s">&quot;4 0 1 160.25 1&quot;</span><span class="w"> </span><span class="na">colorTransfer=</span><span class="s">&quot;16 0 0 0 0 98.7223 0.196078431372549 0.945098039215686 0.956862745098039 412.406 0 0.592157 0.807843 641 1 1 1&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;VectorVolume</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;vtkMRMLVectorVolumeNode2&quot;</span><span class="w"> </span><span class="na">references=</span><span class="s">&quot;storage:vtkMRMLVolumeArchetypeStorageNode2;&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;VolumeArchetypeStorage</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;vtkMRMLVolumeArchetypeStorageNode2&quot;</span><span class="w"> </span><span class="na">fileName=</span><span class="s">&quot;MyPreset2.png&quot;</span><span class="w">  </span><span class="na">fileListMember0=</span><span class="s">&quot;MyPreset2.png&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/MRML&gt;</span>
</pre></div>
</div>
<p>For this example, thumbnail images for the presets should be located in the same directory as <code class="docutils literal notranslate"><span class="pre">MyPresets.mrml</span></code>, with the file names <code class="docutils literal notranslate"><span class="pre">MyPreset1.png</span></code> and <code class="docutils literal notranslate"><span class="pre">MyPreset2.png</span></code>.</p>
<p>Use the following code to read all the custom presets from <em>MyPresets.mrml</em> and load it into the scene:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">presetsScenePath</span> <span class="o">=</span> <span class="s2">&quot;MyPresets.mrml&quot;</span>

<span class="c1"># Read presets scene</span>
<span class="n">customPresetsScene</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLScene</span><span class="p">()</span>
<span class="n">vrPropNode</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkMRMLVolumePropertyNode</span><span class="p">()</span>
<span class="n">customPresetsScene</span><span class="o">.</span><span class="n">RegisterNodeClass</span><span class="p">(</span><span class="n">vrPropNode</span><span class="p">)</span>
<span class="n">customPresetsScene</span><span class="o">.</span><span class="n">SetURL</span><span class="p">(</span><span class="n">presetsScenePath</span><span class="p">)</span>
<span class="n">customPresetsScene</span><span class="o">.</span><span class="n">Connect</span><span class="p">()</span>

<span class="c1"># Add presets to volume rendering logic</span>
<span class="n">vrLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">volumerendering</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span>
<span class="n">presetsScene</span> <span class="o">=</span> <span class="n">vrLogic</span><span class="o">.</span><span class="n">GetPresetsScene</span><span class="p">()</span>
<span class="n">vrNodes</span> <span class="o">=</span> <span class="n">customPresetsScene</span><span class="o">.</span><span class="n">GetNodesByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLVolumePropertyNode&quot;</span><span class="p">)</span>
<span class="n">vrNodes</span><span class="o">.</span><span class="n">UnRegister</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="k">for</span> <span class="n">itemNum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vrNodes</span><span class="o">.</span><span class="n">GetNumberOfItems</span><span class="p">()):</span>
  <span class="n">node</span> <span class="o">=</span> <span class="n">vrNodes</span><span class="o">.</span><span class="n">GetItemAsObject</span><span class="p">(</span><span class="n">itemNum</span><span class="p">)</span>
  <span class="n">vrLogic</span><span class="o">.</span><span class="n">AddPreset</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="batch-processing">
<h2>Batch processing<a class="headerlink" href="#batch-processing" title="Link to this heading"></a></h2>
<section id="iterate-through-dicom-series">
<h3>Iterate through dicom series<a class="headerlink" href="#iterate-through-dicom-series" title="Link to this heading"></a></h3>
<p>This examples shows how to perform an operation on each
series in the dicom database.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">db</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">dicomDatabase</span>
<span class="n">patients</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">patients</span><span class="p">()</span>
<span class="n">patientCount</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">patient</span> <span class="ow">in</span> <span class="n">patients</span><span class="p">:</span>
  <span class="n">patientCount</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Patient </span><span class="si">{</span><span class="n">patient</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">patientCount</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">patients</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">study</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">studiesForPatient</span><span class="p">(</span><span class="n">patient</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Study </span><span class="si">{</span><span class="n">study</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">series</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">seriesForStudy</span><span class="p">(</span><span class="n">study</span><span class="p">):</span>
      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Series </span><span class="si">{</span><span class="n">series</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
      <span class="n">temporaryDir</span> <span class="o">=</span> <span class="n">qt</span><span class="o">.</span><span class="n">QTemporaryDir</span><span class="p">()</span>
      <span class="k">for</span> <span class="n">instanceUID</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">instancesForSeries</span><span class="p">(</span><span class="n">series</span><span class="p">):</span>
        <span class="n">qt</span><span class="o">.</span><span class="n">QFile</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">fileForInstance</span><span class="p">(</span><span class="n">instanceUID</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">temporaryDir</span><span class="o">.</span><span class="n">path</span><span class="p">()</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">instanceUID</span><span class="si">}</span><span class="s2">.dcm&quot;</span><span class="p">)</span>
      <span class="n">patientID</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">dicomDatabase</span><span class="o">.</span><span class="n">instanceValue</span><span class="p">(</span><span class="n">instanceUID</span><span class="p">,</span> <span class="s1">&#39;0010,0020&#39;</span><span class="p">)</span>
      <span class="n">outputPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">convertedPath</span><span class="p">,</span> <span class="n">patientID</span><span class="p">,</span> <span class="n">study</span><span class="p">,</span> <span class="n">series</span><span class="p">,</span> <span class="s2">&quot;BatchResult&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outputPath</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outputPath</span><span class="p">)</span>
      <span class="c1"># do an operation here that processes the series into the outputPath</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It can be helpful for debugging to include a comment with python commands
that can be pasted into the console to run the script.  With this approach
any global variables, such as vtk class instances, defined in the script will exist after the script runs
and you can easily inspect them or call methods on them.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">filePath = &quot;/data/myscript.py&quot;</span>

<span class="sd">exec(open(filePath).read())</span>

<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</section>
<section id="extracting-volume-patches-around-segments">
<h3>Extracting volume patches around segments<a class="headerlink" href="#extracting-volume-patches-around-segments" title="Link to this heading"></a></h3>
<p>For machine learning apps, such as <a class="reference external" href="https://docs.monai.io/projects/label/en/latest/index.html">MONAI Label</a>
it can be helpful to reduce the size of the problem by
extracting out subsets of data.  This example shows how to iterate through
a directory of segmentations, compute their bounding boxes, and save out
new volumes and segmentations centered around the segmentation.</p>
<p>Here the ROI is aligned with the volume.  See <a class="reference internal" href="#segmentations"><span class="std std-ref">Segmentations</span></a> for
examples using oriented bounding boxes and other options.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="k">def</span><span class="w"> </span><span class="nf">segROI</span><span class="p">(</span><span class="n">segmentationNode</span><span class="p">):</span>
  <span class="c1"># Compute bounding boxes</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">SegmentStatistics</span>
  <span class="n">segStatLogic</span> <span class="o">=</span> <span class="n">SegmentStatistics</span><span class="o">.</span><span class="n">SegmentStatisticsLogic</span><span class="p">()</span>
  <span class="n">segStatLogic</span><span class="o">.</span><span class="n">getParameterNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetParameter</span><span class="p">(</span><span class="s2">&quot;Segmentation&quot;</span><span class="p">,</span> <span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
  <span class="n">segStatLogic</span><span class="o">.</span><span class="n">getParameterNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetParameter</span><span class="p">(</span><span class="s2">&quot;LabelmapSegmentStatisticsPlugin.obb_origin_ras.enabled&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
  <span class="n">segStatLogic</span><span class="o">.</span><span class="n">getParameterNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetParameter</span><span class="p">(</span><span class="s2">&quot;LabelmapSegmentStatisticsPlugin.obb_diameter_mm.enabled&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
  <span class="n">segStatLogic</span><span class="o">.</span><span class="n">getParameterNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetParameter</span><span class="p">(</span><span class="s2">&quot;LabelmapSegmentStatisticsPlugin.obb_direction_ras_x.enabled&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
  <span class="n">segStatLogic</span><span class="o">.</span><span class="n">getParameterNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetParameter</span><span class="p">(</span><span class="s2">&quot;LabelmapSegmentStatisticsPlugin.obb_direction_ras_y.enabled&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
  <span class="n">segStatLogic</span><span class="o">.</span><span class="n">getParameterNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetParameter</span><span class="p">(</span><span class="s2">&quot;LabelmapSegmentStatisticsPlugin.obb_direction_ras_z.enabled&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
  <span class="n">segStatLogic</span><span class="o">.</span><span class="n">computeStatistics</span><span class="p">()</span>
  <span class="n">stats</span> <span class="o">=</span> <span class="n">segStatLogic</span><span class="o">.</span><span class="n">getStatistics</span><span class="p">()</span>

  <span class="c1"># Draw ROI for each oriented bounding box</span>
  <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
  <span class="k">for</span> <span class="n">segmentId</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;SegmentIDs&quot;</span><span class="p">]:</span>
    <span class="c1"># Get bounding box</span>
    <span class="n">obb_origin_ras</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="n">segmentId</span><span class="p">,</span><span class="s2">&quot;LabelmapSegmentStatisticsPlugin.obb_origin_ras&quot;</span><span class="p">])</span>
    <span class="n">obb_diameter_mm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="n">segmentId</span><span class="p">,</span><span class="s2">&quot;LabelmapSegmentStatisticsPlugin.obb_diameter_mm&quot;</span><span class="p">])</span>
    <span class="n">obb_direction_ras_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="n">segmentId</span><span class="p">,</span><span class="s2">&quot;LabelmapSegmentStatisticsPlugin.obb_direction_ras_x&quot;</span><span class="p">])</span>
    <span class="n">obb_direction_ras_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="n">segmentId</span><span class="p">,</span><span class="s2">&quot;LabelmapSegmentStatisticsPlugin.obb_direction_ras_y&quot;</span><span class="p">])</span>
    <span class="n">obb_direction_ras_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="n">segmentId</span><span class="p">,</span><span class="s2">&quot;LabelmapSegmentStatisticsPlugin.obb_direction_ras_z&quot;</span><span class="p">])</span>
    <span class="c1"># Create ROI</span>
    <span class="n">segment</span> <span class="o">=</span> <span class="n">segmentationNode</span><span class="o">.</span><span class="n">GetSegmentation</span><span class="p">()</span><span class="o">.</span><span class="n">GetSegment</span><span class="p">(</span><span class="n">segmentId</span><span class="p">)</span>
    <span class="n">roi</span><span class="o">=</span><span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLMarkupsROINode&quot;</span><span class="p">)</span>
    <span class="n">roi</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; OBB&quot;</span><span class="p">)</span>
    <span class="n">roi</span><span class="o">.</span><span class="n">GetDisplayNode</span><span class="p">()</span><span class="o">.</span><span class="n">SetHandlesInteractive</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># do not let the user resize the box</span>
    <span class="n">roi</span><span class="o">.</span><span class="n">SetSize</span><span class="p">(</span><span class="n">obb_diameter_mm</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># make the ROI twice the size of the segmentation</span>
    <span class="c1"># Position and orient ROI using a transform</span>
    <span class="n">obb_center_ras</span> <span class="o">=</span> <span class="n">obb_origin_ras</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">obb_diameter_mm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">obb_direction_ras_x</span> <span class="o">+</span> <span class="n">obb_diameter_mm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">obb_direction_ras_y</span> <span class="o">+</span> <span class="n">obb_diameter_mm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">obb_direction_ras_z</span><span class="p">)</span>
    <span class="n">boundingBoxToRasTransform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">row_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">obb_center_ras</span><span class="p">)),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="n">boundingBoxToRasTransformMatrix</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">vtkMatrixFromArray</span><span class="p">(</span><span class="n">boundingBoxToRasTransform</span><span class="p">)</span>
    <span class="n">roi</span><span class="o">.</span><span class="n">SetAndObserveObjectToNodeMatrix</span><span class="p">(</span><span class="n">boundingBoxToRasTransformMatrix</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">roi</span>

<span class="n">labelFiles</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;/data/imagesTr/labels/final/*.nii.gz&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">labelFile</span> <span class="ow">in</span> <span class="n">labelFiles</span><span class="p">:</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">Clear</span><span class="p">()</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">labelFile</span><span class="p">)</span>
  <span class="n">baseName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">labelFile</span><span class="p">)</span>
  <span class="n">ctFile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;/data/imagesTr&quot;</span><span class="p">,</span> <span class="n">baseName</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">ctFile</span><span class="p">)</span>
  <span class="n">ct</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">loadVolume</span><span class="p">(</span><span class="n">ctFile</span><span class="p">)</span>
  <span class="n">seg</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">loadSegmentation</span><span class="p">(</span><span class="n">labelFile</span><span class="p">)</span>
  <span class="n">roi</span> <span class="o">=</span> <span class="n">segROI</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span>
  <span class="n">cropVolumeParameters</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLCropVolumeParametersNode&quot;</span><span class="p">)</span>
  <span class="n">cropVolumeParameters</span><span class="o">.</span><span class="n">SetInputVolumeNodeID</span><span class="p">(</span><span class="n">ct</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
  <span class="n">cropVolumeParameters</span><span class="o">.</span><span class="n">SetROINodeID</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">GetID</span><span class="p">())</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">cropvolume</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span><span class="o">.</span><span class="n">Apply</span><span class="p">(</span><span class="n">cropVolumeParameters</span><span class="p">)</span>
  <span class="n">croppedCT</span> <span class="o">=</span> <span class="n">cropVolumeParameters</span><span class="o">.</span><span class="n">GetOutputVolumeNode</span><span class="p">()</span>
  <span class="n">seg</span><span class="o">.</span><span class="n">SetReferenceImageGeometryParameterFromVolumeNode</span><span class="p">(</span><span class="n">croppedCT</span><span class="p">)</span>
  <span class="n">segLogic</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">segmentations</span><span class="o">.</span><span class="n">logic</span><span class="p">()</span>
  <span class="n">labelmap</span> <span class="o">=</span> <span class="n">slicer</span><span class="o">.</span><span class="n">mrmlScene</span><span class="o">.</span><span class="n">AddNewNodeByClass</span><span class="p">(</span><span class="s2">&quot;vtkMRMLLabelMapVolumeNode&quot;</span><span class="p">)</span>
  <span class="n">segLogic</span><span class="o">.</span><span class="n">ExportAllSegmentsToLabelmapNode</span><span class="p">(</span><span class="n">seg</span><span class="p">,</span> <span class="n">labelmap</span><span class="p">,</span> <span class="n">slicer</span><span class="o">.</span><span class="n">vtkSegmentation</span><span class="o">.</span><span class="n">EXTENT_REFERENCE_GEOMETRY</span><span class="p">)</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">saveNode</span><span class="p">(</span><span class="n">croppedCT</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/data/crops/</span><span class="si">{</span><span class="n">baseName</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">saveNode</span><span class="p">(</span><span class="n">labelmap</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/data/crops/labels/final/</span><span class="si">{</span><span class="n">baseName</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="n">slicer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span> <span class="c1"># to watch progress</span>
</pre></div>
</div>
</section>
</section>
<section id="webserver">
<h2>WebServer<a class="headerlink" href="#webserver" title="Link to this heading"></a></h2>
<section id="create-a-custom-web-server-instance-to-serve-static-content">
<h3>Create a custom web server instance to serve static content<a class="headerlink" href="#create-a-custom-web-server-instance-to-serve-static-content" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">WebServer</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">WebServerLib</span>
<span class="c1"># serve content from the temp directory on port 9916 and print all messages</span>
<span class="n">handler</span> <span class="o">=</span> <span class="n">WebServerLib</span><span class="o">.</span><span class="n">StaticPagesRequestHandler</span><span class="p">(</span><span class="n">docroot</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;/tmp&quot;</span><span class="p">,</span> <span class="n">logMessage</span><span class="o">=</span><span class="nb">print</span><span class="p">)</span>
<span class="n">logic</span> <span class="o">=</span> <span class="n">WebServer</span><span class="o">.</span><span class="n">WebServerLogic</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">9916</span><span class="p">,</span> <span class="n">requestHandlers</span><span class="o">=</span><span class="p">[</span><span class="n">handler</span><span class="p">],</span> <span class="n">logMessage</span><span class="o">=</span><span class="nb">print</span><span class="p">)</span>
<span class="n">logic</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Open &#39;http://localhost:</span><span class="si">{</span><span class="n">logic</span><span class="o">.</span><span class="n">port</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
<span class="c1"># stop later with logic.stop()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Hosting web content is a complex topic, with security implications.  Use this feature
with caution.  It’s best to use this only on a trusted network.</p>
</div>
</section>
<section id="create-a-custom-web-server-to-handle-request-endpoints">
<h3>Create a custom web server to handle request endpoints<a class="headerlink" href="#create-a-custom-web-server-to-handle-request-endpoints" title="Link to this heading"></a></h3>
<p>See the WebServerLib for more complete examples.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">urllib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">WebServer</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">WebServerLib</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ExampleRequestHandler</span><span class="p">(</span><span class="n">WebServerLib</span><span class="o">.</span><span class="n">BaseRequestHandler</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logMessage</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a new Example request handler instance.</span>
<span class="sd">        :param logMessage: An optional external handle for message logging.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logMessage</span> <span class="o">=</span> <span class="n">logMessage</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">canHandleRequest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Whether the given request is a Example request.</span>
<span class="sd">        :param uri: The request URI to parse.</span>
<span class="sd">        :return: 0.5 confidence if the request is an Example request, else 0.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parsedURL</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="k">if</span> <span class="n">parsedURL</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;/example&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="mf">0.0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handleRequest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">uri</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">requestBody</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dispatches various example requests.</span>
<span class="sd">        :param method: The HTTP request method. &#39;GET&#39;, &#39;POST&#39;, etc.</span>
<span class="sd">        :param uri: The request URI to parse.</span>
<span class="sd">        :param requestBody: the binary that came with the request</span>
<span class="sd">        :return: tuple of content type (based on file ext) and request body binary (contents of file)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parsedURL</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
        <span class="n">contentType</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;text/plain&quot;</span>
        <span class="n">responseBody</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">splitPath</span> <span class="o">=</span> <span class="n">parsedURL</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">splitPath</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">splitPath</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;ping&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logMessage</span><span class="p">(</span><span class="s2">&quot;handling collections&quot;</span><span class="p">)</span>
            <span class="n">responseBody</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;pong&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logMessage</span><span class="p">(</span><span class="s2">&quot;Unhandled Example request path: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">parsedURL</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="n">responseBody</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;Unhandled Example request path&quot;</span>

        <span class="k">return</span> <span class="n">contentType</span><span class="p">,</span> <span class="n">responseBody</span>

<span class="c1"># create a server with a custom handler class - here it does nothing, but it</span>
<span class="c1"># can access and use anything from the Slicer python environment</span>
<span class="n">PORT</span> <span class="o">=</span> <span class="mi">2042</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">WebServer</span>
<span class="n">logMessage</span> <span class="o">=</span> <span class="n">WebServer</span><span class="o">.</span><span class="n">WebServerLogic</span><span class="o">.</span><span class="n">defaultLogMessage</span>
<span class="n">requestHandlers</span> <span class="o">=</span> <span class="p">[</span><span class="n">ExampleRequestHandler</span><span class="p">()]</span>
<span class="n">logic</span> <span class="o">=</span> <span class="n">WebServer</span><span class="o">.</span><span class="n">WebServerLogic</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="n">PORT</span><span class="p">,</span> <span class="n">logMessage</span><span class="o">=</span><span class="n">logMessage</span><span class="p">,</span> <span class="n">enableSlicer</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">enableStaticPages</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">enableDICOM</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">requestHandlers</span><span class="o">=</span><span class="n">requestHandlers</span><span class="p">)</span>

<span class="n">logic</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Open &#39;http://localhost:</span><span class="si">{</span><span class="n">logic</span><span class="o">.</span><span class="n">port</span><span class="si">}</span><span class="s2">/example/ping&#39;&quot;</span><span class="p">)</span>
<span class="c1"># stop later with logic.stop()</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="python_faq.html" class="btn btn-neutral float-left" title="Python FAQ" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="build_instructions/index.html" class="btn btn-neutral float-right" title="Build Instructions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Slicer Community.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>